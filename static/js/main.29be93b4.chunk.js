(this.webpackJsonpfrontend=this.webpackJsonpfrontend||[]).push([[0],{10:function(e,t,s){"use strict";s.d(t,"d",(function(){return o})),s.d(t,"e",(function(){return c})),s.d(t,"b",(function(){return l})),s.d(t,"c",(function(){return d})),s.d(t,"a",(function(){return u}));var a=s(42),n=s(63),i=s(103);const r=a.ab.create({position:n.a.TOP}),o=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:2e3,s=arguments.length>2?arguments[2]:void 0;return r.show({intent:i.a.SUCCESS,message:e,timeout:t},s)},c=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:2e3,s=arguments.length>2?arguments[2]:void 0;return r.show({intent:i.a.WARNING,message:e,timeout:t},s)},l=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:2e3,s=arguments.length>2?arguments[2]:void 0;return r.show({intent:i.a.DANGER,message:e,timeout:t},s)},d=(e,t)=>r.show(e,t),u=e=>r.dismiss(e)},101:function(e,t,s){"use strict";s.d(t,"i",(function(){return u})),s.d(t,"f",(function(){return h})),s.d(t,"g",(function(){return p})),s.d(t,"a",(function(){return m})),s.d(t,"h",(function(){return b})),s.d(t,"c",(function(){return j})),s.d(t,"e",(function(){return y})),s.d(t,"d",(function(){return O})),s.d(t,"b",(function(){return f}));var a=s(33),n=s(277),i=s.n(n),r=s(27),o=s(100),c=s(174),l=s(216),d=s(299);function u(e){let{context:t}=e;try{c.a.drawEnv(t)}catch(s){throw new Error("Env visualizer is not enabled")}}function h(){if(!window.Inspector)throw new Error("Inspector not loaded");window.Inspector.highlightClean()}function p(e){if(!window.Inspector)throw new Error("Inspector not loaded");window.Inspector.highlightLine(e)}const g={display:function e(t,s,a){return e((void 0===s?"":s+" ")+Object(o.stringify)(t),"",a),t},rawDisplay:function(e,t,s){const a=(void 0===t?"":t+" ")+String(e);return d.a.push(a,s),e},prompt:function(e){return prompt(e)},alert:function(e){alert(Object(o.stringify)(e))},visualiseList:function(){try{for(var e=arguments.length,t=new Array(e),s=0;s<e;s++)t[s]=arguments[s];return l.a.drawData(t[0]),1===t[0].length?t[0][0]:t[0]}catch(a){throw console.log(a),new Error("Data visualizer is not enabled")}}};function m(e,t){let s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:r.Variant.DEFAULT;return i()(s,e,t,g)}function b(e){function t(){}t.prototype=e.runtime.environments[0].head;const s=new t,a=new Proxy(e.runtime.environments[0],{get:(e,t,a)=>"head"===t?s:e[t]}),n=new Proxy(e.runtime.environments,{get:(e,t,s)=>"0"===t?a:e[t]}),i=new Proxy(e.runtime,{get:(e,t,s)=>"environments"===t?n:e[t]});return new Proxy(e,{get(e,t,s){switch(t){case"chapter":return 4;case"runtime":return i;default:return e[t]}}})}function j(e,t){const s=e.runtime.environments[0].head,n=t.runtime.environments[0].head;return Object(a.difference)(Object(a.keys)(s),Object(a.keys)(n))}function y(e,t){return`const _____${t} = [${e.join(", ")}];`}function O(e,t){const s=`_____${t}`;return e.map(((e,t)=>"makeUndefinedErrorFunction"===e?"":`const ${e} = ${s}[${t}];`)).join("\n")}function f(e){return e.map((e=>"makeUndefinedErrorFunction"===e?"":`const ${e} = makeUndefinedErrorFunction('${e}');`)).join("\n")}},104:function(e,t,s){"use strict";let a;s.d(t,"a",(function(){return a})),function(e){e.new="new",e.deadline="deadline",e.autograded="autograded",e.graded="graded",e.submitted="submitted",e.unsubmitted="unsubmitted",e.new_message="new_message"}(a||(a={}))},108:function(e,t,s){"use strict";s.d(t,"a",(function(){return a})),s.d(t,"b",(function(){return n})),s.d(t,"e",(function(){return i})),s.d(t,"f",(function(){return r})),s.d(t,"c",(function(){return o})),s.d(t,"d",(function(){return c}));const a="CHANGE_QUERY_STRING",n="GENERATE_LZ_STRING",i="SHORTEN_URL",r="UPDATE_SHORT_URL",o="PLAYGROUND_UPDATE_GITHUB_SAVE_INFO",c="PLAYGROUND_UPDATE_PERSISTENCE_FILE"},110:function(e,t,s){"use strict";s.d(t,"a",(function(){return r}));var a=s(122),n=(s(1),s(12)),i=s(0);const r=e=>{let{handleReplOutputClear:t}=e;return Object(i.jsx)(n.a,{label:"Clear",icon:a.a.REMOVE,onClick:t})}},111:function(e,t,s){"use strict";s.d(t,"a",(function(){return o}));var a=s(122),n=s(303),i=(s(1),s(12)),r=s(0);const o=e=>{let{handleReplEval:t,isRunning:s}=e;return s?null:Object(r.jsx)(n.a,{content:"...or press shift-enter in the REPL",children:Object(r.jsx)(i.a,{label:"Eval",icon:a.a.CODE,onClick:t})})}},112:function(e,t,s){"use strict";var a=s(1308),n=s(304),i=s(1),r=s.n(i),o=s(25),c=s(288),l=s(97),d=s(289),u=s(300),h=s(42),p=s(20),g=s.n(p),m=s(0);var b=e=>{const{tabs:t,isExpanded:s,expandSideBar:a,collapseSideBar:n}=e,[i,o]=r.a.useState(0);return 0===t.length?Object(m.jsx)("div",{className:"sidebar-container"}):Object(m.jsxs)("div",{className:"sidebar-container",children:[Object(m.jsx)("div",{className:"tab-container",children:t.map(((e,t)=>Object(m.jsxs)(h.e,{className:g()("tab",{selected:s&&i===t}),onClick:()=>{var e;i!==(e=t)?(o(e),a()):s?n():a()},children:[Object(m.jsx)(h.w,{className:"tab-icon",icon:e.iconName,size:14}),e.label]},t)))}),null!==i&&Object(m.jsx)(h.e,{className:"panel",children:t[i].body})]})},j=s(303),y=s(291);var O=s(189),f=s(24);var v=i.memo((e=>{let{selectedTabId:t,renderActiveTabPanelOnly:s,editorWidth:a,sideContentHeight:n,...i}=e;return Object(m.jsx)(O.a,{...i,renderFunction:(e,r)=>Object(m.jsx)("div",{className:"side-content",children:Object(m.jsx)(h.e,{children:Object(m.jsx)("div",{className:"side-content-tabs",children:Object(m.jsx)(h.V,{id:"side-content-tabs",onChange:r,renderActiveTabPanelOnly:s,selectedTabId:t,children:e.map((e=>((e,t,s,a)=>{const n=void 0===e.id||e.id===f.b.module?e.label:e.id;var i;const r={id:n,title:Object(m.jsx)(j.a,{content:e.label,children:Object(m.jsx)("div",{className:(i=e.id,i===f.b.module||i===f.b.htmlDisplay?"side-content-tooltip side-content-tab-alert":"side-content-tooltip"),id:Object(O.b)(n),children:Object(m.jsx)(h.w,{icon:e.iconName,iconSize:20})})}),disabled:e.disabled,className:"side-content-tab"};if(!e.body)return Object(m.jsx)(h.U,{...r},n);const o=t?{...e.body,props:{...e.body.props,workspaceLocation:t,editorWidth:s,sideContentHeight:a}}:e.body,c=Object(m.jsx)("div",{className:"side-content-text",children:o});return Object(m.jsx)(h.U,{...r,panel:c},n)})(e,i.workspaceLocation,a,n)))})})})})})}),y.a),x=s(35);const C={right:!0},S={bottom:!0},w={};t.a=e=>{const t=i.useRef(null),s=i.useRef(null),r=i.useRef(null),h=i.useRef(null),p=i.useRef(null),g=i.useRef(null),[j]=Object(x.a)(s),[y,O]=i.useState(200),[f,E]=i.useState(!1);a.a.onlyShowFocusOnTabs(),i.useEffect((()=>{e.sideContentIsResizeable&&null===p.current&&(p.current=g.current.clientHeight)}));const T=(e,s,a,n)=>{if(a.clientWidth<100){const e=t.current;if(null===e)throw Error("Reference to SideBar not found when resizing.");e.updateSize({width:40,height:"100%"}),E(!1)}else E(!0)},k=(e,t,s)=>{const a=s.clientWidth/j*100;a>95?h.current.updateSize({width:"100%",height:"100%"}):a<5&&h.current.updateSize({width:"0%",height:"100%"})},A=(e,t,s)=>{p.current=g.current.clientHeight>p.current?g.current.clientHeight:p.current;const a=s.clientHeight,n=s.parentNode.clientHeight;a+p.current+2>n?g.current.style.display="none":g.current.style.display="initial"},I=Object(m.jsx)(v,{...e.sideContentProps}),N=Object(m.jsxs)(n.a,{bounds:"parent",className:"resize-side-content",enable:S,onResize:A,onResizeStop:(t,s,a)=>e.handleSideContentHeightChange(a.clientHeight),children:[I,Object(m.jsx)("div",{className:"side-content-divider",ref:g})]});return Object(m.jsxs)("div",{className:"workspace",children:[e.hasUnsavedChanges?Object(m.jsx)(o.a,{message:"You have changes that may not be saved. Are you sure you want to leave?"}):null,Object(m.jsx)(c.a,{...e.controlBarProps}),Object(m.jsxs)("div",{className:"workspace-parent",children:[Object(m.jsx)(n.a,{...(()=>{const s=0!==e.sideBarProps.tabs.length,a=s?40:"auto";return{enable:s?C:w,minWidth:a,maxWidth:"50%",onResize:T,onResizeStop:(e,t,s,a)=>{const n=s.clientWidth;40!==n&&O(n)},ref:t,defaultSize:{width:a,height:"100%"}}})(),children:Object(m.jsx)(b,{...e.sideBarProps,isExpanded:f,expandSideBar:()=>{E(!0);const e=t.current;if(null===e)throw Error("Reference to SideBar not found when expanding.");e.updateSize({width:y,height:"100%"})},collapseSideBar:()=>{E(!1);const e=t.current;if(null===e)throw Error("Reference to SideBar not found when collapsing.");e.updateSize({width:40,height:"100%"})}})}),Object(m.jsxs)("div",{className:"row content-parent",ref:s,children:[Object(m.jsx)("div",{className:"editor-divider",ref:r}),Object(m.jsx)(n.a,{className:"resize-editor left-parent",enable:C,minWidth:0,onResize:k,ref:h,defaultSize:{width:"50%",height:"100%"},as:void 0,children:(e=>e.editorContainerProps?Object(m.jsx)(l.b,{...e.editorContainerProps}):Object(m.jsx)(d.a,{...e.mcqProps}))(e)}),Object(m.jsxs)("div",{className:"right-parent",children:[void 0===e.sideContentIsResizeable||e.sideContentIsResizeable?N:I,Object(m.jsx)(u.a,{...e.replProps})]})]})]})]})}},12:function(e,t,s){"use strict";var a=s(103),n=s(42),i=(s(1),s(0));const r={className:"",fullWidth:!1,iconOnRight:!1,intent:a.a.NONE,minimal:!0};t.a=e=>{let{label:t="",icon:s,onClick:a,options:o={},isDisabled:c=!1}=e;const l={...r,...o},d=s&&Object(i.jsx)(n.w,{icon:s,color:l.iconColor});return Object(i.jsx)(n.b,{disabled:c,fill:l.fullWidth,intent:l.intent,minimal:l.minimal,className:l.className,type:l.type,onClick:a,icon:!l.iconOnRight&&d,rightIcon:l.iconOnRight&&d,children:t})}},120:function(e,t,s){"use strict";s.r(t),s.d(t,"deleteSourcecastEntry",(function(){return i})),s.d(t,"recordInit",(function(){return r})),s.d(t,"recordInput",(function(){return o})),s.d(t,"resetInputs",(function(){return c})),s.d(t,"timerPause",(function(){return l})),s.d(t,"timerReset",(function(){return d})),s.d(t,"timerResume",(function(){return u})),s.d(t,"timerStart",(function(){return h})),s.d(t,"timerStop",(function(){return p}));var a=s(7),n=s(86);const i=(e,t)=>Object(a.action)(n.a,{id:e,workspaceLocation:t}),r=(e,t)=>Object(a.action)(n.b,{initData:e,workspaceLocation:t}),o=(e,t)=>Object(a.action)(n.c,{input:e,workspaceLocation:t}),c=(e,t)=>Object(a.action)(n.d,{inputs:e,workspaceLocation:t}),l=e=>Object(a.action)(n.e,{timeNow:Date.now(),workspaceLocation:e}),d=e=>Object(a.action)(n.f,{workspaceLocation:e}),u=(e,t)=>Object(a.action)(n.g,{timeBefore:e,timeNow:Date.now(),workspaceLocation:t}),h=e=>Object(a.action)(n.h,{timeNow:Date.now(),workspaceLocation:e}),p=e=>Object(a.action)(n.i,{timeNow:Date.now(),workspaceLocation:e})},125:function(e,t,s){"use strict";s.d(t,"a",(function(){return h}));var a=s(42),n=s(3),i=s(122),r=s(379),o=(s(1),s(22)),c=s(0);const l=e=>{let{itemsParentRef:t,renderItem:s}=e;const n=o.h.map(s);return Object(c.jsx)(a.A,{ulRef:t,children:n})},d=(e,t)=>{let{handleClick:s}=t;return Object(c.jsx)(a.B,{onClick:s,text:e.displayName},e.displayName)},u=r.a.ofType(),h=e=>{let{sourceChapter:t,sourceVariant:s,handleChapterSelect:r=(()=>{}),disabled:h=!1}=e;return Object(c.jsx)(u,{items:o.n,onItemSelect:r,itemRenderer:d,itemListRenderer:l,filterable:!1,disabled:h,children:Object(c.jsx)(a.b,{className:n.a.MINIMAL,text:Object(o.o)(t,s),rightIcon:h?null:i.a.DOUBLE_CARET_VERTICAL,disabled:h})})}},126:function(e,t,s){"use strict";s.d(t,"c",(function(){return a})),s.d(t,"d",(function(){return n})),s.d(t,"e",(function(){return i})),s.d(t,"b",(function(){return r})),s.d(t,"a",(function(){return o}));const a="SAVE_CANVAS",n=":assessmentId(\\d+)?/:questionId(\\d+)?",i=":submissionId(\\d+)?/:questionId(\\d+)?",r="CREATE_COURSE",o="ADD_NEW_USERS_TO_COURSE"},127:function(e,t,s){"use strict";s.r(t),s.d(t,"generateLzString",(function(){return i})),s.d(t,"shortenURL",(function(){return r})),s.d(t,"updateShortURL",(function(){return o})),s.d(t,"changeQueryString",(function(){return c})),s.d(t,"playgroundUpdatePersistenceFile",(function(){return l})),s.d(t,"playgroundUpdateGitHubSaveInfo",(function(){return d}));var a=s(7),n=s(108);const i=()=>Object(a.action)(n.b),r=e=>Object(a.action)(n.e,e),o=e=>Object(a.action)(n.f,e),c=e=>Object(a.action)(n.a,e),l=e=>Object(a.action)(n.d,e),d=(e,t,s)=>Object(a.action)(n.c,{repoName:e,filePath:t,lastSaved:s})},1283:function(e,t){},1285:function(e,t){},1292:function(e,t,s){"use strict";s.r(t);s(559);var a=s(1307),n=s(1304),i=s(53),r=s(34),o=s(25),c=s(44),l=s(207),d=s(281),u=s(38),h=s(42),p=s(3),g=s(103),m=s(65),b=s.n(m),j=s(1),y=s.n(j),O=s(20),f=s.n(O),v=s(35),x=s(22),C=s(139),S=s(63),w=s(122),E=s(303),T=s(33),k=s.n(T),A=s(47),I=s(211),N=s(13),M=s(27),P=s(100),R=s(305);const _={},L=Object({NODE_ENV:"production",PUBLIC_URL:"/CS4215-frontend",WDS_SOCKET_HOST:void 0,WDS_SOCKET_PATH:void 0,WDS_SOCKET_PORT:void 0,FAST_REFRESH:!0,REACT_APP_SW_EXCLUDE_REGEXES:void 0}).REACT_APP_CADET_LOGGER;function D(e,t){var s;L&&(s={...t,questionId:_[e],sessionId:e},new Promise(((e,t)=>{G().then((a=>{const n=a.transaction([U],"readwrite");n.oncomplete=e,n.onerror=t,n.objectStore(U).add(s)}))})))}function B(e,t){const s=Object(R.a)();return _[s]=e,D(s,{...t,type:"init",time:Date.now()}),s}const U="logs",G=function(e){let t=null;return()=>t||(t=e(),t)}((()=>new Promise(((e,t)=>{const s=indexedDB.open("evtlogs",1);s.onsuccess=t=>{e(s.result)},s.onerror=e=>{console.error("Failed to get db",e),t(s.error)},s.onupgradeneeded=e=>{(null===e||void 0===e?void 0:e.target).result.createObjectStore(U,{keyPath:"id",autoIncrement:!0})}}))));var F=s(37),H=s(18),V=s(125),W=s(110),X=s(111),$=s(173),q=s(169),z=s(170),Y=s(212),K=s(147),Q=s(213),J=s(12),Z=s(97),ee=s(45),te=s(172),se=s(0);var ae=e=>{const{index:t,result:s}=e;return Object(se.jsx)("div",{className:f()("ResultCard","pass"===s.resultType?"correct":"wrong"),children:Object(se.jsxs)(h.e,{elevation:C.a.ONE,children:[Object(se.jsxs)("div",{className:"result-data",children:[Object(se.jsx)("div",{className:"result-idx",children:t+1}),Object(se.jsx)("div",{className:"result-status",children:s.resultType.toUpperCase()})]}),Object(se.jsx)(h.M,{className:"result-expected",children:s.expected}),Object(se.jsx)(h.M,{className:"result-actual",children:"error"===s.resultType?(a=s.errors,a.map((e=>{switch(e.errorType){case"timeout":return"[TIMEOUT] Submission exceeded time limit for this test case.";case"syntax":return`[SYNTAX] Line ${e.line}: ${e.errorExplanation}`;case"runtime":return`[RUNTIME] Line ${e.line}: ${e.errorExplanation}`;case"systemError":return`[SYSTEM] ${e.errorMessage}`;default:return`[UNKNOWN] Autograder error: type ${e.errorType}`}})).join("\n\n")):s.actual})]})});var a},ne=s(292);const ie=Object(se.jsxs)("div",{className:"autograder-help-tooltip",children:[Object(se.jsx)("p",{children:"Click on each testcase below to execute it with the program in the editor."}),Object(se.jsx)("p",{children:"To execute all testcases at once, evaluate the program in the editor with this tab active."}),Object(se.jsx)("p",{children:"A green or red background indicates a passed or failed testcase respectively."}),Object(se.jsx)("p",{children:"Private testcases (only visible to staff when grading) have a grey background."})]}),re=(e,t)=>Object(se.jsxs)("div",{className:e,children:[t,Object(se.jsx)(h.w,{icon:w.a.CARET_DOWN})]}),oe=Object(se.jsxs)("div",{className:"testcases-header",children:[re("header-fn","Testcase"),re("header-expected","Expected result"),re("header-actual","Actual result")]}),ce=Object(se.jsxs)("div",{className:"results-header",children:[Object(se.jsxs)("div",{className:"header-data",children:[re("header-sn","S/N"),re("header-status","Testcase status")]}),re("header-expected","Expected result"),re("header-actual","Actual result")]}),le=(e,t,s)=>Object(se.jsx)(J.a,{label:e,icon:t?w.a.CARET_DOWN:w.a.CARET_RIGHT,onClick:s,options:{className:"collapse-button",minimal:!0}});var de=e=>{const[t,s]=j.useState(!0),[a,n]=j.useState(!0),{testcases:i,autogradingResults:r,handleTestcaseEval:o,workspaceLocation:c}=e,l=j.useMemo((()=>i.length>0?Object(se.jsxs)("div",{className:"testcaseCards",children:[oe,i.map(((e,t)=>Object(se.jsx)(ne.a,{index:t,testcase:e,handleTestcaseEval:o,workspaceLocation:c},t)))]}):Object(se.jsx)("div",{className:"noResults",children:"There are no testcases provided for this question."})),[i,o,c]),d=j.useMemo((()=>r.length>0?Object(se.jsxs)("div",{children:[ce,r.map(((e,t)=>Object(se.jsx)(ae,{index:t,result:e},t)))]}):Object(se.jsx)("div",{className:"noResults",children:"There are no results to show."})),[r]),u=j.useCallback((()=>{s(!t)}),[t]),p=j.useCallback((()=>n(!a)),[a]);return Object(se.jsxs)("div",{className:"Autograder",children:[Object(se.jsxs)(h.b,{className:"collapse-button",icon:t?w.a.CARET_DOWN:w.a.CARET_RIGHT,minimal:!0,onClick:u,children:[Object(se.jsx)("span",{children:"Testcases"}),Object(se.jsx)(E.a,{content:ie,placement:h.L.LEFT,children:Object(se.jsx)(h.w,{icon:w.a.HELP})})]}),Object(se.jsx)(h.g,{isOpen:t,keepChildrenMounted:!0,children:l}),le("Autograder Results",a,p),Object(se.jsx)(h.g,{isOpen:a,keepChildrenMounted:!0,children:d})]})};var ue=e=>{const{handleContestEntryClick:t,contestEntry:s,rank:a}=e;return Object(se.jsx)("div",{className:f()("LeaderboardCard"),children:Object(se.jsxs)(h.e,{className:p.a.INTERACTIVE,elevation:C.a.ONE,onClick:()=>{var e;return t(s.submission_id,null!==(e=s.answer.code)&&void 0!==e?e:"")},children:[Object(se.jsx)(h.M,{className:"contestentry-entryid",children:s.student_name}),Object(se.jsx)(h.M,{className:"contestentry-rank",children:a}),Object(se.jsx)(h.M,{className:"contestentry-score",children:s.final_score})]})})};const he=(e,t)=>Object(se.jsxs)("div",{className:e,children:[t,Object(se.jsx)(h.w,{icon:w.a.CARET_DOWN})]}),pe=Object(se.jsxs)("div",{className:"leaderboard-header",children:[he("header-entryid","Student Name"),he("header-entryrank","Rank"),he("header-score","Score")]});var ge=e=>{const{orderedContestEntries:t,handleContestEntryClick:s}=e,[a,n]=Object(j.useState)(!0),i=Object(j.useMemo)((()=>Object(se.jsxs)("div",{children:[pe,t.length>0?t.map(((e,t)=>Object(se.jsx)(ue,{handleContestEntryClick:s,contestEntry:e,rank:t+1},e.submission_id))):Object(se.jsx)("div",{className:"noResults",children:"There are no eligible contest leaderboard entries found."})]})),[s,t]);return Object(se.jsxs)("div",{className:"ContestLeaderboard",children:[Object(se.jsxs)(h.b,{className:"collapse-button",icon:a?w.a.CARET_DOWN:w.a.CARET_RIGHT,minimal:!0,onClick:()=>n(!a),children:[Object(se.jsx)("span",{children:"Contest Leaderboard"}),Object(se.jsx)(E.a,{content:"View the top-rated contest entries!",children:Object(se.jsx)(h.w,{icon:w.a.HELP})})]}),Object(se.jsx)(h.g,{isOpen:a,keepChildrenMounted:!0,children:i})]})},me=s(10);var be=e=>{const{canSave:t,isValid:s,handleContestEntryClick:a,handleVotingSubmissionChange:n,contestEntry:i,entryNumber:r,minScore:o,maxScore:c}=e;return Object(se.jsx)("div",{className:f()("ContestEntryCard",{wrong:!s}),children:Object(se.jsxs)(h.e,{className:p.a.INTERACTIVE,elevation:C.a.ONE,onClick:()=>{var e;return a(i.submission_id,null!==(e=i.answer.code)&&void 0!==e?e:"")},children:[Object(se.jsx)(h.M,{className:"contestentry-entryid",children:r}),Object(se.jsx)(h.M,{className:"contestentry-rank",children:Object(se.jsx)(h.H,{disabled:!t,value:i.score,onValueChange:e=>n(i.submission_id,e),placeholder:`Enter score for entry ${r}`,min:o,max:c,allowNumericCharactersOnly:!0,fill:!0,minorStepSize:null})})]})})};const je=(e,t)=>Object(se.jsxs)("div",{className:e,children:[t,Object(se.jsx)(h.w,{icon:w.a.CARET_DOWN})]}),ye=Object(se.jsxs)("div",{className:"contestentries-header",children:[je("header-entryid","Entry Id"),je("header-entryrank","Score")]});var Oe=e=>{const{contestEntries:t,canSave:s,isValid:a,handleContestEntryClick:n,handleVotingSubmissionChange:i,maxScore:r,minScore:o}=e,[c,l]=Object(j.useState)(!0),d=Object(j.useMemo)((()=>Object(se.jsxs)("div",{children:[ye,t.length>0?t.map(((e,t)=>Object(se.jsx)(be,{isValid:a,canSave:s,entryNumber:t+1,handleContestEntryClick:n,handleVotingSubmissionChange:i,contestEntry:e,minScore:o,maxScore:r},e.submission_id))):Object(se.jsx)("div",{className:"noResults",children:"There are no eligible entries for voting found."})]})),[a,s,t,n,i,r,o]);return Object(se.jsxs)("div",{className:"ContestEntryVoting",children:[Object(se.jsxs)(h.b,{className:"collapse-button",icon:c?w.a.CARET_DOWN:w.a.CARET_RIGHT,minimal:!0,onClick:()=>l(!c),children:[Object(se.jsx)("span",{children:"Contest Voting"}),Object(se.jsx)(E.a,{content:Object(se.jsxs)("span",{children:["Score your favourite contest entries from ",o," (worst) to ",r," (best)!"]}),children:Object(se.jsx)(h.w,{icon:w.a.HELP})})]}),Object(se.jsx)(h.g,{isOpen:c,keepChildrenMounted:!0,children:d})]})};var fe=e=>{const{canSave:t,contestEntries:s,handleSave:a,handleContestEntryClick:n}=e,[i,r]=Object(j.useState)(!0),[o,c]=Object(j.useState)([]),l=11-s.length;Object(j.useEffect)((()=>{c(s)}),[s]);return Object(se.jsx)(Oe,{isValid:i,canSave:t,handleContestEntryClick:n,handleVotingSubmissionChange:(e,t)=>{const s=o.map((s=>s.submission_id===e?{...s,score:t}:s));c(s);const n=new Set(s.map((e=>e.score))).size===s.length,i=(e=>e.reduce(((e,t)=>e&&void 0!==t.score&&null!==t.score),!0))(s);n&&i&&(e=>e.reduce(((e,t)=>{const s=t.score;return e&&s>=l&&s<=10}),!0))(s)?(a(s),r(!0)):n&&i?(Object(me.e)(`Vote rankings invalid. Please input scores between ${l} - 10.`),r(!1)):!n&&i?(Object(me.e)("Vote scores are not unique. Please input unique rankings."),r(!1)):r(!1)},contestEntries:o,minScore:l,maxScore:10})};class ve extends j.Component{constructor(){super(...arguments),this.$container=null}shouldComponentUpdate(){return!1}componentDidMount(){window.ToneMatrix&&window.ToneMatrix.initialise_matrix(this.$container)}handleClear(){window.ToneMatrix.clear_matrix()}handleRandomise(){window.ToneMatrix.randomise_matrix()}render(){return Object(se.jsxs)("div",{className:"sa-tone-matrix",children:[Object(se.jsx)("div",{className:"row",children:Object(se.jsxs)("div",{className:f()("controls","col-xs-12",p.a.DARK,p.a.BUTTON_GROUP),children:[Object(se.jsx)(h.b,{id:"clear-matrix",onClick:this.handleClear,children:"Clear"}),Object(se.jsx)(h.b,{id:"randomise-matrix",onClick:this.handleRandomise,children:"Randomise"})]})}),Object(se.jsx)("div",{className:"row",children:Object(se.jsx)("div",{className:"col-xs-12",ref:e=>this.$container=e})})]})}}var xe=ve,Ce=s(24),Se=s(16),we=s(52),Ee=s(55),Te=s(112);const ke=e=>{const t=b()(e),s=b()();return t.isBefore(s)},Ae=e=>b()(e).format("Do MMMM, HH:mm");var Ie=e=>Object(se.jsx)("div",{className:"GradingResult",children:Object(se.jsxs)("div",{className:"grading-result-table",children:[Object(se.jsx)(h.v,{children:Object(se.jsxs)("tbody",{children:[Object(se.jsxs)("tr",{children:[Object(se.jsx)("th",{children:"XP:"}),Object(se.jsx)("td",{children:Object(se.jsxs)(h.Y,{children:[e.xp," / ",e.maxXp]})})]}),Object(se.jsxs)("tr",{children:[Object(se.jsx)("th",{children:"Comments:"}),Object(se.jsx)("td",{children:!e.comments&&Object(se.jsx)(h.Y,{children:"None"})})]})]})}),e.comments&&Object(se.jsx)(h.v,{children:Object(se.jsx)("tbody",{children:Object(se.jsx)("tr",{children:Object(se.jsxs)("td",{children:[Object(se.jsx)(h.i,{}),Object(se.jsx)(ee.a,{content:e.comments,simplifiedAutoLink:!0,strikethrough:!0,tasklists:!0,openLinksInNewWindow:!0}),Object(se.jsx)(h.i,{})]})})})}),Object(se.jsx)("br",{}),Object(se.jsx)("div",{className:"grading-result-info",children:Object(se.jsxs)(h.Y,{children:["Graded by ",Object(se.jsx)("b",{children:e.graderName})," on ",Ae(e.gradedAt)]})})]})});const Ne="assessment";var Me=e=>{var t,s,a,n,i;const[o,c]=j.useState(!1),[l,d]=j.useState(!1),[m,b]=j.useState(""),[y,O]=j.useState(void 0!==(null===(t=e.assessment)||void 0===t?void 0:t.questions[e.questionId].grader)?Ce.b.grading:Ce.b.questionOverview),{isMobileBreakpoint:C}=Object(v.e)(),S=Object(r.c)();j.useEffect((()=>{e.handleEditorValueChange("")}),[]),j.useEffect((()=>{if(S(Object(u.fetchAssessment)(e.assessmentId)),0===e.questionId&&e.notAttempted&&c(!0),!e.assessment)return;let t=e.questionId;e.questionId>=e.assessment.questions.length&&(t=e.assessment.questions.length-1);const s=e.assessment.questions[t];let a="";s.type===H.d.programming&&(a=s.answer?s.answer:s.solutionTemplate),e.handleEditorValueChange(a)}),[]),j.useEffect((()=>{I()})),j.useEffect((()=>{C||y!==Ce.b.mobileEditor&&y!==Ce.b.mobileEditorRun||O(Ce.b.questionOverview)}),[C,e,y]);const E=e=>{D(m,e)},k=j.useRef(y);k.current=y;const A=()=>{k.current===Ce.b.autograder?S(Object(N.runAllTestcases)(Ne)):S(Object(N.evalEditor)(Ne));const e={time:Date.now(),type:"keyboardCommand",data:F.a.run};E(e)},I=()=>{var t;if(void 0===e.assessment)return;const s=e.assessmentId,a=e.questionId;if(e.storedAssessmentId===s&&e.storedQuestionId===a)return;const n=e.assessment.questions[a];let i=[],r="",o="",c="",l=[];if(n.type===H.d.programming){const t=n;var d,u;if(i=t.autogradingResults,o=t.prepend,c=t.postpend,l=t.testcases,r=t.answer,r||(r=t.solutionTemplate),!m)b(B(`${e.assessment.number}/${e.questionId}`,{chapter:M.Chapter.CALC,externalLibrary:(null===n||void 0===n||null===(d=n.library)||void 0===d||null===(u=d.external)||void 0===u?void 0:u.name)||"NONE",editorValue:r}))}if(n.type===H.d.voting){const e=n;o=e.prepend,c=e.postpend}e.handleEditorUpdateBreakpoints([]),S(Object(N.updateCurrentAssessmentId)(s,a)),S(Object(N.resetWorkspace)(Ne,{autogradingResults:i,editorTabs:[{value:r,prependValue:o,postpendValue:c,highlightedLines:[],breakpoints:[]}],editorTestcases:l})),S(Object(N.changeExecTime)(null!==(t=n.library.execTimeMs)&&void 0!==t?t:x.l.assessment.execTime,Ne)),S(Object(N.beginClearContext)(Ne,n.library,!0)),e.handleUpdateHasUnsavedChanges(!1),r&&e.handleEditorValueChange(r)},R=(e,t)=>{var s,a,n,i,r,o,c;const l=void 0!==e.assessment.questions[t].grader,d=(t,s)=>{e.handleEditorValueChange(s)},u="voting"===(null===(s=e.assessment.questions[t])||void 0===s?void 0:s.type)?[{label:`Question ${t+1}`,iconName:w.a.NINJA,body:Object(se.jsx)(ee.a,{content:e.assessment.questions[t].content}),id:Ce.b.questionOverview},{label:"Contest Voting Briefing",iconName:w.a.BRIEFCASE,body:Object(se.jsx)(ee.a,{content:e.assessment.longSummary}),id:Ce.b.briefing},{label:"Contest Voting",iconName:w.a.NEW_LAYERS,body:Object(se.jsx)(fe,{canSave:e.canSave,handleSave:s=>{var a;return e.handleSave((null===(a=e.assessment)||void 0===a?void 0:a.questions[t]).id,s)},handleContestEntryClick:d,contestEntries:null!==(a=null===(n=e.assessment)||void 0===n||null===(i=n.questions[t])||void 0===i?void 0:i.contestEntries)&&void 0!==a?a:[]}),id:Ce.b.contestVoting},{label:"Contest Leaderboard",iconName:w.a.CROWN,body:Object(se.jsx)(ge,{handleContestEntryClick:d,orderedContestEntries:null!==(r=null===(o=e.assessment)||void 0===o||null===(c=o.questions[t])||void 0===c?void 0:c.contestLeaderboard)&&void 0!==r?r:[]}),id:Ce.b.contestLeaderboard}]:[{label:`Question ${t+1}`,iconName:w.a.NINJA,body:Object(se.jsx)(ee.a,{className:"sidecontent-overview",content:e.assessment.questions[t].content}),id:Ce.b.questionOverview},{label:"Briefing",iconName:w.a.BRIEFCASE,body:Object(se.jsx)(ee.a,{className:"sidecontent-overview",content:e.assessment.longSummary}),id:Ce.b.briefing},{label:"Autograder",iconName:w.a.AIRPLANE,body:Object(se.jsx)(de,{testcases:e.editorTestcases,autogradingResults:l||!e.assessmentConfiguration.isManuallyGraded?e.autogradingResults:[],handleTestcaseEval:e=>S(Object(N.evalTestcase)(Ne,e)),workspaceLocation:"assessment"}),id:Ce.b.autograder}];l&&u.push({label:"Report Card",iconName:w.a.TICK,body:Object(se.jsx)(Ie,{graderName:e.assessment.questions[t].grader.name,gradedAt:e.assessment.questions[t].gradedAt,xp:e.assessment.questions[t].xp,maxXp:e.assessment.questions[t].maxXp,comments:e.assessment.questions[t].comments}),id:Ce.b.grading});e.assessment.questions[t].library.external.symbols.includes("get_matrix")&&u.push({label:"Tone Matrix",iconName:w.a.GRID_VIEW,body:Object(se.jsx)(xe,{}),id:Ce.b.toneMatrix});return{selectedTabId:y,tabs:{beforeDynamicTabs:u,afterDynamicTabs:[]},onChange:(e,t,s)=>{e!==t&&O(e)},workspaceLocation:"assessment"}},_=t=>{var s;const a=`/courses/${e.courseId}/${Object(Ee.a)(e.assessment.type)}`,n=a+`/${e.assessment.id.toString()}`,i=[t+1,e.assessment.questions.length],r=()=>{we.a.push(n+`/${(t+1).toString()}`),O(Ce.b.questionOverview)},o=()=>we.a.push(a),c=s=>()=>{const a=e.assessment.questions.filter((e=>null!==e.answer)).length-1;if(t<a)return s();const n=e.assessment.questions[t];if(n.type===H.d.mcq){if(null===n.answer)return Object(me.e)("Please select an option!",750);if(void 0===n.solution)return s();if(n.answer!==n.solution)return Object(me.e)("Your MCQ solution is incorrect!",750)}else if(n.type===H.d.programming){if(!e.editorTestcases.reduce(((e,t)=>e&&Object(P.stringify)(t.result)===t.answer),!0))return Object(me.e)("Your solution has not passed all testcases!",750)}return s()},l=Object(se.jsx)($.a,{onClickNext:e.assessment.questions[t].blocking?c(r):r,onClickReturn:e.assessment.questions[t].blocking?c(o):o,questionProgress:i},"next_question"),u=Object(se.jsx)(q.a,{onClick:()=>{we.a.push(n+`/${(t-1).toString()}`),O(Ce.b.questionOverview)},questionProgress:i},"previous_question"),h=Object(se.jsx)(z.a,{questionProgress:i},"question_view"),p=e.assessment.questions[t].type!==H.d.mcq?Object(se.jsx)(Y.a,{onClick:()=>{d(!0)}},"reset_template"):null,g=Object(se.jsx)(K.a,{handleEditorEval:A},"run"),m=e.canSave&&e.assessment.questions[t].type===H.d.programming?Object(se.jsx)(Q.a,{hasUnsavedChanges:e.hasUnsavedChanges,onClickSave:()=>e.handleSave(e.assessment.questions[t].id,e.editorTabs[0].value)},"save"):null,b=Object(se.jsx)(V.a,{handleChapterSelect:()=>{},sourceChapter:M.Chapter.CALC,sourceVariant:null!==(s=e.assessment.questions[t].library.variant)&&void 0!==s?s:Se.b.defaultSourceVariant,disabled:!0},"chapter");return{editorButtons:C?[m,p]:[g,m,p,b],flowButtons:[u,h,l]}};if(void 0===e.assessment||0===e.assessment.questions.length)return Object(se.jsx)(h.G,{className:f()("WorkspaceParent",p.a.DARK),description:"Getting mission ready...",icon:Object(se.jsx)(h.R,{size:h.S.LARGE})});const L=Object(se.jsx)(h.h,{className:"assessment-briefing",isOpen:o,children:Object(se.jsxs)(h.e,{children:[Object(se.jsx)(ee.a,{content:e.assessment.longSummary}),Object(se.jsx)(h.b,{className:"assessment-briefing-button",onClick:()=>c(!1),text:"Continue"})]})}),U=()=>d(!1),G=Object(se.jsxs)(h.h,{className:"assessment-reset",icon:w.a.ERROR,isCloseButtonShown:!0,isOpen:l,onClose:U,title:"Confirmation: Reset editor?",children:[Object(se.jsxs)("div",{className:p.a.DIALOG_BODY,children:[Object(se.jsx)(ee.a,{content:"Are you sure you want to reset the template?"}),Object(se.jsx)(ee.a,{content:"*Note this will not affect the saved copy of your program, unless you save over it.*"})]}),Object(se.jsx)("div",{className:p.a.DIALOG_FOOTER,children:Object(se.jsxs)(h.c,{children:[Object(se.jsx)(J.a,{label:"Cancel",onClick:U,options:{minimal:!1}}),Object(se.jsx)(J.a,{label:"Confirm",onClick:()=>{U(),e.handleEditorValueChange(e.assessment.questions[ae].solutionTemplate),e.handleUpdateHasUnsavedChanges(!0)},options:{minimal:!1,intent:g.a.DANGER}})]})})]}),ae=e.questionId>=e.assessment.questions.length?e.assessment.questions.length-1:e.questionId,ne=e.assessment.questions[ae],ie=ne.type===H.d.programming||ne.type===H.d.voting?{editorVariant:"normal",editorTabs:e.editorTabs.map(Z.a),editorSessionId:"",sourceChapter:M.Chapter.CALC,sourceVariant:null!==(s=ne.library.variant)&&void 0!==s?s:M.Variant.DEFAULT,externalLibraryName:ne.library.external.name||"NONE",handleDeclarationNavigate:e=>S(Object(N.navigateToDeclaration)(Ne,e)),handleEditorEval:A,handleEditorValueChange:e.handleEditorValueChange,handleUpdateHasUnsavedChanges:e.handleUpdateHasUnsavedChanges,handleEditorUpdateBreakpoints:e.handleEditorUpdateBreakpoints,handlePromptAutocomplete:(e,t,s)=>S(Object(N.promptAutocomplete)(Ne,e,t,s)),isEditorAutorun:!1,onChange:(t,s)=>{e.handleUpdateHasUnsavedChanges&&e.handleUpdateHasUnsavedChanges(!0),e.handleEditorValueChange(t);const a={time:Date.now(),type:"codeDelta",data:s};E(a)},onCursorChange:e=>{const t={time:Date.now(),type:"cursorPositionChange",data:e.getCursor()};E(t)},onSelectionChange:e=>{const t=e.getRange(),s=e.isBackwards();if(!Object(T.isEqual)(t.start,t.end)){const e={time:Date.now(),type:"selectionRangeData",data:{range:t,isBackwards:s}};E(e)}}}:void 0,re={mcq:ne,handleMCQSubmit:t=>e.handleSave(e.assessment.questions[ae].id,t)},oe={handleBrowseHistoryDown:()=>S(Object(N.browseReplHistoryDown)(Ne)),handleBrowseHistoryUp:()=>S(Object(N.browseReplHistoryUp)(Ne)),handleReplEval:e.handleReplEval,handleReplValueChange:e=>S(Object(N.updateReplValue)(e,Ne)),output:e.output,replValue:e.replValue,sourceChapter:M.Chapter.CALC,sourceVariant:null!==(a=ne.library.variant)&&void 0!==a?a:M.Variant.DEFAULT,externalLibrary:(null===ne||void 0===ne||null===(n=ne.library)||void 0===n||null===(i=n.external)||void 0===i?void 0:i.name)||"NONE",replButtons:(()=>{const t=Object(se.jsx)(W.a,{handleReplOutputClear:()=>S(Object(N.clearReplOutput)(Ne))},"clear_repl");return[Object(se.jsx)(X.a,{handleReplEval:e.handleReplEval,isRunning:e.isRunning},"eval_repl"),t]})()},ce={tabs:[]},le={controlBarProps:_(ae),editorContainerProps:ie,handleSideContentHeightChange:e=>S(Object(N.changeSideContentHeight)(e,Ne)),hasUnsavedChanges:e.hasUnsavedChanges,mcqProps:re,sideBarProps:ce,sideContentHeight:e.sideContentHeight,sideContentProps:R(e,ae),replProps:oe},ue={editorContainerProps:ie,hasUnsavedChanges:e.hasUnsavedChanges,mcqProps:re,replProps:oe,sideBarProps:ce,mobileSideContentProps:(t=>({mobileControlBarProps:{..._(t)},...R(e,t),onChange:(e,t,s)=>{e!==t&&(t===Ce.b.autograder&&e===Ce.b.mobileEditorRun||O(e))},selectedTabId:y,handleEditorEval:A}))(ae)};return Object(se.jsxs)("div",{className:f()("WorkspaceParent",p.a.DARK),children:[L,G,C?Object(se.jsx)(te.a,{...ue}):Object(se.jsx)(Te.a,{...le})]})};const Pe="assessment";var Re=Object(r.b)(((e,t)=>({courseId:e.session.courseId,assessment:e.session.assessments.get(t.assessmentId),autogradingResults:e.workspaces.assessment.autogradingResults,activeEditorTabIndex:e.workspaces.assessment.activeEditorTabIndex,editorTabs:e.workspaces.assessment.editorTabs,editorTestcases:e.workspaces.assessment.editorTestcases,hasUnsavedChanges:e.workspaces.assessment.hasUnsavedChanges,isRunning:e.workspaces.assessment.isRunning,isDebugging:e.workspaces.assessment.isDebugging,enableDebugging:e.workspaces.assessment.enableDebugging,output:e.workspaces.assessment.output,replValue:e.workspaces.assessment.replValue,sideContentHeight:e.workspaces.assessment.sideContentHeight,storedAssessmentId:e.workspaces.assessment.currentAssessment,storedQuestionId:e.workspaces.assessment.currentQuestion})),(e=>Object(c.b)({handleEditorValueChange:e=>Object(N.updateEditorValue)(e,Pe),handleEditorUpdateBreakpoints:e=>Object(N.setEditorBreakpoint)(e,Pe),handleReplEval:()=>Object(N.evalRepl)(Pe),handleSave:u.submitAnswer,handleUpdateHasUnsavedChanges:e=>Object(N.updateHasUnsavedChanges)(Pe,e)},e)))(Me),_e=s(93),Le=s(377);function De(e){return t=>t.filter((t=>!t.submission_id&&t.assessment_id===e))}function Be(e){return t=>t.filter((t=>t.submission_id===e))}function Ue(e){return t=>t.filter((t=>"Grading"===e?void 0!==t.submission_id:!t.submission_id&&e===t.assessment_type))}var Ge=s(104);const Fe=e=>{switch(e){case Ge.a.new:return"This assessment is new.";case Ge.a.deadline:return"This assessment is closing soon.";case Ge.a.autograded:return"This assessment has been autograded.";case Ge.a.submitted:return"This submission is new.";case Ge.a.unsubmitted:return"This assessment has been unsubmitted.";case Ge.a.graded:return"This assessment has been manually graded.";case Ge.a.new_message:return"There are new messages.";default:return"Unknown notification"}};var He=e=>{const t=e.notificationFilter?e.notificationFilter(e.notifications):e.notifications;if(!t.length)return null;const s=Object(se.jsx)(h.W,{intent:g.a.DANGER,round:!0,large:e.large,children:t.length});if(!e.disableHover){const a=t=>Object(se.jsx)(h.W,{className:"row badge-tag",minimal:!0,multiline:!0,onRemove:()=>{return e.handleAcknowledgeNotifications((s=t.id,e=>e.filter((e=>e.id===s))));var s},children:Fe(t.type)},`${t.id}`),n=Object(se.jsx)("div",{className:"col",children:t.map(a)});return Object(se.jsx)(Le.a,{className:e.className,content:n,interactionKind:h.K.HOVER,placement:S.a.RIGHT,hoverOpenDelay:50,hoverCloseDelay:50,lazy:!0,children:s})}return s};var Ve=Object(r.b)((e=>({notifications:e.session.notifications})),(e=>Object(c.b)({handleAcknowledgeNotifications:u.acknowledgeNotifications},e)))(He);var We=()=>Object(se.jsx)("div",{className:f()("NoPage",p.a.DARK),children:Object(se.jsx)(h.G,{icon:w.a.ERROR,title:"Assessment Not Found",description:"Please check the top right dropdown menu to see if you are in the right course."})});const Xe=e=>{let t,s,a;switch(e){case H.c.graded:t=w.a.TICK,s=g.a.SUCCESS,a="Fully graded";break;case H.c.grading:t=w.a.TIME,s=g.a.WARNING,a="Grading in progress";break;case H.c.none:t=w.a.CROSS,s=g.a.DANGER,a="Not graded yet";break;default:t=w.a.DISABLE,s=g.a.PRIMARY,a="Not applicable"}return Object(se.jsx)(E.a,{className:"listing-title-tooltip",content:a,placement:S.a.RIGHT,children:Object(se.jsx)(h.w,{icon:t,intent:s})})},$e=(e,t,s)=>Object(se.jsx)(J.a,{label:e,icon:t?w.a.CARET_DOWN:w.a.CARET_RIGHT,onClick:s,options:{minimal:!0,className:"collapse-button"}});var qe=e=>{const t=Object(o.j)(),{isMobileBreakpoint:s}=Object(v.e)(),[a,n]=j.useState(null),[i,r]=j.useState(!1),[c,l]=j.useState(!0),[d,u]=j.useState(!0),m=()=>r(!i),b=()=>l(!c),y=()=>u(!d),O=()=>n(null),f=e=>Object(T.sortBy)(e,[e=>-e.id]),x=(e,t)=>Object(se.jsxs)(h.b,{disabled:e.status!==H.a.attempted,icon:w.a.CONFIRM,intent:e.status===H.a.attempted?g.a.DANGER:g.a.NONE,minimal:!0,onClick:()=>n(e),children:[Object(se.jsx)("span",{className:"custom-hidden-xxxs",children:"Finalize"}),Object(se.jsx)("span",{className:"custom-hidden-xxs",children:" Submission"})]}),S=t=>{let s,a,n="";switch(t.status){case H.a.not_attempted:s=w.a.PLAY,a="Attempt";break;case H.a.attempting:s=w.a.PLAY,a="Continue",n=" Attempt";break;case H.a.attempted:s=w.a.EDIT,a="Review",n=" Attempt";break;case H.a.submitted:s=w.a.EYE_OPEN,a="Review",n=" Submission";break;default:s=w.a.PLAY,a="Review"}return Object(se.jsx)(A.b,{to:`/courses/${e.courseId}/${Object(Ee.a)(t.type)}/${t.id.toString()}/${Se.b.defaultQuestionId}`,children:Object(se.jsxs)(h.b,{icon:s,minimal:!0,onClick:()=>e.handleAcknowledgeNotifications(De(t.id)),children:[Object(se.jsx)("span",{className:"custom-hidden-xxxs",children:a}),Object(se.jsx)("span",{className:"custom-hidden-xxs",children:n})]})})},k=(t,a,n,i)=>{const r="graded"===t.gradingStatus||!e.assessmentConfiguration.isManuallyGraded,o=s?5:3;return Object(se.jsx)("div",{children:Object(se.jsxs)(h.e,{className:"row listing",elevation:C.a.ONE,children:[Object(se.jsxs)("div",{className:`col-xs-${String(o)} listing-picture`,children:[Object(se.jsx)(Ve,{className:"badge",notificationFilter:De(t.id),large:!0}),Object(se.jsx)("img",{alt:"Assessment",className:`cover-image-${t.status}`,src:t.coverImage?t.coverImage:I.a})]}),Object(se.jsxs)("div",{className:`col-xs-${String(12-o)} listing-text`,children:[N(t,a,i),Object(se.jsx)("div",{className:"listing-xp",children:Object(se.jsx)(h.t,{children:r?`XP: ${t.xp} / ${t.maxXp}`:`Max XP: ${t.maxXp}`})}),Object(se.jsx)("div",{className:"listing-description",children:Object(se.jsx)(ee.a,{content:t.shortSummary})}),Object(se.jsxs)("div",{className:"listing-footer",children:[Object(se.jsxs)("div",{children:[Object(se.jsxs)(h.Y,{className:"listing-due-date",children:[Object(se.jsx)(h.w,{className:"listing-due-icon",iconSize:12,icon:w.a.CALENDAR}),`${ke(t.openAt)?"Opened":"Opens"}: ${Ae(t.openAt)}`]}),ke(t.openAt)&&Object(se.jsxs)(h.Y,{className:"listing-due-date",children:[Object(se.jsx)(h.w,{className:"listing-due-icon",iconSize:12,icon:w.a.TIME}),`Due: ${Ae(t.closeAt)}`]})]}),Object(se.jsx)("div",{className:"listing-button",children:n?S(t):null})]})]})]})},a)},N=(e,t,s)=>Object(se.jsxs)("div",{className:"listing-header",children:[Object(se.jsx)(h.Y,{ellipsize:!0,children:Object(se.jsxs)(h.r,{className:"listing-title",children:[e.title,e.private?Object(se.jsx)(E.a,{className:"listing-title-tooltip",content:"This assessment is password-protected.",children:Object(se.jsx)(h.w,{icon:"lock"})}):null,s?Xe(e.gradingStatus):null]})}),Object(se.jsx)("div",{className:"listing-button",children:x(e)})]}),{assessmentOverviews:M,isStudent:P}=e,R=j.useMemo((()=>null===M||void 0===M?void 0:M.filter((t=>t.type===e.assessmentConfiguration.type))),[M,e.assessmentConfiguration.type]),_=Object(Ee.b)(t.assessmentId),L=Object(Ee.b)(t.questionId)||Se.b.defaultQuestionId;if(null!==_&&void 0!==R){const t=R.filter((e=>e.id===_))[0];if(!t)return Object(se.jsx)(We,{});const s={assessmentId:_,questionId:L,notAttempted:t.status===H.a.not_attempted,canSave:!e.isStudent||t.status!==H.a.submitted&&!ke(t.closeAt),assessmentConfiguration:e.assessmentConfiguration};return Object(se.jsx)(Re,{...s})}let D;if(void 0===R)D=Object(se.jsx)(h.G,{description:"Fetching assessment...",icon:Object(se.jsx)(h.R,{})});else if(0===R.length)D=Object(se.jsx)(h.G,{title:"There are no assessments.",icon:w.a.FLAME});else{const e=e=>!ke(e.closeAt)&&!ke(e.openAt),t=f(R.filter(e)).map(((e,t)=>k(e,t,!P,!1))),s=e=>!ke(e.closeAt)&&ke(e.openAt)&&e.status!==H.a.submitted,a=f(R.filter((e=>s(e)))).map(((e,t)=>k(e,t,!0,!1))),n=f(R.filter((t=>!s(t)&&!e(t)))).map(((e,t)=>k(e,t,!0,!0))),r=Object(se.jsxs)(se.Fragment,{children:[$e("Upcoming",d,y),Object(se.jsx)(h.g,{isOpen:d,children:t})]}),o=Object(se.jsxs)(se.Fragment,{children:[$e("Open",c,b),Object(se.jsx)(h.g,{isOpen:c,children:a})]}),l=Object(se.jsxs)(se.Fragment,{children:[$e("Closed",i,m),Object(se.jsx)(h.g,{isOpen:i,children:n})]});D=Object(se.jsxs)(se.Fragment,{children:[t.length>0?r:null,a.length>0?o:null,n.length>0?l:null]})}const B=a?Object(se.jsxs)("p",{children:["You are about to finalise your submission for the ",a.type.toLowerCase()," ",Object(se.jsxs)("i",{children:['"',a.title,'"']}),"."]}):Object(se.jsx)("p",{children:"You are about to finalise your submission."}),U=Object(se.jsxs)(se.Fragment,{children:[B,Object(se.jsxs)("p",{children:["Finalising your submission early grants you additional XP, but"," ",Object(se.jsx)("span",{className:"warning",children:"this action is irreversible."})]})]}),G=Object(se.jsxs)(h.h,{className:"betcha-dialog",icon:w.a.ERROR,isCloseButtonShown:!0,isOpen:null!==a,onClose:O,title:"Finalise submission?",children:[Object(se.jsx)("div",{className:p.a.DIALOG_BODY,children:Object(se.jsx)(h.Y,{children:U})}),Object(se.jsx)("div",{className:p.a.DIALOG_FOOTER,children:Object(se.jsxs)(h.c,{children:[Object(se.jsx)(J.a,{label:"Cancel",onClick:O,options:{minimal:!1}}),Object(se.jsx)(J.a,{label:"Finalise",onClick:()=>{a&&(e.handleSubmitAssessment(a.id),O())},options:{minimal:!1,intent:g.a.DANGER}})]})})]});return Object(se.jsxs)("div",{className:"Assessment",children:[Object(se.jsx)(_e.a,{display:D,loadContentDispatch:e.handleAssessmentOverviewFetch}),G]})};var ze=Object(r.b)(((e,t)=>({assessmentOverviews:e.session.assessmentOverviews,isStudent:!e.session.role||e.session.role===x.a.Student,courseId:e.session.courseId})),(e=>Object(c.b)({handleAcknowledgeNotifications:u.acknowledgeNotifications,handleAssessmentOverviewFetch:u.fetchAssessmentOverviews,handleSubmitAssessment:u.submitAssessment},e)))(qe),Ye=s(126);var Ke=()=>Object(se.jsx)("div",{className:f()("NoPage",p.a.DARK),children:Object(se.jsx)(h.G,{icon:w.a.ERROR,title:"404 Not Found",description:"The requested resource could not be found"})}),Qe=s(171),Je=s(96),Ze=s(40);const et={coverImage:`${Ze.d}/default.png`,description:"",completionText:""},tt={uuid:"",title:"Achievement Title Here",xp:0,isVariableXp:!1,isTask:!1,position:0,prerequisiteUuids:[],goalUuids:[],cardBackground:`${Ze.c}/default.png`,view:et};var st=function(e){const{allowNewUuid:t,setNewUuid:s}=e,a=Object(j.useContext)(Ze.a);return Object(se.jsx)(h.b,{className:"command-button",disabled:!t,icon:w.a.NEW_OBJECT,onClick:()=>s(a.insertAchievement(tt)),text:"Create Achievement"})},at=s(69);var nt=function(e){const{deleteItem:t,item:s}=e;return Object(se.jsx)(E.a,{content:"Delete",children:Object(se.jsx)(h.b,{icon:w.a.TRASH,intent:"danger",onClick:async()=>{await Object(at.b)({contents:`Are you sure you want to delete '${s}' ?`,negativeLabel:"No",positiveIntent:"danger",positiveLabel:"Yes, delete"})&&t()}})})};var it=function(e){const{discardChanges:t,saveChanges:s}=e;return Object(se.jsxs)(se.Fragment,{children:[Object(se.jsx)(E.a,{content:"Save Changes",children:Object(se.jsx)(h.b,{icon:w.a.FLOPPY_DISK,intent:"primary",onClick:()=>{s(),Object(me.d)("Saved changes locally")}})}),Object(se.jsx)(E.a,{content:"Discard Changes",children:Object(se.jsx)(h.b,{icon:w.a.CROSS,intent:"danger",onClick:()=>{t(),Object(me.e)("Discarded changes")}})})]})},rt=s(1305);var ot=function(e){const{changeGoalUuids:t,goalUuids:s}=e,a=Object(j.useContext)(Ze.a),n=a.getAllGoalUuids(),i=s.filter((e=>!a.isInvalidGoal(a.getGoal(e)))),r=rt.a.ofType(),o=new Set(i),c=new Set(Object(T.without)(n,...s)),l=e=>{void 0!==l&&(o.delete(e),c.add(e),t([...o]))};return Object(se.jsx)(r,{itemRenderer:(e,t)=>{let{handleClick:s}=t;return Object(se.jsx)(h.B,{onClick:s,text:e.text},e.uuid)},items:[...c].map((e=>a.getGoal(e))),noResults:Object(se.jsx)(h.B,{disabled:!0,text:"No available goal"}),onItemSelect:e=>{return s=e.uuid,o.add(s),c.delete(s),void t([...o]);var s},selectedItems:[...o].map((e=>a.getGoal(e))),tagInputProps:{onRemove:e=>l((e=>a.getUuidByText(e))(e.toString()))},tagRenderer:e=>e.text,itemPredicate:(e,t)=>t.text.toLowerCase().includes(e.toLowerCase()),resetOnSelect:!0})},ct=s(379);var lt=function(e){const{changePosition:t,position:s}=e,a=Object(j.useContext)(Ze.a).listTaskUuids().length+1,n=[...Array(a+1).keys()],i=ct.a.ofType();return Object(se.jsx)(i,{filterable:!1,itemRenderer:(e,t)=>{let{handleClick:s}=t;return Object(se.jsx)(h.B,{onClick:s,text:e},e)},items:n,onItemSelect:t,children:Object(se.jsx)(h.b,{text:s})})};var dt=function(e){const{changePrerequisiteUuids:t,uuid:s,prerequisiteUuids:a}=e,n=Object(j.useContext)(Ze.a),i=[],r=a.filter((e=>!n.isInvalidAchievement(n.getAchievement(e)))),o=rt.a.ofType(),c=new Set(r),l=new Set(Object(T.without)(i,...r));return Object(se.jsx)(o,{itemRenderer:(e,t)=>{let{handleClick:s}=t;return Object(se.jsx)(h.B,{onClick:s,text:e.title},e.uuid)},items:[...l].map((e=>n.getAchievement(e))),noResults:Object(se.jsx)(h.B,{disabled:!0,text:"No available achievement"}),onItemSelect:e=>{return s=e.uuid,c.add(s),l.delete(s),void t([...c]);var s},selectedItems:[...c].map((e=>n.getAchievement(e))),tagInputProps:{onRemove:e=>{var s;void 0!==(s=(e=>n.getUuidByTitle(e))(e.toString()))&&(c.delete(s),l.add(s),t([...c]))}},tagRenderer:e=>e.title,itemPredicate:(e,t)=>t.title.toLowerCase().includes(e.toLowerCase()),resetOnSelect:!0})};var ut=function(e){const{changeCardBackground:t,changeGoalUuids:s,changePosition:a,changePrerequisiteUuids:n,changeIsVariableXp:i,editableAchievement:r}=e,{uuid:o,cardBackground:c,goalUuids:l,position:d,prerequisiteUuids:u,isVariableXp:p}=r,[g,m]=Object(j.useState)(!1),b=()=>m(!g);return Object(se.jsxs)(se.Fragment,{children:[Object(se.jsx)(E.a,{content:"More Settings",children:Object(se.jsx)(h.b,{icon:w.a.WRENCH,onClick:b})}),Object(se.jsx)(h.h,{title:"More Settings",icon:w.a.WRENCH,isOpen:g,onClose:b,children:Object(se.jsxs)("div",{style:{padding:"0 0.5em"},children:[Object(se.jsx)("h3",{children:"Card Background"}),Object(se.jsx)(h.l,{multiline:!0,onChange:t,placeholder:"Enter card background URL here",value:c}),Object(se.jsx)("h3",{children:"Position"}),Object(se.jsx)("p",{children:"Note: Select position 0 to hide achievement"}),Object(se.jsx)(lt,{changePosition:a,position:d}),Object(se.jsx)("h3",{children:"Prerequisites"}),Object(se.jsx)(dt,{changePrerequisiteUuids:n,uuid:o,prerequisiteUuids:u}),Object(se.jsx)("h3",{children:"Goals"}),Object(se.jsx)(ot,{changeGoalUuids:s,goalUuids:l}),Object(se.jsx)("h3",{children:"Variable XP"}),Object(se.jsx)(h.f,{label:"The rewarded XP will be equal to the sum of 'count' of goals",checked:p,onChange:i})]})})]})};var ht=function(e){const{uuid:t}=e;return Object(se.jsx)(se.Fragment,{children:Object(se.jsx)(E.a,{content:"Click to copy achievement UUID",children:Object(se.jsx)(h.b,{icon:w.a.CLIPBOARD,onClick:()=>{navigator.clipboard.writeText(t),Object(me.d)("UUID copied to clipboard")}})})})};let pt;!function(e){e.CHANGE_CARD_BACKGROUND="CHANGE_CARD_BACKGROUND",e.CHANGE_DEADLINE="CHANGE_DEADLINE",e.CHANGE_GOAL_UUIDS="CHANGE_GOAL_UUIDS",e.CHANGE_POSITION="CHANGE_POSITION",e.CHANGE_PREREQUISITE_UUIDS="CHANGE_PREREQUISITE_UUIDS",e.CHANGE_RELEASE="CHANGE_RELEASE",e.CHANGE_TITLE="CHANGE_TITLE",e.CHANGE_IS_VARIABLE_XP="CHANGE_VARIABLE_XP",e.CHANGE_VIEW="CHANGE_VIEW",e.CHANGE_XP="CHANGE_XP",e.DELETE_ACHIEVEMENT="DELETE_ACHIEVEMENT",e.DISCARD_CHANGES="DISCARD_CHANGES",e.SAVE_CHANGES="SAVE_CHANGES"}(pt||(pt={}));var gt=s(529),mt=s(75);var bt=function(e){const{type:t,date:s,changeDate:a}=e,[n,i]=Object(j.useState)(!1),r=()=>i(!n),o=void 0===s?`No ${t}`:`${Object(mt.d)(s)}`;return Object(se.jsxs)(se.Fragment,{children:[Object(se.jsx)(E.a,{content:o,children:Object(se.jsx)(h.b,{minimal:!0,onClick:r,outlined:!0,children:`${t}`})}),Object(se.jsxs)(h.h,{isCloseButtonShown:!1,isOpen:n,onClose:r,style:{background:"#fff",maxWidth:"max-content",padding:"0.25em",textAlign:"center"},title:`${t}`,children:[Object(se.jsx)(gt.a,{onChange:a,timePickerProps:{showArrowButtons:!0},value:s}),Object(se.jsx)(h.b,{onClick:()=>a(void 0),text:`Remove ${t}`})]})]})};var jt=function(e){const{changeView:t,view:s}=e,{coverImage:a,description:n,completionText:i}=s,[r,o]=Object(j.useState)(!1),c=()=>o(!r);return Object(se.jsxs)(se.Fragment,{children:[Object(se.jsx)(E.a,{content:"Edit View",children:Object(se.jsx)(h.b,{icon:w.a.WIDGET_HEADER,onClick:c})}),Object(se.jsx)(h.h,{title:"Edit View",icon:w.a.WIDGET_HEADER,isOpen:r,onClose:c,children:Object(se.jsxs)("div",{style:{padding:"0 0.5em"},children:[Object(se.jsx)("h3",{children:"Cover Image"}),Object(se.jsx)(h.l,{multiline:!0,onChange:e=>t({...s,coverImage:e}),placeholder:"Enter cover image URL here",value:a}),Object(se.jsx)("h3",{children:"Description"}),Object(se.jsx)(h.l,{multiline:!0,onChange:e=>t({...s,description:e}),placeholder:"Enter description here",value:n}),Object(se.jsx)("h3",{children:"Completion Text"}),Object(se.jsx)(h.l,{multiline:!0,onChange:e=>t({...s,completionText:e}),placeholder:"Enter completion text here",value:i})]})})]})};const yt=e=>({editableAchievement:e,isDirty:!1}),Ot=(e,t)=>{switch(t.type){case pt.SAVE_CHANGES:return{...e,isDirty:!1};case pt.DISCARD_CHANGES:return yt(t.payload);case pt.DELETE_ACHIEVEMENT:return{...e,isDirty:!1};case pt.CHANGE_CARD_BACKGROUND:return{editableAchievement:{...e.editableAchievement,cardBackground:t.payload},isDirty:!0};case pt.CHANGE_DEADLINE:return{editableAchievement:{...e.editableAchievement,deadline:t.payload},isDirty:!0};case pt.CHANGE_GOAL_UUIDS:return{editableAchievement:{...e.editableAchievement,goalUuids:t.payload},isDirty:!0};case pt.CHANGE_POSITION:return{editableAchievement:{...e.editableAchievement,isTask:0!==t.payload,position:t.payload},isDirty:!0};case pt.CHANGE_PREREQUISITE_UUIDS:return{editableAchievement:{...e.editableAchievement,prerequisiteUuids:t.payload},isDirty:!0};case pt.CHANGE_RELEASE:return{editableAchievement:{...e.editableAchievement,release:t.payload},isDirty:!0};case pt.CHANGE_TITLE:return{editableAchievement:{...e.editableAchievement,title:t.payload},isDirty:!0};case pt.CHANGE_VIEW:return{editableAchievement:{...e.editableAchievement,view:t.payload},isDirty:!0};case pt.CHANGE_XP:return{editableAchievement:{...e.editableAchievement,xp:t.payload},isDirty:!0};case pt.CHANGE_IS_VARIABLE_XP:return{editableAchievement:{...e.editableAchievement,isVariableXp:!e.editableAchievement.isVariableXp},isDirty:!0};default:return e}};var ft=function(e){const{uuid:t,isNewAchievement:s,releaseUuid:a,removeCard:n,requestPublish:i}=e,r=Object(j.useContext)(Ze.a),o=r.getAchievement(t),c=Object(j.useMemo)((()=>Object(T.cloneDeep)(o)),[o]),[l,d]=Object(j.useReducer)(Ot,c,yt),[u,p]=Object(j.useState)(s),{editableAchievement:g,isDirty:m}=l,{cardBackground:b,deadline:y,release:O,title:f,view:v,xp:x}=g;return Object(se.jsxs)("li",{className:"editable-card",style:{background:`url(${b}) center/cover`},children:[Object(se.jsx)("div",{className:"action-button",children:m?Object(se.jsx)(it,{discardChanges:()=>d({type:pt.DISCARD_CHANGES,payload:c}),saveChanges:()=>{d({type:pt.SAVE_CHANGES}),r.modifyAchievement(g),u&&(a(),p(!1)),i()}}):Object(se.jsx)(nt,{deleteItem:()=>{d({type:pt.DELETE_ACHIEVEMENT}),r.removeAchievement(t),u&&(a(),p(!1)),n(t),i()},item:f})}),Object(se.jsxs)("div",{className:"content",children:[Object(se.jsx)("h3",{className:"title",children:Object(se.jsx)(h.l,{onChange:e=>d({type:pt.CHANGE_TITLE,payload:e}),placeholder:"Enter your title here",value:f})}),Object(se.jsx)("div",{className:"xp",children:Object(se.jsx)(E.a,{content:"XP",children:Object(se.jsx)(h.H,{value:x,min:0,allowNumericCharactersOnly:!0,leftIcon:w.a.TRENDING_UP,placeholder:"XP",onValueChange:e=>d({type:pt.CHANGE_XP,payload:e})})})}),Object(se.jsxs)("div",{className:"details",children:[Object(se.jsx)(bt,{changeDate:e=>d({type:pt.CHANGE_RELEASE,payload:e}),date:O,type:"Release"}),Object(se.jsx)(bt,{changeDate:e=>d({type:pt.CHANGE_DEADLINE,payload:e}),date:y,type:"Deadline"}),Object(se.jsx)(ht,{uuid:t})]})]}),Object(se.jsxs)("div",{className:"content-button",children:[Object(se.jsx)(jt,{changeView:e=>d({type:pt.CHANGE_VIEW,payload:e}),view:v}),Object(se.jsx)(ut,{changeCardBackground:e=>d({type:pt.CHANGE_CARD_BACKGROUND,payload:e}),changeGoalUuids:e=>{d({type:pt.CHANGE_GOAL_UUIDS,payload:e})},changePosition:e=>d({type:pt.CHANGE_POSITION,payload:e}),changePrerequisiteUuids:e=>d({type:pt.CHANGE_PREREQUISITE_UUIDS,payload:e}),changeIsVariableXp:()=>d({type:pt.CHANGE_IS_VARIABLE_XP}),editableAchievement:g})]})]})};let vt=[];var xt=function(e){const{requestPublish:t}=e,s=Object(j.useContext)(Ze.a),[a,n]=Object(j.useState)(""),i=""===a,r=()=>n(""),o=e=>{let t=0;for(;vt[t].key!==e&&t<vt.length;)t++;vt.splice(t,1)},c=(e,s)=>Object(se.jsx)(ft,{uuid:e,isNewAchievement:s,releaseUuid:r,removeCard:o,requestPublish:t},e);return 0===vt.length&&(vt=s.listSortedAchievementUuids().map((e=>c(e,!1)))),Object(se.jsxs)("div",{className:"achievement-editor",children:[Object(se.jsx)("div",{className:"command",children:Object(se.jsx)(st,{allowNewUuid:i,setNewUuid:e=>{n(e),vt[vt.length]=vt[0],vt[0]=c(e,!0)}})}),Object(se.jsx)("ul",{className:"achievement-container",children:vt})]})},Ct=s(26);var St=function(e){const{filterState:t,icon:s,ownStatus:a}=e,[n,i]=t;return Object(se.jsxs)("div",{className:"filter",onClick:()=>i(a),style:{color:Object(Ze.h)(n,a)},children:[Object(se.jsx)(h.w,{icon:s,iconSize:30}),Object(se.jsx)("p",{children:a})]})},wt=s(293),Et=s(15);var Tt=function(e){const{studentXp:t}=e;return Object(se.jsxs)("div",{className:"milestone",children:[Object(se.jsx)("h3",{children:"Your Total XP"}),Object(se.jsxs)("div",{className:"user-xp",children:[t," XP"]}),Object(se.jsx)("h3",{children:"CA Achievement Level"}),Object(se.jsxs)("div",{className:"details",children:[Object(se.jsxs)("div",{className:"level-badge",children:[Object(se.jsx)("span",{className:"level-icon"}),Object(se.jsx)("p",{children:Se.b.caFulfillmentLevel})]}),Object(se.jsx)("p",{className:"description",children:"Complete CS1101S CA Component"})]}),Object(se.jsxs)("div",{className:"details",children:[Object(se.jsxs)("div",{className:"level-badge",children:[Object(se.jsx)("span",{className:"level-icon"}),Object(se.jsxs)("p",{children:[Se.b.caFulfillmentLevel,"+"]})]}),Object(se.jsx)("p",{className:"description",children:"Counts towards CS1010R"})]}),Object(se.jsx)("div",{className:"footer",children:Object(se.jsxs)("p",{children:["Full CA level of ",Se.b.caFulfillmentLevel," is subjected to change."]})})]})};var kt=function(e){const{studentXp:t}=e,[s,a]=Object(j.useState)(!1),n=Math.floor(t/Ze.j)+1,i=t%Ze.j,r=i/Ze.j;return Object(se.jsxs)("div",{className:"level",onMouseEnter:()=>a(!0),onMouseLeave:()=>a(!1),children:[Object(se.jsxs)("div",{className:"level-badge",children:[Object(se.jsx)("span",{className:"level-icon"}),Object(se.jsx)("p",{children:`Level ${n}`})]}),Object(se.jsxs)("span",{className:"level-progress",children:[Object(se.jsx)(h.N,{animate:!1,className:"progress-bar",stripes:!1,value:r}),Object(se.jsxs)("p",{children:[i," / ",Ze.j," XP"]})]}),0!==Se.b.caFulfillmentLevel&&s&&Object(se.jsx)(Tt,{studentXp:t})]})};var At=function(e){const{name:t,userState:s}=e,[a]=s,n=null===a||void 0===a?void 0:a.courseRegId,i=Object(v.f)((e=>e.session.courseRegId)),o=Object(r.c)();Object(j.useEffect)((()=>{o(n&&n!==i?{type:Et.p,payload:n}:{type:Et.o})}),[n,i,o]);const c=Object(v.f)((e=>e.session.xp));return Object(se.jsxs)("div",{className:"achievement-overview",children:[Object(se.jsx)(kt,{studentXp:c}),Object(se.jsx)("h3",{children:t})]})};const It=new Date(0,0,2).getTime()-new Date(0,0,0).getTime();var Nt=function(e){const{deadline:t}=e,s=void 0!==t&&!Object(mt.a)(t)&&Object(mt.g)(t)<=It?Ze.b.RED:Ze.b.BLACK;return Object(se.jsxs)("div",{className:"deadline",children:[Object(se.jsx)(h.w,{color:s,icon:w.a.STOPWATCH}),Object(se.jsx)("p",{style:{color:s},children:Object(mt.e)(t)})]})};const Mt=(e,t)=>(t?"Total ":"")+e+" XP";var Pt=function(e){const{isBonus:t,xp:s}=e;return Object(se.jsx)("div",{className:"xp",children:0!==s&&Object(se.jsxs)(se.Fragment,{children:[Object(se.jsx)(h.w,{icon:w.a.BANK_ACCOUNT}),Object(se.jsx)("p",{children:Mt(s,t)})]})})};var Rt=function(e){const{uuid:t,focusState:s,isDropdownOpen:a,shouldRender:n,toggleDropdown:i}=e,r=Object(j.useContext)(Ze.a),[o,c]=s,{cardBackground:l,title:d}=r.getAchievement(t),u=r.getDisplayDeadline(t),p=r.getDescendantXp(t),m=r.getProgressFrac(t),b=r.getStatus(t),y=void 0!==a&&0!==r.getImmediateChildren(t).size;return Object(se.jsxs)("div",{className:"achievement-card",onClick:()=>c(t),onClickCapture:i,style:{...Object(Ze.i)(t,o),opacity:n?"100%":"20%",background:`url(${l}) center/cover`},children:[Object(se.jsx)("div",{className:"dropdown-button",children:y&&Object(se.jsx)(h.w,{icon:a?w.a.CARET_DOWN:w.a.CARET_RIGHT})}),Object(se.jsxs)("div",{className:"content",children:[Object(se.jsxs)("div",{className:"heading",children:[Object(se.jsx)("h3",{children:d.toUpperCase()}),b===Ct.b.COMPLETED&&Object(se.jsx)(h.w,{icon:w.a.CONFIRM,intent:g.a.SUCCESS,style:{padding:"1em"}})]}),Object(se.jsxs)("div",{className:"details",children:[Object(se.jsx)(Nt,{deadline:u}),Object(se.jsx)(Pt,{isBonus:y,xp:p})]}),Object(se.jsx)(h.N,{animate:!1,className:"progress",intent:1===m?"success":"primary",stripes:!1,value:m})]})]})};var _t=e=>{let{uuid:t,filterStatus:s,focusState:a}=e;const n=Object(j.useContext)(Ze.a),i=[...n.getImmediateChildren(t)],r=Object(Ze.f)(),[o,c]=Object(j.useState)(!1),l=e=>{const t=n.getStatus(e);switch(s){case Ct.f.ALL:return!0;case Ct.f.ACTIVE:return t===Ct.b.ACTIVE;case Ct.f.COMPLETED:return t===Ct.b.COMPLETED;default:return!1}};return Object(se.jsx)(se.Fragment,{children:(e=>(e=>!n.isPrerequisite(e)&&l(e))(e)||(e=>[...n.getImmediateChildren(e)].reduce(((e,t)=>e||l(t)),!1))(e))(t)&&Object(se.jsxs)("li",{className:"task",children:[Object(se.jsx)(Rt,{uuid:t,focusState:a,isDropdownOpen:o,shouldRender:l(t),toggleDropdown:()=>c(!o)}),Object(se.jsx)(h.g,{isOpen:o,keepChildrenMounted:!0,children:Object(se.jsx)("div",{className:"prerequisite-container",children:i.map((e=>Object(se.jsxs)("div",{className:"prerequisite",children:[Object(se.jsx)("div",{className:"dropdown-lines",style:{borderBottom:`1px solid ${r}`,borderLeft:`1px solid ${r}`}}),Object(se.jsx)(Rt,{uuid:e,focusState:a,shouldRender:l(e)})]},e)))})})]})})};var Lt=e=>{let{assessment:t,showToQuestion:s}=e;const a=Object(v.f)((e=>e.session.courseId)),n=Object(j.useMemo)((()=>e=>{if(!a)return void Object(me.e)("Course ID not found");const s=`/courses/${a}/${Object(Ee.a)(null===t||void 0===t?void 0:t.type)}`+`/${null===t||void 0===t?void 0:t.id.toString()}`;we.a.push(s+`/${e}`)}),[null===t||void 0===t?void 0:t.id,null===t||void 0===t?void 0:t.type,a]);return Object(se.jsxs)("div",{children:[Object(se.jsx)("h1",{className:"assessment-feedback",children:"Feedback"}),Object(se.jsx)("div",{className:"feedback-list",children:t&&t.questions.map(((e,t)=>Object(se.jsxs)("div",{className:"assessment-comments",children:[Object(se.jsx)("span",{children:Object(se.jsx)("h2",{className:"question-header",children:"Q"+(t+1)})}),Object(se.jsxs)("div",{className:"box-comment",children:[Object(se.jsx)("p",{children:null===e.comments?"No Comments":e.comments}),Object(se.jsx)("p",{className:"xp",children:"XP: "+e.xp+"/"+e.maxXp})]}),s&&Object(se.jsx)("button",{className:"to-assessment-button",onClick:()=>n(t),children:"To Question"})]},t)))})]})};var Dt=function(e){const{awardedXp:t,completionText:s}=e,a=s?s.split("\n"):[""];return Object(se.jsxs)("div",{className:"completion",children:[t>0&&Object(se.jsx)("h1",{children:`AWARDED ${t}XP`}),a.map(((e,t)=>Object(se.jsxs)("p",{children:[e,Object(se.jsx)("br",{})]},t)))]})};var Bt=function(e){const{goals:t}=e;return Object(se.jsxs)(se.Fragment,{children:[Object(se.jsx)("h1",{className:"progress-header",children:"Progress"}),t.map((e=>(e=>{const{uuid:t,text:s,targetCount:a,count:n,completed:i}=e,r=Math.min(0===a?0:n/a,1);return Object(se.jsxs)("div",{className:"goal",children:[Object(se.jsxs)("div",{className:"goal-badge",children:[Object(se.jsx)("span",{className:"goal-icon"}),Object(se.jsxs)("p",{children:[n," / ",a]})]}),Object(se.jsxs)("div",{className:"goal-progress",children:[Object(se.jsx)("p",{children:s}),Object(se.jsx)(h.N,{animate:!1,className:"progress",intent:i?"success":void 0,stripes:!1,value:r})]})]},t)})(e)))]})};var Ut=function(e){var t;let{focusUuid:s,userState:a}=e;const n=Number.isNaN(+s)||0===+s?void 0:+s;let i;if(a){const[e]=a;i=null===e||void 0===e?void 0:e.courseRegId}const o=Object(v.f)((e=>e.session.courseRegId)),c=void 0!==i&&i!==o,l=Object(r.c)();Object(j.useEffect)((()=>{l({type:H.b}),n&&l(c?{type:Et.g,payload:{assessmentId:n,courseRegId:i}}:{type:Et.f,payload:n})}),[l,n,i,c]);const d=Object(j.useContext)(Ze.a),u=Object(v.f)((e=>e.session.assessments)).get(n),p=(null!==(t=Object(v.f)((e=>e.session.assessmentOverviews)))&&void 0!==t?t:[]).find((e=>e.id===n));if(""===s)return Object(se.jsxs)("div",{className:"no-view",children:[Object(se.jsx)(h.w,{icon:w.a.MOUNTAIN,iconSize:60}),Object(se.jsx)("h2",{children:"Select an achievement"})]});const g=d.getAchievement(s),{deadline:m,title:b,view:y}=g,{coverImage:O,completionText:f,description:x}=y,C=d.getAchievementXp(s),S=d.listGoals(s),E=d.getStatus(s),T=x?x.split("\n"):[""];return Object(se.jsxs)("div",{className:"view",style:{...Object(Ze.g)(),...Object(Ze.e)()},children:[Object(se.jsxs)("div",{className:"cover",style:{background:`rgba(0, 0, 0, 0.5) url(${O}) center/cover`,backgroundBlendMode:"darken"},children:[Object(se.jsx)("h1",{children:b.toUpperCase()}),m&&Object(se.jsx)("p",{children:`Deadline: ${Object(mt.d)(m)}`}),Object(se.jsx)("span",{className:"description",children:T.map(((e,t)=>Object(se.jsxs)("p",{children:[e,Object(se.jsx)("br",{})]},t)))})]}),E===Ct.b.COMPLETED&&u&&p&&p.isManuallyGraded&&Object(se.jsx)(Lt,{assessment:u,showToQuestion:!c}),S.length>0&&Object(se.jsxs)(se.Fragment,{children:[Object(se.jsx)(Bt,{goals:S}),E===Ct.b.COMPLETED&&Object(se.jsxs)(se.Fragment,{children:[Object(se.jsx)("hr",{}),Object(se.jsx)(Dt,{awardedXp:C,completionText:f})]})]})]})};function Gt(e){return"graded"===e.gradingStatus||!e.isManuallyGraded&&"submitted"===e.status}var Ft=function(e,t,s){const a=[...e].sort(((e,t)=>b()(e.closeAt).diff(b()(t.closeAt)))),n=e.length,i=t.map((e=>e.type)),r=i.map((e=>[]));a.forEach(((e,t)=>{if(!Object(mt.b)(new Date(e.openAt))||Object(mt.a)(new Date(e.closeAt))&&"submitted"!==e.status)return;const a=e.id.toString();s.hasAchievement(a)||(s.insertFakeGoalDefinition({uuid:a+"0",text:`Submitted ${e.title}`,achievementUuids:[a],meta:{type:Ct.l.ASSESSMENT,assessmentNumber:e.id,requiredCompletionFrac:0}},"submitted"===e.status),e.isManuallyGraded&&s.insertFakeGoalDefinition({uuid:a+"1",text:`Graded ${e.title}`,achievementUuids:[a],meta:{type:Ct.l.ASSESSMENT,assessmentNumber:e.id,requiredCompletionFrac:0}},"graded"===e.gradingStatus),s.insertFakeAchievement({uuid:a,title:e.title,xp:Gt(e)?e.xp:e.maxXp,isVariableXp:!1,deadline:new Date(e.closeAt),release:new Date(e.openAt),isTask:void 0!==e.isPublished&&e.isPublished,position:t-n-100,prerequisiteUuids:[],goalUuids:e.isManuallyGraded?[a+"0",a+"1"]:[a+"0"],cardBackground:`${Ze.c}/default.png`,view:{coverImage:e.coverImage,description:e.shortSummary,completionText:`XP: ${e.xp} / ${e.maxXp}`}}),Gt(e)&&i.forEach(((t,s)=>{t===e.type&&r[s].push(a)})))})),r.forEach(((e,t)=>{const a=i[t];e.length>0&&s.insertFakeAchievement({uuid:a,title:"Completed "+a,xp:0,isVariableXp:!1,deadline:void 0,release:void 0,isTask:!0,position:-1-t,prerequisiteUuids:e,goalUuids:[],cardBackground:`${Ze.c}/default.png`,view:{coverImage:`${Ze.d}/default.png`,description:"Your completed "+a+" are listed here!",completionText:""}})}))};const Ht=(e,t,s)=>e.map((e=>Object(se.jsx)(_t,{uuid:e,filterStatus:t,focusState:s},e)));var Vt=function(e){const{getAchievements:t,getOwnGoals:s,getGoals:a,getUserAssessmentOverviews:n,getUsers:i,updateGoalProgress:r,fetchAssessmentOverviews:o,group:c,inferencer:l,name:d,role:u,assessmentConfigs:h,assessmentOverviews:p,achievementAssessmentOverviews:g,users:m}=e,b=Object(j.useState)(void 0),[y]=b;Object(j.useEffect)((()=>{y?a(y.courseRegId):s(),y?n(y.courseRegId):o(),t()}),[y,t,a,s,n,o]);const O=y?g:p;O&&h&&Ft(O,h,l);const f=Object(j.useState)(Ct.f.ALL),[v]=f,C=Object(j.useState)(""),[S,E]=C,T=Object(j.useState)(!1),[k]=T;return Object(j.useEffect)((()=>{E("")}),[y,E]),Object(se.jsx)(Ze.a.Provider,{value:l,children:Object(se.jsxs)("div",{className:"AchievementDashboard",children:[Object(se.jsx)(At,{name:y?y.name||y.username:d||"User",userState:b}),u&&u!==x.a.Student&&Object(se.jsx)(wt.a,{userState:b,hiddenState:T,studio:c||"Staff",users:m,getUsers:i,updateGoalProgress:r}),Object(se.jsxs)("div",{className:"achievement-main",children:[Object(se.jsxs)("div",{className:"filter-container",children:[Object(se.jsx)(St,{filterState:f,icon:w.a.GLOBE,ownStatus:Ct.f.ALL}),Object(se.jsx)(St,{filterState:f,icon:w.a.LOCATE,ownStatus:Ct.f.ACTIVE}),Object(se.jsx)(St,{filterState:f,icon:w.a.ENDORSED,ownStatus:Ct.f.COMPLETED})]}),Object(se.jsx)("ul",{className:"task-container",children:Ht(u!==x.a.Student&&k?l.listAllSortedAchievementUuids():l.listSortedReleasedTaskUuids(),v,C)}),Object(se.jsx)("div",{className:"view-container",children:Object(se.jsx)(Ut,{focusUuid:S,userState:b})})]})]})})};var Wt=function(e){const{awaitPublish:t,publishChanges:s}=e,a=Object(j.useContext)(Ze.a),[n,i]=Object(j.useReducer)((e=>!e),!1),r=Object(j.useState)(""),[o]=r;return Object(se.jsxs)("div",{className:"achievement-preview",children:[Object(se.jsxs)("div",{className:"command",children:[Object(se.jsx)(h.b,{className:"command-button",icon:n&&w.a.ARROW_LEFT,rightIcon:!n&&w.a.ARROW_RIGHT,text:n?"Task":"View",onClick:i}),t&&Object(se.jsx)(h.b,{className:"command-button",icon:w.a.CLOUD_UPLOAD,intent:"primary",text:"Publish Changes",onClick:s})]}),n?Object(se.jsx)("div",{className:"preview-container",children:Object(se.jsx)(Ut,{focusUuid:o})}):Object(se.jsx)("ul",{className:"preview-container",children:Ht(a.listSortedTaskUuids(),Ct.f.ALL,r)})]})};let Xt;!function(e){e.CHANGE_META="CHANGE_META",e.CHANGE_TEXT="CHANGE_TEXT",e.DELETE_GOAL="DELETE_GOAL",e.DISCARD_CHANGES="DISCARD_CHANGES",e.SAVE_CHANGES="SAVE_CHANGES"}(Xt||(Xt={}));const $t=e=>{switch(e){case Ct.l.ASSESSMENT:return{type:Ct.l.ASSESSMENT,assessmentNumber:0,requiredCompletionFrac:0};case Ct.l.BINARY:return{type:Ct.l.BINARY,condition:!1,targetCount:1};case Ct.l.MANUAL:return{type:Ct.l.MANUAL,targetCount:1};case Ct.l.EVENT:return{type:Ct.l.EVENT,eventNames:[Ct.e.RUN_CODE],targetCount:1,release:void 0,deadline:void 0,observeFrom:void 0,observeTo:void 0}}},qt={uuid:"",text:"Goal Text Here",achievementUuids:[],meta:$t(Ct.l.MANUAL)};var zt=function(e){const{assessmentMeta:t,changeMeta:s}=e,{assessmentNumber:a,requiredCompletionFrac:n}=t;return Object(se.jsxs)(se.Fragment,{children:[Object(se.jsx)(E.a,{content:"Assessment Number",children:Object(se.jsx)(h.H,{allowNumericCharactersOnly:!0,onValueChange:e=>s({...t,assessmentNumber:e}),placeholder:"Enter assessment number here",value:a})}),Object(se.jsx)(E.a,{content:"Required Completion Percentage",children:Object(se.jsx)(h.H,{allowNumericCharactersOnly:!0,max:100,min:0,onValueChange:e=>{const a=e/100;s({...t,requiredCompletionFrac:a})},placeholder:"Enter required completion percentage here",rightElement:Object(se.jsx)("p",{children:"%"}),value:100*n})})]})};let Yt;function Kt(){for(var e=arguments.length,t=new Array(e),s=0;s<e;s++)t[s]=arguments[s];return{type:"AND",operands:t}}function Qt(){for(var e=arguments.length,t=new Array(e),s=0;s<e;s++)t[s]=arguments[s];return{type:"OR",operands:t}}!function(e){e.ACHIEVEMENT="achievement",e.ASSESSMENT_GRADING="assessment-grading",e.ASSESSMENT_SUBMISSION="assessment-submission"}(Yt||(Yt={}));const Jt=ct.a.ofType(),Zt=(e,t)=>{let{handleClick:s}=t;return Object(se.jsx)(h.B,{onClick:s,text:e},e)},es=e=>{if("object"===typeof e&&"type"in e){const{type:t,operands:s}=e,a=s.length,n=[];for(let e=0;e<a;e++)n.push(es(s[e])),e!==a-1&&n.push(t);return n.flat()}return[JSON.stringify(e)]};var ts=function(e){const{binaryMeta:t,changeMeta:s}=e,{condition:a,targetCount:n}=t,i=[],r=[],o=es(a);for(let l=0;l<o.length;l++)l%2===0?r[r.length]=o[l]:i[i.length]=o[l];const c=()=>{let e=JSON.parse(r[0]);for(let t=1;t<r.length;t++)e="AND"===i[t-1]?Kt(e,JSON.parse(r[t])):Qt(e,JSON.parse(r[t]));s({...t,condition:e})};return Object(se.jsxs)(se.Fragment,{children:[Object(se.jsx)(E.a,{content:"Target Count",children:Object(se.jsx)(h.H,{allowNumericCharactersOnly:!0,leftIcon:w.a.BANK_ACCOUNT,min:0,onValueChange:e=>s({...t,targetCount:e}),placeholder:"Enter target count here",value:n})}),o.map(((e,t)=>Object(se.jsx)("div",{children:t%2===0?Object(se.jsxs)(se.Fragment,{children:[Object(se.jsx)(E.a,{content:"Condition",children:Object(se.jsx)(h.l,{onChange:e=>((e,t)=>{r[t]=e,c()})(e,t/2),multiline:!0,placeholder:"Enter condition here",value:e})}),r.length>1&&Object(se.jsx)(E.a,{content:"Delete Condition",children:Object(se.jsx)(h.b,{intent:"danger",icon:"trash",onClick:()=>(e=>{for(let t=e;t<r.length-1;t++)r[t]=r[t+1],i[t]=i[t+1];r.length=r.length-1,i.length=i.length-1,c()})(t)})})]}):Object(se.jsx)(E.a,{content:"And/Or",children:Object(se.jsx)(Jt,{filterable:!1,itemRenderer:Zt,items:["AND","OR"],onItemSelect:e=>((e,t)=>{i[t]=e,c()})(e,(t-1)/2),children:Object(se.jsx)(h.b,{minimal:!0,outlined:!0,text:e})})})},t))),Object(se.jsx)("br",{}),Object(se.jsx)(h.b,{minimal:!0,outlined:!0,text:"Add Condition",onClick:()=>{i.push("AND"),r.push('{"event":"", "restriction":""}'),c()}})]})};var ss=function(e){const{type:t,date:s,changeDate:a}=e,[n,i]=Object(j.useState)(!1),r=()=>i(!n),o=void 0===s?`No ${t}`:`${Object(mt.d)(s)}`;return Object(se.jsxs)(se.Fragment,{children:[Object(se.jsx)(E.a,{content:o,children:Object(se.jsx)(h.b,{minimal:!0,onClick:r,outlined:!0,children:`${t}`})}),Object(se.jsxs)(h.h,{isCloseButtonShown:!1,isOpen:n,onClose:r,style:{background:"#fff",maxWidth:"max-content",padding:"0.25em",textAlign:"center"},title:`${t}`,children:[Object(se.jsx)(gt.a,{onChange:a,timePickerProps:{showArrowButtons:!0},value:s}),Object(se.jsx)(h.b,{onClick:()=>a(void 0),text:`Remove ${t}`})]})]})},as=s(532);var ns=function(e){const{type:t,time:s,changeTime:a}=e,[n,i]=Object(j.useState)(!1),r=()=>i(!n),o=void 0===s?`No ${t}`:`${Object(mt.f)(s)}`;return Object(se.jsxs)(se.Fragment,{children:[Object(se.jsx)(E.a,{content:o,children:Object(se.jsx)(h.b,{minimal:!0,onClick:r,outlined:!0,children:`${t}`})}),Object(se.jsxs)(h.h,{isCloseButtonShown:!1,isOpen:n,onClose:r,style:{background:"#fff",maxWidth:"max-content",padding:"0.25em",textAlign:"center"},title:`${t}`,children:[Object(se.jsx)(as.a,{onChange:a,showArrowButtons:!0,value:s}),Object(se.jsx)(h.b,{onClick:()=>a(void 0),text:`Remove ${t}`})]})]})};const is=ct.a.ofType(),rs=(e,t)=>{let{handleClick:s}=t;return Object(se.jsx)(h.B,{onClick:s,text:e},e)};var os=function(e){const{changeMeta:t,eventMeta:s}=e,{eventNames:a,targetCount:n,release:i,deadline:r,observeFrom:o,observeTo:c}=s,l=e=>n=>((e,n)=>{e===Ct.e.NONE?t({...s,eventNames:a.filter(((e,t)=>t!==n))}):(a[n]=e,t({...s,eventNames:a}))})(n,e);return Object(se.jsxs)(se.Fragment,{children:[a.map(((e,t)=>Object(se.jsx)(E.a,{content:"Change event type "+t,children:Object(se.jsx)(is,{filterable:!1,items:Object.values(Ct.e),itemRenderer:rs,onItemSelect:l(t),children:Object(se.jsx)(h.b,{outlined:!0,text:e})})},t))),Object(se.jsx)(E.a,{content:"Add Event",children:Object(se.jsx)(h.b,{outlined:!0,text:"Add Event",onClick:()=>{a[a.length]=Ct.e.RUN_CODE,t({...s,eventNames:a})}})}),Object(se.jsx)(E.a,{content:"Target Count",children:Object(se.jsx)(h.H,{allowNumericCharactersOnly:!0,leftIcon:w.a.LOCATE,min:0,onValueChange:e=>t({...s,targetCount:e}),placeholder:"Enter target count here",value:n})}),Object(se.jsx)("br",{}),Object(se.jsx)(ss,{type:"Release",date:i,changeDate:e=>{t({...s,release:e})}}),Object(se.jsx)(ss,{type:"Deadline",date:r,changeDate:e=>{t({...s,deadline:e})}}),Object(se.jsx)(ns,{type:"Observe From",time:o,changeTime:e=>{t({...s,observeFrom:e})}}),Object(se.jsx)(ns,{type:"Observe To",time:c,changeTime:e=>{t({...s,observeTo:e})}})]})};var cs=function(e){const{changeMeta:t,manualMeta:s}=e,{targetCount:a}=s;return Object(se.jsx)(E.a,{content:"Target Count",children:Object(se.jsx)(h.H,{allowNumericCharactersOnly:!0,leftIcon:w.a.BANK_ACCOUNT,min:0,onValueChange:e=>t({...s,targetCount:e}),placeholder:"Enter target count here",value:a})})};var ls=function(e){const{changeMeta:t,meta:s}=e,{type:a}=s,n=ct.a.ofType();return Object(se.jsxs)(se.Fragment,{children:[Object(se.jsx)(E.a,{content:"Change Goal Type",children:Object(se.jsx)(n,{filterable:!1,itemRenderer:(e,t)=>{let{handleClick:s}=t;return Object(se.jsx)(h.B,{onClick:s,text:e},e)},items:Object.values(Ct.l),onItemSelect:e=>t($t(e)),children:Object(se.jsx)(h.b,{minimal:!0,outlined:!0,text:a})})}),(e=>{switch(e){case Ct.l.ASSESSMENT:return Object(se.jsx)(zt,{assessmentMeta:s,changeMeta:t});case Ct.l.BINARY:return Object(se.jsx)(ts,{binaryMeta:s,changeMeta:t});case Ct.l.MANUAL:return Object(se.jsx)(cs,{changeMeta:t,manualMeta:s});case Ct.l.EVENT:return Object(se.jsx)(os,{eventMeta:s,changeMeta:t});default:return null}})(a)]})};const ds=e=>({editableGoal:e,isDirty:!1}),us=(e,t)=>{switch(t.type){case Xt.SAVE_CHANGES:return{...e,isDirty:!1};case Xt.DISCARD_CHANGES:return ds(t.payload);case Xt.DELETE_GOAL:return{...e,isDirty:!1};case Xt.CHANGE_META:return{editableGoal:{...e.editableGoal,meta:t.payload},isDirty:!0};case Xt.CHANGE_TEXT:return{editableGoal:{...e.editableGoal,text:t.payload},isDirty:!0};default:return e}};var hs=function(e){const{uuid:t,isNewGoal:s,releaseUuid:a,removeCard:n,requestPublish:i}=e,r=Object(j.useContext)(Ze.a),o=r.getGoalDefinition(t),c=Object(j.useMemo)((()=>Object(T.cloneDeep)(o)),[o]),[l,d]=Object(j.useReducer)(us,c,ds),[u,p]=Object(j.useState)(s),{editableGoal:g,isDirty:m}=l,{meta:b,text:y}=g;return Object(se.jsxs)("li",{className:"editable-goal",id:t,children:[Object(se.jsx)("div",{className:"action-button",children:m?Object(se.jsx)(it,{discardChanges:()=>d({type:Xt.DISCARD_CHANGES,payload:c}),saveChanges:()=>{d({type:Xt.SAVE_CHANGES}),r.modifyGoalDefinition(g),u&&(a(),p(!1)),i()}}):Object(se.jsx)(nt,{deleteItem:()=>{d({type:Xt.DELETE_GOAL}),r.removeGoalDefinition(t),u&&(a(),p(!1)),n(t),i()},item:y})}),Object(se.jsx)("h3",{children:Object(se.jsx)(h.l,{onChange:e=>d({type:Xt.CHANGE_TEXT,payload:e}),placeholder:"Enter goal text here",value:y})}),Object(se.jsx)("div",{className:"meta",children:Object(se.jsx)(ls,{changeMeta:e=>d({type:Xt.CHANGE_META,payload:e}),meta:b})})]})};var ps=function(e){const{allowNewUuid:t,setNewUuid:s}=e,a=Object(j.useContext)(Ze.a);return Object(se.jsx)(h.b,{className:"command-button",disabled:!t,icon:w.a.NEW_OBJECT,onClick:()=>s(a.insertGoalDefinition(qt)),text:"Create Goal"})};let gs=[];var ms=function(e){const{requestPublish:t}=e,s=Object(j.useContext)(Ze.a),[a,n]=Object(j.useState)(""),i=""===a,r=()=>n(""),o=e=>{let t=0;for(;gs[t].key!==e&&t<gs.length;)t++;gs.splice(t,1)},c=(e,s)=>Object(se.jsx)(hs,{uuid:e,isNewGoal:s,releaseUuid:r,requestPublish:t,removeCard:o},e);return 0===gs.length&&(gs=s.getAllGoalUuids().map((e=>c(e,!1)))),Object(se.jsxs)("div",{className:"goal-editor",children:[Object(se.jsx)("div",{className:"command",children:Object(se.jsx)(ps,{allowNewUuid:i,setNewUuid:e=>{n(e),gs[gs.length]=gs[0],gs[0]=c(e,!0)}})}),Object(se.jsx)("ul",{className:"goal-container",children:gs})]})};var bs=function(e){const{bulkUpdateAchievements:t,bulkUpdateGoals:s,getAchievements:a,getOwnGoals:n,removeAchievement:i,removeGoal:r,inferencer:c}=e;Object(j.useEffect)((()=>{a(),n()}),[a,n]);const[l,d]=Object(j.useState)(!1),u=()=>{d(!0),h()},[,h]=Object(j.useReducer)((e=>e+1),0);return Object(se.jsxs)(Ze.a.Provider,{value:c,children:[Object(se.jsx)(o.a,{message:"You have unpublished changes. Are you sure you want to leave?",when:l}),Object(se.jsxs)("div",{className:"AchievementControl",children:[Object(se.jsx)(Wt,{awaitPublish:l,publishChanges:()=>{s(c.getAllGoals()),t(c.getAllAchievements()),c.getGoalsToDelete().forEach(r),c.getAchievementsToDelete().forEach(i),c.resetToDelete(),d(!1)}}),Object(se.jsx)(xt,{requestPublish:u}),Object(se.jsx)(ms,{requestPublish:u})]})]})};var js=Object(r.b)((e=>({inferencer:new Qe.a(e.achievement.achievements,e.achievement.goals)})),(e=>Object(c.b)({bulkUpdateAchievements:Je.bulkUpdateAchievements,bulkUpdateGoals:Je.bulkUpdateGoals,getAchievements:Je.getAchievements,getOwnGoals:Je.getOwnGoals,removeAchievement:Je.removeAchievement,removeGoal:Je.removeGoal},e)))(bs);var ys=Object(r.b)((e=>({group:e.session.group,inferencer:new Qe.a(e.achievement.achievements,e.achievement.goals),name:e.session.name,role:e.session.role,assessmentOverviews:e.session.assessmentOverviews,achievementAssessmentOverviews:e.achievement.assessmentOverviews,users:e.achievement.users,assessmentConfigs:e.session.assessmentConfigurations})),(e=>Object(c.b)({fetchAssessmentOverviews:u.fetchAssessmentOverviews,getAchievements:Je.getAchievements,getGoals:Je.getGoals,getOwnGoals:Je.getOwnGoals,getUserAssessmentOverviews:Je.getUserAssessmentOverviews,getUsers:Je.getUsers,updateGoalProgress:Je.updateGoalProgress},e)))(Vt);var Os=function(e){const{role:t}=e,s=t===x.a.Admin||t===x.a.Staff?js:Ke;return Object(se.jsxs)(o.e,{children:[Object(se.jsx)(o.c,{exact:!0,path:"/courses/:courseId/achievements",component:ys}),Object(se.jsx)(o.c,{path:"/courses/:courseId/achievements/control",component:s}),Object(se.jsx)(o.c,{component:Ke})]})};var fs=Object(r.b)((e=>({role:e.session.role})),(e=>Object(c.b)({},e)))(Os),vs=s(95),xs=s(68),Cs=s(214);const Ss=e=>{const t=!e.isDebugging&&Object(se.jsx)(K.a,{handleEditorEval:e.handleEditorEval,color:e.isRunning?"#39FF14":void 0,className:e.isRunning?"WaitingCursor":void 0},"run"),s=e.isEditorAutorun&&Object(se.jsx)(J.a,{label:"Auto",icon:w.a.AUTOMATIC_UPDATES}),a=!e.pauseDisabled&&e.isRunning&&!e.isDebugging&&Object(se.jsx)(J.a,{label:"Pause",icon:w.a.STOP,onClick:e.handleDebuggerPause}),n=!e.isRunning&&e.isDebugging&&Object(se.jsx)(J.a,{label:"Resume",icon:w.a.CHEVRON_RIGHT,onClick:e.handleDebuggerResume}),i=t=>e.isDebugging&&Object(se.jsx)(J.a,{label:t,icon:w.a.STOP,onClick:e.handleDebuggerReset}),{isMobileBreakpoint:r}=Object(v.e)();return r?Object(se.jsxs)(se.Fragment,{children:[false,a,n,i("Stop")]}):Object(se.jsxs)(se.Fragment,{children:[!e.autorunDisabled&&Object(se.jsx)("div",{className:"Switch",children:Object(se.jsx)(h.T,{label:"",checked:e.isEditorAutorun,onChange:e.handleToggleEditorAutorun})}),s||t,a,n,i("Stop Debugger")]})};var ws=s(136),Es=s(216);const Ts={PREVIOUS_STEP:"left",NEXT_STEP:"right"};class ks extends j.Component{constructor(e){super(e),this.onPrevButtonClick=()=>{this.setState((e=>({currentStep:e.currentStep-1})))},this.onNextButtonClick=()=>{this.setState((e=>({currentStep:e.currentStep+1})))},this.state={steps:[],currentStep:0},Es.a.init((e=>{if(this.state.steps.length>0){const e=document.getElementById("data_visualizer-icon");null===e||void 0===e||e.classList.add("side-content-tab-alert")}this.setState({steps:e,currentStep:0})}))}render(){const e=()=>0===this.state.currentStep,t=()=>!this.state.steps||this.state.currentStep===this.state.steps.length-1,s={PREVIOUS_STEP:this.onPrevButtonClick,NEXT_STEP:this.onNextButtonClick};Object(ws.configure)({ignoreEventsCondition:s=>"ArrowLeft"===s.key&&e()||"ArrowRight"===s.key&&t(),ignoreRepeatedEventsWhenKeyHeldDown:!1,stopEventPropagationAfterIgnoring:!1});const a=this.state.steps[this.state.currentStep];return Object(se.jsx)(ws.GlobalHotKeys,{keyMap:Ts,handlers:s,children:Object(se.jsxs)("div",{className:f()("sa-data-visualizer",p.a.DARK),children:[this.state.steps.length>1?Object(se.jsxs)("div",{style:{position:"relative",display:"flex",justifyContent:"center",alignItems:"center",marginBottom:10},children:[Object(se.jsx)(h.b,{style:{position:"absolute",left:0},large:!0,outlined:!0,icon:w.a.ARROW_LEFT,onClick:this.onPrevButtonClick,disabled:e(),children:"Previous"}),Object(se.jsxs)("h3",{className:"bp4-text-large",children:["Call ",this.state.currentStep+1,"/",this.state.steps.length]}),Object(se.jsx)(h.b,{style:{position:"absolute",right:0},large:!0,outlined:!0,icon:w.a.ARROW_RIGHT,onClick:this.onNextButtonClick,disabled:t(),children:"Next"})]}):null,this.state.steps.length>0?Object(se.jsx)("div",{style:{display:"flex",flexDirection:"row",overflowX:"auto"},children:null===a||void 0===a?void 0:a.map(((e,t)=>Object(se.jsxs)("div",{style:{margin:a.length>1?0:"0 auto"},children:[" ",Object(se.jsxs)(h.e,{style:{background:"#1a2530",padding:10},children:[a.length>1&&Object(se.jsxs)("h5",{className:"bp4-heading bp4-monospace-text",style:{marginTop:0,marginBottom:20,whiteSpace:"nowrap"},children:["Structure ",t+1]}),e]})]},t)))},a.length):Object(se.jsxs)("p",{id:"data-visualizer-default-text",className:p.a.RUNNING_TEXT,children:["The data visualizer helps you to visualize data structures.",this.state.steps,Object(se.jsx)("br",{}),Object(se.jsx)("br",{}),"It is activated by calling the function"," ",Object(se.jsxs)("code",{children:["draw_data(x",Object(se.jsx)("sub",{children:"1"}),", x",Object(se.jsx)("sub",{children:"2"}),", ... x",Object(se.jsx)("sub",{children:"n"}),")"]}),", where"," ",Object(se.jsxs)("code",{children:["x",Object(se.jsx)("sub",{children:"k"})]})," ","would be the"," ",Object(se.jsxs)("code",{children:["k",Object(se.jsx)("sup",{children:"th"})]})," ","data structure that you want to visualize and ",Object(se.jsx)("code",{children:"n"})," is the number of structures.",Object(se.jsx)("br",{}),Object(se.jsx)("br",{}),"The data visualizer uses box-and-pointer diagrams, as introduced in"," ",Object(se.jsx)("a",{href:Se.a.textbookChapter2_2,rel:"noopener noreferrer",target:"_blank",children:Object(se.jsx)("i",{children:"Structure and Interpretation of Computer Programs, JavaScript Edition, Chapter 2, Section 2"})}),"."]})]})})}}var As=ks,Is=s(174);class Ns extends j.Component{constructor(e){super(e),this.handleResize=Object(T.debounce)((()=>{const e=this.calculateWidth(this.props.editorWidth),t=this.calculateHeight(this.props.sideContentHeight);e===this.state.width&&t===this.state.height||(this.setState({height:t,width:e}),Is.a.updateDimensions(e,t))}),300),this.state={visualization:null,width:this.calculateWidth(e.editorWidth),height:this.calculateHeight(e.sideContentHeight)},Is.a.init((e=>this.setState({visualization:e})),this.state.width,this.state.height)}calculateWidth(e){let t;return t=void 0===e?window.innerWidth-50:Math.min(5e3,window.innerWidth*(100-parseFloat(e))/100-50),Math.min(t,5e3)}calculateHeight(e){let t;return t=window.innerWidth<Se.b.mobileBreakpoint||void 0===e?window.innerHeight-150:e-150,Math.min(t,5e3)}componentDidMount(){this.handleResize(),window.addEventListener("resize",this.handleResize),Is.a.redraw()}componentWillUnmount(){this.handleResize.cancel(),window.removeEventListener("resize",this.handleResize)}componentDidUpdate(e){e.sideContentHeight===this.props.sideContentHeight&&e.editorWidth===this.props.editorWidth||this.handleResize()}render(){return Object(se.jsx)("div",{className:p.a.DARK,children:this.state.visualization||Object(se.jsxs)("p",{id:"env-visualizer-default-text",className:p.a.RUNNING_TEXT,children:["The environment model visualizer generates environment model diagrams following a notation introduced in"," ",Object(se.jsx)("a",{href:Se.a.textbookChapter3_2,rel:"noopener noreferrer",target:"_blank",children:Object(se.jsx)("i",{children:"Structure and Interpretation of Computer Programs, JavaScript Edition, Chapter 3, Section 2"})}),".",Object(se.jsx)("br",{}),Object(se.jsx)("br",{}),"It is activated by setting breakpoints before you run the program. You can set a breakpoint by clicking on the gutter of the editor (where all the line numbers are, on the left). When the program runs into a breakpoint, the visualizer displays the state of the environments before the statement is evaluated, which starts in the line in which you set the breakpoint. Every breakpoint must be at the beginning of a statement."]})})}}var Ms=Ns;class Ps extends j.PureComponent{constructor(e){super(e),this.audio=void 0,this.handleSeeked=()=>{this.stopPreviousPlaybackAndApplyFromStart(this.props.playbackData)},this.handleAudioLoaded=()=>{this.props.handleSetSourcecastDuration(this.audio.current.duration)},this.applyDeltas=e=>{this.props.handleSetCodeDeltasToApply(e)},this.stopPreviousPlaybackAndApplyFromStart=e=>{this.setState({currentDeltaRevision:this.state.currentDeltaRevision+1},(()=>this.applyPlaybackDataFromStart(e)))},this.applyPlaybackDataFromStart=async e=>{const t=e=>new Promise((t=>setTimeout(t,e))),s=this.state.currentDeltaRevision;let a=1e3*this.audio.current.currentTime;this.props.handleEditorValueChange(e.init.editorValue),this.props.handleExternalSelect(e.init.externalLibrary),this.props.handleChapterSelect(e.init.chapter);const n=e.inputs.filter((e=>e.time<=a&&"codeDelta"===e.type)).map((e=>e.data));this.applyDeltas(n);const i=e.inputs.filter((e=>e.time>a)),r=i.length;let o=0;for(;o<r&&this.state.currentDeltaRevision===s;)a=1e3*this.audio.current.currentTime,i[o].time<a?(this.props.handleSetInputToApply(i[o]),o++):await t(20)},this.handlePlayerPausing=()=>{this.audio.current.pause(),this.props.handleSetIsEditorReadonly(!1),this.props.handleSetSourcecastStatus(F.b.paused),this.stopCurrentPlayback()},this.handlePlayerPlaying=()=>{this.audio.current.play(),this.props.handleSetIsEditorReadonly(!0),this.props.handleSetSourcecastStatus(F.b.playing),this.stopPreviousPlaybackAndApplyFromStart(this.props.playbackData),this.props.setSelectedTab&&this.props.setSelectedTab(Ce.b.mobileEditor)},this.handlePlayerStopping=()=>{this.props.handleSetIsEditorReadonly(!1),this.props.handleSetSourcecastStatus(F.b.paused),this.props.handleSetCurrentPlayerTime(0),this.setState({currentPlayerProgress:0})},this.updatePlayerTime=e=>{const{currentTime:t}=e.target;this.props.handleSetCurrentPlayerTime(t),this.setState({currentPlayerProgress:t/this.props.duration}),this.props.playbackStatus===F.b.forcedPaused&&this.handlePlayerPausing()},this.handlePlayerProgressBarChange=e=>{if(this.audio.current){const t=this.props.duration*e;this.audio.current.currentTime=t,this.props.handleSetCurrentPlayerTime(t),this.setState({currentPlayerProgress:e})}},this.renderLabel=e=>{if(this.props.duration){const t=this.props.duration*e,s=Math.floor(t/60),a=Math.floor(t-60*s);return(s<10?"0"+s:s)+":"+(a<10?"0"+a:a)}return"00:00"},this.audio=j.createRef(),this.state={currentDeltaRevision:0,currentPlayerProgress:0,currentSourcecastItem:null,duration:0}}render(){const e=Object(se.jsx)(J.a,{label:"Play",icon:w.a.PLAY,onClick:this.handlePlayerPlaying,isDisabled:!this.props.duration}),t=Object(se.jsx)(J.a,{label:"Pause",icon:w.a.PAUSE,onClick:this.handlePlayerPausing});return Object(se.jsxs)("div",{className:"SourcecastControlBar",children:[Object(se.jsx)("audio",{src:this.props.audioUrl,ref:this.audio,onEnded:this.handlePlayerStopping,onLoadedMetadata:this.handleAudioLoaded,onSeeked:this.handleSeeked,onTimeUpdate:this.updatePlayerTime,preload:"metadata"}),Object(se.jsx)("br",{}),Object(se.jsxs)("div",{className:"PlayerControl",children:[Object(se.jsxs)(h.c,{className:"PlayerControlButton",children:[this.props.playbackStatus===F.b.paused&&e,this.props.playbackStatus===F.b.playing&&t]}),Object(se.jsx)("div",{className:"Slider",children:Object(se.jsx)(h.Q,{min:0,max:1,stepSize:1e-4,onChange:this.handlePlayerProgressBarChange,value:this.state.currentPlayerProgress,labelRenderer:this.renderLabel})})]})]})}stopCurrentPlayback(){this.setState({currentDeltaRevision:this.state.currentDeltaRevision+1})}}var Rs=Ps,_s=(s(198),s(106));var Ls=e=>{const[t,s]=Object(j.useState)(!1),a=()=>s(!1);return Object(se.jsxs)("div",{children:[Object(se.jsx)(J.a,{icon:w.a.TRASH,onClick:()=>s(!0)}),Object(se.jsxs)(h.h,{icon:"info-sign",isOpen:t,onClose:a,title:"Delete Sourcecast",canOutsideClickClose:!0,children:[Object(se.jsx)("div",{className:p.a.DIALOG_BODY,children:Object(se.jsx)("p",{children:"Are you sure to delete this sourcecast entry?"})}),Object(se.jsx)("div",{className:p.a.DIALOG_FOOTER,children:Object(se.jsxs)("div",{className:p.a.DIALOG_FOOTER_ACTIONS,children:[Object(se.jsx)(J.a,{label:"Confirm Delete",icon:w.a.TRASH,onClick:()=>{const{data:t}=e;e.handleDeleteSourcecastEntry(t.id)}}),Object(se.jsx)(J.a,{label:"Cancel",icon:w.a.CROSS,onClick:a})]})})]})]})};class Ds extends j.Component{constructor(e){super(e),this.handleSelect=()=>{const{data:e}=this.props;this.props.handleSetSourcecastData(e.title,e.description,e.uid,e.url,JSON.parse(e.playbackData))}}render(){return Object(se.jsx)(E.a,{content:"Load Sourcecast Recording",children:Object(se.jsx)(J.a,{label:`${this.props.data.title}`,icon:w.a.PAPERCLIP,onClick:this.handleSelect})})}}var Bs=Ds,Us=s(183);class Gs extends j.Component{constructor(e){super(e),this.shareInputElem=void 0,this.shareInputElem=j.createRef(),this.selectShareInputText=this.selectShareInputText.bind(this);const t=`${window.location.protocol}//${window.location.host}/courses/${e.courseId}/sourcecast/${e.data.uid}`;this.state={shareURL:t}}render(){const e=Object(se.jsxs)("div",{children:[Object(se.jsx)("input",{defaultValue:this.state.shareURL,readOnly:!0,ref:this.shareInputElem}),Object(se.jsx)(E.a,{content:"Copy link to clipboard",children:Object(se.jsx)(Us,{text:this.state.shareURL,children:Object(se.jsx)(J.a,{icon:w.a.DUPLICATE,onClick:this.selectShareInputText})})})]},this.state.shareURL);return Object(se.jsx)(Le.a,{popoverClassName:"Popover-share",inheritDarkTheme:!1,content:e,children:Object(se.jsx)(E.a,{content:"Get shareable link",children:Object(se.jsx)(J.a,{icon:w.a.SHARE})})})}selectShareInputText(){null!==this.shareInputElem.current&&(this.shareInputElem.current.focus(),this.shareInputElem.current.select())}}var Fs=Gs;class Hs extends j.Component{constructor(e){super(e),this.defaultColumnDefs=void 0,this.gridApi=void 0,this.handleFilterChange=e=>{const t=e.target.value;this.setState({filterValue:t}),this.gridApi&&this.gridApi.setQuickFilter(t)},this.onGridReady=e=>{this.gridApi=e.api,this.gridApi.sizeColumnsToFit(),window.onresize=()=>this.gridApi.sizeColumnsToFit()},this.state={columnDefs:[{headerName:"Title",field:"title",cellRendererFramework:Bs,cellRendererParams:{handleSetSourcecastData:this.props.handleSetSourcecastData},minWidth:200,suppressMovable:!0,suppressMenu:!0,cellStyle:{"text-align":"left"},hide:!this.props.handleSetSourcecastData},{headerName:"Title",field:"title",minWidth:100,suppressMovable:!0,suppressMenu:!0,hide:!!this.props.handleSetSourcecastData},{headerName:"Uploader",field:"uploader.name",minWidth:150,suppressMovable:!0,suppressMenu:!0,cellStyle:{"text-align":"center"}},{headerName:"Date",valueGetter:e=>{return t=e.data.inserted_at,b()(t).format("MMMM Do YYYY");var t},minWidth:150,suppressMovable:!0,suppressMenu:!0},{headerName:"Share",field:"uid",cellRendererFramework:Fs,cellRendererParams:{courseId:this.props.courseId},minWidth:80,suppressMovable:!0,suppressMenu:!0},{headerName:"Delete",field:"",cellRendererFramework:Ls,cellRendererParams:{handleDeleteSourcecastEntry:this.props.handleDeleteSourcecastEntry},minWidth:100,maxWidth:100,sortable:!1,suppressMovable:!0,suppressMenu:!0,cellStyle:{"text-align":"center"},hide:!this.props.handleDeleteSourcecastEntry},{headerName:"description",field:"description",hide:!0},{headerName:"inserted_at",field:"inserted_at",hide:!0},{headerName:"updated_at",field:"updated_at",hide:!0},{headerName:"audio",field:"audio",hide:!0},{headerName:"playbackData",field:"playbackData",hide:!0},{headerName:"url",field:"url",hide:!0}],filterValue:"",groupFilterEnabled:!1},this.defaultColumnDefs={filter:!0,resizable:!0,sortable:!0}}render(){const e=Object(se.jsx)(h.G,{className:"Sourcecast",description:"Fetching sourcecast index...",icon:Object(se.jsx)(h.R,{size:h.S.LARGE})}),t=Object(T.sortBy)(this.props.sourcecastIndex,[e=>-e.id]),s=Object(se.jsxs)("div",{className:"SourcecastContainer",children:[Object(se.jsx)("br",{}),Object(se.jsx)("div",{children:Object(se.jsx)(h.n,{label:"",labelFor:"text-input",children:Object(se.jsx)(h.y,{id:"searchBar",large:!1,leftIcon:"search",placeholder:"Search",value:this.state.filterValue,onChange:this.handleFilterChange})})}),Object(se.jsx)(h.i,{}),Object(se.jsx)("div",{className:"SourcecastTable",children:Object(se.jsx)("div",{className:"ag-grid-parent",children:Object(se.jsx)(_s.AgGridReact,{domLayout:"autoHeight",columnDefs:this.state.columnDefs,defaultColDef:this.defaultColumnDefs,onGridReady:this.onGridReady,rowData:t,rowHeight:30,pagination:!1,paginationPageSize:50})})}),Object(se.jsx)("br",{})]});return Object(se.jsx)("div",{children:void 0===this.props.sourcecastIndex?e:s})}}var Vs=Hs;const Ws="sourcecast",Xs="Welcome to Sourcecast!",$s={label:"Data Visualizer",iconName:w.a.EYE_OPEN,body:Object(se.jsx)(As,{}),id:Ce.b.dataVisualizer},qs={label:"Env Visualizer",iconName:w.a.GLOBE,body:Object(se.jsx)(Ms,{}),id:Ce.b.envVisualizer};var zs=e=>{const{isMobileBreakpoint:t}=Object(v.e)(),s=Object(r.c)(),[a,n]=j.useState(Ce.b.introduction),i=j.useCallback((()=>{const t=e.match.params.sourcecastId;if(t&&t!==e.uid&&e.sourcecastIndex){const s=e.sourcecastIndex.find((e=>e.uid===t));s&&e.handleSetSourcecastData(s.title,s.description,s.uid,s.url,JSON.parse(s.playbackData))}}),[e]);j.useEffect((()=>{s(Object(Cs.fetchSourcecastIndex)(Ws))}),[]),j.useEffect((()=>{i();const{inputToApply:t}=e;if(t)switch(t.type){case"activeTabChange":n(t.data);break;case"chapterSelect":e.handleChapterSelect(t.data);break;case"externalLibrarySelect":e.handleExternalSelect(t.data);break;case"forcePause":e.handleSetSourcecastStatus(F.b.forcedPaused)}}),[i,e.inputToApply]),j.useEffect((()=>{t||a!==Ce.b.mobileEditor&&a!==Ce.b.mobileEditorRun||n(Ce.b.introduction)}),[t,e,a]);const o=Object(se.jsx)(Ss,{handleDebuggerPause:()=>s(Object(xs.beginDebuggerPause)(Ws)),handleDebuggerReset:()=>s(Object(xs.debuggerReset)(Ws)),handleDebuggerResume:()=>s(Object(xs.debuggerResume)(Ws)),handleEditorEval:e.handleEditorEval,handleInterruptEval:()=>s(Object(xs.beginInterruptExecution)(Ws)),handleToggleEditorAutorun:()=>s(Object(N.toggleEditorAutorun)(Ws)),isDebugging:e.isDebugging,isEditorAutorun:e.isEditorAutorun,isRunning:e.isRunning},"autorun"),c=Object(se.jsx)(V.a,{handleChapterSelect:(t,s)=>{let{chapter:a}=t;return e.handleChapterSelect(a)},sourceChapter:e.sourceChapter,sourceVariant:e.sourceVariant},"chapter"),l=Object(se.jsx)(W.a,{handleReplOutputClear:()=>s(Object(N.clearReplOutput)(Ws))},"clear_repl"),d=Object(se.jsx)(X.a,{handleReplEval:e.handleReplEval,isRunning:e.isRunning},"eval_repl"),u=[{label:"Sourcecast Table",iconName:w.a.HOME,body:Object(se.jsxs)("div",{children:[Object(se.jsx)("span",{className:"Multi-line",children:Object(se.jsx)(h.M,{children:e.title?"Title: "+e.title+"\nDescription: "+e.description:Xs})}),Object(se.jsx)(Vs,{handleSetSourcecastData:e.handleSetSourcecastData,sourcecastIndex:e.sourcecastIndex,courseId:e.courseId})]}),id:Ce.b.introduction},$s,qs],g=(e,t,s)=>{e!==t&&n(e)},m={editorVariant:"sourcecast",editorTabs:e.editorTabs.map(Z.a),codeDeltasToApply:e.codeDeltasToApply,isEditorReadonly:e.isEditorReadonly,editorSessionId:"",handleDeclarationNavigate:e=>s(Object(N.navigateToDeclaration)(Ws,e)),handleEditorEval:e.handleEditorEval,handleEditorValueChange:e.handleEditorValueChange,isEditorAutorun:e.isEditorAutorun,inputToApply:e.inputToApply,isPlaying:e.playbackStatus===F.b.playing,handleEditorUpdateBreakpoints:e=>s(Object(N.setEditorBreakpoint)(e,Ws))},b={output:e.output,replValue:e.replValue,handleBrowseHistoryDown:()=>s(Object(N.browseReplHistoryDown)(Ws)),handleBrowseHistoryUp:()=>s(Object(N.browseReplHistoryUp)(Ws)),handleReplEval:e.handleReplEval,handleReplValueChange:e=>s(Object(N.updateReplValue)(e,Ws)),sourceChapter:e.sourceChapter,sourceVariant:e.sourceVariant,externalLibrary:e.externalLibraryName,replButtons:[d,l]},y={tabs:[]},O={controlBarProps:{editorButtons:[o,c]},editorContainerProps:m,handleSideContentHeightChange:e=>s(Object(N.changeSideContentHeight)(e,Ws)),replProps:b,sideBarProps:y,sideContentHeight:e.sideContentHeight,sideContentProps:{selectedTabId:a,onChange:g,tabs:{beforeDynamicTabs:u,afterDynamicTabs:[]},workspaceLocation:"sourcecast",sideContentHeight:e.sideContentHeight}},x={editorContainerProps:m,replProps:b,sideBarProps:y,mobileSideContentProps:{mobileControlBarProps:{editorButtons:[o,c]},selectedTabId:a,onChange:g,tabs:{beforeDynamicTabs:u,afterDynamicTabs:[]},workspaceLocation:"sourcecast"}},C={handleEditorValueChange:e.handleEditorValueChange,handlePromptAutocomplete:(e,t,a)=>s(Object(N.promptAutocomplete)(Ws,e,t,a)),handleSetCurrentPlayerTime:e=>s(Object(vs.setCurrentPlayerTime)(e,Ws)),handleSetCodeDeltasToApply:e=>s(Object(vs.setCodeDeltasToApply)(e,Ws)),handleSetIsEditorReadonly:e=>s(Object(N.setIsEditorReadonly)(Ws,e)),handleSetInputToApply:e=>s(Object(vs.setInputToApply)(e,Ws)),handleSetSourcecastDuration:e=>s(Object(vs.setSourcecastDuration)(e,Ws)),handleSetSourcecastStatus:e.handleSetSourcecastStatus,audioUrl:e.audioUrl,currentPlayerTime:e.currentPlayerTime,duration:e.playbackDuration,playbackData:e.playbackData,playbackStatus:e.playbackStatus,handleChapterSelect:e.handleChapterSelect,handleExternalSelect:e.handleExternalSelect,setSelectedTab:n};return Object(se.jsxs)("div",{className:f()("Sourcecast",p.a.DARK),children:[Object(se.jsx)(Rs,{...C}),t?Object(se.jsx)(te.a,{...x}):Object(se.jsx)(Te.a,{...O})]})};const Ys="sourcecast";var Ks=Object(o.l)(Object(r.b)((e=>({audioUrl:e.workspaces.sourcecast.audioUrl,currentPlayerTime:e.workspaces.sourcecast.currentPlayerTime,codeDeltasToApply:e.workspaces.sourcecast.codeDeltasToApply,title:e.workspaces.sourcecast.title,description:e.workspaces.sourcecast.description,activeEditorTabIndex:e.workspaces.sourcecast.activeEditorTabIndex,editorTabs:e.workspaces.sourcecast.editorTabs,externalLibraryName:e.workspaces.sourcecast.externalLibrary,isEditorAutorun:e.workspaces.sourcecast.isEditorAutorun,isEditorReadonly:e.workspaces.sourcecast.isEditorReadonly,inputToApply:e.workspaces.sourcecast.inputToApply,isRunning:e.workspaces.sourcecast.isRunning,isDebugging:e.workspaces.sourcecast.isDebugging,enableDebugging:e.workspaces.sourcecast.enableDebugging,output:e.workspaces.sourcecast.output,playbackDuration:e.workspaces.sourcecast.playbackDuration,playbackData:e.workspaces.sourcecast.playbackData,playbackStatus:e.workspaces.sourcecast.playbackStatus,replValue:e.workspaces.sourcecast.replValue,sideContentHeight:e.workspaces.sourcecast.sideContentHeight,sourcecastIndex:e.workspaces.sourcecast.sourcecastIndex,sourceChapter:M.Chapter.CALC,sourceVariant:e.workspaces.sourcecast.context.variant,uid:e.workspaces.sourcecast.uid,courseId:e.session.courseId})),(e=>Object(c.b)({handleChapterSelect:e=>Object(N.chapterSelect)(e,M.Variant.DEFAULT,Ys),handleEditorEval:()=>Object(N.evalEditor)(Ys),handleEditorValueChange:e=>Object(N.updateEditorValue)(e,Ys),handleExternalSelect:e=>Object(N.externalLibrarySelect)(e,Ys),handleReplEval:()=>Object(N.evalRepl)(Ys),handleSetSourcecastData:(e,t,s,a,n)=>Object(vs.setSourcecastData)(e,t,s,a,n,Ys),handleSetSourcecastStatus:e=>Object(vs.setSourcecastStatus)(e,Ys)},e)))(zs)),Qs=(s(238),s(518));var Js=e=>{const[t,s]=y.a.useState([]),[a,n]=y.a.useState(""),i=y.a.useRef(),{CSVReader:r}=Object(Qs.a)(),o=Object(se.jsx)("div",{className:"Grid ag-grid-parent ag-theme-balham",children:Object(se.jsx)(_s.AgGridReact,{domLayout:"autoHeight",columnDefs:[{headerName:"Username",field:"username"},{headerName:"Role",field:"role"},{headerName:"Group",field:"group"}],defaultColDef:{filter:!0,resizable:!0,sortable:!0},onGridReady:e=>{i.current=e.api},onGridSizeChanged:()=>{var e;return null===(e=i.current)||void 0===e?void 0:e.sizeColumnsToFit()},rowData:t,rowHeight:36,suppressCellSelection:!0,suppressMovableColumns:!0,pagination:!0})}),c=[...Se.b.authProviders.entries()].map((e=>{let[t,s]=e;return t})),[l,d]=y.a.useState(c[0]);return Object(se.jsxs)("div",{className:"add-users",children:[Object(se.jsx)(h.p,{children:"Add Users"}),o,Object(se.jsx)(h.r,{children:"Upload a CSV file to mass insert or update users in your course."}),Object(se.jsx)("div",{className:"upload-container",children:Object(se.jsxs)("div",{children:[Object(se.jsxs)("div",{className:"upload-settings",children:[Object(se.jsx)("div",{className:"file-input",children:Object(se.jsx)(r,{onUploadAccepted:e=>(e=>{const{data:a,errors:i}=e;if(i.length)return void n("Error detected while uploading the CSV file! Please recheck the file and try again.");const r=[...t];if(a.length+t.length>1e3)n("Please limit each upload to 1000 entries!");else{for(let e=0;e<a.length;e++){if(2!==a[e].length&&3!==a[e].length)return void n(Object(se.jsxs)(se.Fragment,{children:[Object(se.jsxs)("div",{children:["Invalid format (line ",e,")! Please ensure that the username and role is specified for each row entry!"]}),Object(se.jsx)("br",{}),Object(se.jsxs)("div",{children:["Format: ",Object(se.jsx)("i",{children:"username,role"})," ",Object(se.jsx)("b",{children:"OR"})," ",Object(se.jsx)("i",{children:"username,role,group"})]}),Object(se.jsx)("br",{}),Object(se.jsx)("div",{children:"(please hover over the question mark above for more details)"})]}));if(!Object.values(x.a).includes(a[e][1]))return void n(`Invalid role (line ${e})! Please ensure that the second column of each entry contains one of the following: 'admin, staff, student'`)}a.forEach((e=>{r.push({username:e[0],role:e[1],group:e[2]})})),Object(T.uniqBy)(r,(e=>e.username)).length===r.length?(s(r),n("")):n("There are duplicate usernames in the uploaded CSV(s)!")}})(e),config:{delimiter:",",skipEmptyLines:!0},children:e=>{let{getRootProps:t,acceptedFile:s,ProgressBar:a,getRemoveFileProps:n}=e;return Object(se.jsxs)(se.Fragment,{children:[Object(se.jsx)(h.m,{text:"Upload CSV",inputProps:t()}),Object(se.jsx)(Le.a,{content:Object(se.jsxs)("div",{children:[Object(se.jsxs)("p",{children:[Object(se.jsx)("u",{children:"CSV Format"}),": \xa0",Object(se.jsx)("b",{children:Object(se.jsx)("i",{children:"username,role"})}),"\xa0\xa0OR\xa0\xa0",Object(se.jsx)("b",{children:Object(se.jsx)("i",{children:"username,role,group"})})]}),Object(se.jsxs)("p",{children:[Object(se.jsx)("b",{children:Object(se.jsx)("i",{children:"username"})}),": the username of the learner in the corresponding authentication provider"]}),Object(se.jsxs)("p",{children:[Object(se.jsx)("b",{children:Object(se.jsx)("i",{children:"role"})}),": the role of the learner in this course"," ",Object(se.jsx)("i",{children:"(admin | staff | student)"})]}),Object(se.jsxs)("p",{children:[Object(se.jsx)("b",{children:Object(se.jsx)("i",{children:"group (optional)"})}),": the group name that the learner belongs to in this course"]}),Object(se.jsx)("p",{children:Object(se.jsx)("i",{children:"(*Note that staff or admin will automatically be assigned as group leader and each group"})}),Object(se.jsx)("p",{children:Object(se.jsx)("i",{children:"can only have one leader. If there are duplicates the latest entry will take effect)"})}),Object(se.jsx)("p",{children:"\xa0"}),Object(se.jsx)("p",{children:Object(se.jsx)("u",{children:"Examples:"})}),Object(se.jsx)("p",{children:Object(se.jsx)("i",{children:"(Luminus): \xa0e1234567,student \xa0\u2022\xa0 e1234567,student,Group1"})}),Object(se.jsx)("p",{children:Object(se.jsx)("i",{children:"(Google): \xa0learner@gmail.com,staff \xa0\u2022\xa0 learner@gmail.com,staff,Group1"})}),Object(se.jsx)("p",{children:Object(se.jsx)("i",{children:"(GitHub): \xa0ghusername,admin \xa0\u2022\xa0 ghusername,admin,Group1"})})]}),interactionKind:"hover",position:S.a.TOP,popoverClassName:"file-input-popover",children:Object(se.jsx)(h.w,{icon:w.a.HELP,className:"file-input-icon"})})]})}})}),Object(se.jsx)(h.n,{className:"html-select",label:Object(se.jsxs)("div",{className:"html-select-label",children:[Object(se.jsx)("div",{children:"Authentication Provider"}),Object(se.jsx)(Le.a,{content:"The authentication provider your learners will use to log in with",interactionKind:"hover-target",position:S.a.TOP,popoverClassName:"html-select-popover",children:Object(se.jsx)(h.w,{icon:w.a.HELP,className:"html-select-label-icon"})})]}),inline:!0,children:Object(se.jsx)(h.u,{options:c,value:l,onChange:e=>d(e.target.value)})})]}),a&&Object(se.jsx)(h.d,{intent:g.a.DANGER,title:"Invalid CSV file provided!",children:a})]})}),Object(se.jsx)(h.b,{className:"add-button",text:"Add Users",intent:0===t.length?g.a.NONE:g.a.WARNING,onClick:()=>{e.handleAddNewUsersToCourse(t,l),s([]),d(c[0])}})]})};var Zs=e=>{const{data:t}=e,s=t[e.field],a=y.a.useCallback((()=>{e.setStateHandler(e.rowIndex,!s)}),[e,s]);return Object(se.jsx)(h.T,{checked:s,onChange:a})};var ea=e=>{const[t,s]=y.a.useState(!1),a=y.a.useCallback((()=>{e.deleteRowHandler(e.rowIndex),s(!1)}),[e]);return Object(se.jsxs)(se.Fragment,{children:[Object(se.jsx)(h.b,{icon:w.a.CROSS,onClick:()=>{s(!0)}}),Object(se.jsxs)(h.h,{icon:w.a.WARNING_SIGN,isOpen:t,onClose:()=>s(!1),title:"Warning",children:[Object(se.jsxs)("div",{className:p.a.DIALOG_BODY,children:[Object(se.jsxs)("p",{children:["Are you sure you want to ",Object(se.jsx)("b",{children:"delete"})," the assessment type ",Object(se.jsx)("i",{children:e.data.type}),"?"]}),Object(se.jsx)("p",{children:Object(se.jsx)("b",{children:"All related assessments, submissions and answers will be deleted as well upon clicking the main save button."})})]}),Object(se.jsx)("div",{className:p.a.DIALOG_FOOTER,children:Object(se.jsxs)("div",{className:p.a.DIALOG_FOOTER_ACTIONS,children:[Object(se.jsx)(J.a,{label:"Cancel",icon:w.a.CROSS,onClick:()=>s(!1),options:{minimal:!1}}),Object(se.jsx)(J.a,{label:"Ok",icon:w.a.TICK,onClick:a,options:{minimal:!1,intent:g.a.WARNING}})]})})]})]})};var ta=e=>{const{data:t}=e,s=y.a.useCallback((t=>{e.setStateHandler(e.rowIndex,t)}),[e]);return Object(se.jsx)(h.H,{value:t[e.field],min:0,clampValueOnBlur:!0,onValueChange:s})};function sa(e,t){for(let s=0;s<e.length;s++)if(Object(T.isEqual)(e[s],t))return s;return-1}var aa=e=>{const{assessmentConfig:t,setAssessmentConfig:s,setAssessmentConfigsToDelete:a}=e,n=y.a.useRef(),i=[{headerName:"Assessment Type",field:"type",rowDrag:!0,editable:!0},{headerName:"Is Manually Graded",field:"isManuallyGraded",cellRendererFramework:Zs,cellRendererParams:{setStateHandler:(e,a)=>{var i,r;const o=[...t.current];o[e]={...o[e],isManuallyGraded:a},s(o),null===(i=n.current)||void 0===i||null===(r=i.getDisplayedRowAtIndex(e))||void 0===r||r.setDataValue("isManuallyGraded",a)},field:"isManuallyGraded"}},{headerName:"Display in Dashboard",field:"displayInDashboard",cellRendererFramework:Zs,cellRendererParams:{setStateHandler:(e,a)=>{var i,r;const o=[...t.current];o[e]={...o[e],displayInDashboard:a},s(o),null===(i=n.current)||void 0===i||null===(r=i.getDisplayedRowAtIndex(e))||void 0===r||r.setDataValue("displayInDashboard",a)},field:"displayInDashboard"}},{headerName:"Max Bonus XP",field:"earlySubmissionXp",cellRendererFramework:ta,cellRendererParams:{setStateHandler:(e,a)=>{var i,r;const o=[...t.current];o[e]={...o[e],earlySubmissionXp:a},s(o),null===(i=n.current)||void 0===i||null===(r=i.getDisplayedRowAtIndex(e))||void 0===r||r.setDataValue("earlySubmissionXp",a)},field:"earlySubmissionXp"}},{headerName:"Early Hours Before Decay",field:"hoursBeforeEarlyXpDecay",cellRendererFramework:ta,cellRendererParams:{setStateHandler:(e,a)=>{var i,r;const o=[...t.current];o[e]={...o[e],hoursBeforeEarlyXpDecay:a},s(o),null===(i=n.current)||void 0===i||null===(r=i.getDisplayedRowAtIndex(e))||void 0===r||r.setDataValue("hoursBeforeEarlyXpDecay",a)},field:"hoursBeforeEarlyXpDecay"}},{headerName:"Delete Row",field:"placeholderToPreventColumnRerender",cellRendererFramework:ea,cellRendererParams:{deleteRowHandler:e=>{var i;if(t.current.length<=1)return void Object(me.e)("You must have at least 1 assessment type!");const r=[...t.current],o=r.splice(e,1);null===(i=n.current)||void 0===i||i.setRowData(r),s(r),a(o[0])}},maxWidth:120,resizable:!1}],r=y.a.useCallback((e=>{const s=e.node,a=e.overNode;if(s!==a){const e=s.data,n=null===a||void 0===a?void 0:a.data,i=sa(t.current,e),r=sa(t.current,n),o=[...t.current];!function(e,t,s){const a=e[t];e.splice(t,1),e.splice(s,0,a)}(o,i,r),t.current=o}}),[t]),o=s=>{var a;null===(a=n.current)||void 0===a||a.setRowData(t.current),e.setHasChangesAssessmentConfig(!0)},c=Object(se.jsx)("div",{className:"Grid ag-grid-parent ag-theme-balham",children:Object(se.jsx)(_s.AgGridReact,{domLayout:"autoHeight",columnDefs:i,defaultColDef:{filter:!1,resizable:!0,sortable:!1},onGridReady:e=>{n.current=e.api,e.api.sizeColumnsToFit()},onGridSizeChanged:()=>{var e;return null===(e=n.current)||void 0===e?void 0:e.sizeColumnsToFit()},rowData:e.assessmentConfig.current,rowHeight:36,rowDragManaged:!0,suppressCellSelection:!0,suppressMovableColumns:!0,suppressPaginationPanel:!0,onRowDragMove:r,onRowDragLeave:o,onRowDragEnd:o,onCellValueChanged:s=>{if("type"===s.colDef.field){const a=[...t.current];a[s.rowIndex]={...a[s.rowIndex],type:s.value},t.current=a,e.setHasChangesAssessmentConfig(!0)}}})});return Object(se.jsxs)("div",{className:"assessment-configuration",children:[Object(se.jsxs)("div",{className:"assessment-configuration-header-container",children:[Object(se.jsx)(h.p,{children:"Assessment Configuration"}),Object(se.jsx)(h.b,{text:"Add Row",onClick:()=>{var e;if(t.current.length>=8)return void Object(me.e)("You can have at most 8 assessment types!");const a=[...t.current];a.push({assessmentConfigId:-1,type:"untitled",isManuallyGraded:!0,displayInDashboard:!0,hoursBeforeEarlyXpDecay:0,earlySubmissionXp:0}),s(a),null===(e=n.current)||void 0===e||e.setRowData(a)},className:"add-row-button"})]}),c]})};let na;!function(e){e.WRITE="WRITE",e.PREVIEW="PREVIEW"}(na||(na={}));var ia=e=>{const{isMobileBreakpoint:t}=Object(v.e)(),[s,a]=j.useState(na.WRITE),{courseName:n,courseShortName:i,viewable:r,enableGame:o,enableAchievements:c,enableSourcecast:l,moduleHelpText:d}=e.courseConfiguration,u=Object(se.jsx)(h.Z,{id:"moduleHelpText",className:"input-textarea",fill:!0,value:d||"",onChange:t=>e.setCourseConfiguration({...e.courseConfiguration,moduleHelpText:t.target.value})}),p=Object(se.jsx)("div",{className:"input-markdown",children:Object(se.jsx)(ee.a,{content:d||"",openLinksInNewWindow:!0})}),g=j.useCallback(((e,t,s)=>{e!==t&&a(e)}),[a]);return Object(se.jsxs)("div",{className:"course-configuration",children:[Object(se.jsx)(h.p,{children:n}),Object(se.jsx)(h.q,{children:i}),Object(se.jsxs)("div",{className:"inputs",children:[Object(se.jsxs)("div",{className:"text",children:[Object(se.jsx)(h.n,{helperText:"Please enter the course name that will be used for course selection.",inline:!0,label:"Course Name",labelFor:"courseName",children:Object(se.jsx)(h.y,{id:"courseName",defaultValue:n,onChange:t=>e.setCourseConfiguration({...e.courseConfiguration,courseName:t.target.value})})}),Object(se.jsx)(h.n,{helperText:"Please enter the course short name. This will be displayed on the top left.",inline:!0,label:"Course Short Name",labelFor:"courseShortName",children:Object(se.jsx)(h.y,{id:"courseShortName",defaultValue:i,onChange:t=>e.setCourseConfiguration({...e.courseConfiguration,courseShortName:t.target.value})})}),Object(se.jsxs)(h.n,{helperText:"Please enter the module help text that will be used in the course help dialog.",inline:!0,label:"Module Help Text",labelFor:"moduleHelpText",children:[Object(se.jsxs)(h.V,{selectedTabId:s,onChange:g,className:"module-help-text-tabs",children:[Object(se.jsx)(h.U,{id:na.WRITE,title:"Write"}),Object(se.jsx)(h.U,{id:na.PREVIEW,title:"Preview"})]}),s===na.WRITE&&u,s===na.PREVIEW&&p]})]}),!t&&Object(se.jsx)(h.i,{}),Object(se.jsxs)("div",{className:"booleans",children:[Object(se.jsx)(h.T,{checked:r,label:"Viewable",onChange:t=>e.setCourseConfiguration({...e.courseConfiguration,viewable:t.target.checked})}),Object(se.jsx)(h.T,{checked:o,label:"Enable Game",onChange:t=>e.setCourseConfiguration({...e.courseConfiguration,enableGame:t.target.checked})}),Object(se.jsx)(h.T,{checked:c,label:"Enable Achievements",onChange:t=>e.setCourseConfiguration({...e.courseConfiguration,enableAchievements:t.target.checked})}),Object(se.jsx)(h.T,{checked:l,label:"Enable Sourcecast",onChange:t=>e.setCourseConfiguration({...e.courseConfiguration,enableSourcecast:t.target.checked})})]})]})]})};var ra=e=>{const{data:t}=e,s=y.a.useCallback((s=>{e.handleUpdateUserRole(t.courseRegId,s.target.value)}),[t,e]),a=[{label:"Student",value:x.a.Student},{label:"Staff",value:x.a.Staff},{label:"Admin",value:x.a.Admin}];return Object(se.jsx)(Le.a,{content:"You cannot downgrade yourself from an admin role!",interactionKind:"click",position:S.a.TOP,disabled:e.courseRegId!==t.courseRegId,children:Object(se.jsx)(h.u,{options:a,onChange:s,fill:!0,minimal:!0,style:{textAlign:"center"},value:t.role,disabled:e.courseRegId===t.courseRegId})})};var oa=e=>{const[t,s]=y.a.useState(!1),a=y.a.useCallback((()=>{e.handleDeleteUserFromCourse(e.data.courseRegId),s(!1)}),[e]);return Object(se.jsxs)(se.Fragment,{children:[Object(se.jsx)(Le.a,{content:"You cannot delete an admin!",interactionKind:"click",position:S.a.TOP,disabled:e.data.role!==x.a.Admin,children:Object(se.jsx)(h.b,{text:"Delete User",icon:w.a.CROSS,onClick:()=>{e.data.role!==x.a.Admin?s(!0):Object(me.e)("You cannot delete an admin user!")},disabled:e.data.role===x.a.Admin})}),Object(se.jsxs)(h.h,{icon:w.a.WARNING_SIGN,isOpen:t,onClose:()=>s(!1),title:"Deleting User From Course",canOutsideClickClose:!0,children:[Object(se.jsxs)("div",{className:p.a.DIALOG_BODY,children:[Object(se.jsxs)("p",{children:["Are you sure you want to ",Object(se.jsx)("b",{children:"delete"})," the user"," ",Object(se.jsxs)("i",{children:[e.data.name," (",e.data.username,")"]}),"?"]}),Object(se.jsx)("p",{children:Object(se.jsx)("b",{children:"All their assessment answers will be deleted as well."})})]}),Object(se.jsx)("div",{className:p.a.DIALOG_FOOTER,children:Object(se.jsxs)("div",{className:p.a.DIALOG_FOOTER_ACTIONS,children:[Object(se.jsx)(J.a,{label:"Cancel",icon:w.a.CROSS,onClick:()=>s(!1),options:{minimal:!1}}),Object(se.jsx)(J.a,{label:"Confirm",icon:w.a.TRASH,onClick:a,options:{minimal:!1,intent:g.a.DANGER}})]})})]})]})};var ca=e=>{var t;const s=y.a.useRef(),a=null===(t=e.userCourseRegistrations)||void 0===t?void 0:t.map((e=>e.name?e:{...e,name:"(user has yet to log in)"})),n=[{headerName:"Name",field:"name",sort:"asc"},{headerName:"Username",field:"username"},{headerName:"Group",field:"group"},{headerName:"Role",field:"role",cellRendererFramework:ra,cellRendererParams:{courseRegId:e.courseRegId,handleUpdateUserRole:e.handleUpdateUserRole},width:110},{headerName:"Actions",field:"actions",cellRendererFramework:oa,cellRendererParams:{handleDeleteUserFromCourse:e.handleDeleteUserFromCourse},width:120,filter:!1,resizable:!1}],i=Object(se.jsx)("div",{className:"Grid ag-grid-parent ag-theme-balham",children:Object(se.jsx)(_s.AgGridReact,{domLayout:"autoHeight",columnDefs:n,defaultColDef:{filter:!0,resizable:!0,sortable:!0},onGridReady:e=>{s.current=e.api},onGridSizeChanged:()=>{var e;return null===(e=s.current)||void 0===e?void 0:e.sizeColumnsToFit()},rowData:a,rowHeight:36,suppressCellSelection:!0,suppressMovableColumns:!0,pagination:!0})});return Object(se.jsxs)("div",{className:"users-configuration",children:[Object(se.jsxs)("div",{className:"users-header-container",children:[Object(se.jsx)(h.p,{children:"Users"}),Object(se.jsx)(h.b,{text:"Export as CSV",className:"export-csv-button",onClick:()=>{s.current&&s.current.exportDataAsCsv({fileName:`SA Users (${(new Date).toISOString()}).csv`,columnKeys:["name","username","group","role"]})}})]}),i]})};var la=e=>{const[t,s]=y.a.useState(!1),[a,n]=y.a.useState(!1),[i,r]=y.a.useState({courseName:"",courseShortName:"",viewable:!0,enableGame:!0,enableAchievements:!0,enableSourcecast:!0,moduleHelpText:""}),o=y.a.useRef(e.assessmentConfigurations),[c,l]=y.a.useState([]);y.a.useEffect((()=>{e.handleFetchCourseConfiguration(),e.handleFetchAssessmentConfigs(),e.handleFetchUserCourseRegistrations()}),[]),y.a.useEffect((()=>{r({courseName:e.courseName,courseShortName:e.courseShortName,viewable:e.viewable,enableGame:e.enableGame,enableAchievements:e.enableAchievements,enableSourcecast:e.enableSourcecast,moduleHelpText:e.moduleHelpText}),o.current=Object(T.cloneDeep)(e.assessmentConfigurations)}),[e]);const d={courseConfiguration:i,setCourseConfiguration:e=>{r(e),s(!0)}},u=y.a.useMemo((()=>({assessmentConfig:o,setAssessmentConfig:e=>{o.current=e,n(!0)},setAssessmentConfigsToDelete:e=>{if(-1!==e.assessmentConfigId){const t=[...c];t.push(e),l(t)}},setHasChangesAssessmentConfig:n})),[c]),p={courseRegId:e.courseRegId,userCourseRegistrations:e.userCourseRegistrations,handleUpdateUserRole:e.handleUpdateUserRole,handleDeleteUserFromCourse:e.handleDeleteUserFromCourse},m={handleAddNewUsersToCourse:e.handleAddNewUsersToCourse},b=Object(se.jsxs)("div",{className:"admin-panel",children:[Object(se.jsx)(h.o,{children:"Admin Panel"}),Object(se.jsxs)(h.V,{id:"admin-panel",renderActiveTabPanelOnly:!0,children:[Object(se.jsx)(h.U,{id:"configuration",title:"Configuration",panel:Object(se.jsxs)(se.Fragment,{children:[Object(se.jsx)(ia,{...d}),Object(se.jsx)(h.i,{}),Object(se.jsx)(aa,{...u}),Object(se.jsx)(h.b,{text:"Save",style:{marginTop:"15px"},intent:t||a?g.a.WARNING:g.a.NONE,onClick:()=>{t&&(e.handleUpdateCourseConfig(i),s(!1)),c.length>0&&(c.forEach((t=>{e.handleDeleteAssessmentConfig(t)})),l([])),a&&(e.setAssessmentConfigurations([]),e.handleUpdateAssessmentConfigs(o.current),n(!1))}})]})}),Object(se.jsx)(h.U,{id:"users",title:"Users",panel:Object(se.jsx)(ca,{...p})}),Object(se.jsx)(h.U,{id:"add-users",title:"Add Users",panel:Object(se.jsx)(Js,{...m})})]})]});return Object(se.jsx)(_e.a,{loadContentDispatch:()=>{},display:b,fullWidth:!1})};var da=Object(r.b)((e=>({courseRegId:e.session.courseRegId,courseName:e.session.courseName,courseShortName:e.session.courseShortName,viewable:e.session.viewable,enableGame:e.session.enableGame,enableAchievements:e.session.enableAchievements,enableSourcecast:e.session.enableSourcecast,moduleHelpText:e.session.moduleHelpText,assessmentConfigurations:e.session.assessmentConfigurations,userCourseRegistrations:e.session.userCourseRegistrations})),(e=>Object(c.b)({handleFetchCourseConfiguration:u.fetchCourseConfig,handleFetchAssessmentConfigs:u.fetchAssessmentConfigs,handleFetchUserCourseRegistrations:u.fetchAdminPanelCourseRegistrations,handleUpdateCourseConfig:u.updateCourseConfig,handleUpdateAssessmentConfigs:u.updateAssessmentConfigs,setAssessmentConfigurations:u.setAssessmentConfigurations,handleDeleteAssessmentConfig:u.deleteAssessmentConfig,handleUpdateUserRole:u.updateUserRole,handleDeleteUserFromCourse:u.deleteUserCourseRegistration,handleAddNewUsersToCourse:l.addNewUsersToCourse},e)))(la),ua=s(294);const ha={filter:!0,resizable:!0,sortable:!0};var pa=e=>{let t;const s=e.gradingSummary.cols.map((e=>({headerName:Object(T.startCase)(e),field:e}))),a=Object(se.jsx)("div",{className:"Dashboard",children:Object(se.jsx)("div",{className:"Grid ag-grid-parent ag-theme-balham",children:Object(se.jsx)(_s.AgGridReact,{domLayout:"autoHeight",columnDefs:s,defaultColDef:ha,onGridReady:e=>{t=e.api},onGridSizeChanged:()=>{t&&t.sizeColumnsToFit()},rowData:e.gradingSummary.rows,rowHeight:30,suppressCellSelection:!0,suppressMovableColumns:!0})})});return Object(se.jsx)("div",{children:Object(se.jsx)(_e.a,{display:a,loadContentDispatch:e.handleFetchGradingSummary})})};var ga=Object(r.b)((e=>({gradingSummary:e.dashboard.gradingSummary})),(e=>Object(c.b)({handleFetchGradingSummary:ua.fetchGroupGradingSummary},e)))(pa),ma=s(158);var ba={zektonFont:{key:"zekton",pngPath:"../../assets/zekton.png",fntPath:"../../assets/zekton.fnt"},zektonDarkFont:{key:"zektonDark",pngPath:"../../assets/zekton_dark.png",fntPath:"../../assets/zekton.fnt"},alienCowsFont:{key:"alienAndCows",pngPath:"../../assets/alien_and_cows.png",fntPath:"../../assets/alien_and_cows.fnt"},alienLeagueFont:{key:"alienLeague",pngPath:"../../assets/alien_league.png",fntPath:"../../assets/alien_league.fnt"},pixelFont:{key:"pixel",pngPath:"../../assets/pixel.png",fntPath:"../../assets/pixel.fnt"}};const ja={assetsFolder:Se.a.sourceAcademyAssets,fadeDuration:600,nullFunction:()=>{},nullInteractionId:"",nullSequenceNumber:-1,popUpDuration:1e3,defaultAssetPath:"/ui/wristDeviceButton.png",defaultFontStyle:{key:ba.zektonFont.key,size:30,align:Phaser.GameObjects.BitmapText.ALIGN_CENTER},defaultCursor:""},ya={x:1920,y:1080},Oa={x:ya.x/2,y:ya.y/2},fa={navy:"#03092c",lightBlue:"#ece1fb",offWhite:"#bbc1c9",white:"#ffffff",darkGrey:"#333333",lightGrey:"#555555",blue:"#1133ff",darkBlue:"#0d2440",orange:"#ff9933",yellow:"#ffee33",red:"0#ff0000",maroon:"#142B2E",black:"#000000",purple:"#dd33dd",paleYellow:"#f6ffbd"},va=T.mapValues(fa,(e=>parseInt(e.slice(1),16)));let xa;function Ca(e){let{direction:t=xa.Row,numOfItems:s,maxXSpace:a=ya.x,maxYSpace:n=ya.y,numItemLimit:i=0,redistributeLast:r=!0}=e,o=i||s;const c=Math.ceil(s/o);return T.times(s,(e=>{const i=e%o,l=Math.floor(e/o);return r&&l===c-1&&(o=s%c||o),t===xa.Row?[Sa(ya.x,a,i,o),Sa(ya.y,n,l,c)]:[Sa(ya.x,a,l,c),Sa(ya.y,n,i,o)]}))}function Sa(e,t,s,a){const n=t/a;return(e-t+n)/2+n*s}function wa(e){let{numOfItems:t,xSpacing:s=30,ySpacing:a=30}=e;const n=new Array;for(let i=0;i<t;i++)n.push([i*s,i*a]);return n}!function(e){e.Row="Row",e.Column="Column"}(xa||(xa={}));const Ea={fontFamily:"Verdana",fontSize:"15px",fill:fa.lightBlue,align:"left",wordWrap:{width:290}};class Ta extends Phaser.GameObjects.Container{constructor(e,t,s,a){let n=arguments.length>4&&void 0!==arguments[4]?arguments[4]:300;super(e,t,s),this.renderTextHover(a,n)}renderTextHover(e,t){const s=parseInt(Ea.fontSize.substring(0,Ea.fontSize.length-2)),a=e.length*s*.75,n=Math.min(a,t),i=new Phaser.GameObjects.Text(this.scene,30,10,e,{...Ea,wordWrap:{width:n-10}}),r=new Phaser.GameObjects.Rectangle(this.scene,20,0,n,i.getBounds().bottom+10,va.darkBlue).setOrigin(0,0).setAlpha(.8);this.add([r,i]),this.setDepth(1),this.setVisible(!1)}}var ka=Ta;const Aa=(e,t,s,a)=>{let{x:n,y:i,oriX:r,oriY:o}=s;return new Phaser.GameObjects.BitmapText(e,n,i,a.key,t,a.size,a.align).setOrigin(r,o)},Ia={key:ba.zektonFont.key,size:25,align:Phaser.GameObjects.BitmapText.ALIGN_LEFT},Na={key:ba.alienLeagueFont.key,size:50,align:Phaser.GameObjects.BitmapText.ALIGN_CENTER},Ma={key:ba.zektonFont.key,size:18,align:Phaser.GameObjects.BitmapText.ALIGN_LEFT},Pa={fontFamily:"Verdana",fontSize:"18px",fill:fa.lightBlue,align:"center",lineSpacing:10,wordWrap:{width:500}},Ra={id:"default-award",assetKey:ja.nullInteractionId,assetPath:ja.nullInteractionId,title:ja.nullInteractionId,description:"There is no asset associated with this award.",completed:!1},_a=.3*-ya.x,La=.05*-ya.y,Da=La+275;var Ba={arrow:{x:.08*ya.x,y:.34*ya.y,xOffset:80,xScale:.4,yScale:.3},itemsPerPage:7,list:{yStart:.31*-ya.y,ySpace:100},listTextConfig:{x:.09*-ya.x,y:0,oriX:0,oriY:.55},noPreviewTextConfig:{x:_a,y:-40,oriX:.5,oriY:.5},preview:{descText:{yOffset:320},rect:{dim:430,x:_a,y:La,xOffset:30,yOffset:15},key:{x:_a,y:Da,width:430,height:35},keyTagTextConfig:{x:_a-205,y:Da,oriX:0,oriY:.5},keyTextConfig:{x:_a-90,y:Da,oriX:0,oriY:.5},explanation:{x:_a-150,y:La+200},titleTextConfig:{x:_a+20,y:La-275,oriX:.5,oriY:.5}}};const Ua=e=>e.map((e=>Ga(e))),Ga=e=>{const t=zo.getInstance().getAwardsMapping().get(e);return t||{...Ra,title:e}};let Fa,Ha;!function(e){e.Image="Image",e.Sprite="Sprite"}(Fa||(Fa={})),function(e){e.Background="Background",e.Object="Object"}(Ha||(Ha={}));var Va={spaceshipBg:{type:Fa.Image,key:"spaceship-bg",path:"/locations/spaceshipBackground.png"},saBanner:{type:Fa.Image,key:"sa-banner",path:"/ui/sourceAcadBannerOneLine.png"},shortButton:{type:Fa.Image,key:"short-button",path:"/ui/shortButton.png"},mediumButton:{type:Fa.Image,key:"med-button",path:"/ui/mediumButton.png"},longButton:{type:Fa.Image,key:"long-button",path:"/ui/longButton.png"},topButton:{type:Fa.Image,key:"top-button",path:"/ui/topButton.png"},speechBox:{type:Fa.Image,key:"speechBox",path:"/ui/speechbox.png"},speakerBox:{type:Fa.Image,key:"speakerBox",path:"/ui/speakerBox.png"},defaultLocationImg:{type:Fa.Image,key:"loc-default",path:"/ui/defaultLocation.jpg"},locationPreviewFrame:{type:Fa.Image,key:"loc-preview-frame",path:"/ui/locationPreviewFrame.png"},locationPreviewFill:{type:Fa.Image,key:"loc-preview-fill",path:"/ui/locationPreviewFill.png"},talkOptButton:{type:Fa.Image,key:"talk-opt-button",path:"/ui/talkOptButton.png"},talkOptCheck:{type:Fa.Image,key:"talk-opt-check",path:"/ui/talkOptCheck.png"},modeMenuBanner:{type:Fa.Image,key:"mode-banner",path:"/ui/modeMenuBanner.png"},popUpFrame:{type:Fa.Image,key:"pop-up-frame",path:"/ui/popUpFrame.png"},mediumBox:{type:Fa.Image,key:"medium-box",path:"/ui/mediumBox.png"},diamond:{type:Fa.Image,key:"diamond",path:"/ui/zircon.png"},arrow:{type:Fa.Image,key:"arrow",path:"/ui/arrow.png"},cookies:{type:Fa.Image,key:"cookies",path:"/images/cookies.png"},scrollFrame:{type:Fa.Image,key:"scroll-frame",path:"/ui/scrollFrame.png"},messageBar:{type:Fa.Image,key:"message-bar",path:"/ui/messageBg.png"},escapeMenuBackground:{type:Fa.Image,key:"escape-bg",path:"/ui/escapeMenu.png"},awardsMenu:{type:Fa.Image,key:"award-bg",path:"/ui/collectiblesBg.png"},awardsBanner:{type:Fa.Image,key:"award-banner",path:"/ui/awardsBanner.png"},awardsPageChosen:{type:Fa.Image,key:"award-pg-chosen",path:"/ui/collectiblesPageOptChosen.png"},awardsPage:{type:Fa.Image,key:"award-pg-opt",path:"/ui/collectiblesPageOpt.png"},awardsBackground:{type:Fa.Image,key:"award-hall-bg",path:"/ui/awardsHall.png"},gear:{type:Fa.Image,key:"gear",path:"/ui/settings.png"},journal:{type:Fa.Image,key:"journal",path:"/ui/journal.png"},chapterRepeatButton:{type:Fa.Image,key:"chapter-repeat",path:"/ui/chapterRepeat.png"},chapterContinueButton:{type:Fa.Image,key:"chapter-continue",path:"/ui/chapterContinue.png"},StarGold:{type:Fa.Image,key:"StarGold",path:"/ui/StarGold.png"},StarSilver:{type:Fa.Image,key:"StarSilver",path:"/ui/StarSilver.png"},StarBronze:{type:Fa.Image,key:"StarBronze",path:"/ui/StarBronze.png"},chapterSelectFrame:{type:Fa.Image,key:"chapter-select-frame",path:"/ui/chapterSelectionFrame.png"},chapterSelectBorder:{type:Fa.Image,key:"chapter-select-border",path:"/ui/chapterSelectionBorder.png"},chapterSelectArrow:{type:Fa.Image,key:"chapter-select-arrow",path:"/ui/chapSelectArrow.png"},mainMenuOptBanner:{type:Fa.Image,key:"menu-option",path:"/ui/menuOption.png"},settingBanner:{type:Fa.Image,key:"settings-bg",path:"/ui/settingsBg.png"},settingOption:{type:Fa.Image,key:"settings-opt",path:"/ui/settingsOption.png"},verifiedFrame:{type:Fa.Image,key:"verified-frame",path:"/ui/verifiedFrame.png"},sourceCrashedPod:{type:Fa.Image,key:"source-crashed-pod",path:"/locations/sourceCrashedPod.png"},squareKeyboardIcon:{type:Fa.Image,key:"keyboard-key-square",path:"/ui/keyboardKeyIcon.png"},medKeyboardIcon:{type:Fa.Image,key:"keyboard-key-medium",path:"/ui/TabIcon.png"}};const Wa={volume:0,ease:"Power2"};let Xa;!function(e){e[e.SFX=0]="SFX",e[e.BGM=1]="BGM"}(Xa||(Xa={}));var $a={buttonHover:{key:"btn-hover",path:"/sfx/buttonHover.mp3",config:{volume:.1},soundType:Xa.SFX},buttonClick:{key:"btn-click",path:"/sfx/buttonClick.mp3",config:{volume:.1},soundType:Xa.SFX},radioButtonClick:{key:"radio-btn-click",path:"/sfx/radioButtonClick.mp3",config:{volume:.15},soundType:Xa.SFX},dialogueAdvance:{key:"dialogue-advance",path:"/sfx/dialogueAdvance.mp3",config:{volume:.3},soundType:Xa.SFX},popUpEnter:{key:"pop-up-enter",path:"/sfx/popUpEnter.mp3",config:{volume:.35},soundType:Xa.SFX},popUpExit:{key:"pop-up-exit",path:"/sfx/popUpExit.mp3",config:{volume:.35},soundType:Xa.SFX},menuEnter:{key:"menu-enter",path:"/sfx/menuEnter.mp3",config:{volume:.5},soundType:Xa.SFX},menuExit:{key:"menu-exit",path:"/sfx/menuExit.mp3",config:{volume:.5},soundType:Xa.SFX},modeEnter:{key:"mode-enter",path:"/sfx/modeEnter.mp3",config:{volume:.1},soundType:Xa.SFX},notifEnter:{key:"notif-enter",path:"/sfx/notifEnter.mp3",config:{volume:.25},soundType:Xa.SFX},notifExit:{key:"notif-exit",path:"/sfx/notifExit.mp3",config:{volume:.25},soundType:Xa.SFX},radioStatic:{key:"radio-static",path:"/sfx/radioStatic.mp3",config:{volume:.1},soundType:Xa.SFX},galacticHarmony:{key:"galactic-harmony",path:"/bgm/GalacticHarmony.mp3",config:{volume:.25,loop:!0},soundType:Xa.BGM}};let qa;!function(e){e[e.Effects=0]="Effects",e[e.Background=1]="Background",e[e.Character=2]="Character",e[e.Speaker=3]="Speaker",e[e.PopUp=4]="PopUp",e[e.Dialogue=5]="Dialogue",e[e.SpeakerBox=6]="SpeakerBox",e[e.UI=7]="UI",e[e.Objects=8]="Objects",e[e.BBox=9]="BBox",e[e.Escape=10]="Escape",e[e.Selector=11]="Selector",e[e.Dashboard=12]="Dashboard",e[e.WorkerMessage=13]="WorkerMessage"}(qa||(qa={}));const za=[qa.Background,qa.Selector,qa.Objects,qa.BBox,qa.Character,qa.Speaker,qa.PopUp,qa.Dialogue,qa.SpeakerBox,qa.Effects,qa.Dashboard,qa.Escape,qa.UI,qa.WorkerMessage];var Ya=s(89);function Ka(e){return new Promise((t=>setTimeout(t,e)))}function Qa(e,t,s){return Math.min(Math.max(e,t),s)}function Ja(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return e.startsWith("/")&&(e=e.substr(1)),ja.assetsFolder+(t?tn()+e:e)}function Za(e,t){if(void 0===e)throw new Error(t||"Object not found");return e}const en=()=>Ya.a.getState().session.courseId,tn=()=>Ya.a.getState().session.assetsPrefix||"",sn=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:ja.fadeDuration;return{alpha:0,targets:e,duration:t,ease:"Power2"}},an=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:ja.fadeDuration;return{alpha:1,targets:e,duration:t,ease:"Power2"}};function nn(e,t){let{fadeDuration:s}=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};t&&(e.add.tween(sn([t],s||ja.fadeDuration)),setTimeout((()=>t.destroy()),s||ja.fadeDuration))}function rn(e){return new Phaser.GameObjects.Rectangle(e,Oa.x,Oa.y,ya.x,ya.y,0)}function on(e,t){let s=0;const a=setInterval((()=>{s%2!==0?(t.setAlpha(0),e.tweens.add(an([t],250))):(t.setAlpha(1),e.tweens.add(sn([t],250))),s++}),500);return function(){s=0,clearInterval(a)}}const cn={y:0,duration:300,ease:"Power2"},ln={y:-ya.y,duration:250,ease:"Power2"},dn=(ya.x,{x:0,duration:500,ease:"Power2"}),un={x:ya.x,duration:500,ease:"Power2"},hn={x:1900,y:100,oriX:1,oriY:.5},pn={key:ba.zektonDarkFont.key,size:24,align:Phaser.GameObjects.BitmapText.ALIGN_RIGHT},gn=(()=>{let e=Promise.resolve();return(t,s)=>{e=e.then((()=>async function(e,t){const s=new Phaser.GameObjects.Container(e,0,0),a=new Phaser.GameObjects.Sprite(e,ya.x,100,Va.messageBar.key);a.setScale(-1.5,.8);const n=Aa(e,t,hn,pn);s.add([a,n]),e.getLayerManager().addToLayer(qa.Effects,s),s.setPosition(ya.x,0),s.setAlpha(0),zo.getInstance().getSoundManager().playSound($a.notifEnter.key),e.add.tween({targets:s,alpha:1,...dn}),await Ka(dn.duration+3e3),zo.getInstance().getSoundManager().playSound($a.notifExit.key),e.add.tween({targets:s,alpha:1,...un}),await Ka(un.duration),nn(e,s,{fadeDuration:ja.fadeDuration})}(t,s)))}})();const mn={prompt:{x:30,y:60,xPad:30,yPad:10},rect:{x:10,y:760,width:ya.x-20},text:{xPad:100,yPad:70},speakerTextConfig:{x:320,y:745,oriX:.5,oriY:.5}},bn={fontFamily:"Verdana",fontSize:"30px",fill:fa.lightBlue,align:"left",lineSpacing:10,wordWrap:{width:mn.rect.width-2*mn.text.xPad-2*mn.rect.x}},jn={key:ba.zektonFont.key,size:36,align:Phaser.GameObjects.BitmapText.ALIGN_CENTER};var yn=mn;var On=function(e,t){let{x:s=0,y:a=0,textStyle:n={},typeWriterInterval:i=1}=t;const r=new Phaser.GameObjects.Text(e,s,a,"",n);let o,c="",l=0;const d=()=>{o&&clearInterval(o)};return{container:r,changeLine:e=>{e&&(c=e,r.text="",l=0,d(),o=setInterval((()=>{r.text+=c[l++],l===c.length&&clearInterval(o)}),i))},clearTyping:d}};var fn=class{constructor(e){this.typewriter=void 0,this.dialogueBox=void 0,this.blinkingDiamond=void 0;const t=Nn.getInstance().getGameManager();var s;this.dialogueBox=(s=t,new Phaser.GameObjects.Image(s,Oa.x,Oa.y,Va.speechBox.key).setAlpha(.9)).setInteractive({useHandCursor:!0,pixelPerfect:!0}),this.typewriter=function(e,t){return On(e,{x:yn.rect.x+yn.text.xPad,y:yn.rect.y+yn.text.yPad,textStyle:t})}(t,e),this.blinkingDiamond=this.drawDiamond(t)}getDialogueContainer(){const e=Nn.getInstance().getGameManager(),t=new Phaser.GameObjects.Container(e,0,0);return t.add([this.dialogueBox,this.blinkingDiamond.container,this.typewriter.container]),t}drawDiamond(e){const t=new Phaser.GameObjects.Image(e,ya.x-yn.prompt.x-yn.prompt.xPad,ya.y-yn.prompt.y-yn.prompt.yPad,Va.diamond.key).setDisplaySize(yn.prompt.x,yn.prompt.y);return{container:t,clearBlink:on(e,t)}}getDialogueBox(){return this.dialogueBox}destroy(){const e=Nn.getInstance().getGameManager();this.typewriter.clearTyping(),this.blinkingDiamond.clearBlink(),this.getDialogueBox().off(Phaser.Input.Events.GAMEOBJECT_POINTER_UP),nn(e,this.getDialogueContainer())}changeText(e){this.typewriter.changeLine(e)}};const vn={key:ba.alienLeagueFont.key,size:100,align:Phaser.GameObjects.BitmapText.ALIGN_CENTER},xn={x:Oa.x,y:yn.rect.y+2*vn.size,oriX:.5,oriY:.9};function Cn(e,t){let{assetKey:s,message:a="",textConfig:n={x:0,y:0,oriX:0,oriY:0},bitMapTextStyle:i=ja.defaultFontStyle,onDown:r=ja.nullFunction,onUp:o=ja.nullFunction,onHover:c=ja.nullFunction,onOut:l=ja.nullFunction,onPointerMove:d=ja.nullFunction,onHoverEffect:u=!0,onClickSound:h=$a.buttonClick.key,onHoverSound:p=$a.buttonHover.key}=t;const g=new Phaser.GameObjects.Container(e,0,0),m=new Phaser.GameObjects.Sprite(e,0,0,s);m.setInteractive({pixelPerfect:!0,useHandCursor:!0}),m.addListener(Phaser.Input.Events.GAMEOBJECT_POINTER_UP,(()=>{zo.getInstance().getSoundManager().playSound(h),o()})),m.addListener(Phaser.Input.Events.GAMEOBJECT_POINTER_OVER,(()=>{zo.getInstance().getSoundManager().playSound(p),u&&g.setAlpha(1),c()})),m.addListener(Phaser.Input.Events.GAMEOBJECT_POINTER_OUT,(()=>{u&&g.setAlpha(.9),l()})),m.addListener(Phaser.Input.Events.GAMEOBJECT_POINTER_DOWN,(()=>{r()})),m.addListener(Phaser.Input.Events.GAMEOBJECT_POINTER_MOVE,((e,t,s)=>{d(e,t,s)}));const b=Aa(e,a,n,i);return g.add([m,b]),u&&g.setAlpha(.9),g}const Sn={textPad:20,textConfig:{x:15,y:-15,oriX:.5,oriY:.5},y:100,width:450,yInterval:100},wn={fontFamily:"Verdana",fontSize:"20px",fill:fa.offWhite,align:"right",lineSpacing:10,wordWrap:{width:Sn.width-2*Sn.textPad}},En={key:ba.zektonFont.key,size:25,align:Phaser.GameObjects.BitmapText.ALIGN_CENTER};async function Tn(e,t,s){const a=new Phaser.GameObjects.Container(e,0,0),n=new Phaser.GameObjects.Text(e,ya.x-Sn.textPad,Sn.y,t,wn).setOrigin(1,0),i=new Phaser.GameObjects.Rectangle(e,ya.x,Sn.y-Sn.textPad,Sn.width,.5*n.getBounds().bottom+Sn.textPad,va.darkBlue,.8).setOrigin(1,0),r=new Phaser.GameObjects.Rectangle(e,ya.x,Sn.y-Sn.textPad,Sn.width,.5*i.getBounds().bottom+(s.length+.5)*Sn.yInterval,va.lightBlue,.2).setOrigin(1,0);a.add([r,i,n]);const o=wa({numOfItems:s.length,xSpacing:0,ySpacing:Sn.yInterval});Nn.getInstance().addToLayer(qa.UI,a);const c=new Promise((t=>{a.add(s.map(((s,n)=>Cn(e,{assetKey:Va.mediumButton.key,message:s,textConfig:Sn.textConfig,bitMapTextStyle:En,onUp:()=>{a.destroy(),t(n)}}).setPosition(ya.x-Sn.width/2,o[n][1]+i.getBounds().bottom+75))))}));a.setPosition(ya.x,0),zo.getInstance().getSoundManager().playSound($a.notifEnter.key),e.add.tween({targets:a,alpha:1,...dn}),await Ka(dn.duration);const l=await c;return zo.getInstance().getSoundManager().playSound($a.notifExit.key),e.add.tween({targets:a,alpha:1,...un}),await Ka(un.duration),nn(e,a,{fadeDuration:ja.fadeDuration}),l}let kn,An;!function(e){e.Move="Move",e.Explore="Explore",e.Talk="Talk",e.Menu="Menu",e.EscapeMenu="EscapeMenu",e.None="None",e.Sequence="Sequence",e.Dashboard="Dashboard"}(kn||(kn={})),function(e){e[e.EscapeMenu=kn.EscapeMenu]="EscapeMenu",e[e.Dashboard=kn.Dashboard]="Dashboard"}(An||(An={}));class In{constructor(){this.gameManager=void 0,this.getGameManager=()=>Za(this.gameManager),this.gameManager=void 0}static getInstance(){return In.instance||(In.instance=new In),In.instance}setGameManager(e){this.gameManager=e}getCurrLocId(){return this.getGameManager().currentLocationId}getLocationAtId(e){return this.getGameManager().getStateManager().getGameMap().getLocationAtId(e)}async changeLocationTo(e){await this.getGameManager().changeLocationTo(e)}getLocationModes(e){return this.getGameManager().getStateManager().getLocationModes(e)}addLocationMode(e,t){this.getGameManager().getStateManager().addLocationMode(e,t)}removeLocationMode(e,t){this.getGameManager().getStateManager().removeLocationMode(e,t)}hasTriggeredInteraction(e){return this.getGameManager().getStateManager().hasTriggeredInteraction(e)}triggerStateChangeAction(e){this.getGameManager().getStateManager().triggerStateChangeAction(e)}triggerInteraction(e){this.getGameManager().getStateManager().triggerInteraction(e)}watchGameItemType(e,t){this.getGameManager().getStateManager().watchGameItemType(e,t)}getGameMap(){return this.getGameManager().getStateManager().getGameMap()}getGameItemsInLocation(e,t){return this.getGameManager().getStateManager().getGameItemsInLocation(e,t)}addItem(e,t,s){this.getGameManager().getStateManager().addItem(e,t,s)}removeItem(e,t,s){return this.getGameManager().getStateManager().removeItem(e,t,s)}makeObjectGlow(e,t){this.getGameManager().getObjectManager().makeObjectGlow(e,t)}makeObjectBlink(e,t){this.getGameManager().getObjectManager().makeObjectBlink(e,t)}setObjProperty(e,t){this.getGameManager().getStateManager().setObjProperty(e,t)}renderObjectLayerContainer(e){this.getGameManager().getObjectManager().renderObjectsLayerContainer(e)}getAllActivatables(){return[...this.getGameManager().getObjectManager().getActivatables(),...this.getGameManager().getBBoxManager().getActivatables()]}setBBoxProperty(e,t){this.getGameManager().getStateManager().setBBoxProperty(e,t)}renderBBoxLayerContainer(e){this.getGameManager().getBBoxManager().renderBBoxLayerContainer(e)}areAllObjectivesComplete(){return this.getGameManager().getStateManager().areAllObjectivesComplete()}isObjectiveComplete(e){return this.getGameManager().getStateManager().isObjectiveComplete(e)}areObjectivesComplete(e){return this.getGameManager().getStateManager().areObjectivesComplete(e)}completeObjective(e){this.getGameManager().getStateManager().completeObjective(e)}isTaskComplete(e){return this.getGameManager().getStateManager().isTaskComplete(e)}areTasksComplete(e){return this.getGameManager().getStateManager().areTasksComplete(e)}completeTask(e){this.getGameManager().getStateManager().completeTask(e),gn(this.getGameManager(),"Task completed!")}showTask(e){this.getGameManager().getStateManager().showTask(e),gn(this.getGameManager(),"New task added")}getAllVisibleTaskData(){return this.getGameManager().getStateManager().getAllVisibleTaskData()}addCollectible(e){zo.getInstance().getUserStateManager().addCollectible(e)}async isInUserState(e,t){return zo.getInstance().getUserStateManager().isInUserState(e,t)}clearSeveralLayers(e){this.getGameManager().getLayerManager().clearSeveralLayers(e)}addToLayer(e,t){this.getGameManager().getLayerManager().addToLayer(e,t)}showLayer(e){this.getGameManager().getLayerManager().showLayer(e)}hideLayer(e){this.getGameManager().getLayerManager().hideLayer(e)}async fadeInLayer(e,t){await this.getGameManager().getLayerManager().fadeInLayer(e,t)}async fadeOutLayer(e,t){await this.getGameManager().getLayerManager().fadeOutLayer(e,t)}async bringUpUpdateNotif(e){await async function(e,t){const s=new fn({}),a=s.getDialogueContainer();e.getLayerManager().addToLayer(qa.Effects,a),e.getLayerManager().fadeInLayer(qa.Effects);const n=Aa(e,t,xn,vn).setAlpha(0);a.add(n),zo.getInstance().getSoundManager().playSound($a.notifEnter.key),e.add.tween(an([n],2*ja.fadeDuration)),await Ka(2*ja.fadeDuration);const i=new Promise((t=>{s.getDialogueBox().on(Phaser.Input.Events.GAMEOBJECT_POINTER_UP,(()=>{zo.getInstance().getSoundManager().playSound($a.notifExit.key),nn(e,n,{fadeDuration:ja.fadeDuration/4}),s.destroy(),t()}))}));await i}(this.getGameManager(),e)}async processGameActions(e){await this.getGameManager().getPhaseManager().pushPhase(kn.Sequence),await this.getGameManager().getActionManager().processGameActions(e),await this.getGameManager().getPhaseManager().popPhase()}async processGameActionsInSamePhase(e){await this.getGameManager().getActionManager().processGameActions(e)}async showDialogue(e){await this.getGameManager().getPhaseManager().pushPhase(kn.Sequence),await this.getGameManager().getDialogueManager().showDialogue(e),await this.getGameManager().getPhaseManager().popPhase()}async showDialogueInSamePhase(e){await this.getGameManager().getDialogueManager().showDialogue(e)}storeDialogueLine(e,t){this.getGameManager().getDialogueStorageManager().storeLine(e,t)}getDialogueStorage(){return this.getGameManager().getDialogueStorageManager().getDialogueStorage()}async obtainCollectible(e){gn(this.getGameManager(),`Obtained ${Ga(e).title}`),zo.getInstance().getUserStateManager().addCollectible(e)}displayPopUp(e,t,s,a){this.getGameManager().getPopupManager().displayPopUp(e,t,s,a)}destroyAllPopUps(){this.getGameManager().getPopupManager().destroyAllPopUps()}async destroyPopUp(e){this.getGameManager().getPopupManager().destroyPopUp(e)}async saveGame(){await this.getGameManager().getSaveManager().saveGame()}async saveSettings(e){await this.getGameManager().getSaveManager().saveSettings(e)}getLoadedUserState(){return this.getGameManager().getSaveManager().getLoadedUserState()}getSoundManager(){return zo.getInstance().getSoundManager()}playSound(e){zo.getInstance().getSoundManager().playSound(e)}playBgMusic(e){zo.getInstance().getSoundManager().playBgMusic(e)}async stopAllSound(){zo.getInstance().getSoundManager().stopAllSound()}pauseCurrBgMusic(){zo.getInstance().getSoundManager().pauseCurrBgMusic()}continueCurrBgMusic(){zo.getInstance().getSoundManager().continueCurrBgMusic()}applySoundSettings(e){zo.getInstance().getSoundManager().applyUserSettings(e)}loadSounds(e){zo.getInstance().getSoundManager().loadSounds(e)}startAnimation(e,t,s){const a=this.getAssetByKey(this.getGameMap().getAssetKeyFromId(e));this.getGameManager().getAnimationManager().displayAnimation(a,t,s)}stopAnimation(e){const t=this.getAssetByKey(this.getGameMap().getAssetKeyFromId(e));this.getGameManager().getAnimationManager().stopAnimation(t)}setDefaultCursor(e){this.getGameManager().getInputManager().setDefaultCursor(e)}enableKeyboardInput(e){this.getGameManager().getInputManager().enableKeyboardInput(e)}enableMouseInput(e){this.getGameManager().getInputManager().enableMouseInput(e)}enableSprite(e,t){t?this.getGameManager().input.enable(e):this.getGameManager().input.disable(e)}async popPhase(){await this.getGameManager().getPhaseManager().popPhase()}async pushPhase(e){await this.getGameManager().getPhaseManager().pushPhase(e)}async swapPhase(e){await this.getGameManager().getPhaseManager().swapPhase(e)}isCurrentPhase(e){return this.getGameManager().getPhaseManager().isCurrentPhase(e)}renderBackgroundLayerContainer(e){this.getGameManager().getBackgroundManager().renderBackgroundLayerContainer(e)}async promptNavigateToAssessment(e){0===await Tn(In.getInstance().getGameManager(),"Are you ready for the challenge?",["Yes","No"])&&(window.open(`/courses/${en()}/missions/${e}/0`,"blank"),window.focus())}async updateAssessmentState(){await zo.getInstance().getUserStateManager().loadAssessments()}createCharacterSprite(e,t,s){return this.getGameManager().getCharacterManager().createCharacterSprite(e,t,s)}moveCharacter(e,t,s){this.getGameManager().getStateManager().moveCharacter(e,t,s)}updateCharacter(e,t){this.getGameManager().getStateManager().updateCharacter(e,t)}getDialogueById(e){return Za(this.getGameMap().getDialogueMap().get(e))}getCharacterById(e){return Za(this.getGameMap().getCharacterMap().get(e))}getActionById(e){return Za(this.getGameMap().getActionMap().get(e))}getObjectById(e){return Za(this.getGameMap().getObjectPropMap().get(e))}getBBoxById(e){return Za(this.getGameMap().getBBoxPropMap().get(e))}getAssetByKey(e){return this.getGameMap().getAssetByKey(e)}}In.instance=void 0;var Nn=In;let Mn,Pn,Rn,_n;!function(e){e.UserState="UserState",e.ChecklistState="ChecklistState",e.TasklistState="TasklistState"}(Mn||(Mn={})),function(e){e.collectibles="collectibles",e.assessments="assessments",e.achievements="achievements"}(Pn||(Pn={}));class Ln{static async checkAllConditionsSatisfied(e){return(await Promise.all(e.map((async e=>await this.checkConditionSatisfied(e))))).every((e=>!0===e))}static async checkConditionSatisfied(e){const{state:t,conditionParams:s,boolean:a}=e;switch(t){case Mn.UserState:return await Nn.getInstance().isInUserState(s.userStateType,s.id)===a;case Mn.ChecklistState:return Nn.getInstance().isObjectiveComplete(s.id)===a;case Mn.TasklistState:return Nn.getInstance().isTaskComplete(s.id)===a;default:return!0}}}!function(e){e.MoveCharacter="MoveCharacter",e.UpdateCharacter="UpdateCharacter",e.ObtainCollectible="ObtainCollectible",e.CompleteObjective="CompleteObjective",e.CompleteTask="CompleteTask",e.ShowTask="ShowTask",e.PreviewLocation="PreviewLocation",e.AddItem="AddItem",e.RemoveItem="RemoveItem",e.ShowDialogue="ShowDialogue",e.ChangeBackground="ChangeBackground",e.StartAnimation="StartAnimation",e.StopAnimation="StopAnimation",e.RemoveLocationMode="RemoveLocationMode",e.AddLocationMode="AddLocationMode",e.AddPopup="AddPopup",e.MakeObjectBlink="MakeObjectBlink",e.MakeObjectGlow="MakeObjectGlow",e.PlayBGM="PlayBGM",e.PlaySFX="PlaySFX",e.ShowObjectLayer="ShowObjectLayer",e.NavigateToAssessment="NavigateToAssessment",e.UpdateAssessmentStatus="UpdateAssessmentStatus",e.Delay="Delay"}(Rn||(Rn={}));class Dn{static async executeGameAction(e,t){const s=Nn.getInstance();switch(e){case Rn.AddItem:return void s.addItem(t.gameItemType,t.locationId,t.id);case Rn.RemoveItem:return void s.removeItem(t.gameItemType,t.locationId,t.id);case Rn.AddLocationMode:return void s.addLocationMode(t.locationId,t.mode);case Rn.RemoveLocationMode:return void s.removeLocationMode(t.locationId,t.mode);case Rn.MoveCharacter:return void s.moveCharacter(t.id,t.locationId,t.position);case Rn.UpdateCharacter:return void s.updateCharacter(t.id,t.expression);case Rn.ChangeBackground:return void s.renderBackgroundLayerContainer(t.id);case Rn.StartAnimation:return void s.startAnimation(t.id,t.startFrame,t.frameRate);case Rn.StopAnimation:return void s.stopAnimation(t.id);case Rn.PreviewLocation:return s.renderBackgroundLayerContainer(t.id),s.renderObjectLayerContainer(t.id),void s.renderBBoxLayerContainer(t.id);case Rn.ObtainCollectible:return void s.obtainCollectible(t.id);case Rn.CompleteObjective:return void s.completeObjective(t.id);case Rn.CompleteTask:return void s.completeTask(t.id);case Rn.ShowTask:return void s.showTask(t.id);case Rn.ShowDialogue:return void(s.isCurrentPhase(kn.Sequence)?await s.showDialogueInSamePhase(t.id):await s.showDialogue(t.id));case Rn.AddPopup:return void await s.displayPopUp(t.id,t.position,t.duration,t.size);case Rn.MakeObjectBlink:return void await s.makeObjectBlink(t.id,t.turnOn);case Rn.MakeObjectGlow:return void await s.makeObjectGlow(t.id,t.turnOn);case Rn.PlayBGM:return void zo.getInstance().getSoundManager().playBgMusic(t.id);case Rn.PlaySFX:return void await zo.getInstance().getSoundManager().playSound(t.id);case Rn.ShowObjectLayer:return void(t.show?s.showLayer(qa.Objects):s.hideLayer(qa.Objects));case Rn.NavigateToAssessment:return void await s.promptNavigateToAssessment(t.assessmentId);case Rn.UpdateAssessmentStatus:return void await s.updateAssessmentState();case Rn.Delay:return void await Ka(t.duration);default:return}}static isStateChangeAction(e){switch(e){case Rn.AddItem:case Rn.RemoveItem:case Rn.AddLocationMode:case Rn.RemoveLocationMode:case Rn.MoveCharacter:case Rn.UpdateCharacter:return!0;case Rn.NavigateToAssessment:case Rn.UpdateAssessmentStatus:case Rn.PreviewLocation:case Rn.ChangeBackground:case Rn.StartAnimation:case Rn.StopAnimation:case Rn.ObtainCollectible:case Rn.CompleteObjective:case Rn.CompleteTask:case Rn.ShowTask:case Rn.ShowDialogue:case Rn.AddPopup:case Rn.MakeObjectBlink:case Rn.MakeObjectGlow:case Rn.PlayBGM:case Rn.PlaySFX:case Rn.ShowObjectLayer:case Rn.Delay:return!1}}}class Bn{async fastForwardGameActions(e){if(e)for(const t of e){const{actionType:e,actionParams:s}=Nn.getInstance().getActionById(t);await Dn.executeGameAction(e,s)}}async processGameActions(e){if(e){for(const t of e)await this.processGameAction(t);await Nn.getInstance().saveGame()}}async processGameAction(e){const{actionType:t,actionParams:s,actionConditions:a,isRepeatable:n,interactionId:i}=Nn.getInstance().getActionById(e);await this.checkCanPlayAction(n,i,a)&&(await Dn.executeGameAction(t,s),Dn.isStateChangeAction(t)&&Nn.getInstance().triggerStateChangeAction(e),Nn.getInstance().triggerInteraction(e))}async checkCanPlayAction(e,t,s){return(e||!Nn.getInstance().hasTriggeredInteraction(t))&&await Ln.checkAllConditionsSatisfied(s)}}!function(e){e.navigation="navigation",e.locations="locations",e.talkTopics="talkTopics",e.dialogues="dialogues",e.objects="objects",e.boundingBoxes="boundingBoxes",e.characters="characters",e.actions="actions",e.bgmKey="bgmKey",e.collectibles="collectibles"}(_n||(_n={}));class Un{constructor(){this.game=Nn.getInstance().getGameManager(),this.animationInstanceMap=new Map,this.isSprite=e=>e.type===Fa.Sprite}createImage(e,t){var s,a,n,i;switch(e.type){case Fa.Sprite:return this.createAnimation(e,(null===(s=e.config)||void 0===s?void 0:s.start)||0,(null===(a=e.config)||void 0===a?void 0:a.frameRate)||20),this.getAnimation(e);case Fa.Image:return new Phaser.GameObjects.Image(this.game,(null===e||void 0===e||null===(n=e.config)||void 0===n?void 0:n.centreX)||0,(null===e||void 0===e||null===(i=e.config)||void 0===i?void 0:i.centreY)||0,t)}}displayAnimation(e,t,s){var a;const n=Nn.getInstance().getAssetByKey(e.path);switch(n&&n.config&&(n.config.start=t,n.config.frameRate=s),null===(a=n.config)||void 0===a?void 0:a.animType){case Ha.Object:const t=Nn.getInstance().getCurrLocId();Nn.getInstance().addItem(_n.objects,t,e.key);break;case Ha.Background:Nn.getInstance().renderBackgroundLayerContainer(e.key)}}createAnimation(e,t,s){if(this.isSprite(e)){var a,n,i;this.removeAnimation(e);const r=new Phaser.GameObjects.Sprite(this.game,(null===(a=e.config)||void 0===a?void 0:a.centreX)||0,(null===(n=e.config)||void 0===n?void 0:n.centreY)||0,e.path),o={key:e.path,frames:this.game.anims.generateFrameNumbers(e.path,{start:t,end:(null===(i=e.config)||void 0===i?void 0:i.endFrame)||0,first:0}),frameRate:s,repeat:-1};this.game.anims.create(o),this.animationInstanceMap.set(e.key,r)}}startAnimation(e){if(this.isSprite(e)){const t=this.getAnimation(e);t.play(e.path,!1),this.game.add.existing(t)}}stopAnimation(e){const t=this.animationInstanceMap.get(e.key);this.isSprite(e)&&t&&t.anims&&t.anims.stop()}removeAnimation(e){const t=this.animationInstanceMap.get(e.key);t&&(this.game.anims.remove(e.path),t.destroy(),this.animationInstanceMap.delete(e.key))}getAnimation(e){return Za(this.animationInstanceMap.get(e.key),`Image: ${e.path} not found`)}}function Gn(e,t,s){const a=e.displayHeight/e.displayWidth;t?(e.displayWidth=t,e.displayHeight=s||t*a):(e.displayWidth=s/a,e.displayHeight=s)}function Fn(e,t,s){e.displayWidth>e.displayHeight?Gn(e,0,s):Gn(e,t)}function Hn(e,t,s){e.displayWidth>e.displayHeight?Gn(e,t):Gn(e,0,s)}var Vn=class{constructor(e,t){this.scene=void 0,this.awardsGetter=void 0,this.uiContainer=void 0,this.previewContainer=void 0,this.itemsContainer=void 0,this.activePageNumber=void 0,this.scene=e,this.awardsGetter=t,this.activePageNumber=0}createUIContainer(){const e=new Phaser.GameObjects.Container(this.scene,0,0);this.uiContainer=e;const t=Cn(this.scene,{assetKey:Va.arrow.key,onUp:()=>this.nextPage(!1)}).setScale(Ba.arrow.yScale,Ba.arrow.yScale).setRotation(-90*Math.PI/180).setPosition(Ba.arrow.x-Ba.arrow.xOffset,Ba.arrow.y),s=Cn(this.scene,{assetKey:Va.arrow.key,onUp:()=>this.nextPage(!0)}).setScale(Ba.arrow.xScale,Ba.arrow.yScale).setRotation(90*Math.PI/180).setPosition(Ba.arrow.x+Ba.arrow.xOffset,Ba.arrow.y);e.add([t,s]);const a=new Phaser.GameObjects.Sprite(this.scene,Ba.preview.rect.x,Ba.preview.rect.y,Va.popUpFrame.key).setScale(1.2);return e.add(a),e.add(function(e){const t=new Phaser.GameObjects.Container(e,Ba.preview.rect.xOffset,Ba.preview.rect.yOffset),s=Ba.preview.key,a=new Phaser.GameObjects.Rectangle(e,s.x,s.y,s.width,s.height,va.lightBlue,.1),n=new Phaser.GameObjects.Rectangle(e,s.x-s.width*a.originX*.75,s.y,s.width/4,s.height,va.lightBlue,.2),i=Aa(e,"asset key",Ba.preview.keyTagTextConfig,Ma),r=new ka(e,Ba.preview.explanation.x,Ba.preview.explanation.y,"Asset key can be used to include the asset into your room by using 'create_award' function.");return n.setInteractive(),n.addListener(Phaser.Input.Events.GAMEOBJECT_POINTER_OVER,(()=>r.setVisible(!0))),n.addListener(Phaser.Input.Events.GAMEOBJECT_POINTER_OUT,(()=>r.setVisible(!1))),t.add([a,n,i,r]),t}(this.scene)),this.setPage(),e}setPage(){this.uiContainer&&(this.itemsContainer&&this.itemsContainer.destroy(),this.itemsContainer=this.createItemsContainer(),this.uiContainer.add(this.itemsContainer),this.setPreview())}setPreview(e){if(this.uiContainer){if(this.previewContainer&&this.previewContainer.destroy(),!e)return;let t;if(this.previewContainer=new Phaser.GameObjects.Container(this.scene,Ba.preview.rect.xOffset,Ba.preview.rect.yOffset),e.assetKey===ja.nullInteractionId)t=Aa(this.scene,"No preview available",Ba.noPreviewTextConfig,Ma);else{const s=Ba.preview.rect;t=new Phaser.GameObjects.Sprite(this.scene,0,0,e.assetKey),Hn(t,s.dim,s.dim),t.setPosition(s.x,s.y)}const s=Aa(this.scene,e.title,Ba.preview.titleTextConfig,Na),a=new Phaser.GameObjects.Text(this.scene,Ba.preview.rect.x,Ba.preview.rect.y+Ba.preview.descText.yOffset,e.description,Pa).setOrigin(.5,0),n=!1===e.completed?"":e.assetKey,i=Aa(this.scene,n,Ba.preview.keyTextConfig,Ma),r=new Phaser.GameObjects.Rectangle(this.scene,Ba.preview.rect.x,Ba.preview.rect.y,Ba.preview.rect.dim,Ba.preview.rect.dim,0).setAlpha(e.completed?0:.8);this.previewContainer.add([t,r,s,a,i]),this.uiContainer.add(this.previewContainer)}}nextPage(e){const t=this.activePageNumber,s=Qa(e?t+1:t-1,0,Number.MAX_SAFE_INTEGER);this.getItems(s).length>0&&(this.activePageNumber=s,this.setPage())}createItemsContainer(){const e=new Phaser.GameObjects.Container(this.scene,0,0),t=this.getItems(this.activePageNumber),s=wa({numOfItems:t.length,xSpacing:0,ySpacing:Ba.list.ySpace});return e.add(t.map(((e,t)=>this.createItemButton(e.title,s[t][0],s[t][1]+Ba.list.yStart,(()=>this.setPreview(e)),!1!==e.completed)))),e}createItemButton(e,t,s,a,n){const i=Cn(this.scene,{assetKey:Va.awardsBanner.key,message:e,textConfig:Ba.listTextConfig,bitMapTextStyle:Ia,onUp:a,onHoverEffect:n}).setPosition(t,s);return n||i.setAlpha(.5),i}getItems(e){const t=this.awardsGetter(),s=Ua(t),a=e*Ba.itemsPerPage;return s.slice(a,a+Ba.itemsPerPage)}};class Wn{constructor(){this.currentBackground=void 0}renderBackgroundLayerContainer(e){const t=Nn.getInstance().getLocationAtId(e).assetKey;this.renderBackgroundImage(t)}renderBackgroundImage(e){Nn.getInstance().clearSeveralLayers([qa.Background]),this.currentBackground=Nn.getInstance().getAssetByKey(e);const t=Nn.getInstance().getGameManager().getAnimationManager();let s;this.currentBackground&&(s=t.createImage(this.currentBackground,e),t.startAnimation(this.currentBackground),Fn(s,ya.x,ya.y),Nn.getInstance().addToLayer(qa.Background,s),Nn.getInstance().fadeInLayer(qa.Background))}}var Xn=class{constructor(){this.bboxes=void 0,this.bboxes=new Map,Nn.getInstance().watchGameItemType(_n.boundingBoxes,this)}renderBBoxLayerContainer(e){Nn.getInstance().clearSeveralLayers([qa.BBox]);const t=Nn.getInstance().getGameItemsInLocation(_n.boundingBoxes,e);this.bboxes.clear(),t.map((e=>this.handleAdd(e)))}createBBox(e){const t=Nn.getInstance().getGameManager(),{x:s,y:a,width:n,height:i,actionIds:r,interactionId:o}=e,c=new Phaser.GameObjects.Rectangle(t,s,a,n,i,0,0);return e.isInteractive&&c.setInteractive(),{sprite:c,clickArea:c,actionIds:r,interactionId:o}}handleAdd(e){const t=Nn.getInstance().getBBoxById(e),s=this.createBBox(t);return Nn.getInstance().addToLayer(qa.BBox,s.sprite),this.bboxes.set(e,s),!0}handleMutate(e){return this.handleDelete(e)&&this.handleAdd(e)}handleDelete(e){const t=this.bboxes.get(e);return!!t&&(this.bboxes.delete(e),t.sprite.destroy(),!0)}getActivatables(){return Array.from(this.bboxes.values())}};var $n={charWidth:600,charRect:{x:{Left:350,Middle:Oa.x,Right:ya.x-350}}};class qn{constructor(){this.characterSpriteMap=void 0,this.characterSpriteMap=new Map,Nn.getInstance().watchGameItemType(_n.characters,this)}renderCharacterLayerContainer(e){const t=Nn.getInstance().getGameItemsInLocation(_n.characters,e);this.characterSpriteMap.clear(),t.map((e=>this.handleAdd(e)))}createCharacterSprite(e,t,s){const a=Nn.getInstance().getCharacterById(e),{defaultPosition:n,defaultExpression:i,expressions:r,scale:o}=a,c=$n.charRect.x[s||n],l=r.get(t||i),d=new Phaser.GameObjects.Image(Nn.getInstance().getGameManager(),c,ya.y,l).setOrigin(.5,1);return Gn(d,$n.charWidth*o),d}handleAdd(e){const t=this.createCharacterSprite(e);return Nn.getInstance().addToLayer(qa.Character,t),this.characterSpriteMap.set(e,t),!0}handleMutate(e){return this.handleDelete(e)&&this.handleAdd(e)}handleDelete(e){const t=this.characterSpriteMap.get(e);return!!t&&(this.characterSpriteMap.delete(e),t.destroy(),!0)}}const zn={key:ba.alienLeagueFont.key,size:35,align:Phaser.GameObjects.BitmapText.ALIGN_LEFT};var Yn={backButton:{y:.3*ya.y},page:{yStart:.3*-ya.y,ySpace:150},pageTextConfig:{x:.3*ya.x,y:0,oriX:.1,oriY:.5},pageArea:{x:-869,y:-412,width:.72*ya.x,height:.77*ya.y}};let Kn;!function(e){e.Log="Log",e.Tasks="Tasks",e.Collectibles="Collectibles",e.Achievements="Achievements"}(Kn||(Kn={}));var Qn=class{constructor(e,t,s){this.scene=void 0,this.pages=void 0,this.pageManagers=void 0,this.pageMask=void 0,this.uiContainer=void 0,this.pageChosenContainer=void 0,this.pageUIContainers=void 0,this.currPageIndex=void 0,this.getSoundManager=()=>zo.getInstance().getSoundManager(),this.scene=e,this.pages=t,this.pageManagers=s,this.pageMask=this.createPageMask(),this.pageUIContainers=new Array(t.length),this.currPageIndex=0,this.scene.getPhaseManager().addPhaseToMap(kn.Dashboard,this)}createPageMask(){const e=new Phaser.GameObjects.Graphics(this.scene),{x:t,y:s,width:a,height:n}=Yn.pageArea;return e.fillRect(t,s,a,n),e.createGeometryMask()}setPage(e){if(this.uiContainer){this.pageChosenContainer&&this.pageChosenContainer.destroy();const t=this.pageUIContainers[this.currPageIndex];t&&t.setVisible(!1),this.currPageIndex=e;let s=this.pageUIContainers[this.currPageIndex];s?s.setVisible(!0):(s=this.pageManagers[this.currPageIndex].createUIContainer(),s.setMask(this.pageMask),this.pageUIContainers[this.currPageIndex]=s,this.uiContainer.add(s));const a=this.getPageOptPositions(),n=this.currPageIndex,i=new Phaser.GameObjects.Sprite(this.scene,a[n][0],a[n][1]+Yn.page.yStart,Va.awardsPageChosen.key);this.pageChosenContainer=new Phaser.GameObjects.Container(this.scene,0,0,[i]),this.uiContainer.add(this.pageChosenContainer)}}createUIContainer(){const e=new Phaser.GameObjects.Container(this.scene,0,0),t=new Phaser.GameObjects.Rectangle(this.scene,0,0,ya.x,4*ya.y,0).setAlpha(.7).setInteractive(),s=new Phaser.GameObjects.Image(this.scene,0,0,Va.awardsMenu.key);e.add([t,s]);const a=this.pages.map(((e,t)=>({text:e,callback:()=>this.setPage(t)}))),n=this.getPageOptPositions();e.add(a.map(((e,t)=>this.createPageOpt(e.text,n[t][0],n[t][1]+Yn.page.yStart,e.callback))));const i=this.createPageOpt("Back",0,Yn.backButton.y,(async()=>{this.scene.getPhaseManager().isCurrentPhase(kn.Dashboard)&&await this.scene.getPhaseManager().popPhase()}));return e.add(i),e}getPageOptPositions(){return wa({numOfItems:Object.keys(Kn).length,xSpacing:0,ySpacing:Yn.page.ySpace})}createPageOpt(e,t,s,a){return Cn(this.scene,{assetKey:Va.awardsPage.key,message:e,textConfig:Yn.pageTextConfig,bitMapTextStyle:zn,onUp:a}).setPosition(t,s)}async activateUI(){this.uiContainer=this.createUIContainer(),this.scene.getLayerManager().addToLayer(qa.Dashboard,this.uiContainer),this.getSoundManager().playSound($a.menuEnter.key),this.setPage(this.currPageIndex),this.uiContainer.setPosition(Oa.x,-ya.y),this.pageMask.geometryMask.setPosition(Oa.x,-ya.y),this.scene.tweens.add({targets:[this.uiContainer,this.pageMask.geometryMask],...cn,y:Oa.y})}async deactivateUI(){this.uiContainer&&(this.pageUIContainers=new Array(this.pages.length),this.uiContainer.setPosition(this.uiContainer.x,this.uiContainer.y),this.getSoundManager().playSound($a.menuExit.key),this.scene.tweens.add({targets:[this.uiContainer,this.pageMask.geometryMask],...ln}),await Ka(ln.duration),nn(this.scene,this.uiContainer,{fadeDuration:50}))}};class Jn{constructor(e){this.currPart=void 0,this.currLineNum=void 0,this.dialogueContent=void 0,this.dialogueContent=e,this.currPart=e.keys().next().value,this.currLineNum=0}async generateNextLine(){const e=this.dialogueContent.get(this.currPart)[this.currLineNum];if(!e||!e.line)return{line:""};if(e.goto){let t=e.goto.part;if(await Ln.checkAllConditionsSatisfied(e.goto.conditions)||(t=e.goto.altPart),t){if(!this.dialogueContent.get(t))return{line:""};this.currPart=t,this.currLineNum=0}else this.currLineNum++}else this.currLineNum++;return e}updateCurrPart(e){this.currPart=e,this.currLineNum=0}}let Zn,ei;!function(e){e.Left="Left",e.Middle="Middle",e.Right="Right"}(Zn||(Zn={})),function(e){e.Small="Small",e.Medium="Medium",e.Large="Large"}(ei||(ei={}));class ti{static splitToParagraph(e){const t=[];return e.forEach((e=>{if(e.startsWith("\t")||e.startsWith("    ")){const s=e.startsWith("\t")?e.slice(1):e.slice(4);if(0===t.length)return void console.error("Unexpected tabs");t[t.length-1][1].push(s)}else t.push([e.trim(),[]])})),t}static mapByHeader(e,t){const s=new Map;if(!t(e[0]))return s.set("0",e),s;let a="";return e.forEach((e=>{if(t(e))return a=e,void s.set(e,[]);s.get(a).push(e)})),s}static splitWithLimit(e,t,s){if(s>=0){const a=e.split(t),n=a.slice(0,s);return n.push(a.slice(s).join(t)),n.map((e=>e.trim()))}return ti.splitByChar(e,t)}static splitByChar(e,t){return e.split(t).map((e=>e.trim()))}static splitToLines(e){return e.split("\n").map((e=>e.trimRight())).filter((e=>""!==e))}static splitToLinesAndRemoveComments(e){return this.removeMultiLineComments(e.split("\n"),"/*","*/").map((e=>this.removeSingleLineComment(e,"//"))).map((e=>e.trimRight())).filter((e=>""!==e))}static removeSingleLineComment(e,t){let s=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];const a=e.indexOf(t);return-1===a?e:s?e.slice(0,a):e.slice(a+t.length)}static removeMultiLineComments(e,t,s){const a=[];let n=!1;for(let i=0;i<e.length;i++){const r=e[i],o=[],c=this.findAllInstances(r,t),l=this.findAllInstances(r,s);let d=-1,u=0,h=0,p=n?[0]:[];for(;u<c.length||h<l.length;){const e=d;d=n?l[h++]+s.length:c[u++],d<=e?(console.error(`Comment mismatch: Line ${i+1},  Pos ${d+1}`),d=e):(p.push(d),n=!n),2===p.length&&(o.push([p[0],p[1]]),p=[])}1===p.length&&o.push([p[0],r.length]),a.push(this.removeCommentRegions(r,o))}return a}static removeCommentRegions(e,t){let s="",a=0;return t.forEach((t=>{s+=e.slice(a,t[0]),a=t[1]})),s+=e.slice(a,e.length),s}static findAllInstances(e,t){const s=[];let a=e.indexOf(t);for(;-1!==a;)s.push(a),a=e.indexOf(t,a+1);return s}static capitalize(e){return e.charAt(0).toUpperCase()+e.slice(1)}static toCapitalizedWords(e){return(e.match(/[A-Za-z][a-z]*/g)||[]).map(ti.capitalize).join(" ")}static toIntString(e){return Math.floor(e).toString()}static isEmptyString(e){return e===ja.nullInteractionId}}class si{constructor(){this.currentSpeakerId=void 0,this.getUsername=()=>zo.getInstance().getAccountInfo().name}changeSpeakerTo(e){void 0!==e&&(this.currentSpeakerId&&Nn.getInstance().clearSeveralLayers([qa.Speaker,qa.SpeakerBox]),this.showNewSpeaker(e))}showNewSpeaker(e){e&&(this.drawSpeakerSprite(e),this.drawSpeakerBox(e.speakerId))}drawSpeakerBox(e){if("narrator"===e)return;const t="you"===e?this.createSpeakerBox(this.getUsername(),Zn.Right):this.createSpeakerBox(Nn.getInstance().getCharacterById(e).name,Zn.Left);Nn.getInstance().addToLayer(qa.SpeakerBox,t)}drawSpeakerSprite(e){let{speakerId:t,speakerPosition:s,expression:a}=e;if(this.currentSpeakerId=t,"you"===t||"narrator"===t)return;const n=Nn.getInstance().createCharacterSprite(t,a,s);Nn.getInstance().addToLayer(qa.Speaker,n)}createSpeakerBox(e,t){const s=Nn.getInstance().getGameManager(),a=new Phaser.GameObjects.Container(s,0,0),n=new Phaser.GameObjects.Image(s,Oa.x,Oa.y,Va.speakerBox.key).setAlpha(.8),i=Aa(s,"",yn.speakerTextConfig,jn);return t===Zn.Right&&(n.displayWidth*=-1,i.x=ya.x-i.x),a.add([n,i]),i.text=ti.capitalize(e),a}}class ai{constructor(){this.speakerRenderer=void 0,this.dialogueRenderer=void 0,this.dialogueGenerator=void 0,this.getDialogueGenerator=()=>this.dialogueGenerator,this.getDialogueRenderer=()=>this.dialogueRenderer,this.getSpeakerRenderer=()=>this.speakerRenderer,this.getUsername=()=>zo.getInstance().getAccountInfo().name}async showDialogue(e){const t=Nn.getInstance().getDialogueById(e);this.dialogueRenderer=new fn(bn),this.dialogueGenerator=new Jn(t.content),this.speakerRenderer=new si,Nn.getInstance().addToLayer(qa.Dialogue,this.dialogueRenderer.getDialogueContainer()),Nn.getInstance().fadeInLayer(qa.Dialogue),await new Promise((e=>this.playWholeDialogue(e))),this.getDialogueRenderer().destroy(),this.getSpeakerRenderer().changeSpeakerTo(null)}async playWholeDialogue(e){await this.showNextLine(e),this.getDialogueRenderer().getDialogueBox().on(Phaser.Input.Events.GAMEOBJECT_POINTER_UP,(async()=>await this.showNextLine(e)))}async showNextLine(e){Nn.getInstance().playSound($a.dialogueAdvance.key);const{line:t,speakerDetail:s,actionIds:a,prompt:n}=await this.getDialogueGenerator().generateNextLine(),i=t.replace("{name}",this.getUsername());if(this.getDialogueRenderer().changeText(i),this.getSpeakerRenderer().changeSpeakerTo(s),Nn.getInstance().storeDialogueLine(i,s),Nn.getInstance().enableSprite(this.getDialogueRenderer().getDialogueBox(),!1),n){const e=await Tn(Nn.getInstance().getGameManager(),n.promptTitle,n.choices.map((e=>e[0])));this.getDialogueGenerator().updateCurrPart(n.choices[e][1])}await Nn.getInstance().processGameActionsInSamePhase(a),Nn.getInstance().enableSprite(this.getDialogueRenderer().getDialogueBox(),!0),t||e()}}class ni{constructor(){this.dialogueStorage=void 0,this.getUsername=()=>zo.getInstance().getAccountInfo().name}storeLine(e,t){if(!t)return;this.dialogueStorage||(this.dialogueStorage=new Array);const s={speaker:this.getSpeakerName(t),line:e};this.dialogueStorage.push(s)}getSpeakerName(e){const t=null===e||void 0===e?void 0:e.speakerId;return t?"you"===t?this.getUsername():"narrator"===t?"Narrator":Nn.getInstance().getCharacterById(t).name:""}clearDialogueStorage(){this.dialogueStorage=new Array}getDialogueStorage(){return this.dialogueStorage?this.dialogueStorage.map((e=>`${e.speaker}:\n${e.line}`)):new Array}}const ii=Oa.x-160,ri=Oa.y,oi=ii+10,ci=ri+10;function li(e){let t,s,a;e.load.on("start",(()=>{a=e.add.existing(rn(e)),t=e.add.graphics(),s=e.add.graphics(),s.fillStyle(2236962,.8),s.fillRect(ii,ri,320,50)})),e.load.on("progress",(e=>{t.clear(),t.fillStyle(16777215,1),t.fillRect(oi,ci,300*e,30)})),e.load.on("complete",(function(){t.destroy(),s.destroy(),a.destroy()}))}class di extends Phaser.GameObjects.Container{constructor(e,t,s,a){let{choices:n,defaultChoiceIdx:i=0,maxXSpace:r=ya.x,radioChoiceConfig:o={circleDim:20,checkedDim:10,outlineThickness:5},choiceTextConfig:c={x:0,y:0,oriX:.5,oriY:.5},bitmapTextStyle:l=ja.defaultFontStyle}=t,d=arguments.length>4&&void 0!==arguments[4]?arguments[4]:$a.radioButtonClick.key;super(e,s,a),this.buttonClickSoundKey=void 0,this.activeChoice=void 0,this.activeChoiceIdx=void 0,this.choices=void 0,this.buttonPositions=void 0,this.radioChoiceConfig=void 0,this.choiceTextConfig=void 0,this.bitmapTextStyle=void 0,this.activeChoiceIdx=i,this.choices=n,this.choiceTextConfig=c,this.bitmapTextStyle=l,this.radioChoiceConfig=o,this.buttonClickSoundKey=d;const u=this.getRadioButtons(n);this.buttonPositions=Ca({numOfItems:u.length,maxXSpace:r}),this.renderRadioButtons(u,this.buttonPositions,this.radioChoiceConfig),this.activate(i)}getRadioButtons(e){return e.map(((e,t)=>({text:e,callback:()=>this.activate(t)})))}renderRadioButtons(e,t,s){this.add(e.map(((e,a)=>this.createRadioButton(t[a][0],t[a][1],e.callback,s))))}createRadioButton(e,t,s,a){return new Phaser.GameObjects.Ellipse(this.scene,e,t,a.circleDim,a.circleDim,va.lightBlue).setStrokeStyle(a.outlineThickness,va.darkBlue).setInteractive({useHandCursor:!0}).addListener(Phaser.Input.Events.GAMEOBJECT_POINTER_UP,(()=>{zo.getInstance().getSoundManager().playSound(this.buttonClickSoundKey),s()}))}activate(e){this.activeChoiceIdx=e,this.activeChoice&&this.activeChoice.destroy(),this.activeChoice=new Phaser.GameObjects.Container(this.scene,this.buttonPositions[e][0],this.buttonPositions[e][1]);const t=Aa(this.scene,this.choices[e],this.choiceTextConfig,this.bitmapTextStyle),s=new Phaser.GameObjects.Ellipse(this.scene,0,0,this.radioChoiceConfig.checkedDim,this.radioChoiceConfig.checkedDim,va.darkBlue);this.activeChoice.add([t,s]),this.add(this.activeChoice)}getValueIdx(){return this.activeChoiceIdx}getChoices(){return this.choices}getChosenChoice(){return this.activeChoiceIdx<this.choices.length?this.choices[this.activeChoiceIdx]:ja.nullInteractionId}}var ui=di;const hi={key:ba.zektonFont.key,size:25,align:Phaser.GameObjects.BitmapText.ALIGN_CENTER},pi={key:ba.zektonFont.key,size:35,align:Phaser.GameObjects.BitmapText.ALIGN_CENTER},gi={key:ba.zektonFont.key,size:30,align:Phaser.GameObjects.BitmapText.ALIGN_CENTER};var mi={optHeaderTextConfig:{x:.25*ya.x,y:0,oriX:.5,oriY:.75},opt:{x:140,xSpace:.4*ya.x,ySpace:.7*ya.y},radioButtonsTextConfig:{x:0,y:-50,oriX:.5,oriY:.25},volContainerOpts:["0","0.25","0.5","1.0","1.5","2.0"]};const bi={key:ba.zektonFont.key,size:30,align:Phaser.GameObjects.BitmapText.ALIGN_CENTER},ji={key:ba.zektonFont.key,size:20,align:Phaser.GameObjects.BitmapText.ALIGN_CENTER},yi={key:ba.zektonFont.key,size:30,align:Phaser.GameObjects.BitmapText.ALIGN_CENTER};var Oi={button:{y:.15*ya.y},escapeOptTextConfig:{x:0,y:0,oriX:.37,oriY:.75},settings:{yOffset:.1*-Oa.y,ySpace:.3*ya.y},settingsTextConfig:{x:.38*ya.x,y:.1*-Oa.y,oriX:0,oriY:.5},radioButtons:{xSpace:.2*ya.x},radioChoiceTextConfig:{x:0,y:-45,oriX:.5,oriY:.25},volOpt:{x:.05*ya.x}};var fi=class{constructor(e){this.bgmVolumeRadioButtons=void 0,this.sfxVolumeRadioButtons=void 0,this.scene=void 0,this.getSoundManager=()=>zo.getInstance().getSoundManager(),this.getSettingsSaveManager=()=>zo.getInstance().getSaveManager(),this.scene=e,this.scene.getPhaseManager().addPhaseToMap(kn.EscapeMenu,this)}createUIContainer(){const e=new Phaser.GameObjects.Container(this.scene,0,0),t=new Phaser.GameObjects.Image(this.scene,Oa.x,Oa.y,Va.escapeMenuBackground.key).setDisplaySize(ya.x,ya.y).setInteractive({pixelPerfect:!0});e.add(t);const s=this.getSettings(),a=Ca({direction:xa.Column,numOfItems:s.length,maxYSpace:Oi.settings.ySpace});e.add(s.map(((e,t)=>Aa(this.scene,e,{...Oi.settingsTextConfig,y:a[t][1]+Oi.settingsTextConfig.y},yi))));const{bgmVolume:n,sfxVolume:i}=this.getSettingsSaveManager().getSettings(),r=mi.volContainerOpts.findIndex((e=>parseFloat(e)===i)),o=mi.volContainerOpts.findIndex((e=>parseFloat(e)===n));this.sfxVolumeRadioButtons=this.createSettingsRadioOptions(r,a[0][1]),this.bgmVolumeRadioButtons=this.createSettingsRadioOptions(o,a[1][1]),e.add([this.sfxVolumeRadioButtons,this.bgmVolumeRadioButtons]);const c=this.getOptButtons(),l=Ca({numOfItems:c.length});return e.add(c.map(((e,t)=>this.createEscapeOptButton(e.text,l[t][0],l[t][1]+Oi.button.y,e.callback)))),e}getSettings(){return["SFX","BGM"]}createSettingsRadioOptions(e,t){return new ui(this.scene,{choices:mi.volContainerOpts,defaultChoiceIdx:e,maxXSpace:Oi.radioButtons.xSpace,radioChoiceConfig:{circleDim:15,checkedDim:10,outlineThickness:3},choiceTextConfig:Oi.radioChoiceTextConfig,bitmapTextStyle:ji},Oi.volOpt.x,-Oa.y+t+Oi.settings.yOffset)}getOptButtons(){return[{text:"Main Menu",callback:()=>{this.cleanUp(),zo.getInstance().isGameType(qo.Simulator)?this.scene.scene.start("StorySimulatorMenu"):this.scene.scene.start("MainMenu")}},{text:"Continue",callback:async()=>{this.scene.getPhaseManager().isCurrentPhase(kn.EscapeMenu)&&await this.scene.getPhaseManager().popPhase()}},{text:"Apply Settings",callback:()=>this.applySettings()}]}createEscapeOptButton(e,t,s,a){return Cn(this.scene,{assetKey:Va.mediumButton.key,message:e,textConfig:Oi.escapeOptTextConfig,bitMapTextStyle:bi,onUp:a}).setPosition(t,s)}async applySettings(){const e=this.sfxVolumeRadioButtons?parseFloat(this.sfxVolumeRadioButtons.getChosenChoice()):1,t={bgmVolume:this.bgmVolumeRadioButtons?parseFloat(this.bgmVolumeRadioButtons.getChosenChoice()):1,sfxVolume:e};await this.getSettingsSaveManager().saveSettings(t),zo.getInstance().getSoundManager().applyUserSettings(t)}cleanUp(){this.scene.getInputManager().clearListeners(),this.scene.getLayerManager().clearAllLayers()}activateUI(){const e=this.createUIContainer();this.getSoundManager().playSound($a.menuEnter.key),this.scene.getLayerManager().addToLayer(qa.Escape,e)}deactivateUI(){this.getSoundManager().playSound($a.menuExit.key),this.scene.getLayerManager().clearSeveralLayers([qa.Escape])}};var vi=class{constructor(e){this.scene=void 0,this.keyboardListeners=void 0,this.eventListeners=void 0,this.keyboardListeners=[],this.eventListeners=[],this.scene=e}setDefaultCursor(e){this.scene.input.setDefaultCursor(e)}enableMouseInput(e){this.scene.input.mouse.enabled=e}enableKeyboardInput(e){this.scene.input.keyboard.enabled=e}registerKeyboardListener(e,t,s){const a=this.scene.input.keyboard.addKey(e).addListener(t,s);this.keyboardListeners.push(a)}registerEventListener(e,t){const s=this.scene.input.addListener(e,t);this.eventListeners.concat(s)}clearListeners(){this.keyboardListeners.forEach((e=>e.removeAllListeners())),this.eventListeners.forEach((e=>e.removeAllListeners()))}};var xi=class{constructor(e){this.layers=void 0,this.layers=new Map(za.map((t=>[t,new Phaser.GameObjects.Container(e,0,0)]))),this.layers.forEach((t=>e.add.existing(t)))}getLayer(e){return this.layers.get(e)}hideLayer(e){const t=this.layers.get(e);t&&t.setVisible(!1)&&t.setAlpha(0)}showLayer(e){const t=this.layers.get(e);t&&t.setVisible(!0)&&t.setAlpha(1)}async fadeInLayer(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:ja.fadeDuration;const s=Nn.getInstance().getGameManager(),a=this.layers.get(e);a.setVisible(!0),a.setAlpha(0),s.tweens.add(an([a],t)),await Ka(t)}async fadeOutLayer(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:ja.fadeDuration;const s=Nn.getInstance().getGameManager(),a=this.layers.get(e);a.setVisible(!0),a.setAlpha(1),s.tweens.add(sn([a],t)),await Ka(t)}addToLayer(e,t){const s=this.layers.get(e);s&&s.add(t)}clearSeveralLayers(e){e.forEach((e=>this.clearLayerContents(e)))}clearAllLayers(){this.layers.forEach(((e,t)=>this.clearLayerContents(t)))}clearLayerContents(e){const t=this.layers.get(e);if(t)for(;t.list.length;)t.list[0].destroy()}};const Ci={key:ba.zektonFont.key,size:30,align:Phaser.GameObjects.BitmapText.ALIGN_LEFT},Si=.251*ya.x;var wi={logTextConfig:{x:-.44*ya.x,y:-.378*ya.y,oriX:0,oriY:0},textMaxWidth:.68*ya.x,logHeight:.7632*ya.y,scrollbarTrack:{x:Si,y:.005*ya.y,width:7,height:.73*ya.y,color:5592405},scrollbarThumb:{x:Si,width:7,color:8947848},scrollSpeed:.5};var Ei=class{constructor(e){this.scene=void 0,this.scene=e}createUIContainer(){const e=new Phaser.GameObjects.Container(this.scene,0,0),t=Nn.getInstance().getDialogueStorage();if(0===t.length)return e;const s=Aa(this.scene,t.join("\n\n"),wi.logTextConfig,Ci).setMaxWidth(wi.textMaxWidth),a=wi.logTextConfig.y-Math.max(s.height-wi.logHeight,0);s.y=a,e.add(s);const n=new Phaser.GameObjects.Rectangle(this.scene,wi.scrollbarTrack.x,wi.scrollbarTrack.y,wi.scrollbarTrack.width,wi.scrollbarTrack.height,wi.scrollbarTrack.color),i=Math.max(wi.logHeight/s.height*wi.scrollbarTrack.height,4*wi.scrollbarThumb.width),r=wi.scrollbarTrack.y+wi.scrollbarTrack.height/2-i/2,o=(wi.scrollbarTrack.height-i)/(wi.logTextConfig.y-a),c=new Phaser.GameObjects.Rectangle(this.scene,wi.scrollbarThumb.x,r,wi.scrollbarThumb.width,i,wi.scrollbarThumb.color);e.add(n),e.add(c),s.height<=wi.logHeight&&(n.setVisible(!1),c.setVisible(!1));const{x:l,y:d,width:u,height:h}=Yn.pageArea,p=new Phaser.GameObjects.Zone(this.scene,l+u/2,d+h/2,u,h);return p.setInteractive(),p.on("wheel",((e,t,n,i)=>{s.y=Qa(s.y-n*wi.scrollSpeed,a,wi.logTextConfig.y),c.y=r-(s.y-a)*o})),e.add(p),e}};class Ti{constructor(e,t,s,a,n,i){this.scene=void 0,this.container=void 0,this.imageGlow=void 0,this.clickArea=void 0,this.glowClearer=void 0,this.blinkClearer=void 0,this.scene=e,this.container=new Phaser.GameObjects.Container(e,t,s),this.imageGlow=new Phaser.GameObjects.Image(e,0,0,a).setAlpha(0).setBlendMode(Phaser.BlendModes.ADD),this.clickArea=new Phaser.GameObjects.Image(e,0,0,a).setAlpha(.01).setInteractive({pixelPerfect:!0});const r=Nn.getInstance().getGameMap().getMapAssets().get(a),o=Nn.getInstance().getGameManager().getAnimationManager();if(r){const e=o.createImage(r,a);switch(null===r||void 0===r?void 0:r.type){case Fa.Sprite:this.clickArea.setAlpha(0),o.startAnimation(r);break;case Fa.Image:n&&(Gn(e,n,i),Gn(this.imageGlow,n,i),Gn(this.clickArea,n,i))}this.container.add([e,this.imageGlow,this.clickArea])}}startGlow(){this.glowClearer&&this.glowClearer(),this.glowClearer=on(this.scene,this.imageGlow),this.imageGlow.setAlpha(1)}clearGlow(){this.glowClearer&&this.glowClearer(),this.imageGlow.setAlpha(0)}startBlink(){this.blinkClearer=on(this.scene,this.getContainer())}clearBlink(){this.getContainer().setAlpha(1),this.blinkClearer&&this.blinkClearer()}getContainer(){return this.container}getClickArea(){return this.clickArea}}var ki=class{constructor(){this.objects=void 0,this.objects=new Map,Nn.getInstance().watchGameItemType(_n.objects,this)}renderObjectsLayerContainer(e){Nn.getInstance().clearSeveralLayers([qa.Objects]);const t=Nn.getInstance().getGameItemsInLocation(_n.objects,e);this.objects.clear(),t.map((e=>this.handleAdd(e)))}makeObjectGlow(e,t){const s=this.objects.get(e);s&&(t?s.sprite.startGlow():s.sprite.clearGlow())}makeObjectBlink(e,t){const s=this.objects.get(e);s&&(t?s.sprite.startBlink():s.sprite.clearBlink())}createObject(e){const t=Nn.getInstance().getGameManager(),{assetKey:s,x:a,y:n,width:i,height:r,actionIds:o,interactionId:c}=e,l=new Ti(t,a,n,s,i,r);return{sprite:l,clickArea:l.getClickArea(),actionIds:o,interactionId:c}}handleAdd(e){const t=Nn.getInstance().getObjectById(e),s=this.createObject(t);return Nn.getInstance().addToLayer(qa.Objects,s.sprite.getContainer()),this.objects.set(e,s),!0}handleMutate(e){return this.handleDelete(e)&&this.handleAdd(e)}handleDelete(e){const t=this.objects.get(e);return!!t&&(this.objects.delete(e),t.sprite.getContainer().destroy(),!0)}getActivatables(){return Array.from(this.objects.values())}};class Ai{constructor(e,t){this.phaseMap=void 0,this.phaseStack=void 0,this.inputManager=void 0,this.interruptCheckCallback=void 0,this.interruptTransitionCallback=void 0,this.transitionCallback=void 0,this.phaseStack=[kn.None],this.phaseMap=e,this.interruptCheckCallback=()=>!1,this.interruptTransitionCallback=async()=>ja.nullFunction(),this.transitionCallback=ja.nullFunction,this.inputManager=t}addPhaseToMap(e,t){this.phaseMap.set(e,t)}setInterruptCheckCallback(e){this.interruptCheckCallback=e}setInterruptCallback(e){this.interruptTransitionCallback=e}setCallback(e){this.transitionCallback=e}async popPhase(){const e=this.phaseStack.pop();await this.executePhaseTransition(e,this.getCurrentPhase())}async pushPhase(e){const t=this.getCurrentPhase();e!==t&&(this.phaseStack.push(e),await this.executePhaseTransition(t,e))}async swapPhase(e){const t=this.getCurrentPhase();e!==t&&(this.phaseStack.pop(),this.phaseStack.push(e),await this.executePhaseTransition(t,e))}async executePhaseTransition(e,t){if(this.inputManager.enableKeyboardInput(!1),this.inputManager.enableMouseInput(!1),await this.phaseMap.get(e).deactivateUI(),this.interruptCheckCallback(e,t))return this.inputManager.enableMouseInput(!0),this.inputManager.enableKeyboardInput(!0),void await this.interruptTransitionCallback(e,t);this.transitionCallback(e,t),await this.phaseMap.get(t).activateUI(),this.inputManager.enableMouseInput(!0),this.inputManager.enableKeyboardInput(!0)}isCurrentPhase(e){return this.getCurrentPhase()===e}isCurrentPhaseTerminal(){return Object.values(An).includes(this.getCurrentPhase())}getCurrentPhase(){return this.phaseStack.length||(this.phaseStack=[kn.None]),this.phaseStack[this.phaseStack.length-1]}}var Ii={image:{xOffset:20,yOffset:20},rect:{x:{Left:400,Middle:Oa.x,Right:ya.x-400},y:{Small:325,Medium:350,Large:420},scale:{Small:.7,Medium:1,Large:1.5},width:280,height:280},tweenDuration:300};var Ni=class{constructor(){this.currPopUp=void 0,this.currPopUp=new Map}async displayPopUp(e,t){let s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:ja.popUpDuration,a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:ei.Medium;this.destroyPopUp(t);const n=Nn.getInstance().getGameManager(),i=new Phaser.GameObjects.Container(n,0,0),r=new Phaser.GameObjects.Image(n,Ii.rect.x[t],Ii.rect.y[a],Va.popUpFrame.key).setScale(Ii.rect.scale[a]),o=this.getAssetKey(e);if(!o)return;const c=new Phaser.GameObjects.Image(n,Ii.rect.x[t]+Ii.image.xOffset,Ii.rect.y[a]+Ii.image.yOffset,o);Hn(c,Ii.rect.width*Ii.rect.scale[a],Ii.rect.height*Ii.rect.scale[a]),i.add([r,c]),this.currPopUp.set(t,i),Nn.getInstance().addToLayer(qa.PopUp,i),Nn.getInstance().playSound($a.popUpEnter.key),i.setActive(!0),i.setVisible(!0),i.setScale(1,0),n.tweens.add(function(e){return{scaleY:1,targets:e,duration:arguments.length>1&&void 0!==arguments[1]?arguments[1]:500,ease:"Power1"}}([i],Ii.tweenDuration)),await Ka(Ii.tweenDuration),setTimeout((()=>this.destroyPopUp(t)),s)}destroyAllPopUps(){this.currPopUp.forEach(((e,t,s)=>{this.destroyPopUp(t)}))}async destroyPopUp(e){const t=this.currPopUp.get(e);t&&(Nn.getInstance().getGameManager().tweens.add(function(e){return{scaleY:0,targets:e,duration:arguments.length>1&&void 0!==arguments[1]?arguments[1]:500,ease:"Power1"}}([t],Ii.tweenDuration)),await Ka(Ii.tweenDuration),t.setVisible(!1),t.setActive(!1),t.destroy(),this.currPopUp.delete(e),Nn.getInstance().playSound($a.popUpExit.key))}getAssetKey(e){const t=Nn.getInstance().getGameMap().getObjectPropMap().get(e);if(t)return t.assetKey}};const Mi=()=>({lastCheckpointPlayed:0,currentLocation:void 0,currentPhase:kn.Menu,chapterNewlyCompleted:!1,incompleteTasks:[],completedTasks:[],completedObjectives:[],triggeredInteractions:[],triggeredStateChangeActions:[]});function Pi(e){return Array.from(e).filter((e=>{let[t,s]=e;return s})).map((e=>{let[t]=e;return t}))}var Ri=class{constructor(e){this.subscribers=void 0,this.gameMap=void 0,this.checkpointObjective=void 0,this.checkpointTask=void 0,this.chapterNewlyCompleted=void 0,this.updatedLocations=void 0,this.triggeredInteractions=void 0,this.triggeredStateChangeActions=void 0,this.getGameMap=()=>this.gameMap,this.getCharacterAtId=e=>Za(this.gameMap.getCharacterMap().get(e)),this.getSaveManager=()=>zo.getInstance().getSaveManager(),this.getChapterNewlyCompleted=()=>this.chapterNewlyCompleted,this.subscribers=new Map,this.gameMap=e.map,this.checkpointObjective=e.objectives,this.checkpointTask=e.tasks,this.chapterNewlyCompleted=!1,this.updatedLocations=new Set(this.gameMap.getLocationIds()),this.triggeredInteractions=new Map,this.triggeredStateChangeActions=[],this.loadStatesFromSaveManager()}loadStatesFromSaveManager(){this.triggeredStateChangeActions=this.getSaveManager().getTriggeredStateChangeActions(),this.getSaveManager().getTriggeredInteractions().forEach((e=>this.triggerInteraction(e))),this.getSaveManager().getCompletedObjectives().forEach((e=>this.checkpointObjective.setObjective(e,!0))),this.getSaveManager().getCompletedTasks().forEach((e=>{this.checkpointTask.setTask(e,!0),this.checkpointTask.showTask(e)})),this.getSaveManager().getIncompleteTasks().forEach((e=>{this.checkpointTask.setTask(e,!1),this.checkpointTask.showTask(e)})),this.chapterNewlyCompleted=this.getSaveManager().getChapterNewlyCompleted()}watchGameItemType(e,t){this.subscribers.set(e,t)}getSubscriberForItemType(e){return this.subscribers.get(e)}triggerInteraction(e){this.triggeredInteractions.set(e,!0)}triggerStateChangeAction(e){this.triggeredStateChangeActions.push(e)}hasTriggeredInteraction(e){return this.triggeredInteractions.get(e)}addLocationNotif(e){this.updatedLocations.add(e)}removeLocationNotif(e){this.updatedLocations.delete(e)}hasLocationNotif(e){return this.updatedLocations.has(e)}isCurrentLocation(e){return e===Nn.getInstance().getCurrLocId()}getLocationModes(e){return Array.from(this.gameMap.getLocationAtId(e).modes)||[]}addLocationMode(e,t){this.gameMap.getLocationAtId(e).modes.add(t),!this.isCurrentLocation(e)&&this.addLocationNotif(e)}removeLocationMode(e,t){this.gameMap.getLocationAtId(e).modes.delete(t),!this.isCurrentLocation(e)&&this.addLocationNotif(e)}getGameItemsInLocation(e,t){return Array.from(this.gameMap.getLocationAtId(t)[e])||[]}addItem(e,t,s){var a,n;null===(a=this.gameMap.getLocationAtId(t)[e])||void 0===a||a.add(s),this.isCurrentLocation(t)?null===(n=this.getSubscriberForItemType(e))||void 0===n||n.handleAdd(s):this.addLocationNotif(t)}removeItem(e,t,s){var a,n;null===(a=this.gameMap.getLocationAtId(t)[e])||void 0===a||a.delete(s),this.isCurrentLocation(t)?null===(n=this.getSubscriberForItemType(e))||void 0===n||n.handleDelete(s):this.addLocationNotif(t)}setObjProperty(e,t){this.gameMap.setItemInMap(_n.objects,e,t),this.gameMap.getLocations().forEach(((t,s)=>{var a;t.objects.has(e)&&(this.isCurrentLocation(s)?null===(a=this.getSubscriberForItemType(_n.objects))||void 0===a||a.handleMutate(e):this.addLocationNotif(s))}))}setBBoxProperty(e,t){this.gameMap.setItemInMap(_n.boundingBoxes,e,t),this.gameMap.getLocations().forEach(((t,s)=>{var a;t.boundingBoxes.has(e)&&(this.isCurrentLocation(s)?null===(a=this.getSubscriberForItemType(_n.boundingBoxes))||void 0===a||a.handleMutate(e):this.addLocationNotif(s))}))}moveCharacter(e,t,s){this.getCharacterAtId(e).defaultPosition=s,this.gameMap.getLocations().forEach(((t,s)=>{t.characters.has(e)&&this.removeItem(_n.characters,s,e)})),this.addItem(_n.characters,t,e)}updateCharacter(e,t){this.getCharacterAtId(e).defaultExpression=t,this.gameMap.getLocations().forEach(((t,s)=>{var a;t.characters.has(e)&&(this.isCurrentLocation(s)?null===(a=this.getSubscriberForItemType(_n.characters))||void 0===a||a.handleMutate(e):this.addLocationNotif(s))}))}areAllObjectivesComplete(){return this.checkpointObjective.isAllComplete()}isObjectiveComplete(e){return this.checkpointObjective.getObjectiveState(e)}areObjectivesComplete(e){let t=!0;return e.forEach((e=>t=t&&this.isObjectiveComplete(e))),t}completeObjective(e){this.checkpointObjective.setObjective(e,!0)}isTaskComplete(e){return this.checkpointTask.getTaskState(e)}areTasksComplete(e){let t=!0;return e.forEach((e=>t=t&&this.isTaskComplete(e))),t}completeTask(e){this.checkpointTask.setTask(e,!0)}showTask(e){this.checkpointTask.showTask(e)}getAllVisibleTaskData(){return this.checkpointTask.getAllVisibleTaskData()}getCompletedObjectives(){return Pi(this.checkpointObjective.getObjectives())}getCompletedTasks(){return Pi(this.checkpointTask.getAllTasks())}getIncompleteTasks(){return this.checkpointTask.getAllIncompleteTasks()}getTriggeredInteractions(){return Pi(this.triggeredInteractions)}getTriggeredStateChangeActions(){return this.triggeredStateChangeActions}};const _i={key:ba.zektonFont.key,size:30,align:Phaser.GameObjects.BitmapText.ALIGN_LEFT},Li=.251*ya.x;var Di={taskTextConfig:{x:-.42*ya.x,y:-.378*ya.y,oriX:0,oriY:0},textMaxWidth:.66*ya.x,checkMark:{x:-.202*ya.x,y:-.369*ya.y,imageUrl:Va.talkOptCheck.key},logHeight:.7632*ya.y,scrollbarTrack:{x:Li,y:.005*ya.y,width:7,height:.73*ya.y,color:5592405},scrollbarThumb:{x:Li,width:7,color:8947848},scrollSpeed:.5};var Bi=class{constructor(e){this.scene=void 0,this.scene=e}createUIContainer(){const e=new Phaser.GameObjects.Container(this.scene,0,0),t=Nn.getInstance().getAllVisibleTaskData(),s=new Phaser.GameObjects.Container(this.scene,0,0);let a=0;if(0===t.length){const e=Aa(this.scene,"No tasks available.",Di.taskTextConfig,_i).setMaxWidth(Di.textMaxWidth);s.add(e),a=e.height}else for(let m=0;m<t.length;m++){const e=t[m][0];if(t[m][1]){const e=new Phaser.GameObjects.Image(this.scene,Di.checkMark.x,Di.checkMark.y+a,Di.checkMark.imageUrl);s.add(e)}const n=Aa(this.scene,e.title,{...Di.taskTextConfig,y:Di.taskTextConfig.y+a},_i).setMaxWidth(Di.textMaxWidth),i=Aa(this.scene,"_",{...Di.taskTextConfig,y:Di.taskTextConfig.y+a},_i);i.setScale(n.width/i.width,1),s.add(n),s.add(i),a+=n.height;const r=Aa(this.scene,e.description+(m<t.length-1?"\n ":""),{...Di.taskTextConfig,y:Di.taskTextConfig.y+a},_i).setMaxWidth(Di.textMaxWidth);s.add(r),a+=r.height}const n=-Math.max(a-Di.logHeight,0);s.y=n,e.add(s);const i=new Phaser.GameObjects.Rectangle(this.scene,Di.scrollbarTrack.x,Di.scrollbarTrack.y,Di.scrollbarTrack.width,Di.scrollbarTrack.height,Di.scrollbarTrack.color),r=Math.max(Di.logHeight/a*Di.scrollbarTrack.height,4*Di.scrollbarThumb.width),o=Di.scrollbarTrack.y+Di.scrollbarTrack.height/2-r/2,c=(Di.scrollbarTrack.height-r)/-n,l=new Phaser.GameObjects.Rectangle(this.scene,Di.scrollbarThumb.x,o,Di.scrollbarThumb.width,r,Di.scrollbarThumb.color);e.add(i),e.add(l),a<=Di.logHeight&&(i.setVisible(!1),l.setVisible(!1));const{x:d,y:u,width:h,height:p}=Yn.pageArea,g=new Phaser.GameObjects.Zone(this.scene,d+h/2,u+p/2,h,p);return g.setInteractive(),g.on("wheel",((e,t,a,i)=>{s.y=Qa(s.y-a*Di.scrollSpeed,n,0),l.y=o-(s.y-n)*c})),e.add(g),e}};const Ui=[{assetKey:Va.gear.key,onUp:e=>async()=>{const t=e.getPhaseManager();t.isCurrentPhase(kn.EscapeMenu)?await t.popPhase():t.isCurrentPhaseTerminal()?await t.swapPhase(kn.EscapeMenu):await t.pushPhase(kn.EscapeMenu)}},{assetKey:Va.journal.key,onUp:e=>async()=>{const t=e.getPhaseManager();t.isCurrentPhase(kn.Dashboard)?await t.popPhase():t.isCurrentPhaseTerminal()?await t.swapPhase(kn.Dashboard):await t.pushPhase(kn.Dashboard)}}];var Gi={firstButton:{x:ya.x-37,y:37},xOffset:64,buttonConfigs:Ui};var Fi=class{constructor(e){this.uiContainer=void 0,this.scene=void 0,this.scene=e}createUIContainer(){const e=new Phaser.GameObjects.Container(this.scene,0,0);return e.add(Gi.buttonConfigs.map(((e,t)=>this.createToolbarButton(Gi.firstButton.x-Gi.xOffset*t,Gi.firstButton.y,e)))),e}createToolbarButton(e,t,s){return Cn(this.scene,{assetKey:s.assetKey,onUp:s.onUp(this.scene)}).setPosition(e,t)}async renderToolbarContainer(){this.uiContainer=this.createUIContainer(),this.scene.getLayerManager().addToLayer(qa.UI,this.uiContainer)}};const Hi=.975*-Oa.y,Vi={key:ba.zektonDarkFont.key,size:25,align:Phaser.GameObjects.BitmapText.ALIGN_CENTER};class Wi extends Phaser.GameObjects.Container{constructor(e,t){super(e,0,0),this.renderBackButton(t)}renderBackButton(e){const t=Cn(this.scene,{assetKey:Va.topButton.key,message:"Back",textConfig:{x:0,y:Hi,oriX:.5,oriY:.25},bitMapTextStyle:Vi,onUp:e}).setPosition(Oa.x,Oa.y);this.add(t)}}var Xi=Wi;var $i={normal:`url(${Ja("/ui/magnifying.png",!1)}), pointer`,hover:`url(${Ja("/ui/magnifying_trigg.png",!1)}), pointer`,checked:`url(${Ja("/ui/magnifying_check.png",!1)}), pointer`};var qi=class{constructor(){this.uiContainer=void 0}createUIContainer(){const e=Nn.getInstance().getGameManager(),t=new Phaser.GameObjects.Container(e,0,0),s=new Xi(e,(async()=>await Nn.getInstance().swapPhase(kn.Menu)));return t.add(s),t}async activateUI(){const e=Nn.getInstance().getGameManager();this.uiContainer=this.createUIContainer(),Nn.getInstance().addToLayer(qa.UI,this.uiContainer),this.uiContainer.setPosition(this.uiContainer.x,-ya.y),this.enableInteractions(),e.tweens.add({targets:this.uiContainer,...cn}),Nn.getInstance().setDefaultCursor($i.normal),Nn.getInstance().playSound($a.modeEnter.key)}async deactivateUI(){const e=Nn.getInstance().getGameManager();Nn.getInstance().setDefaultCursor(ja.defaultCursor),this.disableInteractions(),this.uiContainer&&(this.uiContainer.setPosition(this.uiContainer.x,0),e.tweens.add({targets:this.uiContainer,...ln}),await Ka(500),nn(e,this.uiContainer))}enableInteractions(){Nn.getInstance().getAllActivatables().forEach((e=>{e.actionIds&&e.actionIds.length&&(e.clickArea.on("pointerout",(()=>this.explorePointerOut())),e.clickArea.on("pointerover",(()=>this.explorePointerOver(e.interactionId))),e.clickArea.on("pointerup",(async()=>{this.explorePointerUp(e.interactionId),await Nn.getInstance().processGameActions(e.actionIds)})))}))}disableInteractions(){Nn.getInstance().getAllActivatables().forEach((e=>{e.clickArea.off("pointerout"),e.clickArea.off("pointerover"),e.clickArea.off("pointerup")}))}explorePointerOver(e){Nn.getInstance().hasTriggeredInteraction(e)?Nn.getInstance().setDefaultCursor($i.checked):Nn.getInstance().setDefaultCursor($i.hover)}explorePointerOut(){Nn.getInstance().setDefaultCursor($i.normal)}explorePointerUp(e){Nn.getInstance().setDefaultCursor(ja.defaultCursor),Nn.getInstance().triggerInteraction(e),Nn.getInstance().setDefaultCursor($i.normal)}};let zi;!function(e){e.Move="Move",e.Explore="Explore",e.Talk="Talk",e.Menu="Menu"}(zi||(zi={}));const Yi={Move:kn.Move,Explore:kn.Explore,Talk:kn.Talk,Menu:kn.Menu},Ki={key:ba.zektonFont.key,size:45,align:Phaser.GameObjects.BitmapText.ALIGN_CENTER};var Qi={button:{yOffset:.3*ya.y},entryTweenProps:{y:0,duration:500,ease:"Power2"},exitTweenProps:{y:.4*ya.y,duration:300,ease:"Power2"}};var Ji=class{constructor(){this.uiContainer=void 0}getLatestLocationModes(){const e=Nn.getInstance().getCurrLocId();let t=Nn.getInstance().getLocationModes(e);return 0===Nn.getInstance().getGameItemsInLocation(_n.talkTopics,e).length&&(t=t.filter((e=>e!==zi.Talk))),t}createUIContainer(){const e=Nn.getInstance().getGameManager(),t=new Phaser.GameObjects.Container(e,0,0),s=new Phaser.GameObjects.Image(e,Oa.x,Oa.y,Va.modeMenuBanner.key);t.add(s);const a=this.getLatestLocationModes(),n=this.getModeButtons(a),i=Ca({numOfItems:n.length});return t.add(n.map(((e,t)=>this.createModeButton(e.text,i[t][0],i[t][1]+Qi.button.yOffset,e.callback)))),t}getModeButtons(e){return e.sort().map((e=>({text:e,callback:async()=>await Nn.getInstance().swapPhase(Yi[e])})))}createModeButton(e,t,s,a){return Cn(Nn.getInstance().getGameManager(),{assetKey:Va.shortButton.key,message:e,textConfig:{x:0,y:0,oriX:.5,oriY:.25},bitMapTextStyle:Ki,onUp:a}).setPosition(t,s)}async activateUI(){const e=Nn.getInstance().getGameManager();this.uiContainer=this.createUIContainer(),Nn.getInstance().addToLayer(qa.UI,this.uiContainer),this.uiContainer.setPosition(this.uiContainer.x,ya.y),e.tweens.add({targets:this.uiContainer,...Qi.entryTweenProps}),await Ka(500),Nn.getInstance().playSound($a.modeEnter.key)}async deactivateUI(){const e=Nn.getInstance().getGameManager();this.uiContainer&&(this.uiContainer.setPosition(this.uiContainer.x,0),e.tweens.add({targets:this.uiContainer,...Qi.exitTweenProps}),await Ka(500),nn(e,this.uiContainer))}};const Zi={key:ba.zektonFont.key,size:30,align:Phaser.GameObjects.BitmapText.ALIGN_CENTER};var er={button:{xOffSet:.25*ya.x,ySpace:.8*ya.y},preview:{rect:{x:.3125*ya.x,y:.515*ya.y,width:.473*ya.x,height:.56*ya.y},frame:{x:.3*ya.x}}};var tr=class{constructor(){this.uiContainer=void 0}setPreview(e,t){e.setTexture(t).setDisplaySize(er.preview.rect.width,er.preview.rect.height).setPosition(er.preview.rect.x,er.preview.rect.y)}getLatestNavigations(){return Nn.getInstance().getGameItemsInLocation(_n.navigation,Nn.getInstance().getCurrLocId())}createUIContainer(){const e=Nn.getInstance().getGameManager(),t=new Phaser.GameObjects.Container(e,0,0),s=new Phaser.GameObjects.Sprite(e,er.preview.frame.x,Oa.y,Va.locationPreviewFrame.key),a=new Phaser.GameObjects.Sprite(e,Oa.x,Oa.y,Va.locationPreviewFill.key);t.add([s,a]);const n=this.getLatestNavigations(),i=this.getMoveButtons(n,a),r=Ca({numOfItems:i.length,numItemLimit:1,maxYSpace:er.button.ySpace});t.add(i.map(((e,t)=>this.createMoveButton(e.text,r[t][0]+er.button.xOffSet,r[t][1],e.callback,e.onHover,e.onOut))));const o=new Xi(e,(async()=>await Nn.getInstance().swapPhase(kn.Menu)));return t.add(o),this.setPreview(a,Va.defaultLocationImg.key),t}getMoveButtons(e,t){const s=e=>this.setPreview(t,e),a=()=>this.setPreview(t,Va.defaultLocationImg.key);return e.map((e=>{const t=Nn.getInstance().getLocationAtId(e);return{text:t.name,callback:async()=>{await Nn.getInstance().swapPhase(kn.Sequence),await Nn.getInstance().changeLocationTo(e)},onHover:()=>s(t.previewKey||t.assetKey),onOut:()=>a()}}))}createMoveButton(e,t,s,a,n,i){return Cn(Nn.getInstance().getGameManager(),{assetKey:Va.longButton.key,message:e,textConfig:{x:0,y:0,oriX:.4,oriY:.15},bitMapTextStyle:Zi,onUp:a,onHover:n,onOut:i}).setPosition(t,s)}async activateUI(){const e=Nn.getInstance().getGameManager();this.uiContainer=this.createUIContainer(),Nn.getInstance().addToLayer(qa.UI,this.uiContainer),this.uiContainer.setPosition(this.uiContainer.x,-ya.y),e.tweens.add({targets:this.uiContainer,...cn}),Nn.getInstance().playSound($a.modeEnter.key)}async deactivateUI(){const e=Nn.getInstance().getGameManager();this.uiContainer&&(this.uiContainer.setPosition(this.uiContainer.x,0),e.tweens.add({targets:this.uiContainer,...ln}),await Ka(500),nn(e,this.uiContainer))}};var sr=class{activateUI(){}deactivateUI(){}};const ar={key:ba.zektonFont.key,size:30,align:Phaser.GameObjects.BitmapText.ALIGN_CENTER};var nr={button:{ySpace:.7*ya.y}};var ir=class{constructor(){this.uiContainer=void 0}getLatestTalkTopics(){return Nn.getInstance().getGameItemsInLocation(_n.talkTopics,Nn.getInstance().getCurrLocId())}createUIContainer(){const e=Nn.getInstance().getGameManager(),t=new Phaser.GameObjects.Container(e,0,0),s=this.getLatestTalkTopics(),a=this.getTalkTopicButtons(s),n=Ca({direction:xa.Column,numOfItems:a.length,maxYSpace:nr.button.ySpace});t.add(a.map(((e,t)=>this.createTalkTopicButton(e.text,n[t][0],n[t][1],e.callback)))),a.forEach(((s,a)=>{const i=new Phaser.GameObjects.Sprite(e,n[a][0],n[a][1],Va.talkOptCheck.key);!!s.interactionId&&Nn.getInstance().hasTriggeredInteraction(s.interactionId)&&t.add(i)}));const i=new Xi(e,(async()=>await Nn.getInstance().swapPhase(kn.Menu)));return t.add(i),t}getTalkTopicButtons(e){return e.map((e=>({text:Za(Nn.getInstance().getDialogueById(e)).title,callback:async()=>{Nn.getInstance().triggerInteraction(e),await Nn.getInstance().showDialogue(e)},interactionId:e})))}createTalkTopicButton(e,t,s,a){return Cn(Nn.getInstance().getGameManager(),{assetKey:Va.talkOptButton.key,message:e,textConfig:{x:0,y:0,oriX:.5,oriY:.2},bitMapTextStyle:ar,onUp:a}).setPosition(t,s)}async activateUI(){const e=Nn.getInstance().getGameManager();this.uiContainer=this.createUIContainer(),Nn.getInstance().addToLayer(qa.UI,this.uiContainer),this.uiContainer.setPosition(this.uiContainer.x,-ya.y),e.tweens.add({targets:this.uiContainer,...cn}),Nn.getInstance().playSound($a.modeEnter.key)}async deactivateUI(){const e=Nn.getInstance().getGameManager();this.uiContainer&&(this.uiContainer.setPosition(this.uiContainer.x,0),e.tweens.add({targets:this.uiContainer,...ln}),await Ka(500),nn(e,this.uiContainer))}};class rr extends Phaser.Scene{constructor(){super("GameManager"),this.currentLocationId=void 0,this.hasTransitioned=void 0,this.stateManager=void 0,this.layerManager=void 0,this.objectManager=void 0,this.characterManager=void 0,this.dialogueManager=void 0,this.actionManager=void 0,this.boundingBoxManager=void 0,this.popUpManager=void 0,this.phaseManager=void 0,this.backgroundManager=void 0,this.animationManager=void 0,this.inputManager=void 0,this.escapeManager=void 0,this.collectibleManager=void 0,this.achievementManager=void 0,this.logManager=void 0,this.dialogueStorageManager=void 0,this.toolbarManager=void 0,this.taskLogManager=void 0,this.dashboardManager=void 0,this.getSaveManager=()=>zo.getInstance().getSaveManager(),this.getStateManager=()=>Za(this.stateManager),this.getObjectManager=()=>Za(this.objectManager),this.getDialogueManager=()=>Za(this.dialogueManager),this.getCharacterManager=()=>Za(this.characterManager),this.getBBoxManager=()=>Za(this.boundingBoxManager),this.getActionManager=()=>Za(this.actionManager),this.getInputManager=()=>Za(this.inputManager),this.getLayerManager=()=>Za(this.layerManager),this.getPhaseManager=()=>Za(this.phaseManager),this.getBackgroundManager=()=>Za(this.backgroundManager),this.getAnimationManager=()=>Za(this.animationManager),this.getPopupManager=()=>Za(this.popUpManager),this.getEscapeManager=()=>Za(this.escapeManager),this.getCollectibleManager=()=>Za(this.collectibleManager),this.getAchievementManager=()=>Za(this.achievementManager),this.getLogManager=()=>Za(this.logManager),this.getDialogueStorageManager=()=>Za(this.dialogueStorageManager),this.getToolbarManager=()=>Za(this.toolbarManager),this.getTaskLogManager=()=>Za(this.taskLogManager),this.getDashboardManager=()=>Za(this.dashboardManager),this.currentLocationId=ja.nullInteractionId,this.hasTransitioned=!1}init(e){let{gameCheckpoint:t,continueGame:s,chapterNum:a,checkpointNum:n}=e;Nn.getInstance().setGameManager(this),zo.getInstance().setCurrentSceneRef(this),this.getSaveManager().registerGameInfo(a,n,s),this.currentLocationId=this.getSaveManager().getLoadedLocation()||t.startingLoc,this.hasTransitioned=!1,this.stateManager=new Ri(t),this.layerManager=new xi(this),this.inputManager=new vi(this),this.phaseManager=new Ai(new Map([[kn.Menu,new Ji],[kn.Move,new tr],[kn.Explore,new qi],[kn.Talk,new ir],[kn.Sequence,new sr],[kn.None,new sr]]),this.inputManager),this.characterManager=new qn,this.objectManager=new ki,this.dialogueManager=new ai,this.actionManager=new Bn,this.boundingBoxManager=new Xn,this.backgroundManager=new Wn,this.animationManager=new Un,this.popUpManager=new Ni,this.escapeManager=new fi(this),this.collectibleManager=new Vn(this,zo.getInstance().getUserStateManager().getCollectibles),this.achievementManager=new Vn(this,zo.getInstance().getUserStateManager().getAchievements),this.logManager=new Ei(this),this.dialogueStorageManager=new ni,this.toolbarManager=new Fi(this),this.taskLogManager=new Bi(this),this.dashboardManager=new Qn(this,[Kn.Log,Kn.Tasks,Kn.Collectibles,Kn.Achievements],[this.logManager,this.taskLogManager,this.collectibleManager,this.achievementManager])}preload(){li(this),this.getPhaseManager().setInterruptCheckCallback(((e,t)=>this.transitionChecker(e,t))),this.getPhaseManager().setInterruptCallback((async(e,t)=>await this.checkpointTransition())),this.getPhaseManager().setCallback((async(e,t)=>await this.handleCharacterLayer(e,t))),this.preloadLocationsAssets(),this.bindKeyboardTriggers()}preloadLocationsAssets(){const e=this.getStateManager().getGameMap();Nn.getInstance().loadSounds(e.getSoundAssets()),e.getMapAssets().forEach(((e,t)=>{this.loadImage(e,t)}))}loadImage(e,t){switch(e.type){case Fa.Image:this.load.image(t,Ja(e.path,!0));break;case Fa.Sprite:this.load.spritesheet(t,Ja(e.path,!0),e.config)}}async create(){Nn.getInstance().hideLayer(qa.Character),await this.changeLocationTo(this.currentLocationId,!0),await Nn.getInstance().saveGame()}async renderLocation(e,t){const s=Nn.getInstance().getLocationAtId(e);this.getToolbarManager().renderToolbarContainer(),await Nn.getInstance().playBgMusic(s.bgmKey),this.getBackgroundManager().renderBackgroundLayerContainer(e),this.getObjectManager().renderObjectsLayerContainer(e),this.getBBoxManager().renderBBoxLayerContainer(e),this.getCharacterManager().renderCharacterLayerContainer(e),await this.getPhaseManager().swapPhase(kn.Sequence),t&&(await this.getActionManager().fastForwardGameActions(this.getStateManager().getTriggeredStateChangeActions()),await this.getActionManager().processGameActions(this.getStateManager().getGameMap().getGameStartActions())),await this.getActionManager().processGameActions(s.actionIds),this.getStateManager().hasLocationNotif(e)&&(await Nn.getInstance().bringUpUpdateNotif(s.name),this.getStateManager().removeLocationNotif(e)),this.getPhaseManager().isCurrentPhase(kn.Sequence)&&await this.getPhaseManager().swapPhase(kn.Menu)}async changeLocationTo(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];this.currentLocationId=e,await(async(e,t,s,a)=>{const n=rn(e);e.getLayerManager().addToLayer(qa.Effects,n),n.setAlpha(0),e.tweens.add(an([n],t)),await Ka(t),await a(),await Ka(s),n.setAlpha(1),e.tweens.add(sn([n],t)),await Ka(t),n.destroy()})(this,300,500,(async()=>{await this.getLayerManager().clearAllLayers(),await this.renderLocation(e,t)})),this.getStateManager().triggerInteraction(e)}bindKeyboardTriggers(){this.getInputManager().registerKeyboardListener(Phaser.Input.Keyboard.KeyCodes.ESC,"up",(async()=>{this.getPhaseManager().isCurrentPhaseTerminal()?await this.getPhaseManager().popPhase():await this.getPhaseManager().pushPhase(kn.EscapeMenu)})),this.getInputManager().registerKeyboardListener(Phaser.Input.Keyboard.KeyCodes.TAB,"up",(async()=>{this.getPhaseManager().isCurrentPhase(kn.Dashboard)?await this.getPhaseManager().popPhase():this.getPhaseManager().isCurrentPhaseTerminal()?await this.getPhaseManager().swapPhase(kn.Dashboard):await this.getPhaseManager().pushPhase(kn.Dashboard)}))}cleanUp(){this.getInputManager().clearListeners(),this.getLayerManager().clearAllLayers(),this.getDialogueStorageManager().clearDialogueStorage()}transitionChecker(e,t){return!this.hasTransitioned&&t!==kn.Sequence&&Nn.getInstance().areAllObjectivesComplete()&&!this.getStateManager().getChapterNewlyCompleted()}async checkpointTransition(){this.hasTransitioned=!0,await this.getActionManager().processGameActions(this.getStateManager().getGameMap().getCheckpointCompleteActions()),this.getInputManager().setDefaultCursor(ja.defaultCursor),this.getInputManager().enableMouseInput(!0),this.getInputManager().enableKeyboardInput(!0),this.tweens.add(an([rn(this).setAlpha(0)],ja.fadeDuration)),await Ka(ja.fadeDuration),this.cleanUp(),this.scene.start("CheckpointTransition")}async handleCharacterLayer(e,t){e===kn.Menu&&Nn.getInstance().fadeOutLayer(qa.Character),t===kn.Menu&&Nn.getInstance().fadeInLayer(qa.Character)}}var or=rr;class cr{constructor(){this.fullSaveState=void 0,this.chapterNum=void 0,this.checkpointNum=void 0,this.getTriggeredStateChangeActions=()=>this.getGameSaveState().triggeredStateChangeActions,this.getTriggeredInteractions=()=>this.getGameSaveState().triggeredInteractions,this.getCompletedObjectives=()=>this.getGameSaveState().completedObjectives,this.getCompletedTasks=()=>this.getGameSaveState().completedTasks,this.getIncompleteTasks=()=>this.getGameSaveState().incompleteTasks,this.getLoadedPhase=()=>this.getGameSaveState().currentPhase,this.getChapterNewlyCompleted=()=>this.getGameSaveState().chapterNewlyCompleted,this.getChapterNum=()=>Za(this.chapterNum),this.getCheckpointNum=()=>Za(this.checkpointNum),this.getFullSaveState=()=>this.fullSaveState,this.fullSaveState={gameSaveStates:{},userSaveState:{collectibles:[],settings:{bgmVolume:1,sfxVolume:1},recentlyPlayedCheckpoint:[-1,-1],largestCompletedChapter:-1}}}async loadLastSaveState(){this.fullSaveState=await async function(){var e;const t={method:"GET",headers:Qo(zo.getInstance().getAccountInfo().accessToken)},s=await fetch(`${Se.b.backendUrl}/v2/user`,t),a=await s.text(),n=null===(e=JSON.parse(a).courseRegistration)||void 0===e?void 0:e.gameStates;return k.a.isEmpty(n)?{gameSaveStates:{},userSaveState:{collectibles:[],settings:{bgmVolume:1,sfxVolume:1},recentlyPlayedCheckpoint:[-1,-1],largestCompletedChapter:-1}}:n}()}registerGameInfo(e,t,s){this.chapterNum=e,this.checkpointNum=t,s||(this.fullSaveState.gameSaveStates[e]=Mi())}async saveGame(){zo.getInstance().getCurrentSceneRef()instanceof or&&(this.fullSaveState=function(e,t,s){const a=Nn.getInstance().getGameManager(),n=a.getStateManager(),i=a.getPhaseManager();return{gameSaveStates:{...e.gameSaveStates,[t]:{lastCheckpointPlayed:s,currentLocation:a.currentLocationId,currentPhase:i.getCurrentPhase(),chapterNewlyCompleted:n.getChapterNewlyCompleted(),incompleteTasks:n.getIncompleteTasks(),completedTasks:n.getCompletedTasks(),completedObjectives:n.getCompletedObjectives(),triggeredInteractions:n.getTriggeredInteractions(),triggeredStateChangeActions:n.getTriggeredStateChangeActions()}},userSaveState:{settings:e.userSaveState.settings,recentlyPlayedCheckpoint:[t,s],collectibles:zo.getInstance().getUserStateManager().getCollectibles(),largestCompletedChapter:e.userSaveState.largestCompletedChapter}}}(this.fullSaveState,this.getChapterNum(),this.getCheckpointNum()),await Ko(this.fullSaveState))}async saveChapterComplete(e){this.fullSaveState.gameSaveStates[e].chapterNewlyCompleted=!0,e>this.getLargestCompletedChapterNum()&&(this.fullSaveState.userSaveState.largestCompletedChapter=e),await Ko(this.fullSaveState)}async saveSettings(e){this.fullSaveState.userSaveState.settings=e,await Ko(this.fullSaveState)}getSettings(){return this.fullSaveState.userSaveState.settings}getLoadedUserState(){return this.fullSaveState.userSaveState}getLargestCompletedChapterNum(){return this.fullSaveState.userSaveState.largestCompletedChapter}getGameSaveState(){return this.fullSaveState.gameSaveStates[this.getChapterNum()]||Mi()}getLoadedLocation(){return this.getGameSaveState().currentLocation}getChapterSaveState(e){return this.fullSaveState.gameSaveStates[e]||Mi()}}const lr={key:ba.zektonFont.key,size:30,align:Phaser.GameObjects.BitmapText.ALIGN_CENTER};const dr=["Clang. Thud. One hit to the wall, one hit to my flesh.","","They told me I was to be the pillar of this","spaceship - who knew they meant it literally?","- A. Halim"],ur=["I blink synchronously with the screen;","I breathe as the machine steams on and off.","","Behind this closed space, my very blood fuels","these engines - hoping for you to find me.","- T. S. Chong"],hr=80,pr=5e3;function gr(e,t,s,a){let n=arguments.length>4&&void 0!==arguments[4]?arguments[4]:50,i=arguments.length>5&&void 0!==arguments[5]?arguments[5]:50;const r=new Phaser.GameObjects.Rectangle(e,s,a,n,i,0,0),o="A"===t?dr:ur;r.setInteractive({useHandCursor:!0}),r.addListener(Phaser.Input.Events.GAMEOBJECT_POINTER_UP,(()=>mr(e,o))),e.getLayerManager().addToLayer(qa.UI,r)}async function mr(e,t){const s=rn(e).setInteractive().setAlpha(0),a=wa({numOfItems:t.length,xSpacing:0,ySpacing:hr}),n={x:Oa.x,y:0,oriX:.5,oriY:.5},i=Oa.y-t.length*hr*.5;e.getLayerManager().addToLayer(qa.WorkerMessage,s),e.add.tween(an([s],ja.fadeDuration)),zo.getInstance().getSoundManager().playSound($a.radioStatic.key),await Ka(ja.fadeDuration),t.forEach(((t,s)=>{const r=function(e,t){let s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{x:0,y:0,oriX:.5,oriY:.5},a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:lr,n=arguments.length>4&&void 0!==arguments[4]?arguments[4]:4,i=arguments.length>5&&void 0!==arguments[5]?arguments[5]:5,r=arguments.length>6&&void 0!==arguments[6]?arguments[6]:3;const o=[];for(let c=0;c<n;c++){const n={x:s.x+i*Math.random(),y:s.y+r*Math.random(),oriX:s.oriX,oriY:s.oriY},c=Aa(e,t,n,a);c.setAlpha(.4).setBlendMode(Phaser.BlendModes.SCREEN),o.push(c)}return o.forEach((t=>{e.tweens.add({targets:t,x:t.x+i*Math.random(),y:t.y+r*Math.random(),alpha:.5,duration:20,yoyo:!0,loop:-1,loopDelay:1e3*Math.random()})})),o}(e,t,{...n,y:a[s][1]+i});r.forEach((t=>e.getLayerManager().addToLayer(qa.WorkerMessage,t))),setTimeout((()=>r.forEach((e=>e.destroy()))),pr)})),await Ka(pr),nn(e,s)}const br={scrollSpeed:20,tileDim:2048,maxAwardsPerCol:2,arrow:{xOffset:875},award:{xSpace:300,yStart:300,ySpace:Oa.y-50,dim:200},awardInfo:{width:300},banner:{xOffset:.28*-ya.x},bannerTextConfig:{x:30,y:0,oriX:0,oriY:.5}},jr={key:ba.alienLeagueFont.key,size:35,align:Phaser.GameObjects.BitmapText.ALIGN_LEFT},yr={fontFamily:"Verdana",fontSize:"30px",fill:fa.lightBlue,align:"center",wordWrap:{width:br.award.dim-20}},Or={fontFamily:"Verdana",fontSize:"20px",fill:fa.lightBlue,align:"left",wordWrap:{width:br.awardInfo.width-20}},fr={fontFamily:"Verdana",fontSize:"15px",fill:fa.offWhite,align:"left",wordWrap:{width:br.awardInfo.width-20}},vr={fontFamily:"Verdana",fontSize:"15px",fill:fa.lightBlue,align:"left",wordWrap:{width:br.awardInfo.width-20}};class xr extends Phaser.Scene{constructor(){super("AwardsHall"),this.layerManager=void 0,this.inputManager=void 0,this.backgroundTile=void 0,this.awardsContainer=void 0,this.isScrollLeft=void 0,this.isScrollRight=void 0,this.scrollLim=void 0,this.awardXSpace=void 0,this.getUserStateManager=()=>zo.getInstance().getUserStateManager(),this.getInputManager=()=>Za(this.inputManager),this.getLayerManager=()=>Za(this.layerManager),zo.getInstance().setCurrentSceneRef(this),this.isScrollLeft=!1,this.isScrollRight=!1,this.scrollLim=0,this.awardXSpace=0}init(){this.layerManager=new xi(this),this.inputManager=new vi(this)}preload(){li(this)}async create(){const e=this.getUserStateManager().getAchievements().length,t=this.getUserStateManager().getCollectibles().length;this.awardXSpace=Math.ceil(Math.max(e,t)/br.maxAwardsPerCol)*br.award.xSpace,this.scrollLim=this.awardXSpace<ya.x?0:this.awardXSpace-ya.x,this.renderBackground(),this.renderAwards(),gr(this,"A",.95*ya.x,.99*ya.y)}update(){if(!this.backgroundTile||!this.awardsContainer)return;let e=this.awardsContainer.x;this.isScrollRight?e-=br.scrollSpeed:this.isScrollLeft&&(e+=br.scrollSpeed),e=Qa(e,-this.scrollLim,0),this.backgroundTile.tilePositionX=-e,this.awardsContainer.x=e}renderBackground(){this.backgroundTile&&this.backgroundTile.destroy(),this.backgroundTile=new Phaser.GameObjects.TileSprite(this,0,0,br.tileDim,br.tileDim,Va.awardsBackground.key).setOrigin(0,.25),this.getLayerManager().addToLayer(qa.Background,this.backgroundTile);const e=["Achievements","Collectibles"],t=Ca({direction:xa.Column,numOfItems:e.length});e.forEach(((e,s)=>{const a=this.createBanner(e,t[s][1]);this.getLayerManager().addToLayer(qa.UI,a)}));const s=Cn(this,{assetKey:Va.chapterSelectArrow.key,onDown:()=>this.isScrollLeft=!0,onUp:()=>this.isScrollLeft=!1,onOut:()=>this.isScrollLeft=!1}).setPosition(Oa.x-br.arrow.xOffset,Oa.y),a=Cn(this,{assetKey:Va.chapterSelectArrow.key,onDown:()=>this.isScrollRight=!0,onUp:()=>this.isScrollRight=!1,onOut:()=>this.isScrollRight=!1}).setPosition(Oa.x+br.arrow.xOffset,Oa.y).setScale(-1,1),n=new Xi(this,(()=>{this.cleanUp(),this.scene.start("MainMenu")}));this.getLayerManager().addToLayer(qa.UI,s),this.getLayerManager().addToLayer(qa.UI,a),this.getLayerManager().addToLayer(qa.UI,n)}renderAwards(){this.awardsContainer&&this.awardsContainer.destroy(),this.awardsContainer=new Phaser.GameObjects.Container(this,0,0);const e=this.getAwards(this.getUserStateManager().getAchievements()),t=Ca({direction:xa.Column,numOfItems:e.length,numItemLimit:br.maxAwardsPerCol,redistributeLast:!1,maxXSpace:this.awardXSpace,maxYSpace:br.award.ySpace});this.awardsContainer.add(e.map(((e,s)=>this.createAward(e,t[s][0],t[s][1]+br.award.yStart-Oa.y))));const s=this.getAwards(this.getUserStateManager().getCollectibles()),a=Ca({direction:xa.Column,numOfItems:s.length,numItemLimit:br.maxAwardsPerCol,redistributeLast:!1,maxXSpace:this.awardXSpace,maxYSpace:br.award.ySpace});this.awardsContainer.add(s.map(((e,t)=>this.createAward(e,a[t][0],a[t][1]+br.award.yStart)))),this.getLayerManager().addToLayer(qa.Objects,this.awardsContainer)}getAwards(e){return Ua(e)}createAward(e,t,s){const a=new Phaser.GameObjects.Container(this,t,s);let n;if(e.assetKey===ja.nullInteractionId){n=new Phaser.GameObjects.Rectangle(this,0,0,br.award.dim,br.award.dim,va.darkBlue,.8),n.setInteractive();const t=new Phaser.GameObjects.Text(this,0,0,e.title,yr).setOrigin(.5,.5);a.add([n,t])}else n=new Phaser.GameObjects.Sprite(this,0,0,e.assetKey).setOrigin(.5),Hn(n,br.award.dim,br.award.dim),n.setInteractive({pixelPerfect:!0,useHandCursor:!0}),a.add(n);const i=new Phaser.GameObjects.Rectangle(this,0,0,br.award.dim,br.award.dim,0).setAlpha(e.completed?0:.8);a.add(i);const r=((e,t)=>{const s=new Phaser.GameObjects.Container(e,0,0),a=new Phaser.GameObjects.Text(e,20,20,t.title,Or),n=new Phaser.GameObjects.Text(e,20,a.getBounds().bottom+20,t.assetKey,fr),i=new Phaser.GameObjects.Text(e,20,n.getBounds().bottom+20,t.description,vr),r=new Phaser.GameObjects.Rectangle(e,0,0,br.awardInfo.width,i.getBounds().bottom+20,va.darkBlue).setOrigin(0,0).setAlpha(.8),o=new Phaser.GameObjects.Sprite(e,br.awardInfo.width/2,0,Va.scrollFrame.key),c=new Phaser.GameObjects.Sprite(e,br.awardInfo.width/2,r.getBounds().bottom,Va.scrollFrame.key);return s.add([r,a,i,o,c]),t.completed&&s.add(n),s.setVisible(!1),s})(this,e);return n.addListener(Phaser.Input.Events.GAMEOBJECT_POINTER_OVER,(()=>r.setVisible(!0))),n.addListener(Phaser.Input.Events.GAMEOBJECT_POINTER_OUT,(()=>r.setVisible(!1))),n.addListener(Phaser.Input.Events.GAMEOBJECT_POINTER_MOVE,(e=>{r.x=e.x+10,r.y=e.y-10})),this.getLayerManager().addToLayer(qa.UI,r),a}cleanUp(){this.getInputManager().clearListeners(),this.getLayerManager().clearAllLayers()}createBanner(e,t){const s=new Phaser.GameObjects.Container(this,0,t),a=new Phaser.GameObjects.Sprite(this,br.banner.xOffset,0,Va.awardsPage.key),n=Aa(this,e,br.bannerTextConfig,jr);return s.add([a,n]),s}}var Cr=xr;const Sr={keyTextConfig:{x:Oa.x-100,y:0,oriX:.5,oriY:.5},keyDescTextConfig:{x:Oa.x+100,y:0,oriX:.5,oriY:.5},key:{yStart:.9*Oa.y,yInterval:150},icon:{x:Oa.x-100}},wr={key:ba.zektonFont.key,size:30,align:Phaser.GameObjects.BitmapText.ALIGN_CENTER},Er={key:ba.zektonFont.key,size:25,align:Phaser.GameObjects.BitmapText.ALIGN_CENTER};class Tr extends Phaser.Scene{constructor(){super("Bindings"),this.layerManager=void 0,this.inputManager=void 0,this.getInputManager=()=>Za(this.inputManager),this.getLayerManager=()=>Za(this.layerManager)}init(){this.layerManager=new xi(this),this.inputManager=new vi(this)}create(){this.renderBackground(),this.renderBindings()}renderBackground(){const e=new Phaser.GameObjects.Image(this,Oa.x,Oa.y,Va.spaceshipBg.key),t=new Phaser.GameObjects.Rectangle(this,Oa.x,Oa.y,ya.x,ya.y,0).setAlpha(.3);this.getLayerManager().addToLayer(qa.Background,e),this.getLayerManager().addToLayer(qa.Background,t)}renderBindings(){const e=new Phaser.GameObjects.Container(this,0,0),t=this.getBindings(),s=wa({numOfItems:t.length,xSpacing:0,ySpacing:Sr.key.yInterval});e.add(t.map(((e,t)=>this.createBinding(e.key,e.text,s[t][0],s[t][1]+Sr.key.yStart))));const a=new Xi(this,(()=>{this.getLayerManager().clearAllLayers(),this.scene.start("MainMenu")}));this.getLayerManager().addToLayer(qa.UI,e),this.getLayerManager().addToLayer(qa.UI,a)}getBindings(){return[{key:"Esc",text:"Escape Menu"},{key:"Tab",text:"Dashboard"}]}createBinding(e,t,s,a){const n=new Phaser.GameObjects.Container(this,s,a),i=new Phaser.GameObjects.Sprite(this,Sr.icon.x,0,Va.squareKeyboardIcon.key);if("Tab"===e)i.setTexture(Va.medKeyboardIcon.key);const r=Aa(this,e,Sr.keyTextConfig,wr),o=Aa(this,t,Sr.keyDescTextConfig,Er);return n.add([i,r,o]),n}}var kr=Tr;const Ar=(e,t,s)=>new Promise((a=>{"__MISSING"!==e.textures.get(t).key?a(t):(e.load.image(t,s),e.load.once(`filecomplete-image-${t}`,a),e.load.once("loaderror",a),e.load.start())})),Ir=(e,t,s)=>new Promise((a=>{e.cache.text.exists(t)?a(t):(e.load.text(t,s),e.load.once(`filecomplete-text-${t}`,a),e.load.start())})),Nr={key:ba.zektonFont.key,size:25,align:Phaser.GameObjects.BitmapText.ALIGN_CENTER},Mr={key:ba.zektonFont.key,size:30,align:Phaser.GameObjects.BitmapText.ALIGN_CENTER},Pr={key:ba.zektonFont.key,size:25,align:Phaser.GameObjects.BitmapText.ALIGN_CENTER};var Rr={arrow:{xOffset:875},buttons:{scale:.65},resetButton:{xOffset:135,yOffset:85},playButton:{xOffset:55,yOffset:85},frame:{xOffset:12,yOffset:-4},scrollSpeed:100,indexTextConfig:{x:0,y:-110,oriX:.5,oriY:.5},titleTextConfig:{x:0,y:-50,oriX:.5,oriY:.5},pageNumberTextConfig:{x:Oa.x,y:ya.y-30,oriX:.5,oriY:.5},imageRect:{width:400,height:280},imageScale:{x:.8,y:.4},chapComplete:{y:10,height:30,text:"Chapter Completed"},grid:{chapPerRow:3,chapPerCol:3,chapPerPage:9,chapGapX:50,chapGapY:50}};const _r=e=>Ja(`/stories/${e}`,!0),Lr={defaultCheckpoint:{key:"default-chap",path:_r("defaultCheckpoint.txt")},awardsMapping:{key:"awards-mapping",path:_r("awardsMapping.txt")},roomPreviewMapping:{key:"room-prev-mapping",path:_r("roomPreviewMapping.txt")}},Dr={defaultCheckpoint:{key:"mock-default-chap",path:"../../assets/mockDefaultCheckpoint.txt"},awardsMapping:{key:"mock-awards-mapping",path:"../../assets/mockAwardsMapping.txt"},roomPreviewMapping:{key:"mock-room-prev-mapping",path:"../../assets/mockRoomPreviewMapping.txt"}};var Br=Lr;var Ur=class{constructor(){this.soundAssets=void 0,this.mapAssets=void 0,this.locations=void 0,this.dialogues=void 0,this.objects=void 0,this.boundingBoxes=void 0,this.characters=void 0,this.actions=void 0,this.gameStartActions=void 0,this.checkpointCompleteActions=void 0,this.getLocationAtId=e=>Za(this.locations.get(e),`Location ${e} was not found!`),this.getAssetByKey=e=>Za(this.mapAssets.get(e),`Asset ${e} not found!`),this.soundAssets=[],this.mapAssets=new Map,this.locations=new Map,this.dialogues=new Map,this.objects=new Map,this.boundingBoxes=new Map,this.characters=new Map,this.actions=new Map,this.gameStartActions=[],this.checkpointCompleteActions=[]}addSoundAsset(e){this.soundAssets.push(e)}addMapAsset(e,t){this.mapAssets.set(e,t)}getMapAssets(){return this.mapAssets}addLocation(e,t){this.locations.set(e,t)}setModesAt(e,t){this.getLocationAtId(e).modes=new Set(t)}setNavigationFrom(e,t){this.getLocationAtId(e).navigation=new Set(t)}getNavigationFrom(e){return this.getLocationAtId(e).navigation}setGameStartActions(e){this.gameStartActions=e}setCheckpointCompleteActions(e){this.checkpointCompleteActions=e}getGameStartActions(){return this.gameStartActions}getCheckpointCompleteActions(){return this.checkpointCompleteActions}getLocations(){return this.locations}getObjectPropMap(){return this.objects}getBBoxPropMap(){return this.boundingBoxes}getDialogueMap(){return this.dialogues}getCharacterMap(){return this.characters}getActionMap(){return this.actions}getSoundAssets(){return this.soundAssets}setItemInMap(e,t,s){this[e].set(t,s)}addItemToLocation(e,t,s){this.getLocationAtId(e)[t].add(s)}setBGMusicAt(e,t){this.getLocationAtId(e).bgmKey=t}getLocationIds(){return Array.from(this.locations.keys())}getAssetKeyFromId(e){var t,s;return Za((null===(t=this.objects.get(e))||void 0===t?void 0:t.assetKey)||(null===(s=this.locations.get(e))||void 0===s?void 0:s.assetKey),`Id ${e} not found!`)}};var Gr=class{constructor(){this.objective=void 0,this.totalNumOfObjectives=void 0,this.numOfCompletedObjectives=void 0,this.objective=new Map,this.totalNumOfObjectives=0,this.numOfCompletedObjectives=0}setObjective(e,t){const s=this.objective.get(e);this.objective.set(e,t),void 0!==s&&s!==t&&this.numOfCompletedObjectives++}addObjective(e){this.objective.set(e,!1),this.totalNumOfObjectives++}addObjectives(e){e.forEach((e=>this.addObjective(e)))}isAllComplete(){return this.numOfCompletedObjectives>=this.totalNumOfObjectives}getObjectiveState(e){const t=this.objective.get(e);if(void 0===t)throw new Error(`Cannot find objective with the given task id "${e}"`);return t}getObjectives(){return this.objective}setObjectives(e){this.objective=e}};var Fr=class{constructor(){this.tasks=void 0,this.taskDetails=void 0,this.tasks=new Map,this.taskDetails=new Map}setTask(e,t){this.tasks.set(e,t)}showTask(e){const t=this.taskDetails.get(e);if(void 0!==t){const s={...t,visible:!0};this.taskDetails.set(e,s)}}addTask(e){const t=e.taskId;this.tasks.set(t,!1),this.taskDetails.set(t,e)}addTasks(e){e.forEach((e=>this.addTask(e)))}getTaskState(e){const t=this.tasks.get(e);if(void 0===t)throw new Error(`Cannot find task with the given task id "${e}"`);return t}getTaskDetail(e){const t=this.taskDetails.get(e);if(void 0===t)throw new Error(`Cannot find task with the given task id "${e}"`);return t}getAllTasks(){return this.tasks}getAllIncompleteTasks(){const e=new Array;for(const s of this.tasks.keys()){var t;!this.tasks.get(s)&&null!==(t=this.taskDetails.get(s))&&void 0!==t&&t.visible&&e.push(s)}return e}getAllVisibleTaskData(){const e=new Array;for(const t of this.tasks.keys()){const s=this.getTaskState(t),a=this.getTaskDetail(t);void 0!==s&&void 0!==a&&a.visible&&e.push([a,s])}return e}};const Hr={small:ei.Small,medium:ei.Medium,large:ei.Large},Vr={left:Zn.Left,middle:Zn.Middle,right:Zn.Right},Wr={talk:zi.Talk,explore:zi.Explore,move:zi.Move,menu:zi.Menu},Xr={navigation:_n.navigation,talkTopics:_n.talkTopics,objects:_n.objects,boundingBoxes:_n.boundingBoxes,characters:_n.characters,actions:_n.actions,bgmKey:_n.bgmKey,collectibles:_n.collectibles},$r={move_character:Rn.MoveCharacter,update_character:Rn.UpdateCharacter,obtain_collectible:Rn.ObtainCollectible,complete_objective:Rn.CompleteObjective,complete_task:Rn.CompleteTask,show_task:Rn.ShowTask,add_item:Rn.AddItem,remove_item:Rn.RemoveItem,change_background:Rn.ChangeBackground,start_animation:Rn.StartAnimation,stop_animation:Rn.StopAnimation,show_dialogue:Rn.ShowDialogue,add_mode:Rn.AddLocationMode,remove_mode:Rn.RemoveLocationMode,add_popup:Rn.AddPopup,make_object_glow:Rn.MakeObjectGlow,make_object_blink:Rn.MakeObjectBlink,play_bgm:Rn.PlayBGM,play_sfx:Rn.PlaySFX,preview_location:Rn.PreviewLocation,show_object_layer:Rn.ShowObjectLayer,navigate_to_assessment:Rn.NavigateToAssessment,update_assessment_status:Rn.UpdateAssessmentStatus,delay:Rn.Delay},qr={checklist:Mn.ChecklistState,tasklist:Mn.TasklistState,userstate:Mn.UserState},zr={assessments:Pn.assessments,achievements:Pn.achievements,collectibles:Pn.collectibles};class Yr{static stringToSize(e){return Hr[e]||ei.Medium}static stringToPosition(e){return Vr[e]||Zn.Middle}static stringToGameMode(e){return Za(Wr[e],`Invalid location mode, ${e}`)}static stringToActionType(e){return Za($r[e],`Invalid action type, ${e}`)}static stringToGameStateStorage(e){return Za(qr[e],`Invalid condition type, ${e}`)}static stringToGameItemType(e){return Za(Xr[e],`Invalid entity type, ${e}`)}static stringToBoolean(e){return"false"!==e}static stringToUserStateType(e){return Za(zr[e],`Invalid user state type ${e}`)}}let Kr;!function(e){e.locations="locations",e.objectives="objectives",e.tasks="tasks",e.bgms="bgms",e.sfxs="sfxs"}(Kr||(Kr={}));class Qr{constructor(){this.gameItemAsserts=void 0,this.gameEntityAsserts=void 0,this.gameAnimAsserts=void 0,this.gameAnimMaps=[ho.checkpoint.map.getLocations(),ho.checkpoint.map[_n.objects]],this.allItemIds=void 0,this.gameItemAsserts=new Map,this.gameEntityAsserts=new Map,this.gameAnimAsserts=[],this.allItemIds=new Set}registerId(e){if(this.allItemIds.has(e))throw new Error(`Duplicate item id ${e}`);this.allItemIds.add(e)}verifyAssertions(){this.verifyGameItemAssert(),this.verifyGameEntityAsserts(),this.verifyGameAnimAsserts()}assertItemType(e,t,s){e===_n.talkTopics?e=_n.dialogues:e===_n.navigation&&(e=_n.locations),this.gameItemAsserts.get(e)||this.gameItemAsserts.set(e,[]),this.gameItemAsserts.get(e).push({itemId:t,actionType:s})}verifyGameItemAssert(){this.gameItemAsserts.forEach(((e,t)=>{e.forEach((e=>{const{itemId:s,actionType:a}=e;if(!ho.checkpoint.map[t].has(s))throw a&&this.actionAssertionError(s,t,a),new Error(`Cannot find id "${s}" under ${t} entity type`)}))}))}assertItemTypes(e,t,s){t.forEach((t=>this.assertItemType(e,t,s)))}assertEntityType(e,t,s){this.gameEntityAsserts.get(e)||this.gameEntityAsserts.set(e,[]),this.gameEntityAsserts.get(e).push({itemId:t,actionType:s})}verifyGameEntityAsserts(){this.gameEntityAsserts.forEach(((e,t)=>{e.forEach((e=>{const{itemId:s,actionType:a}=e;switch(t){case Kr.locations:ho.checkpoint.map.getLocationAtId(s);break;case Kr.objectives:if(void 0===ho.checkpoint.objectives.getObjectives().get(s))throw a&&this.actionAssertionError(s,t,a),new Error(`Cannot find objective id "${s}"`);break;case Kr.tasks:if(void 0===ho.checkpoint.tasks.getAllTasks().get(s))throw a&&this.actionAssertionError(s,t,a),new Error(`Cannot find task id "${s}"`);break;case Kr.bgms:const e=ho.checkpoint.map.getSoundAssets().filter((e=>e.soundType===Xa.BGM&&e.key===s)).length;if(0===e)throw new Error(`Cannot find bgm key "${s}"`);if(e>1)throw new Error(`More than 1 bgm key "${s}"`);break;case Kr.sfxs:const n=ho.checkpoint.map.getSoundAssets().filter((e=>e.soundType===Xa.SFX&&e.key===s)).length;if(0===n)throw new Error(`Cannot find sfx key "${s}"`);if(n>1)throw new Error(`More than 1 sfx key "${s}"`)}}))}))}assertAnimType(e,t){this.gameAnimAsserts.push({itemId:e,actionType:t})}verifyGameAnimAsserts(){this.gameAnimAsserts.forEach((e=>{const{itemId:t,actionType:s}=e;let a=!1;this.gameAnimMaps.forEach((e=>{e.get(t)&&(a=!0)})),a||this.actionAssertionError(t,"locationId or itemId",s)}))}actionAssertionError(e,t,s){throw new Error(`Expected type of "${t}" as argument for "${s}", obtained "${e}" which is either undefined or the wrong id.`)}}class Jr{static parse(e){const t="!"===e[0];t&&(e=e.slice(1));const[s,...a]=ti.splitByChar(e,".");switch(Yr.stringToGameStateStorage(s)){case Mn.ChecklistState:return ho.validator.assertEntityType(Kr.objectives,a[0]),{state:Mn.ChecklistState,conditionParams:{id:a[0]},boolean:!t};case Mn.TasklistState:return ho.validator.assertEntityType(Kr.tasks,a[0]),{state:Mn.TasklistState,conditionParams:{id:a[0]},boolean:!t};case Mn.UserState:return{state:Mn.UserState,conditionParams:{userStateType:Yr.stringToUserStateType(a[0]),id:a[1]},boolean:!t};default:throw new Error("Parsing error: Invalid condition param")}}}class Zr{static parseActions(e){return e.map((e=>this.parseAction(e)))}static parseAction(e){const[t,s]=ti.splitByChar(e,"if"),a=this.parseActionContent(t);return s&&(a.actionConditions=ti.splitByChar(s,"AND").map((e=>Jr.parse(e)))),ho.checkpoint.map.setItemInMap(_n.actions,a.interactionId,a),a.interactionId}static parseActionContent(e){const[t,s]=ti.splitByChar(e,"(");let a=!1,n=t;"*"===t[t.length-1]&&(a=!0,n=n.slice(0,-1));const i=Yr.stringToActionType(n),r=ti.splitByChar(s.slice(0,-1),","),o={};switch(i){case Rn.ObtainCollectible:o.id=r[0];break;case Rn.CompleteObjective:o.id=r[0],ho.validator.assertEntityType(Kr.objectives,r[0],n);break;case Rn.CompleteTask:case Rn.ShowTask:o.id=r[0],ho.validator.assertEntityType(Kr.tasks,r[0],n);break;case Rn.PreviewLocation:case Rn.ChangeBackground:o.id=r[0],ho.validator.assertEntityType(Kr.locations,r[0],n);break;case Rn.StartAnimation:o.id=r[0],o.startFrame=+r[1],o.frameRate=+r[2],o.assetCategory=r[3],ho.validator.assertAnimType(r[0],n);break;case Rn.StopAnimation:o.id=r[0],ho.validator.assertAnimType(r[0],n);break;case Rn.ShowDialogue:o.id=r[0],ho.validator.assertItemType(_n.dialogues,r[0],n);break;case Rn.AddItem:case Rn.RemoveItem:const e=Yr.stringToGameItemType(r[0]);o.gameItemType=e,o.locationId=r[1],ho.validator.assertEntityType(Kr.locations,r[1],n),o.id=r[2],ho.validator.assertItemType(e,r[2],n);break;case Rn.AddLocationMode:case Rn.RemoveLocationMode:ho.validator.assertEntityType(Kr.locations,r[0],n),o.locationId=r[0],o.mode=Yr.stringToGameMode(r[1]);break;case Rn.AddPopup:ho.validator.assertItemType(_n.objects,r[0],n),o.id=r[0],o.position=Yr.stringToPosition(r[1]),r[2]&&(o.duration=1e3*parseInt(r[2])),r[3]&&(o.size=Yr.stringToSize(r[3]));break;case Rn.MakeObjectBlink:case Rn.MakeObjectGlow:ho.validator.assertItemType(_n.objects,r[0],n),o.id=r[0],o.turnOn=Yr.stringToBoolean(r[1]);break;case Rn.PlayBGM:o.id=r[0],ho.validator.assertEntityType(Kr.bgms,r[0],n);break;case Rn.PlaySFX:o.id=r[0],ho.validator.assertEntityType(Kr.sfxs,r[0],n);break;case Rn.ShowObjectLayer:o.show=Yr.stringToBoolean(r[0]);break;case Rn.UpdateCharacter:ho.validator.assertItemType(_n.characters,r[0],n),o.id=r[0],o.expression=r[1];break;case Rn.MoveCharacter:ho.validator.assertItemType(_n.characters,r[0],n),ho.validator.assertEntityType(Kr.locations,r[1],n),o.id=r[0],o.locationId=r[1],o.position=Yr.stringToPosition(r[2]);break;case Rn.NavigateToAssessment:o.assessmentId=r[0];break;case Rn.Delay:o.duration=1e3*parseInt(r[0])}return{actionType:i,actionParams:o,actionConditions:[],interactionId:ho.generateActionId(),isInteractive:!1,isRepeatable:a}}}class eo{static parsePrompt(e,t){return{promptTitle:e.split("prompt:")[1].trim(),choices:t.map(this.splitChoice)}}static splitChoice(e){const t=ti.splitWithLimit(e,"->",1);return[t[0].trim(),t[1].split(" ")[1].trim()]}}class to{static parse(e,t){t.forEach((t=>this.parseCharacterDetails(e,t)))}static characterAssetKey(e,t){return e+"-"+t}static characterAssetPath(e,t){return`/avatars/${e}/${e}.${t}.png`}static parseCharacterDetails(e,t){const s="+"===t[0];s&&(t=t.slice(1));const[a,n,i,r,o]=ti.splitByChar(t,",");ho.validator.registerId(a);const c=new Map,l={id:a,name:n,expressions:c,defaultExpression:i,defaultPosition:Yr.stringToPosition(r),scale:o?parseFloat(o):1};c.set(i,this.characterAssetKey(a,i)),ho.checkpoint.map.addMapAsset(this.characterAssetKey(a,i),{type:Fa.Image,path:this.characterAssetPath(a,i),key:a}),ho.checkpoint.map.setItemInMap(_n.characters,a,l),s&&ho.checkpoint.map.addItemToLocation(e,_n.characters,a)}}class so{static parse(e){const[t,s,a]=ti.splitByChar(e.slice(1),","),n=Yr.stringToPosition(a);return this.addCharacterExprToMap(t,s),{speakerId:t,expression:s,speakerPosition:n}}static addCharacterExprToMap(e,t){if("you"===e||"narrator"===e)return;const s=ho.checkpoint.map.getCharacterMap().get(e);if(!s)throw new Error(`Character "${e}" not in map`);const a=t||s.defaultExpression;s.expressions.set(t,to.characterAssetKey(e,t||a)),ho.checkpoint.map.addMapAsset(to.characterAssetKey(e,a),{path:to.characterAssetPath(e,a),type:Fa.Image,key:e})}}const ao=e=>new RegExp(/^[0-9]+$/).test(e),no=e=>new RegExp(/^goto [0-9]+.*$/).test(e),io=e=>e&&("\t"===e[0]||"    "===e.slice(0,4)),ro=e=>e&&"@"===e[0],oo=e=>e.trim().startsWith("prompt:"),co=e=>new RegExp(/-> +goto/).test(e);class lo{static parse(e,t,s){t.forEach(((t,a)=>{const[n,i,r]=ti.splitByChar(t,",");ho.validator.registerId(n),ho.checkpoint.map.addSoundAsset({key:n,path:i,config:{volume:parseFloat(r),loop:s===Xa.BGM},soundType:s}),s===Xa.BGM&&0===a&&ho.checkpoint.map.setBGMusicAt(e,n)}))}}class uo{static generateActionId(){return uo.actionIdNum++,`action#${uo.actionIdNum}`}static init(){uo.actionIdNum=0,uo.checkpoint={map:new Ur,startingLoc:"",objectives:new Gr,tasks:new Fr},uo.validator=new Qr}static parse(e){arguments.length>1&&void 0!==arguments[1]&&arguments[1]||uo.init();const t=ti.splitToLinesAndRemoveComments(e);ti.splitToParagraph(t).forEach((e=>{let[t,s]=e;0===s.length&&t.includes(":")?uo.parseCheckpointConfig(t):uo.parseCheckpointParagraphs(t,s)||class{static parse(e,t){const s=ho.checkpoint.map.getLocationAtId(e);ti.splitToParagraph(t).forEach((e=>{let[t,a]=e;0===a.length&&t.includes(":")?this.parseLocationConfig(s,t):this.parseLocationParagraphs(s,t,a)}))}static parseLocationConfig(e,t){const[s,a]=ti.splitByChar(t,":"),n=ti.splitByChar(a,",");switch(s){case"modes":n.forEach((t=>{const s=Yr.stringToGameMode(t);e.modes.add(s)}));break;case"nav":n.forEach((t=>{ho.validator.assertEntityType(Kr.locations,t),e.navigation.add(t)}));break;case"talkTopics":const t=n;ho.validator.assertItemTypes(_n.dialogues,t),e.talkTopics=new Set(t);break;case"preview":const[a]=n;if(a){const t="/preview"+a;ho.checkpoint.map.addMapAsset(t,{type:Fa.Image,key:e.id+"Preview",path:a}),e.previewKey=t}break;default:throw new Error(`Invalid config key "${s}" specified under location "${e.id}"`)}}static parseLocationParagraphs(e,t,s){switch(t){case"objects":(class{static parse(e,t){ti.splitToParagraph(t).forEach((t=>{let[s,a]=t;const n=this.parseObjectConfig(e,s);a.length&&(n.isInteractive=!0,n.actionIds=Zr.parseActions(a))}))}static objectAssetKey(e){return e}static objectPath(e){return e}static parseObjectConfig(e,t){const s="+"===t[0];s&&(t=t.slice(1));const[a,n,i,r,o,c,l,d]=ti.splitByChar(t,",");ho.validator.registerId(a);const u={assetKey:this.objectAssetKey(n),x:parseInt(i),y:parseInt(r),width:parseInt(o)||void 0,height:parseInt(c)||void 0,isInteractive:!1,interactionId:a};return ho.checkpoint.map.addMapAsset(this.objectAssetKey(n),{type:Fa[l]||Fa.Image,key:a,path:this.objectPath(n),config:{frameHeight:parseInt(c)||-1,frameWidth:parseInt(o)||-1,centreX:0,centreY:0,endFrame:parseInt(d)-1||0,animType:Ha.Object}}),ho.checkpoint.map.setItemInMap(_n.objects,a,u),s&&ho.checkpoint.map.addItemToLocation(e,_n.objects,a),u}}).parse(e.id,s);break;case"boundingBoxes":(class{static parse(e,t){ti.splitToParagraph(t).forEach((t=>{let[s,a]=t;const n=this.parseBBoxConfig(e,s);a.length&&(n.isInteractive=!0,n.actionIds=Zr.parseActions(a))}))}static parseBBoxConfig(e,t){const s="+"===t[0];s&&(t=t.slice(1));const[a,n,i,r,o]=ti.splitByChar(t,","),c={x:parseInt(n),y:parseInt(i),width:parseInt(r),height:parseInt(o),isInteractive:!1,interactionId:a};return ho.validator.registerId(a),ho.checkpoint.map.setItemInMap(_n.boundingBoxes,a,c),s&&ho.checkpoint.map.addItemToLocation(e,_n.boundingBoxes,a),c}}).parse(e.id,s);break;case"characters":to.parse(e.id,s);break;case"bgm":lo.parse(e.id,s,Xa.BGM);break;case"sfx":lo.parse(e.id,s,Xa.SFX);break;case"actions":e.actionIds=Zr.parseActions(s);break;default:throw new Error(`Invalid location paragraph header "${t}"`)}}}.parse(t,s)})),uo.validator.verifyAssertions()}static parseCheckpointConfig(e){const[t,s]=ti.splitByChar(e,":");if("startingLoc"!==t)throw new Error(`Invalid checkpoint config key, "${e}"`);uo.validator.assertEntityType(Kr.locations,s),uo.checkpoint.startingLoc=s}static parseCheckpointParagraphs(e,t){switch(e){case"objectives":uo.checkpoint.objectives.addObjectives(t);break;case"tasks":(class{static parse(e){const t=[];e.forEach((e=>{const[s,a,n]=ti.splitWithLimit(e,",",2),i={taskId:s,title:a,description:n,visible:!1};t.push(i)})),ho.checkpoint.tasks.addTasks(t)}}).parse(t);break;case"locations":(class{static parse(e){e.forEach((e=>{const[t,s,a,n,i]=ti.splitByChar(e,",");ho.validator.registerId(t),ho.checkpoint.map.addLocation(t,{id:"",name:"",assetKey:"",previewKey:null,modes:new Set([]),navigation:new Set([]),talkTopics:new Set([]),objects:new Set([]),boundingBoxes:new Set([]),bgmKey:"",characters:new Set([]),id:t,name:a,assetKey:this.locationAssetKey(s)}),ho.checkpoint.map.addMapAsset(this.locationAssetKey(s),{type:Fa[n]||Fa.Image,key:t,path:this.locationPath(s),config:{frameWidth:ya.x,frameHeight:ya.y,centreX:Oa.x,centreY:Oa.y,endFrame:parseInt(i)-1||0,animType:Ha.Background}})}))}static locationAssetKey(e){return e}static locationPath(e){return e}}).parse(t);break;case"gameStartActions":uo.checkpoint.map.setGameStartActions(Zr.parseActions(t));break;case"checkpointCompleteActions":uo.checkpoint.map.setCheckpointCompleteActions(Zr.parseActions(t));break;case"dialogues":(class{static parse(e){ti.splitToParagraph(e).forEach((e=>{let[t,s]=e;0!==s.length?this.parseDialogue(t,s):console.error("No dialogue found for dialogueId")}))}static parseDialogue(e,t){const[s,a]=ti.splitWithLimit(e,",",1);ho.validator.registerId(s);const n={title:a,content:this.parseDialogueContent(t)};n.title||(n.title=ti.toCapitalizedWords(s)),ho.checkpoint.map.setItemInMap(_n.dialogues,s,n)}static parseDialogueContent(e){return function(e,t){const s=new Map;return e.forEach(((e,a)=>{const n=t(e,a);s.set(a,n)})),s}(ti.mapByHeader(e,ao),this.createDialogueLines)}static createDialogueLines(e){const t=[];let s=0;for(;s!==e.length;){const a=e[s];switch(!0){case no(a):const[n,i]=ti.splitByChar(a,"if"),[r,o]=i?ti.splitByChar(i,"else"):[null,null],c=r?ti.splitByChar(r,"AND").map((e=>Jr.parse(e))):[];t[t.length-1].goto={conditions:c,part:n.split(" ")[1],altPart:o};break;case oo(a):const l=a,d=[];for(;e[s+1]&&co(e[s+1]);)s++,d.push(e[s].trim());const u=eo.parsePrompt(l,d);t[t.length-1].prompt=u;break;case io(a):const h=t[t.length-1];!h.actionIds&&(h.actionIds=[]),h.actionIds.push(Zr.parseAction(a));break;case ro(a):s++;const p=e[s];if(!p)throw new Error("Parsing error: Cannot change speaker without next line");t.push({line:p}),t[t.length-1].speakerDetail=so.parse(a);break;default:t.push({line:a}),t[t.length-1].speakerDetail=so.parse("@narrator")}s++}return t}}).parse(t);break;default:return!1}return!0}}uo.checkpoint=void 0,uo.actionIdNum=void 0,uo.validator=void 0;var ho=uo;async function po(e,t,s){const a=zo.getInstance().getIsUsingMock()?Dr:Br,n=zo.getInstance().getCurrentSceneRef(),i=zo.getInstance().getGameChapters()[t].filenames[s];if(!i)return;await Ir(n,i,i),await Ir(n,a.defaultCheckpoint.key,a.defaultCheckpoint.path);const r=n.cache.text.get(i),o=n.cache.text.get(a.defaultCheckpoint.key);ho.parse(o),ho.parse(r,!0);const c=ho.checkpoint;n.scene.start("GameManager",{gameCheckpoint:c,continueGame:e,chapterNum:t,checkpointNum:s})}async function go(){const e=zo.getInstance().getCurrentSceneRef(),t=zo.getInstance().getSSChapterSimFilenames();if(!t.length)return void e.scene.start("StorySimulatorMenu");const s=t.pop();await Ir(e,s,_r(s)),await Ir(e,Br.defaultCheckpoint.key,Br.defaultCheckpoint.path);const a=e.cache.text.get(s),n=e.cache.text.get(Br.defaultCheckpoint.key);ho.parse(n),ho.parse(a,!0);const i=ho.checkpoint;return e.scene.start("GameManager",{gameCheckpoint:i,chapterNum:-1,checkpointNum:-1}),!0}function mo(e,t,s){let{title:a,imageUrl:n}=t;const[i,r]=function(e){const t=Math.floor(e/Rr.grid.chapPerPage);e%=Rr.grid.chapPerPage;const s=Math.floor(e/Rr.grid.chapPerRow),a=e%Rr.grid.chapPerRow,n=(Rr.grid.chapPerRow-1)/2,i=(Rr.grid.chapPerCol-1)/2;let r=t*ya.x+Oa.x;r+=(a-n)*(Rr.imageRect.width+Rr.grid.chapGapX);let o=Oa.y;return o+=(s-i)*(Rr.imageRect.height+Rr.grid.chapGapY),[r,o]}(s),o=new Phaser.GameObjects.Container(e,i,r),c=s<=zo.getInstance().getSaveManager().getLargestCompletedChapterNum(),l=new Phaser.GameObjects.Image(e,0,0,n).setDisplaySize(Rr.imageRect.width,Rr.imageRect.height),d=new Phaser.GameObjects.Sprite(e,Rr.frame.xOffset,Rr.frame.yOffset,Va.chapterSelectFrame.key).setScale(.99*Rr.imageScale.x,.99*Rr.imageScale.y),u=new Phaser.GameObjects.Rectangle(e,0,Rr.chapComplete.y,Rr.imageRect.width,Rr.chapComplete.height,0).setOrigin(.5).setAlpha(.7).setInteractive().setVisible(c),h=Aa(e,Rr.chapComplete.text,{x:0,y:Rr.chapComplete.y,oriX:.5,oriY:.5},Nr).setVisible(c),p=new ka(e,Rr.resetButton.xOffset+8,Rr.resetButton.yOffset-20,"Reset progress"),g=new ka(e,Rr.playButton.xOffset+8,Rr.playButton.yOffset-20,"Play/Continue"),m=Cn(e,{assetKey:Va.chapterRepeatButton.key,onUp:async()=>await po(!1,s,0),onHover:()=>p.setVisible(!0),onOut:()=>p.setVisible(!1)}).setPosition(Rr.resetButton.xOffset,Rr.resetButton.yOffset).setScale(Rr.buttons.scale),b=zo.getInstance().getSaveManager().getChapterSaveState(s).lastCheckpointPlayed,j=Cn(e,{assetKey:Va.chapterContinueButton.key,onUp:async()=>await po(!0,s,b),onHover:()=>g.setVisible(!0),onOut:()=>g.setVisible(!1)}).setPosition(Rr.playButton.xOffset,Rr.playButton.yOffset).setScale(Rr.buttons.scale),y=Aa(e,`Chapter ${s}`,Rr.indexTextConfig,Nr),O=Aa(e,a,Rr.titleTextConfig,Mr),f=s<=zo.getInstance().getSaveManager().getLargestCompletedChapterNum()+1,v=new Phaser.GameObjects.Rectangle(e,0,0,Rr.imageRect.width,Rr.imageRect.height,0).setOrigin(.5).setAlpha(f?0:.8).setInteractive();return o.add([l,d,u,h,m,j,p,g,y,O,v]),o}class bo extends Phaser.Scene{constructor(){super("ChapterSelect"),this.layerManager=void 0,this.chaptersContainer=void 0,this.backButtonContainer=void 0,this.pageNumberText=void 0,this.targetPage=void 0,this.getGameChapters=()=>zo.getInstance().getGameChapters(),this.getLayerManager=()=>Za(this.layerManager),this.chaptersContainer=void 0,this.backButtonContainer=void 0,this.pageNumberText=void 0,this.targetPage=0}preload(){li(this)}async create(){zo.getInstance().setCurrentSceneRef(this),this.layerManager=new xi(this),await this.preloadChapterAssets(),this.renderBackground(),this.renderChapters()}update(){if(!this.chaptersContainer)return;const e=-this.targetPage*ya.x;if(this.chaptersContainer.x>e){const t=this.chaptersContainer.x-Rr.scrollSpeed;this.chaptersContainer.x=Math.max(t,e)}else if(e>this.chaptersContainer.x){const t=this.chaptersContainer.x+Rr.scrollSpeed;this.chaptersContainer.x=Math.min(t,e)}}cleanUp(){this.getLayerManager().clearAllLayers()}async preloadChapterAssets(){await Promise.all(this.getGameChapters().map((async e=>await Ar(this,e.imageUrl,Ja(e.imageUrl,!0)))))}renderBackground(){const e=new Phaser.GameObjects.Image(this,Oa.x,Oa.y,Va.spaceshipBg.key),t=new Phaser.GameObjects.Rectangle(this,Oa.x,Oa.y,ya.x,ya.y,0).setAlpha(.3);this.getLayerManager().addToLayer(qa.Background,e),this.getLayerManager().addToLayer(qa.Background,t)}renderChapters(){this.backButtonContainer=new Xi(this,(()=>{this.cleanUp(),this.scene.start("MainMenu")})),this.chaptersContainer=this.createChaptersContainer(),this.pageNumberText=Aa(this,`1 / ${this.numPages()}`,Rr.pageNumberTextConfig,Pr);const e=Math.min(zo.getInstance().getSaveManager().getLargestCompletedChapterNum()+1,this.getGameChapters().length-1);this.targetPage=Math.floor(e/Rr.grid.chapPerPage),this.targetPage<0&&(this.targetPage=0),this.pageNumberText.setText(`${this.targetPage+1} / ${this.numPages()}`);const t=new Phaser.GameObjects.Image(this,Oa.x,Oa.y,Va.chapterSelectBorder.key),s=Cn(this,{assetKey:Va.chapterSelectArrow.key,onUp:()=>this.scrollPrevPage()}).setPosition(Oa.x-Rr.arrow.xOffset,Oa.y),a=Cn(this,{assetKey:Va.chapterSelectArrow.key,onUp:()=>this.scrollNextPage()}).setPosition(Oa.x+Rr.arrow.xOffset,Oa.y).setScale(-1,1);this.getLayerManager().addToLayer(qa.UI,this.chaptersContainer),this.getLayerManager().addToLayer(qa.UI,this.backButtonContainer),this.getLayerManager().addToLayer(qa.UI,this.pageNumberText),this.getLayerManager().addToLayer(qa.UI,t),this.getLayerManager().addToLayer(qa.UI,s),this.getLayerManager().addToLayer(qa.UI,a)}createChaptersContainer(){const e=new Phaser.GameObjects.Container(this,0,0);return e.add(this.getGameChapters().map(((e,t)=>mo(this,e,t)))).sort("depth").reverse(),e}numPages(){const e=Math.ceil(this.getGameChapters().length/Rr.grid.chapPerPage);return Math.max(e,1)}scrollPrevPage(){var e;this.targetPage=Math.max(this.targetPage-1,0),null===(e=this.pageNumberText)||void 0===e||e.setText(`${this.targetPage+1} / ${this.numPages()}`)}scrollNextPage(){var e;const t=this.numPages();this.targetPage=Math.min(this.targetPage+1,t-1),null===(e=this.pageNumberText)||void 0===e||e.setText(`${this.targetPage+1} / ${t}`)}}var jo=bo;const yo={key:ba.alienCowsFont.key,size:80,align:Phaser.GameObjects.BitmapText.ALIGN_CENTER},Oo=1500;var fo={text:{chapter:"Chapter completed.",checkpoint:"Checkpoint reached."},transitionTextConfig:{x:Oa.x,y:Oa.y,oriX:.5,oriY:.5},tweenDuration:Oo,entryTween:{alpha:1,duration:Oo,ease:"Power2"},exitTween:{alpha:0,duration:Oo,ease:"Power2"}};class vo extends Phaser.Scene{constructor(){super("CheckpointTransition")}preload(){zo.getInstance().setCurrentSceneRef(this)}async create(){if(zo.getInstance().isGameType(qo.Simulator))return await this.showTransitionText(fo.text.checkpoint),void await go();const e=zo.getInstance().getSaveManager().getFullSaveState(),t=zo.getInstance().getGameChapters(),[s,a]=e.userSaveState.recentlyPlayedCheckpoint;return this.isLastCheckpoint(t,s,a)?(await zo.getInstance().getSaveManager().saveChapterComplete(s),await this.showTransitionText(fo.text.chapter),this.isLastChapter(t,s)?void this.scene.start("ChapterSelect"):void await po(!0,s+1,0)):(await this.showTransitionText(fo.text.checkpoint),void await po(!1,s,a+1))}async showTransitionText(e){const t=Aa(this,e,fo.transitionTextConfig,yo).setAlpha(0);this.add.existing(t),this.tweens.add({targets:t,...fo.entryTween}),await Ka(2*fo.tweenDuration),this.tweens.add({targets:t,...fo.exitTween}),await Ka(fo.tweenDuration)}isLastCheckpoint(e,t,s){return s>=e[t].filenames.length-1}isLastChapter(e,t){return t>=e.length-1}}var xo=vo;const Co={key:ba.zektonFont.key,size:30,align:Phaser.GameObjects.BitmapText.ALIGN_RIGHT};var So={text:{chapterSelect:"Play Chapter",studentRoom:"Go to My Room",awards:"Awards Hall",settings:"Settings",bindings:"Key Bindings"},button:{ySpace:.5*ya.y},buttonTextConfig:{x:600,y:0,oriX:1,oriY:.1},banner:{xHide:300},onFocusTween:{x:Oa.x+200,duration:200,ease:"Power2"},outFocusTween:{x:Oa.x+300,duration:200,ease:"Power2"},saBanner:{x:.3*ya.x,y:.9*ya.y}};class wo extends Phaser.Scene{constructor(){super("MainMenu"),this.layerManager=void 0,this.getLayerManager=()=>Za(this.layerManager)}async create(){zo.getInstance().setCurrentSceneRef(this),this.layerManager=new xi(this),this.renderBackground(),this.renderOptionButtons(),gr(this,"T",1.12*Oa.x,1.1*Oa.y),zo.getInstance().getSoundManager().playBgMusic($a.galacticHarmony.key)}renderBackground(){const e=new Phaser.GameObjects.Image(this,Oa.x,Oa.y,Va.spaceshipBg.key).setDisplaySize(ya.x,ya.y),t=rn(this).setAlpha(.15),s=new Phaser.GameObjects.Image(this,So.saBanner.x,So.saBanner.y,Va.saBanner.key).setAlpha(.7);this.getLayerManager().addToLayer(qa.Background,e),this.getLayerManager().addToLayer(qa.Background,t),this.getLayerManager().addToLayer(qa.Background,s)}renderOptionButtons(){const e=new Phaser.GameObjects.Container(this,0,0),t=this.getOptionButtons(),s=Ca({direction:xa.Column,numOfItems:t.length,maxYSpace:So.button.ySpace});e.add(t.map(((e,t)=>this.createOptionButton(e.text,s[t][0]+So.banner.xHide,s[t][1],e.callback)))),this.getLayerManager().addToLayer(qa.UI,e)}createOptionButton(e,t,s,a){const n=e=>{this.tweens.add({targets:e,...So.onFocusTween})},i=e=>{this.tweens.add({targets:e,...So.outFocusTween})},r=Cn(this,{assetKey:Va.mainMenuOptBanner.key,message:e,textConfig:So.buttonTextConfig,bitMapTextStyle:Co,onUp:a,onHover:()=>n(r),onOut:()=>i(r),onHoverEffect:!1}).setPosition(t,s);return r}getOptionButtons(){return[{text:So.text.chapterSelect,callback:()=>{this.getLayerManager().clearAllLayers(),this.scene.start("ChapterSelect")}},{text:So.text.awards,callback:()=>{this.getLayerManager().clearAllLayers(),this.scene.start("AwardsHall")}},{text:So.text.studentRoom,callback:()=>{this.getLayerManager().clearAllLayers(),this.scene.start("RoomPreview")}},{text:So.text.settings,callback:()=>{this.getLayerManager().clearAllLayers(),this.scene.start("Settings")}},{text:So.text.bindings,callback:()=>{this.getLayerManager().clearAllLayers(),this.scene.start("Bindings")}}]}}var Eo=wo,To=s(88),ko=s(101);const Ao='\nimport { prepend_remote_url, get_screen_width, get_screen_height, load_image, create_image, create_text, create_rect, add, set_display_size, set_alpha, set_origin } from \'game\';\n\nfunction preload() {\n    load_image("galaxy", prepend_remote_url("/locations/galaxy/normal.png"));\n}\n\nfunction create() {\n    const width = get_screen_width();\n    const height = get_screen_height();\n    const centre_x = width / 2;\n    const centre_y = height / 2;\n\n    const image = create_image(centre_x, centre_y, "galaxy");\n    const image_resized = set_display_size(image, width, height);\n\n    const black_tint = create_rect(centre_x, centre_y, width, height, 0x000011);\n    const black_tint_alpha = set_alpha(black_tint, 0.5);\n\n    const text = create_text(centre_x, centre_y, "Unable to fetch mission!");\n    const text_repos = set_origin(text, 0.5, 0.5);\n\n    add(image_resized);\n    add(black_tint_alpha);\n    add(text_repos);\n}\n\nfunction update() {}\n',Io={key:ba.pixelFont.key,size:20,align:Phaser.GameObjects.BitmapText.ALIGN_CENTER},No={assessmentNumber:"MYROOM",verifiedText:"VERIFIED",tag:{width:128,height:50},hoverTagTextConfig:{x:64,y:0,oriX:.5,oriY:.55},refreshButton:{x:.95*ya.x,y:.92*ya.y}};var Mo=s(30);async function Po(){const e=await async function(){const e=(await Object(Mo.k)(zo.getInstance().getAccountInfo())||[]).find((e=>e.number===No.assessmentNumber));return e?e.id:null}();if(!e)return Ro(null);return Ro(await Object(Mo.i)(e,zo.getInstance().getAccountInfo()))}function Ro(e){if(e){const t=e.questions[0],s=t.answer;return s||t.solutionTemplate}return Ao}class _o extends Phaser.Scene{constructor(){super("RoomPreview"),this.layerManager=void 0,this.inputManager=void 0,this.phaseManager=void 0,this.escapeManager=void 0,this.collectibleManager=void 0,this.achievementManager=void 0,this.toolbarManager=void 0,this.dashboardManager=void 0,this.studentCode=void 0,this.preloadImageMap=void 0,this.preloadSoundMap=void 0,this.preloadSpritesheetMap=void 0,this.verifCont=void 0,this.context=void 0,this.getVerifCont=()=>Za(this.verifCont),this.getUserStateManager=()=>zo.getInstance().getUserStateManager(),this.getInputManager=()=>Za(this.inputManager),this.getLayerManager=()=>Za(this.layerManager),this.getPhaseManager=()=>Za(this.phaseManager),this.getEscapeManager=()=>Za(this.escapeManager),this.getCollectibleManager=()=>Za(this.collectibleManager),this.getAchievementManager=()=>Za(this.achievementManager),this.getToolbarManager=()=>Za(this.toolbarManager),this.getDashboardManager=()=>Za(this.dashboardManager),this.preloadImageMap=new Map,this.preloadSoundMap=new Map,this.preloadSpritesheetMap=new Map,this.studentCode=Ao}init(){zo.getInstance().setCurrentSceneRef(this),this.studentCode=zo.getInstance().getRoomCode(),this.createContext()}preload(){li(this),this.verifCont=(e=>{const t=new Phaser.GameObjects.Container(e,0,0),s=new Phaser.GameObjects.Rectangle(e,0,0,No.tag.width,No.tag.height,va.darkBlue).setOrigin(0,.5).setAlpha(.8),a=new Phaser.GameObjects.Sprite(e,0,0,Va.verifiedFrame.key).setOrigin(0,.5),n=new Phaser.GameObjects.Rectangle(e,0,.5*-s.height,s.width,.05*s.height,va.offWhite).setOrigin(0,0),i=Aa(e,No.verifiedText,No.hoverTagTextConfig,Io).setBlendMode(Phaser.BlendModes.DIFFERENCE);return e.tweens.add({targets:n,alpha:.2,y:.35*s.height,duration:2e3,ease:"Power0",yoyo:!0,loop:-1}),t.add([s,i,n,a]),t.setVisible(!1),t})(this)}async create(){await this.eval(this.studentCode),this.renderDefaultBackground(),await this.eval("preload();"),await Promise.all(Array.from(this.preloadImageMap).map((async e=>{let[t,s]=e;await Ar(this,t,s)}))),await Promise.all(Array.from(this.preloadSoundMap).map((async e=>{let[t,s]=e;var a,n,i;await(a=this,n=t,i=s,new Promise((e=>{null!==a.sound.get(n)?e(n):(a.load.audio(n,i).on("filecomplete",e),a.load.start())})))}))),await Promise.all(Array.from(this.preloadSpritesheetMap).map((async e=>{let[t,[s,a]]=e;await((e,t,s,a)=>new Promise((n=>{"__MISSING"!==e.textures.get(t).key?n(t):(e.load.spritesheet(t,s,a),e.load.once(`filecomplete-spritesheet-${t}`,n),e.load.once("loaderror",n),e.load.start())})))(this,t,s,a)})));const e=new ka(this,No.refreshButton.x-200,No.refreshButton.y-30,"Refresh Room"),t=Cn(this,{assetKey:Va.chapterRepeatButton.key,onUp:async()=>{await zo.getInstance().loadRoomCode(),this.studentCode=zo.getInstance().getRoomCode(),this.getLayerManager().clearAllLayers(),this.sound.stopAll(),this.scene.restart()},onHover:()=>e.setVisible(!0),onOut:()=>e.setVisible(!1)}).setPosition(No.refreshButton.x,No.refreshButton.y);await this.eval("create();"),zo.getInstance().getSoundManager().playBgMusic(ja.nullInteractionId),this.initialiseManagers(),this.bindKeyboardTriggers(),this.getLayerManager().addToLayer(qa.UI,this.getVerifCont()),this.getLayerManager().addToLayer(qa.UI,t),this.getLayerManager().addToLayer(qa.UI,e),this.getToolbarManager().renderToolbarContainer()}update(){this.eval("update();")}createContext(){this.context=Object(ko.a)([],"playground",M.Variant.DEFAULT),this.context.moduleContexts.game={tabs:null,state:{scene:this,preloadImageMap:this.preloadImageMap,preloadSoundMap:this.preloadSoundMap,preloadSpritesheetMap:this.preloadSpritesheetMap,remotePath:e=>Ja(e,!0),screenSize:ya,createAward:(e,t,s)=>this.createAward(e,t,s)}}}async eval(e){await Object(To.runInContext)(e,this.context)}bindKeyboardTriggers(){this.getInputManager().registerKeyboardListener(Phaser.Input.Keyboard.KeyCodes.ESC,"up",(async()=>{this.getPhaseManager().isCurrentPhaseTerminal()?await this.getPhaseManager().popPhase():await this.getPhaseManager().pushPhase(kn.EscapeMenu)})),this.getInputManager().registerKeyboardListener(Phaser.Input.Keyboard.KeyCodes.TAB,"up",(async()=>{this.getPhaseManager().isCurrentPhase(kn.Dashboard)?await this.getPhaseManager().popPhase():this.getPhaseManager().isCurrentPhaseTerminal()?await this.getPhaseManager().swapPhase(kn.Dashboard):await this.getPhaseManager().pushPhase(kn.Dashboard)}))}cleanUp(){this.getInputManager().clearListeners(),this.getLayerManager().clearAllLayers()}createAward(e,t,s){const a=this.getUserStateManager().getAchievements(),n=this.getUserStateManager().getCollectibles(),i=new Phaser.GameObjects.Sprite(this,e,t,Va.cookies.key);if(!a.includes(s)&&!n.includes(s))return i;const r=Ga(s);if(!r.completed)return i;const o=new Phaser.GameObjects.Sprite(this,e,t,r.assetKey);return this.attachVerificationTag(o)}attachVerificationTag(e){const t=this.getVerifCont();return e.setInteractive({pixelPerfect:!0,useHandCursor:!0}),e.addListener(Phaser.Input.Events.GAMEOBJECT_POINTER_OVER,(()=>t.setVisible(!0))),e.addListener(Phaser.Input.Events.GAMEOBJECT_POINTER_OUT,(()=>t.setVisible(!1))),e.addListener(Phaser.Input.Events.GAMEOBJECT_POINTER_MOVE,(e=>{t.x=e.x+10,t.y=e.y-10})),e}renderDefaultBackground(){const e=new Phaser.GameObjects.Image(this,Oa.x,Oa.y,this.getDefaultBackgroundKey());Fn(e,ya.x,ya.y),this.add.existing(e)}getDefaultBackgroundKey(){const e=this.getUserStateManager().getAssessments().reverse(),t=zo.getInstance().getRoomPreviewMapping();for(let s=0;s<e.length;s++)if(t.has(e[s]))return e[s];return Va.sourceCrashedPod.key}initialiseManagers(){this.layerManager=new xi(this),this.inputManager=new vi(this),this.phaseManager=new Ai(new Map([[kn.None,new sr]]),this.inputManager),this.escapeManager=new fi(this),this.collectibleManager=new Vn(this,zo.getInstance().getUserStateManager().getCollectibles),this.achievementManager=new Vn(this,zo.getInstance().getUserStateManager().getAchievements),this.toolbarManager=new Fi(this),this.dashboardManager=new Qn(this,[Kn.Collectibles,Kn.Achievements],[this.collectibleManager,this.achievementManager])}}class Lo extends Phaser.Scene{constructor(){super("Settings"),this.bgmVolumeRadioButtons=void 0,this.sfxVolumeRadioButtons=void 0,this.layerManager=void 0,this.getSaveManager=()=>zo.getInstance().getSaveManager(),this.getLayerManager=()=>Za(this.layerManager)}async create(){zo.getInstance().setCurrentSceneRef(this),this.layerManager=new xi(this),this.renderBackground(),this.renderOptions()}renderBackground(){const e=new Phaser.GameObjects.Image(this,Oa.x,Oa.y,Va.spaceshipBg.key),t=new Phaser.GameObjects.Image(this,Oa.x,Oa.y,Va.settingBanner.key);this.getLayerManager().addToLayer(qa.Background,e),this.getLayerManager().addToLayer(qa.Background,t)}renderOptions(){const e=new Phaser.GameObjects.Container(this,0,0),t=this.getSettingsHeader(),s=Ca({direction:xa.Column,numOfItems:t.length,maxYSpace:mi.opt.ySpace});e.add(t.map(((e,t)=>this.createOptionHeader(e,s[t][1]))));const{bgmVolume:a,sfxVolume:n}=this.getSaveManager().getSettings(),i=mi.volContainerOpts.findIndex((e=>parseFloat(e)===n)),r=mi.volContainerOpts.findIndex((e=>parseFloat(e)===a));this.sfxVolumeRadioButtons=this.createOptRadioOptions(i,s[0][1]),this.bgmVolumeRadioButtons=this.createOptRadioOptions(r,s[1][1]);const o=Cn(this,{assetKey:Va.mediumButton.key,message:"Apply Settings",textConfig:{x:0,y:0,oriX:.33,oriY:.85},bitMapTextStyle:gi,onUp:()=>this.applySettings()}).setPosition(Oa.x,.925*ya.y),c=new Xi(this,(()=>{this.getLayerManager().clearAllLayers(),this.scene.start("MainMenu")}));this.getLayerManager().addToLayer(qa.UI,e),this.getLayerManager().addToLayer(qa.UI,this.sfxVolumeRadioButtons),this.getLayerManager().addToLayer(qa.UI,this.bgmVolumeRadioButtons),this.getLayerManager().addToLayer(qa.UI,o),this.getLayerManager().addToLayer(qa.UI,c)}getSettingsHeader(){return["SFX","BGM"]}createOptionHeader(e,t){const s=new Phaser.GameObjects.Container(this,0,t),a=new Phaser.GameObjects.Image(this,Oa.x,0,Va.settingOption.key),n=Aa(this,e,mi.optHeaderTextConfig,pi);return s.add([a,n]),s}createOptRadioOptions(e,t){return new ui(this,{choices:mi.volContainerOpts,defaultChoiceIdx:e,maxXSpace:mi.opt.xSpace,choiceTextConfig:mi.radioButtonsTextConfig,bitmapTextStyle:hi},mi.opt.x,-Oa.y+t)}async applySettings(){const e=this.sfxVolumeRadioButtons?parseFloat(this.sfxVolumeRadioButtons.getChosenChoice()):1,t=this.bgmVolumeRadioButtons?parseFloat(this.bgmVolumeRadioButtons.getChosenChoice()):1;await this.getSaveManager().saveSettings({bgmVolume:t,sfxVolume:e}),zo.getInstance().getSoundManager().applyUserSettings(this.getSaveManager().getSettings())}}var Do=Lo;var Bo=class{constructor(){this.soundAssetMap=void 0,this.bgmVol=void 0,this.sfxVol=void 0,this.currBgMusicKey=void 0,this.currBgMusic=void 0,this.getBaseSoundManager=()=>this.getCurrentScene().sound,this.getCurrentScene=()=>Za(zo.getInstance().getCurrentSceneRef()),this.soundAssetMap=new Map,this.bgmVol=1,this.sfxVol=1,this.currBgMusicKey=ja.nullInteractionId}applyUserSettings(e){if(this.bgmVol=void 0!==e.bgmVolume?e.bgmVolume:1,this.sfxVol=void 0!==e.sfxVolume?e.sfxVolume:1,this.currBgMusic&&this.currBgMusic.isPlaying){const e=Za(this.getSoundAsset(this.currBgMusicKey)),t=void 0!==e.config.volume?e.config.volume:1;this.currBgMusic.setVolume(t*this.bgmVol)}}addSoundAsset(e){this.soundAssetMap.set(e.key,e)}getSoundAsset(e){return this.soundAssetMap.get(e)}loadSounds(e){e.forEach((e=>{this.addSoundAsset(e),this.loadSound(e.key,Ja(e.path,!0))}))}loadSoundAssetMap(e){Object.values(e).forEach((e=>{this.addSoundAsset(e),this.loadSound(e.key,Ja(e.path,!1))}))}loadSound(e,t){this.getCurrentScene().load.audio(e,t)}playSound(e){const t=this.getSoundAsset(e);if(t){const e=void 0!==t.config.volume?t.config.volume:1;this.getBaseSoundManager().play(t.key,{...t.config,volume:e*this.sfxVol})}}playBgMusic(e,t){if(!zo.getInstance().isMounted)return;if(this.currBgMusicKey===e)return;if(e===ja.nullInteractionId&&this.currBgMusic)return this.fadeOutAndDestroyMusic(this.currBgMusic,t),this.currBgMusic=void 0,void(this.currBgMusicKey=e);this.currBgMusic&&this.fadeOutAndDestroyMusic(this.currBgMusic);const s=Za(this.getSoundAsset(e)),a=void 0!==s.config.volume?s.config.volume:1;this.currBgMusic=this.getBaseSoundManager().add(s.key,{...s.config,volume:a*this.bgmVol}),this.currBgMusicKey=s.key,this.currBgMusic.play()}fadeOutAndDestroyMusic(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1e3;this.getCurrentScene().tweens.add({targets:e,...Wa,duration:t}),setTimeout((()=>e.destroy()),2*t)}stopAllSound(){this.getBaseSoundManager().stopAll()}pauseCurrBgMusic(){this.getCurrentScene()&&this.currBgMusic&&this.currBgMusic.isPlaying&&this.currBgMusic.pause()}continueCurrBgMusic(){this.getCurrentScene()&&this.currBgMusic&&this.currBgMusic.isPaused&&this.currBgMusic.play()}};var Uo=[{title:"Spaceship Emergency",imageUrl:"/locations/planet-y-orbit/crashing.png",filenames:["../../assets/mockChapter0.txt","../../assets/mockChapter0.1.txt"]},{title:"Alien Attack",imageUrl:"/locations/telebay/emergency.png",filenames:["../../assets/mockChapter1.txt"]},{title:"Jedi Master",imageUrl:"/locations/classroom/normal.png",filenames:["../../assets/mockChapter2.txt"]}];class Go{static parse(e){Go.awardsMapping=new Map;const t=ti.splitToLines(e);return ti.splitToParagraph(t).forEach((e=>{let[,t]=e;Go.parseAwardParagraphs(t)})),this.awardsMapping}static parseAwardParagraphs(e){ti.splitToParagraph(e).forEach((e=>{let[t,s]=e;const[a,n,i,r]=ti.splitWithLimit(s[0],",",3);Go.awardsMapping.set(t,{id:t,assetKey:a,assetPath:Ja(n,!0),title:i,description:r,completed:!0})}))}}Go.awardsMapping=void 0;var Fo=Go;class Ho{static parse(e){Ho.backgroundMapping=new Map;const t=ti.splitToLines(e);return ti.splitToParagraph(t).forEach((e=>{let[t,s]=e;Ho.backgroundMapping.set(t,Ja(s[0],!0))})),Ho.backgroundMapping}}Ho.backgroundMapping=void 0;var Vo=Ho;class Wo extends Phaser.Scene{constructor(){super("Entry")}async preload(){zo.getInstance().setCurrentSceneRef(this),this.preloadAssets(),li(this),await zo.getInstance().loadGameChapters(),await zo.getInstance().loadRoomCode(),await zo.getInstance().getSaveManager().loadLastSaveState()}async create(){await this.preloadAwards(),await zo.getInstance().getUserStateManager().loadUserState(),await this.preloadRoomPreviewBackgrounds(),this.applyLoadedSettings(),this.scene.start("MainMenu")}applyLoadedSettings(){const e=zo.getInstance().getSaveManager().getSettings();zo.getInstance().getSoundManager().applyUserSettings(e)}async preloadAwards(){const e=this.cache.text.get(Br.awardsMapping.key)||"",t=Fo.parse(e);zo.getInstance().setAwardsMapping(t),await Promise.all(Array.from(t.values()).map((async e=>await Ar(this,e.assetKey,e.assetPath))))}async preloadRoomPreviewBackgrounds(){const e=this.cache.text.get(Br.roomPreviewMapping.key)||"",t=Vo.parse(e);zo.getInstance().setRoomPreviewMapping(t),await Promise.all(Array.from(t.entries()).map((async e=>{let[t,s]=e;return await Ar(this,t,s)})))}preloadAssets(){zo.getInstance().getSoundManager().loadSoundAssetMap($a),Object.values(Va).forEach((e=>this.load.image(e.key,Ja(e.path,!1)))),Object.values(ba).forEach((e=>this.load.bitmapFont(e.key,e.pngPath,e.fntPath))),Object.values(Br).forEach((e=>this.load.text(e.key,e.path)))}}var Xo=Wo;class $o{constructor(){this.collectibles=void 0,this.achievements=void 0,this.assessments=void 0,this.getCollectibles=()=>Array.from(this.collectibles),this.getAchievements=()=>Array.from(this.achievements),this.getAssessments=()=>Array.from(this.assessments),this.collectibles=new Set([]),this.achievements=new Set([]),this.assessments=new Set([])}async loadUserState(){zo.getInstance().isGameType(qo.Simulator)||(await this.loadAchievements(),await this.loadAssessments(),this.collectibles=new Set(zo.getInstance().getSaveManager().getLoadedUserState().collectibles))}addCollectible(e){this.collectibles.add(e)}async loadAssessments(){const e=await Object(Mo.k)(zo.getInstance().getAccountInfo());this.assessments=new Set((e||[]).filter((e=>"submitted"===e.status)).sort(((e,t)=>e.closeAt<=t.closeAt?-1:1)).map((e=>e.id.toString())))}async isInUserState(e,t){if(zo.getInstance().isGameType(qo.Game))return this[e].has(t);return 0===await Tn(Nn.getInstance().getGameManager(),`${ti.capitalize(e)} ${t}?`,["Yes","No"])}async loadAchievements(){const e=zo.getInstance().getAwardsMapping(),t=zo.getInstance().getAchievements(),s=zo.getInstance().getGoals(),a=new Map;s.forEach((e=>a.set(e.uuid,e))),t.forEach((t=>{const s=t.uuid.toString(),n=t.goalUuids.reduce(((e,t)=>{var s;return e&&!(null===(s=a.get(t))||void 0===s||!s.completed)}),!0),i=e.get(s);if(i){const e={...i,completed:n};zo.getInstance().addAwardMapping(e.assetKey,e),this.achievements.add(e.assetKey)}}))}}let qo;!function(e){e.Simulator="Simulator",e.Game="Game"}(qo||(qo={}));class zo extends ma.Game{constructor(e,t){super(e),this.global=void 0,this.isMounted=void 0,this.getAwardsMapping=()=>Za(this.global.awardsMapping),this.getAccountInfo=()=>Za(this.global.accountInfo),this.getAchievements=()=>Za(this.global.achievements),this.getSoundManager=()=>Za(this.global.soundManager),this.getGoals=()=>Za(this.global.goals),this.getRoomPreviewMapping=()=>Za(this.global.roomPreviewMapping),this.getUserStateManager=()=>Za(this.global.userStateManager),this.getSaveManager=()=>Za(this.global.saveManager),this.getCurrentSceneRef=()=>Za(this.global.currentSceneRef),this.isGameType=e=>this.global.gameType===e,this.getSSChapterSimFilenames=()=>this.global.ssChapterSimFilenames,this.getIsUsingMock=()=>this.global.isUsingMock,this.getRoomCode=()=>this.global.roomCode,this.getGameChapters=()=>this.global.isUsingMock?Uo:this.global.gameChapters,zo.instance=this,this.isMounted=!0,this.global={awardsMapping:new Map,accountInfo:void 0,achievements:void 0,currentSceneRef:void 0,gameChapters:[],gameType:t,goals:void 0,isUsingMock:!1,roomCode:"",roomPreviewMapping:new Map,saveManager:new cr,setStorySimState:ja.nullFunction,soundManager:new Bo,ssChapterSimFilenames:[],userStateManager:new $o}}stopAllSounds(){this.sound.stopAll()}setAccountInfo(e){this.global.accountInfo=e}setAchievements(e){this.global.achievements=e}setAwardsMapping(e){this.global.awardsMapping=e}addAwardMapping(e,t){this.global.awardsMapping.set(e,t)}setGoals(e){this.global.goals=e}setStorySimStateSetter(e){this.setStorySimState=e}setRoomPreviewMapping(e){this.global.roomPreviewMapping=e}async loadGameChapters(){this.global.gameChapters=await async function(){const e=Ya.a.getState().session.courseId,t=await Object(Mo.U)(`courses/${e}/stories`,"GET",{accessToken:zo.getInstance().getAccountInfo().accessToken,refreshToken:zo.getInstance().getAccountInfo().refreshToken,shouldAutoLogout:!1,shouldRefresh:!0});if(!t)return[];const s=200===t.status?await t.json():[],a=k.a.sortBy(s,(e=>new Date(e.openAt)));return a.forEach((e=>e.filenames=e.filenames.map(_r))),a}()}async loadRoomCode(){this.global.roomCode=await Po()}setStorySimState(e){this.global.setStorySimState(e)}setCurrentSceneRef(e){this.global.currentSceneRef=e}toggleUsingMock(e){this.global.isUsingMock=void 0===e?!this.global.isUsingMock:e}setChapterSimStack(e){this.global.ssChapterSimFilenames=e.reverse()}}zo.instance=void 0,zo.getInstance=()=>Za(zo.instance);const Yo={debug:!0,type:ma.CANVAS,width:ya.x,height:ya.y,physics:{default:"arcade"},scale:{mode:ma.Scale.FIT,parent:"game-display"},fps:{target:24},scene:[Xo,Eo,Do,jo,or,xo,Cr,_o,kr]};async function Ko(e){if("student"!==zo.getInstance().getAccountInfo().role)return;const t={method:"PUT",headers:Qo(zo.getInstance().getAccountInfo().accessToken),body:JSON.stringify({gameStates:e})},s=await fetch(`${Se.b.backendUrl}/v2/courses/${en()}/user/game_states`,t);return s&&s.ok?s:void 0}function Qo(e){const t=new Headers;return t.append("Accept","application/json"),t.append("Authorization",`Bearer ${e}`),t.append("Content-Type","application/json"),t}var Jo=function(){const e=Object(v.f)((e=>e.session)),t=Object(r.c)(),s=Object(v.f)((e=>e.achievement.achievements)),a=Object(v.f)((e=>e.achievement.goals)),[n,i]=j.useState(!1),[o,c]=j.useState(!1);return j.useEffect((()=>{t(Object(Je.getAchievements)()),t(Object(Je.getOwnGoals)())}),[t]),j.useEffect((()=>{const e=new zo(Yo,qo.Game);return()=>{e.isMounted=!1,e.stopAllSounds(),e.destroy(!0)}}),[]),j.useEffect((()=>{zo.getInstance().setAccountInfo({accessToken:e.accessToken,refreshToken:e.refreshToken,role:e.role,name:e.name}),zo.getInstance().setAchievements(s),zo.getInstance().setGoals(a)}),[e,s,a]),Object(se.jsxs)(se.Fragment,{children:[Object(se.jsx)("div",{id:"game-display"}),n&&Object(se.jsxs)("div",{className:"Horizontal",children:[Object(se.jsx)("button",{onClick:async()=>{await Ko({}),alert("Game cleared! Please refresh")},children:"Clear data"}),Object(se.jsx)("button",{onClick:()=>{c(!o),zo.getInstance().toggleUsingMock()},children:o?"Use Game Chapters":"Use Mock Chapters"})]})]})},Zo=s(382);function ec(e){return t=>Object(se.jsx)(h.a,{onClick:s=>{try{e.onClick&&e.onClick(s)}catch(a){throw s.preventDefault(),a}s.defaultPrevented||0!==s.button||e.target&&"_self"!==e.target||s.metaKey||s.altKey||s.ctrlKey||s.shiftKey||(s.preventDefault(),t.navigate())},href:t.href,...e})}function tc(e){let{to:t,replace:s,...a}=e;return Object(se.jsx)(A.a,{to:t,replace:s,component:ec(a)})}var sc=e=>{const t=e.courseRegId&&e.courseRegId===e.data.studentId,s=t||"submitted"===e.data.submissionStatus,a="submitted"===e.data.submissionStatus&&e.courseRegId&&(e.courseRegId===e.data.groupLeaderId||t||e.role===x.a.Admin);return Object(se.jsxs)(se.Fragment,{children:[Object(se.jsx)(tc,{to:`/courses/${e.courseId}/grading/${e.data.submissionId}`,icon:"annotation",minimal:!0,title:"Grade"}),Object(se.jsx)(h.b,{icon:"refresh",minimal:!0,onClick:async()=>{await Object(at.b)({contents:Object(se.jsxs)(se.Fragment,{children:[Object(se.jsx)("p",{children:"Reautograde this submission?"}),Object(se.jsx)("p",{children:"Note: all manual adjustments will be reset to 0."})]}),positiveIntent:"danger",positiveLabel:"Reautograde"})&&e.handleReautogradeSubmission(e.data.submissionId)},disabled:!s,title:"Reautograde"}),Object(se.jsx)(h.b,{icon:"arrow-left",minimal:!0,onClick:async()=>{await Object(at.b)({contents:"Are you sure you want to unsubmit?",positiveIntent:"danger",positiveLabel:"Unsubmit"})&&e.handleUnsubmitSubmission(e.data.submissionId)},disabled:!a,title:"Unsubmit"})]})};var ac=e=>{let t,s,a;switch(e.data.gradingStatus){case H.c.graded:t=w.a.TICK,s=`Fully graded: ${e.data.gradedCount} of\n          ${e.data.questionCount}`,a=g.a.SUCCESS;break;case H.c.grading:t=w.a.TIME,s=`Partially graded: ${e.data.gradedCount} of\n          ${e.data.questionCount}`,a=g.a.WARNING;break;case H.c.none:t=w.a.CROSS,s=`Not graded: ${e.data.gradedCount} of\n          ${e.data.questionCount}`,a=g.a.DANGER;break;default:t=w.a.DISABLE,s="Not applicable",a=g.a.PRIMARY}return Object(se.jsx)("div",{children:Object(se.jsx)(E.a,{content:s,placement:S.a.LEFT,hoverOpenDelay:10,lazy:!0,children:Object(se.jsx)(h.w,{icon:t,intent:a})})})},nc=s(370),ic=s.n(nc);const rc="grading-editor-button",oc={header:[w.a.HEADER,"Header Styles"],bold:[w.a.BOLD,"Bold"],italic:[w.a.ITALIC,"Italic"],strikethrough:[w.a.STRIKETHROUGH,"Strikethrough"],link:[w.a.LINK,"Link"],quote:[w.a.CITATION,"Quote"],code:[w.a.CODE,"Monospaced"],image:[w.a.MEDIA,"Image"],"unordered-list":[w.a.UNGROUP_OBJECTS,"Bullets"],"ordered-list":[w.a.NUMBERED_LIST,"Numbering"],"checked-list":[w.a.SQUARE,"Checkboxes"]},cc=e=>{switch(e){case"header":case"bold":case"italic":case"strikethrough":case"link":case"quote":case"code":case"image":case"unordered-list":case"ordered-list":case"checked-list":const[t,s]=oc[e];return{iconName:t,title:s};default:return{iconName:w.a.HELP}}};var lc=e=>{const[t,s]=Object(j.useState)(e.xpAdjustment.toString()),[a,n]=Object(j.useState)(e.comments),[i,r]=Object(j.useState)("write"),[c,l]=Object(j.useState)(!1);Object(j.useEffect)((()=>{d()}),[e.submissionId,e.questionId]);const d=()=>{s(e.xpAdjustment.toString()),n(e.comments),r("write"),l(!1)};const u=s=>()=>{const n=Object(Ee.b)(t||void 0)||void 0,i=e.initialXp+(n||0);i<0||i>e.maxXp?Object(me.e)(`XP ${i.toString()} is out of bounds. Maximum xp is ${e.maxXp.toString()}.`):s(e.submissionId,e.questionId,n,a)},p=()=>{const s=Object(Ee.b)(t||void 0);return e.xpAdjustment!==s||e.comments!==a},m=p(),b={intent:m?g.a.WARNING:g.a.NONE,minimal:!m,className:rc},y={intent:m?g.a.DANGER:g.a.NONE,minimal:!m,className:rc},O={intent:m?g.a.SUCCESS:g.a.NONE,minimal:!m,className:rc},f=e.initialXp+(Object(Ee.b)(t||void 0)||0),v=`${e.initialXp>0?"-":""}${e.initialXp} to ${e.maxXp-e.initialXp}`;return Object(se.jsxs)("div",{className:"GradingEditor",children:[!c&&m?Object(se.jsx)(o.a,{message:"You have unsaved changes. Are you sure you want to leave?"}):null,Object(se.jsx)("div",{className:"grading-editor-header",children:Object(se.jsxs)(h.q,{children:["Currently Grading: ",e.studentName]})}),null!==e.solution?Object(se.jsx)("div",{className:"grading-editor-marking-scheme",children:Object(se.jsxs)(h.M,{children:[e.solution.toString()," "]})}):null,Object(se.jsx)("div",{className:"grading-editor-container",children:Object(se.jsxs)("div",{className:"grading-editor-xp",children:[Object(se.jsxs)("div",{className:"autograder-xp",children:[Object(se.jsx)("div",{children:"Autograder XP:"}),Object(se.jsxs)("div",{children:[`${e.initialXp} / ${e.maxXp}`," ",Object(se.jsx)(h.b,{icon:"refresh",small:!0,minimal:!0,onClick:async()=>{await Object(at.b)({contents:Object(se.jsxs)(se.Fragment,{children:[Object(se.jsx)("p",{children:"Reautograde this answer?"}),Object(se.jsx)("p",{children:"Note: manual adjustments will be reset to 0."})]}),positiveLabel:"Reautograde",positiveIntent:"danger"})&&e.handleReautogradeAnswer(e.submissionId,e.questionId)}})]})]}),Object(se.jsxs)("div",{className:"xp-adjustment",children:[Object(se.jsx)("div",{children:"XP adjustment:"}),Object(se.jsx)("div",{children:Object(se.jsx)(h.H,{className:"adjustment-input",onValueChange:(e,t)=>{s(t)},value:t||"",buttonPosition:S.a.RIGHT,fill:!0,placeholder:v,intent:f<0||f>e.maxXp?g.a.DANGER:g.a.NONE,min:0-e.initialXp,max:e.maxXp>e.initialXp?e.maxXp-e.initialXp:void 0,stepSize:50,minorStepSize:25,majorStepSize:100})})]}),Object(se.jsxs)("div",{className:"final-xp",children:[Object(se.jsx)("div",{children:"Final XP:"}),Object(se.jsx)("div",{children:`${f} / ${e.maxXp}`})]})]})}),Object(se.jsx)("div",{className:"react-mde-parent",children:Object(se.jsx)(ic.a,{value:a,onChange:n,selectedTab:i,onTabChange:e=>r(e),generateMarkdownPreview:e=>Promise.resolve(Object(se.jsx)(ee.a,{content:e,simplifiedAutoLink:!0,strikethrough:!0,tasklists:!0,openLinksInNewWindow:!0})),minEditorHeight:200,maxEditorHeight:1e3,minPreviewHeight:240,getIcon:function(e){const t=cc(e);return Object(se.jsx)(h.w,{icon:t.iconName,htmlTitle:t.title})}})}),"write"===i&&Object(se.jsxs)("div",{className:"grading-editor-draft-buttons",children:[Object(se.jsx)("div",{className:"grading-editor-save-button",children:Object(se.jsx)(J.a,{label:"Save Changes",icon:w.a.FLOPPY_DISK,onClick:u(e.handleGradingSave),options:b})}),Object(se.jsx)("div",{className:"grading-editor-discard-button",children:Object(se.jsx)(J.a,{label:"Discard Changes",icon:w.a.TRASH,onClick:()=>{p()&&!window.confirm("This will reset the editor. Are you sure?")||(s(e.xpAdjustment.toString()),n(e.comments),Object(me.d)("Discarded!",1e3))},options:y})})]}),Object(se.jsx)("div",{className:"grading-editor-save-continue-button",children:Object(se.jsx)(J.a,{label:"Save and Continue",icon:w.a.UPDATED,onClick:u(((t,s,a,n)=>{l(!0),e.handleGradingSaveAndContinue(t,s,a,n)})),options:O})}),e.graderName&&e.gradedAt&&Object(se.jsxs)(se.Fragment,{children:[Object(se.jsx)(h.i,{}),Object(se.jsxs)("div",{className:"grading-editor-last-graded-details",children:["Last edited by ",Object(se.jsx)("b",{children:e.graderName})," on ",Ae(e.gradedAt)]})]})]})};var dc=Object(r.b)(null,(e=>Object(c.b)({handleGradingSave:u.submitGrading,handleGradingSaveAndContinue:u.submitGradingAndContinue,handleReautogradeAnswer:u.reautogradeAnswer},e)))(lc);class uc extends j.Component{constructor(e){super(e),this.sideContentProps=(e,t)=>{var s;const a=[{label:`Grading: Question ${t+1}`,iconName:w.a.TICK,body:Object(se.jsx)(dc,{solution:e.grading[t].question.solution,questionId:e.grading[t].question.id,submissionId:e.submissionId,initialXp:e.grading[t].grade.xp,xpAdjustment:e.grading[t].grade.xpAdjustment,maxXp:e.grading[t].question.maxXp,studentName:e.grading[t].student.name,comments:null!==(s=e.grading[t].grade.comments)&&void 0!==s?s:"",graderName:e.grading[t].grade.grader?e.grading[t].grade.grader.name:void 0,gradedAt:e.grading[t].grade.grader?e.grading[t].grade.gradedAt:void 0}),id:Ce.b.grading},{label:`Question ${t+1}`,iconName:w.a.NINJA,body:Object(se.jsx)(ee.a,{content:e.grading[t].question.content}),id:Ce.b.questionOverview},{label:"Autograder",iconName:w.a.AIRPLANE,body:Object(se.jsx)(de,{testcases:e.editorTestcases,autogradingResults:e.autogradingResults,handleTestcaseEval:this.props.handleTestcaseEval,workspaceLocation:"grading"}),id:Ce.b.autograder}];e.grading[t].question.library.external.symbols.includes("get_matrix")&&a.push({label:"Tone Matrix",iconName:w.a.GRID_VIEW,body:Object(se.jsx)(xe,{}),id:Ce.b.toneMatrix});return{onChange:(e,t,s)=>{e!==t&&this.setState({selectedTab:e})},tabs:{beforeDynamicTabs:a,afterDynamicTabs:[]},workspaceLocation:"grading"}},this.controlBarProps=e=>{const t=`/courses/${this.props.courseId}/grading`,s=t+`/${this.props.submissionId}`,a=[e+1,this.props.grading.length],n=Object(se.jsx)($.a,{onClickNext:()=>we.a.push(s+`/${(e+1).toString()}`),onClickReturn:()=>we.a.push(t),questionProgress:a},"next_question"),i=Object(se.jsx)(q.a,{onClick:()=>we.a.push(s+`/${(e-1).toString()}`),questionProgress:a},"previous_question"),r=Object(se.jsx)(z.a,{questionProgress:a},"question_view");return{editorButtons:[Object(se.jsx)(K.a,{handleEditorEval:this.handleEval},"run")],flowButtons:[i,r,n]}},this.state={selectedTab:Ce.b.grading},this.handleEval=this.handleEval.bind(this)}componentDidMount(){if(this.props.handleGradingFetch(this.props.submissionId),!this.props.grading)return;let e=this.props.questionId;this.props.questionId>=this.props.grading.length&&(e=this.props.grading.length-1);const t=this.props.grading[e].question;let s="";t.type===H.d.programming&&(s=t.answer?t.answer:t.solutionTemplate||""),this.props.handleEditorValueChange(s)}componentDidUpdate(){if(void 0===this.props.grading)return;const e=this.props.questionId;void 0===this.props.grading[e]?we.a.push(`/courses/${this.props.courseId}/grading`):this.checkWorkspaceReset(this.props)}render(){var e,t,s,a,n,i,r,o;if(void 0===this.props.grading)return Object(se.jsx)(h.G,{className:f()("WorkspaceParent",p.a.DARK),description:"Getting assessment ready...",icon:Object(se.jsx)(h.R,{size:h.S.LARGE})});const c=this.props.questionId>=this.props.grading.length?this.props.grading.length-1:this.props.questionId,l=this.props.grading[c].question,d={controlBarProps:this.controlBarProps(c),editorContainerProps:l.type===H.d.programming||l.type===H.d.voting?{editorVariant:"normal",editorTabs:this.props.editorTabs.map(Z.a),editorSessionId:"",handleDeclarationNavigate:this.props.handleDeclarationNavigate,handleEditorEval:this.handleEval,handleEditorValueChange:this.props.handleEditorValueChange,handleEditorUpdateBreakpoints:this.props.handleEditorUpdateBreakpoints,handlePromptAutocomplete:this.props.handlePromptAutocomplete,isEditorAutorun:!1,sourceChapter:M.Chapter.CALC,sourceVariant:null!==(e=null===l||void 0===l||null===(t=l.library)||void 0===t?void 0:t.variant)&&void 0!==e?e:M.Variant.DEFAULT,externalLibraryName:(null===l||void 0===l||null===(s=l.library)||void 0===s||null===(a=s.external)||void 0===a?void 0:a.name)||"NONE"}:void 0,handleSideContentHeightChange:this.props.handleSideContentHeightChange,mcqProps:{mcq:l,handleMCQSubmit:e=>{}},sideBarProps:{tabs:[]},sideContentHeight:this.props.sideContentHeight,sideContentProps:this.sideContentProps(this.props,c),replProps:{handleBrowseHistoryDown:this.props.handleBrowseHistoryDown,handleBrowseHistoryUp:this.props.handleBrowseHistoryUp,handleReplEval:this.props.handleReplEval,handleReplValueChange:this.props.handleReplValueChange,output:this.props.output,replValue:this.props.replValue,sourceChapter:M.Chapter.CALC,sourceVariant:null!==(n=null===l||void 0===l||null===(i=l.library)||void 0===i?void 0:i.variant)&&void 0!==n?n:M.Variant.DEFAULT,externalLibrary:(null===l||void 0===l||null===(r=l.library)||void 0===r||null===(o=r.external)||void 0===o?void 0:o.name)||"NONE",replButtons:this.replButtons()}};return Object(se.jsx)("div",{className:f()("WorkspaceParent",p.a.DARK),children:Object(se.jsx)(Te.a,{...d})})}checkWorkspaceReset(e){var t;const s=e.submissionId,a=e.questionId;if(e.storedSubmissionId===s&&e.storedQuestionId===a)return;const n=e.grading[a].question;let i=[],r="",o="",c="",l=[];if(n.type===H.d.programming){const e=n;i=e.autogradingResults,o=e.prepend,c=e.postpend,l=e.testcases,r=e.answer,r||(r=e.solutionTemplate)}e.handleEditorUpdateBreakpoints([]),e.handleUpdateCurrentSubmissionId(s,a),e.handleResetWorkspace({autogradingResults:i,editorTabs:[{value:r,prependValue:o,postpendValue:c,highlightedLines:[],breakpoints:[]}],editorTestcases:l}),e.handleChangeExecTime(null!==(t=n.library.execTimeMs)&&void 0!==t?t:x.l.grading.execTime),e.handleClearContext(n.library,!0),e.handleUpdateHasUnsavedChanges(!1),r&&e.handleEditorValueChange(r)}replButtons(){const e=Object(se.jsx)(W.a,{handleReplOutputClear:this.props.handleReplOutputClear},"clear_repl");return[Object(se.jsx)(X.a,{handleReplEval:this.props.handleReplEval,isRunning:this.props.isRunning},"eval_repl"),e]}handleEval(){this.props.handleEditorEval(),this.state.selectedTab===Ce.b.autograder&&this.props.handleRunAllTestcases()}}var hc=uc;const pc="grading";var gc=Object(r.b)(((e,t)=>({autogradingResults:e.workspaces.grading.autogradingResults,activeEditorTabIndex:e.workspaces.grading.activeEditorTabIndex,editorTabs:e.workspaces.grading.editorTabs,editorTestcases:e.workspaces.grading.editorTestcases,grading:e.session.gradings.get(t.submissionId),hasUnsavedChanges:e.workspaces.grading.hasUnsavedChanges,isRunning:e.workspaces.grading.isRunning,isDebugging:e.workspaces.grading.isDebugging,enableDebugging:e.workspaces.grading.enableDebugging,output:e.workspaces.grading.output,replValue:e.workspaces.grading.replValue,sideContentHeight:e.workspaces.grading.sideContentHeight,storedSubmissionId:e.workspaces.grading.currentSubmission,storedQuestionId:e.workspaces.grading.currentQuestion,courseId:e.session.courseId})),(e=>Object(c.b)({handleBrowseHistoryDown:()=>Object(N.browseReplHistoryDown)(pc),handleBrowseHistoryUp:()=>Object(N.browseReplHistoryUp)(pc),handleClearContext:(e,t)=>Object(N.beginClearContext)(pc,e,t),handleDeclarationNavigate:e=>Object(N.navigateToDeclaration)(pc,e),handleEditorEval:()=>Object(N.evalEditor)(pc),handleEditorValueChange:e=>Object(N.updateEditorValue)(e,pc),handleEditorUpdateBreakpoints:e=>Object(N.setEditorBreakpoint)(e,pc),handleGradingFetch:u.fetchGrading,handleInterruptEval:()=>Object(xs.beginInterruptExecution)(pc),handleReplEval:()=>Object(N.evalRepl)(pc),handleReplOutputClear:()=>Object(N.clearReplOutput)(pc),handleReplValueChange:e=>Object(N.updateReplValue)(e,pc),handleSendReplInputToOutput:e=>Object(N.sendReplInputToOutput)(e,pc),handleResetWorkspace:e=>Object(N.resetWorkspace)(pc,e),handleChangeExecTime:e=>Object(N.changeExecTime)(e,pc),handleSideContentHeightChange:e=>Object(N.changeSideContentHeight)(e,pc),handleTestcaseEval:e=>Object(N.evalTestcase)(pc,e),handleRunAllTestcases:()=>Object(N.runAllTestcases)(pc),handleUpdateCurrentSubmissionId:N.updateCurrentSubmissionId,handleUpdateHasUnsavedChanges:e=>Object(N.updateHasUnsavedChanges)(pc,e),handleDebuggerPause:()=>Object(xs.beginDebuggerPause)(pc),handleDebuggerResume:()=>Object(xs.debuggerResume)(pc),handleDebuggerReset:()=>Object(xs.debuggerReset)(pc),handlePromptAutocomplete:(e,t,s)=>Object(N.promptAutocomplete)(pc,e,t,s)},e)))(hc);var mc=e=>{if(e.data.maxXp||e.data.xpBonus){const t=`Initial XP: ${e.data.initialXp}\n        (${e.data.xpBonus>0?`+${e.data.xpBonus} bonus `:""}\n        ${e.data.xpAdjustment>=0?"+":""}${e.data.xpAdjustment} adj.)`;return Object(se.jsx)("div",{children:Object(se.jsx)(E.a,{content:t,placement:S.a.LEFT,hoverOpenDelay:10,lazy:!0,children:`${e.data.currentXp+e.data.xpBonus} / ${e.data.maxXp}`})})}return Object(se.jsx)("div",{children:"No Exp"})};class bc extends j.Component{constructor(e){super(e),this.columnDefs=void 0,this.defaultColumnDefs=void 0,this.gridApi=void 0,this.GradingStatus=e=>Object(se.jsx)(ac,{data:e.data}),this.NotificationBadgeCell=e=>Object(se.jsx)(Ve,{notificationFilter:Be(e.data.submissionId)}),this.GradingExp=e=>Object(se.jsx)(mc,{data:e.data}),this.resizeGrid=()=>{this.gridApi&&this.gridApi.sizeColumnsToFit()},this.updatePaginationState=()=>{if(this.gridApi){const e=this.gridApi.paginationGetTotalPages(),t=0===e?0:this.gridApi.paginationGetCurrentPage()+1;this.setState({currPage:t,maxPages:e,rowCountString:this.formatRowCountString(25,t,e,this.gridApi.paginationGetRowCount()),isBackDisabled:0===e||1===t,isForwardDisabled:0===e||t===e})}},this.formatRowCountString=(e,t,s,a)=>0===s?"(none)":t!==s?`(#${e*t-24} - #${e*t})`:`(#${e*t-24} - #${a})`,this.handleFilterKeypress=e=>{"Enter"===e.key&&this.applyFilter(e.currentTarget.value)},this.handleApplyFilter=e=>{this.applyFilter(e.target.value)},this.handleGroupsFilter=()=>{this.gridApi&&(this.setState({groupFilterEnabled:!this.state.groupFilterEnabled}),this.props.handleFetchGradingOverviews(this.state.groupFilterEnabled))},this.applyFilter=e=>{var t;null===(t=this.gridApi)||void 0===t||t.setQuickFilter(e)},this.onGridReady=e=>{this.gridApi=e.api,this.gridApi.sizeColumnsToFit(),this.updatePaginationState()},this.exportCSV=()=>{this.gridApi&&this.gridApi.exportDataAsCsv({fileName:`SA submissions (${(new Date).toISOString()}).csv`,columnKeys:["assessmentName","assessmentCategory","studentName","groupName","submissionStatus","gradingStatus","questionCount","gradedCount","initialGrade","gradeAdjustment","currentGrade","maxGrade","initialXp","xpAdjustment","currentXp","maxXp","xpBonus"]})},this.changePaginationView=e=>()=>{if(this.gridApi)switch(e){case"first":return this.gridApi.paginationGoToFirstPage();case"prev":return this.gridApi.paginationGoToPreviousPage();case"next":return this.gridApi.paginationGoToNextPage();case"last":return this.gridApi.paginationGoToLastPage()}},this.sortSubmissionsByNotifications=()=>this.props.gradingOverviews?this.props.gradingOverviews.map((e=>({...e,notifications:Be(e.submissionId)(this.props.notifications)}))).sort(((e,t)=>t.notifications.length-e.notifications.length)):[],this.columnDefs=[{headerName:"",field:"notifications",cellRendererFramework:this.NotificationBadgeCell,width:30,filter:!1,resizable:!1,sortable:!1,suppressSizeToFit:!0},{headerName:"Assessment Name",field:"assessmentName"},{headerName:"Category",field:"assessmentType",maxWidth:100},{headerName:"Student Name",field:"studentName"},{headerName:"Group",field:"groupName",maxWidth:100},{headerName:"Status",field:"submissionStatus",maxWidth:100,valueFormatter:e=>{const t=e.value;return t.charAt(0).toUpperCase()+t.slice(1)},cellStyle:e=>"submitted"===e.data.submissionStatus?{backgroundColor:Zo.Colors.GREEN5}:{backgroundColor:Zo.Colors.RED5}},{headerName:"Grading",field:"gradingStatus",cellRendererFramework:this.GradingStatus,maxWidth:110},{headerName:"XP",field:"",cellRendererFramework:this.GradingExp,maxWidth:100,comparator:(e,t,s,a,n)=>s&&a?s.data.currentXp-a.data.currentXp:e-t},{headerName:"Actions",colId:"Actions",width:120,field:"",cellRendererFramework:sc,cellRendererParams:{courseId:this.props.courseId,courseRegId:this.props.courseRegId,handleUnsubmitSubmission:this.props.handleUnsubmitSubmission,handleReautogradeSubmission:this.props.handleReautogradeSubmission,role:this.props.role},filter:!1,resizable:!1,sortable:!1,suppressSizeToFit:!0,cellStyle:{padding:0}},{headerName:"Question Count",field:"questionCount",hide:!0},{headerName:"Questions Graded",field:"gradedCount",hide:!0},{headerName:"Initial Grade",field:"initialGrade",hide:!0},{headerName:"Grade Adjustment",field:"gradeAdjustment",hide:!0},{headerName:"Initial XP",field:"initialXp",hide:!0},{headerName:"XP Adjustment",field:"xpAdjustment",hide:!0},{headerName:"Current Grade",field:"currentGrade",hide:!0},{headerName:"Max Grade",field:"maxGrade",hide:!0},{headerName:"Current XP (excl. bonus)",field:"currentXp",hide:!0},{headerName:"Max XP",field:"maxXp",hide:!0},{headerName:"Bonus XP",field:"xpBonus",hide:!0}],this.defaultColumnDefs={filter:!0,resizable:!0,sortable:!0},this.state={groupFilterEnabled:!1,currPage:1,maxPages:1,rowCountString:"(none)",isBackDisabled:!0,isForwardDisabled:!0}}render(){const e=Object(Ee.b)(this.props.match.params.submissionId),t=Object(Ee.b)(this.props.match.params.questionId)||0;if(null!==e){const s={submissionId:e,questionId:t};return Object(se.jsx)(gc,{...s})}const s=Object(se.jsx)(h.G,{className:"Grading",description:"Fetching submissions...",icon:Object(se.jsx)(h.R,{size:h.S.LARGE})}),a=this.sortSubmissionsByNotifications().map((e=>e.studentName?e:{...e,studentName:"(user has yet to log in)"})),n=Object(se.jsxs)("div",{className:"grading-controls",children:[Object(se.jsx)(h.n,{label:"Filter:",labelFor:"text-input",inline:!0,children:Object(se.jsx)(h.y,{id:"filterBar",large:!1,leftIcon:"filter",placeholder:"Enter any text (e.g. mission)",onKeyPress:this.handleFilterKeypress,onBlur:this.handleApplyFilter})}),Object(se.jsxs)("div",{className:"GridControls ag-grid-controls",children:[Object(se.jsx)("div",{className:"left-controls",children:Object(se.jsx)(h.b,{active:this.state.groupFilterEnabled,icon:w.a.GIT_REPO,intent:this.state.groupFilterEnabled?g.a.PRIMARY:g.a.NONE,onClick:this.handleGroupsFilter,children:Object(se.jsx)("span",{className:"hidden-xs",children:"Show all groups"})})}),Object(se.jsxs)("div",{className:"centre-controls",children:[Object(se.jsx)(h.b,{icon:w.a.CHEVRON_BACKWARD,onClick:this.changePaginationView("first"),minimal:!0,disabled:this.state.isBackDisabled}),Object(se.jsx)(h.b,{icon:w.a.CHEVRON_LEFT,onClick:this.changePaginationView("prev"),minimal:!0,disabled:this.state.isBackDisabled}),Object(se.jsxs)(h.b,{className:"pagination-details hidden-xs",disabled:!0,minimal:!0,children:[Object(se.jsx)("div",{children:`Page ${this.state.currPage} of ${this.state.maxPages}`}),Object(se.jsx)("div",{children:this.state.rowCountString})]}),Object(se.jsx)(h.b,{icon:w.a.CHEVRON_RIGHT,onClick:this.changePaginationView("next"),minimal:!0,disabled:this.state.isForwardDisabled}),Object(se.jsx)(h.b,{icon:w.a.CHEVRON_FORWARD,onClick:this.changePaginationView("last"),minimal:!0,disabled:this.state.isForwardDisabled})]}),Object(se.jsx)("div",{className:"right-controls",children:Object(se.jsx)(h.b,{icon:w.a.EXPORT,onClick:this.exportCSV,children:Object(se.jsx)("span",{className:"hidden-xs",children:"Export to CSV"})})})]})]}),i=Object(se.jsx)("div",{className:"Grid ag-grid-parent ag-theme-balham",children:Object(se.jsx)(_s.AgGridReact,{domLayout:"autoHeight",columnDefs:this.columnDefs,defaultColDef:this.defaultColumnDefs,onGridReady:this.onGridReady,onGridSizeChanged:this.resizeGrid,onPaginationChanged:this.updatePaginationState,rowData:a,rowHeight:30,pagination:!0,paginationPageSize:25,suppressCellSelection:!0,suppressMovableColumns:!0,suppressPaginationPanel:!0})}),r=Object(se.jsxs)("div",{className:"Grading",children:[n,Object(se.jsx)(h.i,{}),i]});return Object(se.jsx)("div",{children:Object(se.jsx)(_e.a,{loadContentDispatch:this.props.handleFetchGradingOverviews,display:void 0===this.props.gradingOverviews?s:r,fullWidth:!1})})}componentDidUpdate(e,t){this.gridApi&&this.props.notifications.length!==e.notifications.length&&this.gridApi.setRowData(this.sortSubmissionsByNotifications())}}var jc=bc;var yc=Object(r.b)((e=>({gradingOverviews:e.session.gradingOverviews,courseRegId:e.session.courseRegId,notifications:e.session.notifications,role:e.session.role,courseId:e.session.courseId})),(e=>Object(c.b)({handleAcknowledgeNotifications:u.acknowledgeNotifications,handleFetchGradingOverviews:u.fetchGradingOverviews,handleUnsubmitSubmission:u.unsubmitSubmission,handleReautogradeSubmission:u.reautogradeSubmission},e)))(jc),Oc=s(188);var fc=e=>{const{handleUpdateSublanguage:t}=e,{sourceChapter:s,sourceVariant:a}=e,[n,i]=j.useState(x.n[0]),[r,o]=j.useState(!1),c=j.useCallback((e=>{o(!0),i(e)}),[o,i]),l=j.useCallback((()=>{o(!1)}),[o]),d=j.useCallback((()=>{o(!1),t(n)}),[n,o,t]),u=j.useCallback(((e,t)=>{let{handleClick:s}=t;return Object(se.jsx)(h.B,{onClick:s,text:e.displayName},e.displayName)}),[]),m=j.useCallback((e=>{let{itemsParentRef:t,renderItem:s}=e;const a=x.h.map(s),n=x.p.map(s);return Object(se.jsxs)(h.A,{ulRef:t,children:[a,Object(se.jsx)(h.B,{text:"Variants",icon:"cog",children:n},"variant-menu")]})}),[]),b=ct.a.ofType(),y=Object(se.jsxs)(h.h,{canEscapeKeyClose:!0,canOutsideClickClose:!0,className:"change-default-lang-dialog",icon:w.a.ERROR,isCloseButtonShown:!0,isOpen:r,onClose:l,title:"Updating default Source sublanguage",children:[Object(se.jsxs)("div",{className:p.a.DIALOG_BODY,children:["Are you sure you want to update the ",Object(se.jsx)("b",{children:"default Playground Source sublanguage"})," from"," ",Object(x.o)(s,a)," to ",Object(se.jsx)("b",{children:n.displayName}),"?"]}),Object(se.jsx)("div",{className:p.a.DIALOG_FOOTER,children:Object(se.jsxs)("div",{className:p.a.DIALOG_FOOTER_ACTIONS,children:[Object(se.jsx)(J.a,{label:"Cancel",onClick:l,options:{minimal:!1}}),Object(se.jsx)(J.a,{label:"Confirm",onClick:d,options:{minimal:!1,intent:g.a.DANGER}})]})})]});return Object(se.jsxs)(se.Fragment,{children:[Object(se.jsx)(b,{items:x.n,onItemSelect:c,itemRenderer:u,itemListRenderer:m,filterable:!1,children:Object(se.jsxs)(h.b,{rightIcon:w.a.DOUBLE_CARET_VERTICAL,children:[Object(se.jsx)("span",{className:"hidden-xs hidden-sm",children:"Default sublanguage: "}),Object(se.jsx)("span",{children:Object(x.o)(s,a)})]})}),y]})};var vc=Object(r.b)((e=>({sourceChapter:e.session.sourceChapter||Se.b.defaultSourceChapter,sourceVariant:e.session.sourceVariant||Se.b.defaultSourceVariant})),(e=>Object(c.b)({handleUpdateSublanguage:N.changeSublanguage},e)))(fc);var xc=e=>{const[t,s]=j.useState(!1),a=j.useCallback((()=>s(!0)),[]),n=j.useCallback((()=>s(!1)),[]),{handleDeleteAssessment:i,data:r}=e,o=j.useCallback((()=>{const{id:e}=r;i(e),n()}),[r,n,i]);return Object(se.jsxs)(se.Fragment,{children:[Object(se.jsx)(J.a,{icon:w.a.TRASH,onClick:a}),Object(se.jsxs)(h.h,{icon:w.a.WARNING_SIGN,isOpen:t,onClose:n,title:"Deleting assessment",canOutsideClickClose:!0,children:[Object(se.jsxs)("div",{className:p.a.DIALOG_BODY,children:[Object(se.jsxs)("p",{children:["Are you sure you want to ",Object(se.jsx)("b",{children:"delete"})," the assessment ",Object(se.jsx)("i",{children:r.title}),"?"]}),Object(se.jsx)("p",{children:Object(se.jsx)("b",{children:"All submissions and their answers will be deleted as well."})})]}),Object(se.jsx)("div",{className:p.a.DIALOG_FOOTER,children:Object(se.jsxs)("div",{className:p.a.DIALOG_FOOTER_ACTIONS,children:[Object(se.jsx)(J.a,{label:"Cancel",icon:w.a.CROSS,onClick:n,options:{minimal:!1}}),Object(se.jsx)(J.a,{label:"Confirm",icon:w.a.TRASH,onClick:o,options:{minimal:!1,intent:g.a.DANGER}})]})})]})]})},Cc=s(528);var Sc=e=>{const[t,s]=j.useState(void 0),[a,n]=j.useState(!1),[i,r]=j.useState(!1),[o,c]=j.useState(-1);j.useEffect((()=>{e.assessmentConfigurations&&-1===o&&c(e.assessmentConfigurations[0].assessmentConfigId)}),[e.assessmentConfigurations,o]);const{handleUploadAssessment:l}=e,d=j.useMemo((()=>{var t;return null===(t=e.assessmentConfigurations)||void 0===t?void 0:t.map((e=>({value:e.assessmentConfigId,label:e.type})))}),[e.assessmentConfigurations]),u=j.useCallback((()=>{-1!==o?(t&&(l(t,i,o),r(!1)),s(void 0)):Object(me.e)("Please select a valid assessment type before uploading!")}),[t,i,l,o]),p=j.useCallback((()=>s(void 0)),[s]),m=j.useCallback((e=>{s(e[0]),r(!1)}),[s]),b=j.useCallback((e=>{e.length>1&&Object(me.e)("Uploading multiple files at once is not currently supported!",2e3)}),[]),{getRootProps:y,getInputProps:O,isFocused:v,isDragActive:x,isDragAccept:S,isDragReject:E}=Object(Cc.a)({multiple:!1,onDropAccepted:m,onDropRejected:b}),T=j.useMemo((()=>f()("dropzone-base",v||x?"dropzone-active":void 0,S?"dropzone-accept":void 0,E?"dropzone-reject":void 0)),[v,x,S,E]),k=j.useCallback((()=>{i?r(!1):n(!0)}),[i,n,r]),A=j.useMemo((()=>Object(se.jsx)("div",{className:"toggle-button-wrapper",children:Object(se.jsx)(h.T,{checked:i,onChange:k})})),[i,k]),I=j.useCallback((()=>{r(!0),n(!1)}),[r]),N=j.useCallback((()=>{n(!1)}),[n]),M=j.useMemo((()=>Object(se.jsxs)("div",{className:"dropzone-controls",children:[Object(se.jsx)(J.a,{label:"Yes",icon:w.a.CONFIRM,onClick:I,options:{minimal:!1,intent:g.a.DANGER}}),Object(se.jsx)(J.a,{label:"No",icon:w.a.CROSS,onClick:N,options:{minimal:!1}})]})),[N,I]);return Object(se.jsxs)(se.Fragment,{children:[Object(se.jsx)(h.e,{elevation:C.a.TWO,interactive:!0,children:Object(se.jsxs)("div",{...y({className:T}),children:[Object(se.jsx)("input",{...O()}),Object(se.jsx)("p",{children:"Drag 'n' drop a file here, or click to select a file"})]})}),t&&Object(se.jsxs)(h.e,{className:"dropzone-prompt",elevation:C.a.TWO,interactive:!0,children:[Object(se.jsx)("h3",{children:null===t||void 0===t?void 0:t.name}),!a&&Object(se.jsxs)(se.Fragment,{children:[Object(se.jsxs)("div",{className:"dropzone-controls",children:[Object(se.jsx)(h.u,{options:d,onChange:e=>c(parseInt(e.target.value)),value:o}),Object(se.jsx)(J.a,{label:"Confirm Upload",icon:w.a.UPLOAD,onClick:u,options:{minimal:!1,intent:g.a.DANGER}}),Object(se.jsx)(J.a,{label:"Cancel Upload",icon:w.a.DELETE,onClick:p,options:{minimal:!1}})]}),Object(se.jsxs)("div",{className:"dropzone-controls",children:[Object(se.jsx)("p",{children:"Force update opened assessment"}),A]})]}),a&&Object(se.jsx)("p",{children:"Are you sure that you want to force update the assessment?"}),a&&M]})]})},wc=s(1309);const Ec="YYYY-MM-DD HH:mm:ss ZZ";var Tc=e=>{const t=new Date(2010,0,0),s=new Date(2030,11,31),{data:a,forOpenDate:n}=e,i=n?a.openAt:a.closeAt,r=m(i,m.ISO_8601,!0),[o,c]=j.useState(!1),[l,d]=j.useState(r),u=j.useCallback((()=>c(!0)),[]),b=j.useCallback((()=>c(!1)),[]),{handleAssessmentChangeDate:y}=e,O=j.useCallback((()=>{if(l){const{id:e,openAt:t,closeAt:s}=a;y(e,n?l.toISOString():t,n?s:l.toISOString()),b()}else Object(me.e)("No date and time selected!",2e3),d(r)}),[l,r,a,y,n,b]),f=j.useCallback((e=>d(m(e))),[]),v=j.useCallback((()=>{Object(me.e)("Failed to parse date string! Defaulting to current date.",2e3),d(r)}),[r]),x=Object(se.jsx)(wc.a,{formatDate:e=>m(e).format(Ec),onChange:f,onError:v,parseDate:e=>{const t=m(e,Ec,!0);return!!t.isValid()&&t.toDate()},placeholder:`${Ec} or select a date`,value:null===l||void 0===l?void 0:l.toDate(),timePrecision:"second",fill:!0,minDate:t,maxDate:s,closeOnSelection:!1});return Object(se.jsxs)(se.Fragment,{children:[Object(se.jsx)("span",{className:"date-cell-text",children:r.format(Ec)}),Object(se.jsx)(J.a,{icon:w.a.EDIT,onClick:u}),Object(se.jsxs)(h.h,{icon:w.a.INFO_SIGN,isOpen:o,onClose:b,title:"Updating assessment settings",canOutsideClickClose:!0,children:[Object(se.jsxs)("div",{className:p.a.DIALOG_BODY,children:[Object(se.jsxs)("p",{children:[n?"Opening":"Closing"," date and time:"]}),x]}),Object(se.jsx)("div",{className:p.a.DIALOG_FOOTER,children:Object(se.jsxs)("div",{className:p.a.DIALOG_FOOTER_ACTIONS,children:[Object(se.jsx)(J.a,{label:"Cancel",icon:w.a.CROSS,onClick:b,options:{minimal:!1}}),Object(se.jsx)(J.a,{label:"Confirm",icon:w.a.TICK,onClick:O,options:{minimal:!1,intent:g.a.DANGER}})]})})]})]})};var kc=e=>{const{data:t}=e,[s,a]=j.useState(!1),[n]=j.useState(!!t.isPublished),i=j.useCallback((()=>a(!0)),[]),r=j.useCallback((()=>a(!1)),[]),{handlePublishAssessment:o}=e,c=j.useCallback((()=>{const{id:e}=t;o(!n,e),r()}),[t,n,r,o]);return Object(se.jsxs)(se.Fragment,{children:[Object(se.jsx)(h.T,{className:"publish-cell",checked:n,onChange:i}),Object(se.jsxs)(h.h,{icon:w.a.WARNING_SIGN,isOpen:s,onClose:r,title:(n?"Unpublish":"Publish")+" assessment",canOutsideClickClose:!0,children:[Object(se.jsxs)("div",{className:p.a.DIALOG_BODY,children:[Object(se.jsxs)("p",{children:["Are you sure you want to ",Object(se.jsx)("b",{children:n?"unpublish":"publish"})," the assessment"," ",Object(se.jsx)("i",{children:t.title}),"?"]}),n?Object(se.jsx)("p",{children:Object(se.jsx)("b",{children:"This will hide the assessment for students and prevent them from uploading new answers. Admins and staff are not affected."})}):null]}),Object(se.jsx)("div",{className:p.a.DIALOG_FOOTER,children:Object(se.jsxs)("div",{className:p.a.DIALOG_FOOTER_ACTIONS,children:[Object(se.jsx)(J.a,{label:"Cancel",icon:w.a.CROSS,onClick:r,options:{minimal:!1}}),Object(se.jsx)(J.a,{label:"Confirm",icon:w.a.CONFIRM,onClick:c,options:{minimal:!1,intent:g.a.DANGER}})]})})]})]})};class Ac extends j.Component{constructor(e){super(e),this.columnDefs=void 0,this.defaultColumnDefs=void 0,this.gridApi=void 0,this.columnApi=void 0,this.loadContent=()=>{this.props.handleAssessmentOverviewFetch(),this.props.handleFetchCourseConfigs()},this.dateFilterComparator=(e,t)=>{const s=new Date(t);return s<e?-1:s>e?1:0},this.onGridReady=e=>{this.gridApi=e.api,this.columnApi=e.columnApi,this.gridApi.sizeColumnsToFit(),this.columnApi.applyColumnState({state:[{colId:"openAt",sort:"desc"},{colId:"closeAt",sort:"desc"}]})},this.resizeGrid=()=>{this.gridApi&&this.gridApi.sizeColumnsToFit()},this.toggleDropzone=()=>{this.setState({showDropzone:!this.state.showDropzone})},this.state={showDropzone:!1},this.columnDefs=[{field:"number",headerName:"ID",width:50},{headerName:"Title",field:"title"},{headerName:"Category",field:"type",width:100},{headerName:"Open Date",field:"openAt",filter:"agDateColumnFilter",filterParams:{comparator:this.dateFilterComparator,inRangeInclusive:!0},sortingOrder:["desc","asc",null],cellRendererFramework:Tc,cellRendererParams:{handleAssessmentChangeDate:this.props.handleAssessmentChangeDate,forOpenDate:!0},width:150},{headerName:"Close Date",field:"closeAt",filter:"agDateColumnFilter",filterParams:{comparator:this.dateFilterComparator,inRangeInclusive:!0},sortingOrder:["desc","asc",null],cellRendererFramework:Tc,cellRendererParams:{handleAssessmentChangeDate:this.props.handleAssessmentChangeDate,forOpenDate:!1},width:150},{headerName:"Publish",field:"",cellRendererFramework:kc,cellRendererParams:{handlePublishAssessment:this.props.handlePublishAssessment},width:100,filter:!1,resizable:!1,sortable:!1,cellStyle:{padding:0}},{headerName:"Delete",field:"",cellRendererFramework:xc,cellRendererParams:{handleDeleteAssessment:this.props.handleDeleteAssessment},width:100,filter:!1,resizable:!1,sortable:!1,cellStyle:{padding:0}}],this.defaultColumnDefs={filter:!0,resizable:!0,sortable:!0}}render(){const e=Object(se.jsxs)("div",{className:"GridControls ground-control-controls",children:[Object(se.jsx)(h.b,{active:this.state.showDropzone,icon:w.a.CLOUD_UPLOAD,intent:this.state.showDropzone?g.a.PRIMARY:g.a.NONE,onClick:this.toggleDropzone,children:Object(se.jsx)("span",{className:"hidden-xs",children:"Upload assessment"})}),Object(se.jsx)(vc,{}),Object(se.jsx)(h.b,{icon:w.a.REFRESH,onClick:this.props.handleAssessmentOverviewFetch,children:Object(se.jsx)("span",{className:"hidden-xs",children:"Refresh assessments"})})]}),t=Object(se.jsx)(h.g,{isOpen:this.state.showDropzone,keepChildrenMounted:!0,children:Object(se.jsx)(Sc,{handleUploadAssessment:this.props.handleUploadAssessment,assessmentConfigurations:this.props.assessmentConfigurations})}),s=Object(se.jsx)("div",{className:"Grid ag-grid-parent ag-theme-balham",children:Object(se.jsx)(_s.AgGridReact,{domLayout:"autoHeight",columnDefs:this.columnDefs,defaultColDef:this.defaultColumnDefs,onGridReady:this.onGridReady,onGridSizeChanged:this.resizeGrid,rowData:this.props.assessmentOverviews,rowHeight:30,suppressCellSelection:!0,suppressMovableColumns:!0,suppressPaginationPanel:!0})}),a=Object(se.jsxs)("div",{className:"GroundControl",children:[e,t,Object(se.jsx)(h.i,{}),s]});return Object(se.jsx)("div",{children:Object(se.jsx)(_e.a,{display:a,loadContentDispatch:this.loadContent})})}}var Ic=Ac;var Nc=Object(r.b)((e=>({assessmentOverviews:e.session.assessmentOverviews,assessmentConfigurations:e.session.assessmentConfigurations})),(e=>Object(c.b)({handleAssessmentChangeDate:Oc.changeDateAssessment,handleAssessmentOverviewFetch:u.fetchAssessmentOverviews,handleDeleteAssessment:Oc.deleteAssessment,handleUploadAssessment:Oc.uploadAssessment,handlePublishAssessment:Oc.publishAssessment,handleFetchCourseConfigs:u.fetchCourseConfig},e)))(Ic),Mc=s(120),Pc=s(375),Rc=s.n(Pc);class _c extends j.PureComponent{constructor(e){super(e),this.recorder=void 0,this.handleCloseDialog=()=>this.setState({dialogOpen:!1}),this.handleOpenDialog=()=>this.setState({dialogOpen:!0}),this.updateTimerDuration=()=>{this.setState({duration:this.props.getTimerDuration()})},this.handleTruncatePlaybackData=()=>{const e=this.props.playbackData.inputs.filter((e=>e.time<=1e3*this.props.currentPlayerTime));this.props.handleResetInputs(e)},this.handleRecorderPausing=()=>{if(!this.recorder)return;const{handleSetIsEditorReadonly:e,handleSetSourcecastData:t,handleTimerPause:s}=this.props;clearInterval(this.state.updater),e(!0),s(),this.recorder.pause();t("","","",window.URL.createObjectURL(this.recorder.exportWAV()),this.props.playbackData)},this.handleRecorderStarting=()=>{this.recorder=new Rc.a;const{handleRecordInit:e,handleSetIsEditorReadonly:t,handleTimerStart:s}=this.props;this.recorder.start().then((()=>{e(),t(!1),s();const a=setInterval(this.updateTimerDuration,100);this.setState({updater:a})}),(e=>{alert("Microphone not found: "+e)}))},this.handleRecorderResuming=()=>{if(!this.recorder)return;const{handleSetIsEditorReadonly:e,handleTimerResume:t}=this.props;e(!1),t(-1);const s=setInterval(this.updateTimerDuration,100);this.setState({updater:s}),this.recorder.resume()},this.handleRecorderResumingFromCurrent=()=>{if(!this.recorder)return;const{currentPlayerTime:e,handleSetIsEditorReadonly:t,handleTimerResume:s}=this.props;this.handleTruncatePlaybackData(),t(!1),s(1e3*e);const a=setInterval(this.updateTimerDuration,100);this.setState({updater:a}),this.recorder.resume(e)},this.handleRecorderStopping=()=>{if(!this.recorder)return;const{handleSetIsEditorReadonly:e,handleTimerStop:t}=this.props;e(!1),t(),clearInterval(this.state.updater),this.recorder.stop(),this.setState({fileDataBlob:this.recorder.exportWAV()}),this.recorder.clear()},this.handleRecorderResetting=()=>{const{handleSetIsEditorReadonly:e,handleTimerReset:t}=this.props;e(!1),t(),clearInterval(this.state.updater),this.setState({duration:0}),this.recorder&&(this.recorder.stop(),this.recorder.clear())},this.handleRecorderSaving=()=>{this.state.fileDataBlob?this.props.handleSaveSourcecastData(this.state.saveTitle,this.state.saveDescription,this.state.saveUID,this.state.fileDataBlob,this.props.playbackData):alert("No recording found")},this.renderLabel=e=>{const t=Math.floor(e/60),s=Math.floor(e-60*t);return(t<10?"0"+t:t)+":"+(s<10?"0"+s:s)},this.handleSaveTitleInputChange=e=>{this.setState({saveTitle:e.target.value})},this.handleSaveDescriptionInputChange=e=>{this.setState({saveDescription:e.target.value})},this.handleSaveUIDInputChange=e=>{this.setState({saveUID:e.target.value})},this.state={dialogOpen:!1,duration:0,updater:void 0,saveTitle:"",saveDescription:"",saveUID:""}}async componentDidMount(){Rc.a.getPermission().then((()=>{}),(e=>{alert("Microphone not found: "+e)}))}render(){const e=Object(se.jsx)(J.a,{label:"Record Pause",icon:w.a.SNOWFLAKE,onClick:this.props.handleRecordPause}),t=Object(se.jsx)(J.a,{label:"Pause",icon:w.a.PAUSE,onClick:this.handleRecorderPausing}),s=Object(se.jsx)(J.a,{label:"Resume",icon:w.a.PLAY,onClick:this.handleRecorderResuming}),a=Object(se.jsx)(J.a,{label:"Resume Here",icon:w.a.PLAY,onClick:this.handleRecorderResumingFromCurrent}),n=Object(se.jsx)(J.a,{label:"Record",icon:w.a.PLAY,onClick:this.handleRecorderStarting}),i=Object(se.jsx)(J.a,{label:"Stop",icon:w.a.STOP,onClick:this.handleRecorderStopping}),r=Object(se.jsx)(J.a,{label:"Reset",icon:w.a.REFRESH,onClick:this.handleRecorderResetting}),o=Object(se.jsx)(J.a,{label:"Upload",icon:w.a.FLOPPY_DISK,onClick:this.handleOpenDialog});return Object(se.jsxs)("div",{children:[Object(se.jsxs)(h.h,{icon:"info-sign",isOpen:this.state.dialogOpen,onClose:this.handleCloseDialog,title:"Upload Sourcecast",canOutsideClickClose:!0,children:[Object(se.jsxs)("div",{className:p.a.DIALOG_BODY,children:[Object(se.jsx)(h.y,{id:"title",leftIcon:w.a.HEADER,onChange:this.handleSaveTitleInputChange,placeholder:"Title",value:this.state.saveTitle}),Object(se.jsx)("br",{}),Object(se.jsx)(h.y,{id:"description",leftIcon:w.a.LIST_DETAIL_VIEW,onChange:this.handleSaveDescriptionInputChange,placeholder:"Description",value:this.state.saveDescription}),Object(se.jsx)("br",{}),Object(se.jsx)(h.y,{id:"uid",leftIcon:w.a.KEY,onChange:this.handleSaveUIDInputChange,placeholder:"UID (optional, only alphanumeric, dash and underscore allowed)",value:this.state.saveUID})]}),Object(se.jsx)("div",{className:p.a.DIALOG_FOOTER,children:Object(se.jsxs)("div",{className:p.a.DIALOG_FOOTER_ACTIONS,children:[Object(se.jsx)(J.a,{label:"Confirm Upload",icon:w.a.TICK,onClick:this.handleRecorderSaving}),Object(se.jsx)(J.a,{label:"Cancel",icon:w.a.CROSS,onClick:this.handleCloseDialog})]})})]}),Object(se.jsx)("br",{}),Object(se.jsx)("div",{className:"Timer",children:Object(se.jsx)(h.e,{elevation:2,style:{background:"#24323F"},children:Object(se.jsx)(h.o,{children:this.renderLabel(this.props.recordingStatus!==F.c.paused?this.state.duration/1e3:this.props.currentPlayerTime)})})}),Object(se.jsx)("br",{}),Object(se.jsxs)("div",{className:"RecorderControl",children:[this.props.recordingStatus===F.c.notStarted&&n,this.props.recordingStatus===F.c.paused&&s,this.props.recordingStatus===F.c.paused&&a,this.props.recordingStatus===F.c.recording&&t,this.props.recordingStatus===F.c.recording&&e,this.props.recordingStatus===F.c.paused&&i,this.props.recordingStatus===F.c.finished&&o,this.props.recordingStatus!==F.c.notStarted&&r]}),Object(se.jsx)("br",{})]})}}var Lc=_c;const Dc="sourcereel",Bc="Welcome to Sourcereel!",Uc={label:"Data Visualizer",iconName:w.a.EYE_OPEN,body:Object(se.jsx)(As,{}),id:Ce.b.dataVisualizer},Gc={label:"Env Visualizer",iconName:w.a.GLOBE,body:Object(se.jsx)(Ms,{}),id:Ce.b.envVisualizer};var Fc=e=>{const[t,s]=Object(j.useState)(Ce.b.sourcereel),a=Object(r.c)();Object(j.useEffect)((()=>{Object(Cs.fetchSourcecastIndex)("sourcecast")}),[]),Object(j.useEffect)((()=>{const{inputToApply:t}=e;if(t)switch(t.type){case"activeTabChange":s(t.data);break;case"chapterSelect":e.handleChapterSelect(t.data);break;case"externalLibrarySelect":e.handleExternalSelect(t.data);break;case"forcePause":e.handleSetSourcecastStatus(F.b.forcedPaused)}}),[e.inputToApply]);const n=()=>e.timeElapsedBeforePause+Date.now()-e.timeResumed,i=Object(se.jsx)(Ss,{handleDebuggerPause:()=>a(Object(xs.beginDebuggerPause)(Dc)),handleDebuggerResume:()=>a(Object(xs.debuggerResume)(Dc)),handleDebuggerReset:()=>a(Object(xs.debuggerReset)(Dc)),handleEditorEval:()=>{e.handleEditorEval(),e.recordingStatus===F.c.recording&&e.handleRecordInput({time:n(),type:"keyboardCommand",data:F.a.run})},handleInterruptEval:()=>a(Object(xs.beginInterruptExecution)(Dc)),handleToggleEditorAutorun:()=>a(Object(N.toggleEditorAutorun)(Dc)),isDebugging:e.isDebugging,isEditorAutorun:e.isEditorAutorun,isRunning:e.isRunning},"autorun"),o=Object(se.jsx)(V.a,{handleChapterSelect:(t,s)=>{let{chapter:a}=t;e.handleChapterSelect(a),e.recordingStatus===F.c.recording&&e.handleRecordInput({time:n(),type:"chapterSelect",data:a})},sourceChapter:e.sourceChapter,sourceVariant:e.sourceVariant},"chapter"),c=Object(se.jsx)(W.a,{handleReplOutputClear:()=>a(Object(N.clearReplOutput)(Dc))},"clear_repl"),l=Object(se.jsx)(X.a,{handleReplEval:e.handleReplEval,isRunning:e.isRunning},"eval_repl"),d={controlBarProps:{editorButtons:[i,o]},editorContainerProps:{...k.a.pick(e,"codeDeltasToApply","handleEditorEval","handleEditorValueChange","isEditorAutorun","inputToApply","handleRecordInput","isEditorReadonly"),editorVariant:"sourcecast",editorTabs:e.editorTabs.map(Z.a),handleDeclarationNavigate:e=>a(Object(N.navigateToDeclaration)(Dc,e)),handleEditorUpdateBreakpoints:e=>a(Object(N.setEditorBreakpoint)(e,Dc)),editorSessionId:"",getTimerDuration:n,isPlaying:e.playbackStatus===F.b.playing,isRecording:e.recordingStatus===F.c.recording},handleSideContentHeightChange:e=>a(Object(N.changeSideContentHeight)(e,Dc)),replProps:{output:e.output,replValue:e.replValue,handleBrowseHistoryDown:()=>a(Object(N.browseReplHistoryDown)(Dc)),handleBrowseHistoryUp:()=>a(Object(N.browseReplHistoryUp)(Dc)),handleReplEval:e.handleReplEval,handleReplValueChange:e=>a(Object(N.updateReplValue)(e,Dc)),sourceChapter:e.sourceChapter,sourceVariant:e.sourceVariant,externalLibrary:e.externalLibraryName,replButtons:[l,c]},sideBarProps:{tabs:[]},sideContentHeight:e.sideContentHeight,sideContentProps:{onChange:t=>{s(t),e.recordingStatus===F.c.recording&&e.handleRecordInput({time:n(),type:"activeTabChange",data:t})},selectedTabId:t,tabs:{beforeDynamicTabs:[{label:"Recording Panel",iconName:w.a.COMPASS,body:Object(se.jsxs)("div",{children:[Object(se.jsx)("span",{className:"Multi-line",children:Object(se.jsxs)(h.M,{children:[" ",Bc," "]})}),Object(se.jsx)(Lc,{currentPlayerTime:e.currentPlayerTime,editorValue:e.editorTabs[0].value,getTimerDuration:n,playbackData:e.playbackData,handleRecordInit:()=>{const t={chapter:e.sourceChapter,externalLibrary:e.externalLibraryName,editorValue:e.editorTabs[0].value};a(Object(Mc.recordInit)(t,Dc))},handleRecordPause:()=>e.handleRecordInput({time:n(),type:"forcePause",data:null}),handleResetInputs:e=>a(Object(Mc.resetInputs)(e,Dc)),handleSaveSourcecastData:(e,t,s,n,i)=>a(Object(vs.saveSourcecastData)(e,t,s,n,i,"sourcecast")),handleSetSourcecastData:(e,t,s,n,i)=>a(Object(vs.setSourcecastData)(e,t,s,n,i,"sourcecast")),handleSetIsEditorReadonly:e.handleSetIsEditorReadonly,handleTimerPause:()=>a(Object(Mc.timerPause)(Dc)),handleTimerReset:()=>a(Object(Mc.timerReset)(Dc)),handleTimerResume:e=>a(Object(Mc.timerResume)(e,Dc)),handleTimerStart:()=>a(Object(Mc.timerStart)(Dc)),handleTimerStop:()=>a(Object(Mc.timerStop)(Dc)),recordingStatus:e.recordingStatus})]}),id:Ce.b.sourcereel},{label:"Sourcecast Table",iconName:w.a.EDIT,body:Object(se.jsx)("div",{children:Object(se.jsx)(Vs,{handleDeleteSourcecastEntry:e=>a(Object(Mc.deleteSourcecastEntry)(e,"sourcecast")),sourcecastIndex:e.sourcecastIndex,courseId:e.courseId})}),id:Ce.b.introduction},Uc,Gc],afterDynamicTabs:[]},workspaceLocation:"sourcereel"}},u={...k.a.pick(e,"handleEditorValueChange","handleSetIsEditorReadonly","handleSetSourcecastStatus","audioUrl","currentPlayerTime","playbackData","playbackStatus","handleChapterSelect","handleExternalSelect"),handleSetCurrentPlayerTime:e=>a(Object(vs.setCurrentPlayerTime)(e,"sourcecast")),handleSetCodeDeltasToApply:e=>a(Object(vs.setCodeDeltasToApply)(e,"sourcecast")),handleSetInputToApply:e=>a(Object(vs.setInputToApply)(e,"sourcecast")),handleSetSourcecastDuration:e=>a(Object(vs.setSourcecastDuration)(e,"sourcecast")),handlePromptAutocomplete:(e,t,s)=>a(Object(N.promptAutocomplete)(Dc,e,t,s)),duration:e.playbackDuration};return Object(se.jsxs)("div",{className:f()("Sourcereel",p.a.DARK),children:[e.recordingStatus===F.c.paused?Object(se.jsx)(Rs,{...u}):void 0,Object(se.jsx)(Te.a,{...d})]})};const Hc="sourcereel";var Vc=Object(r.b)((e=>({audioUrl:e.workspaces.sourcecast.audioUrl,currentPlayerTime:e.workspaces.sourcecast.currentPlayerTime,codeDeltasToApply:e.workspaces.sourcecast.codeDeltasToApply,activeEditorTabIndex:e.workspaces.sourcereel.activeEditorTabIndex,editorTabs:e.workspaces.sourcereel.editorTabs,enableDebugging:e.workspaces.sourcereel.enableDebugging,externalLibraryName:e.workspaces.sourcereel.externalLibrary,inputToApply:e.workspaces.sourcecast.inputToApply,isDebugging:e.workspaces.sourcereel.isDebugging,isEditorAutorun:e.workspaces.sourcereel.isEditorAutorun,isEditorReadonly:e.workspaces.sourcereel.isEditorReadonly,isRunning:e.workspaces.sourcereel.isRunning,output:e.workspaces.sourcereel.output,playbackData:e.workspaces.sourcereel.playbackData,playbackDuration:e.workspaces.sourcecast.playbackDuration,playbackStatus:e.workspaces.sourcecast.playbackStatus,recordingStatus:e.workspaces.sourcereel.recordingStatus,replValue:e.workspaces.sourcereel.replValue,sideContentHeight:e.workspaces.sourcereel.sideContentHeight,sourcecastIndex:e.workspaces.sourcecast.sourcecastIndex,sourceChapter:M.Chapter.CALC,sourceVariant:e.workspaces.sourcereel.context.variant,timeElapsedBeforePause:e.workspaces.sourcereel.timeElapsedBeforePause,timeResumed:e.workspaces.sourcereel.timeResumed,courseId:e.session.courseId})),(e=>Object(c.b)({handleChapterSelect:e=>Object(N.chapterSelect)(e,M.Variant.DEFAULT,Hc),handleEditorEval:()=>Object(N.evalEditor)(Hc),handleEditorValueChange:e=>Object(N.updateEditorValue)(e,Hc),handleExternalSelect:e=>Object(N.externalLibrarySelect)(e,Hc),handleRecordInput:e=>Object(Mc.recordInput)(e,Hc),handleReplEval:()=>Object(N.evalRepl)(Hc),handleSetSourcecastStatus:e=>Object(vs.setSourcecastStatus)(e,"sourcecast"),handleSetIsEditorReadonly:e=>Object(N.setIsEditorReadonly)(Hc,e)},e)))(Fc);let Wc;!function(e){e.Default="Default",e.ObjectPlacement="ObjectPlacement",e.AssetUploader="AssetUploader",e.CheckpointSim="CheckpointSim",e.ChapterSim="ChapterSim"}(Wc||(Wc={}));const Xc=e=>async function(t,s){let a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};try{const i=Yc(zo.getInstance().getAccountInfo().accessToken||"");Object.entries(a).forEach((e=>{let[t,s]=e;i.append(t,s)}));const r={method:s,headers:i,...n};return fetch(Se.b.backendUrl+`/v2/courses/${en()}/${e}/`+t,r)}finally{}},$c=Xc("admin/assets"),qc=Xc("stories"),zc=Xc("admin/stories");function Yc(e){const t=new Headers;return t.append("Accept","application/json"),t.append("Authorization",`Bearer ${e}`),t}const Kc=["locations","objects","images","avatars","ui","sfx","bgm","stories"];const Qc=async()=>(await Zc("stories")).filter((e=>e.startsWith("stories")&&e.endsWith("txt"))).map((e=>e.slice(8)));async function Jc(){return(await Promise.all(Kc.map((async e=>{const t=await Zc(e);return t.length?t:[`${e}`]})))).reduce(((e,t)=>e.concat(t)),[])}async function Zc(e){const t=await $c(e,"GET",{"Content-Type":"application/json"});return 200===t.status?t.json():[]}async function el(e,t){const s=await Promise.all(Array.from(e).map((async e=>{const s=await async function(e,t){const s=new FormData;s.set("upload",e);const a=await $c(`${t}/${e.name}`,"POST",{},{body:s,mode:"cors"});return a?a.text():""}(e,t);return e.name+" => "+s})));return s.join("\n")}async function tl(){const e=await qc("","GET"),t=200===e.status?await e.json():[];return k.a.sortBy(t,(e=>new Date(e.openAt)))}async function sl(e,t){const s=await zc(e,"POST",{"Content-Type":"application/json"},{body:JSON.stringify(t)});return 200===s.status?"Chapter successfully created/updated":s.text()}const al="Specify own folder...";var nl=()=>{const[e,t]=y.a.useState(),[s,a]=y.a.useState(Kc[0]),[n,i]=y.a.useState(),[r,o]=y.a.useState(!1);function c(e){e.target.innerText&&(a(e.target.innerText),o(!1))}const l=Object(se.jsxs)(h.A,{children:[Kc.map((e=>Object(se.jsx)(h.B,{onClick:c,id:e,text:e},e))),Object(se.jsx)(h.B,{onClick:function(e){e.target.innerText&&(a(e.target.innerText),o(!0))},id:al,text:al},al)]});return Object(se.jsxs)("div",{className:"LeftAlign",children:[Object(se.jsx)("h4",{children:"Choose Folder"}),Object(se.jsx)(Le.a,{placement:S.a.BOTTOM,content:l,children:Object(se.jsx)(h.b,{text:s})}),r&&Object(se.jsx)(h.y,{placeholder:"Or specify your own, e.g. 'locations/hallway'",onChange:function(e){i(e.target.value)}}),Object(se.jsx)("br",{}),Object(se.jsx)("h4",{children:"Choose File"}),Object(se.jsx)("input",{type:"file",multiple:!0,onChange:function(e){if(!e.target.files)return;const s=e.target.files;t(s)}}),Object(se.jsx)(h.b,{onClick:async function(){const t=n||s;if(!e||!t)return;const a=await el(e,t);alert(a)},children:"Upload"})]})};function il(e,t){e&&e.forEach((e=>{t(e),il(e.childNodes,t)}))}function rl(e,t){let s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[];const a={};function n(e,s){return Object.keys(s).map((a=>{const i="/"+e.join("/")+"/"+a;return{id:i,label:a,secondaryLabel:t(i),childNodes:"FILE"===s[a]?void 0:n([...e,a],s[a])}}))}return e.forEach((e=>k.a.set(a,e.split("/"),"FILE"))),s.forEach((e=>{a[e]&&"FILE"!==a[e]||(a[e]=[])})),n([],a)}var ol=Object(j.memo)((e=>{let{assetPath:t}=e;const s=t||ja.defaultAssetPath;return Object(se.jsx)(se.Fragment,{children:Object(se.jsx)("img",{alt:"asset",crossOrigin:"anonymous",src:Ja(s,!!t),width:"150px",onError:e=>{e.target.onerror=null,e.target.src=Ja(ja.defaultAssetPath,!1)}})})}));const cl=e=>Object(se.jsx)(E.a,{content:"Delete",children:Object(se.jsx)(h.w,{icon:"trash",onClick:ll(e)})}),ll=e=>async()=>{const t=window.confirm(`Are you sure you want to delete ${e}?\nThere is no undoing this action!`);alert(t?await async function(e){const t=await $c(e,"DELETE");return await t.text()||"Successfully Deleted"}(e):"Whew")};var dl=()=>{const{value:e}=Object(v.d)(Jc,[]),[t,s]=y.a.useState(""),[a,n]=y.a.useState({nodes:[]});y.a.useEffect((()=>{n({nodes:rl(e,cl,Kc)})}),[e]);return Object(se.jsxs)(se.Fragment,{children:[Object(se.jsx)(ol,{assetPath:t}),Object(se.jsx)(h.bb,{contents:a.nodes,onNodeClick:e=>{il(a.nodes,(e=>e.isSelected=!1)),e.isSelected=!e.isSelected,e.isExpanded=!e.isExpanded;const t=e.id.toString();e.childNodes||(s(t),sessionStorage.setItem("selectedAsset",t)),n({...a})}})]})},ul=s(521),hl=s(378);const pl=y.a.memo(Object(hl.b)((e=>{let{value:t}=e;return Object(se.jsx)("div",{children:Object(se.jsx)(h.b,{children:t})})}))),gl=y.a.memo(Object(hl.a)((e=>{let{items:t}=e;return Object(se.jsx)("div",{children:t&&t.map(((e,t)=>Object(se.jsx)(pl,{index:t,value:e},`item-${e}`)))})})));var ml=y.a.memo((e=>{let{chapterDetail:t,checkpointFilenames:s}=e;const{id:a}=t,{value:n,setValue:i,inputProps:r}=Object(v.b)(""),{value:o,setValue:c,inputProps:l}=Object(v.b)(""),{items:d,setItems:u,onSortEnd:p}=(()=>{const[e,t]=y.a.useState([]),s=y.a.useCallback((e=>{let{oldIndex:s,newIndex:a}=e;t((e=>Object(ul.a)(e,s,a)))}),[]);return{items:e,setItems:t,onSortEnd:s}})(),[m,j]=y.a.useState(!1),[O,f]=y.a.useState(new Date),[x,C]=y.a.useState([]),[S,w]=y.a.useState(!1);y.a.useEffect((()=>{i(t.title),c(t.imageUrl),f(new Date(t.openAt)),u(t.filenames),j(t.isPublished),C((s||[]).filter((e=>!t.filenames.includes(e))))}),[t,u,c,f,i,s,S]);const E=y.a.useCallback((e=>{u((t=>t.filter((t=>t!==e)))),C((t=>[...t,e]))}),[u]),T=y.a.useCallback((e=>{u((t=>[...t,e])),C((t=>t.filter((t=>t!==e))))}),[u]);return Object(se.jsxs)(se.Fragment,{children:[Object(se.jsxs)("h4",{children:["Title: ",Object(se.jsx)("input",{className:"bp4-input",type:"text",...r})]}),Object(se.jsx)("b",{children:"Open date: "}),O&&(k=O.toISOString(),b()(k).format("MMMM Do YYYY, HH:mm")),Object(se.jsx)(gt.a,{onChange:e=>{e&&f(e)}}),Object(se.jsxs)("h4",{children:["Image url: ",Object(se.jsx)("input",{className:"bp4-input",type:"text",...l}),Object(se.jsx)(h.b,{onClick:e=>window.open(Ja(o,!0)),children:"View"})]}),Object(se.jsx)("b",{children:"Checkpoint Txt Files"}),Object(se.jsx)(gl,{items:d,onSortEnd:p}),Object(se.jsx)("br",{}),d.length>0&&Object(se.jsx)(h.b,{icon:"delete",onClick:()=>d.map(E),children:"Clear checkpoint files"}),Object(se.jsx)("br",{}),Object(se.jsx)("b",{children:"All Txt Files"}),x&&x.map((e=>Object(se.jsx)("div",{children:Object(se.jsx)(h.b,{onClick:()=>T(e),icon:"add",children:e})},`choice-${e}`))),Object(se.jsx)("br",{}),Object(se.jsx)(h.b,{icon:"play",onClick:async()=>{zo.getInstance().setChapterSimStack(d),await go()},children:"Simulate Chapter"}),Object(se.jsx)("br",{}),Object(se.jsx)("br",{}),Object(se.jsx)(h.T,{checked:m,labelElement:"Published",onChange:()=>j(!m)}),Object(se.jsx)(h.b,{onClick:async()=>{const e={openAt:O.toISOString(),closeAt:bl(O).toISOString(),title:n,filenames:d,imageUrl:o,isPublished:m};if(!window.confirm(`Are you sure you want to save changes to ${JSON.stringify(e)}`))return;const t=parseInt(a)===jl?await sl("",{story:e}):await sl(a,{story:e});alert(t)},children:"Save Changes"}),Object(se.jsx)(h.b,{intent:g.a.WARNING,onClick:()=>{window.confirm("Are you you want to clear changes for this chapter?")&&(w(!S),alert("Cleared changes"))},children:"Clear Changes"}),Object(se.jsx)("br",{}),Object(se.jsx)("br",{}),Object(se.jsx)(h.b,{icon:"trash",intent:g.a.DANGER,onClick:async()=>{if(window.confirm("Are you sure you want to delete this chapter?")){const e=await async function(e){const t=await zc(e,"DELETE");return 204===t.status?"Chapter successfully deleted":t.text()}(a);alert(e)}},children:"Delete Chapter"})]});var k}));const bl=e=>(e.setFullYear(e.getFullYear()+1),e),jl=-1,yl={id:jl,title:"title goes here",imageUrl:"/locations/telebay/emergency.png",openAt:(new Date).toISOString(),closeAt:bl(new Date).toISOString(),isPublished:!1,filenames:[]};var Ol=y.a.memo((()=>{const{value:e}=Object(v.d)(Qc,[]),{value:t}=Object(v.d)(tl,[]),[s,a]=y.a.useState(jl);return Object(se.jsxs)(se.Fragment,{children:[Object(se.jsx)("h3",{children:"Chapter Simulator"}),Object(se.jsxs)("select",{className:"bp4-menu",onChange:e=>a(e.target.value),children:[t.map(((e,t)=>Object(se.jsx)("option",{value:t,children:`Chapter ${t}: ${e.title}`},t))),Object(se.jsx)("option",{value:jl,children:"Create new chapter"},jl)]}),Object(se.jsx)("hr",{}),Object(se.jsx)(ml,{chapterDetail:t[s]||yl,checkpointFilenames:e})]})}));const fl={key:ba.zektonDarkFont.key,size:35,align:Phaser.GameObjects.BitmapText.ALIGN_CENTER};var vl={maxOptButtonsRow:2,optButton:{xSpace:.9*ya.x,ySpace:.5*ya.y},gameTxtStorageName:{defaultChapter:"defaultChapter",checkpointTxt:"checkpointTxt"}};s(845);const xl=(e,t)=>{const s=new FileReader;s.readAsText(t),s.onloadend=t=>{s.result&&sessionStorage.setItem(e,s.result.toString())}};var Cl=function(e){let{storageName:t,s3TxtFiles:s}=e;const[a,n]=y.a.useState(s[0]),i=Object(se.jsx)("input",{type:"file",onChange:function(e){if(!e.target.files)return;const[s]=e.target.files;xl(t,s)},style:{width:"250px"}}),r=Object(se.jsxs)(se.Fragment,{children:[Object(se.jsx)("select",{className:"bp4-menu",onChange:async function(e){const s=e.target.value;n(s);const a=await fetch(Ja(`/stories/${s}`,!0),{headers:Sl()}),i=await a.text();sessionStorage.setItem(t,i)},children:s.map((e=>Object(se.jsx)("option",{value:e,children:e},e)))}),Object(se.jsx)(h.b,{icon:"download",onClick:()=>window.open(_r(a))})]});return Object(se.jsxs)("div",{className:"LeftAlign",children:[Object(se.jsx)("hr",{}),Object(se.jsxs)(h.V,{id:"Tabs",renderActiveTabPanelOnly:!0,children:[Object(se.jsx)(h.U,{id:"own",title:"Local",panel:i}),Object(se.jsx)(h.U,{id:"s3",title:"S3",panel:r})]},"vertical"),Object(se.jsx)("hr",{})]})};function Sl(){const e=new Headers;return e.append("Access-Control-Allow-Origin","*"),e}function wl(){const{value:e}=Object(v.d)(Qc,[]);return Object(se.jsxs)(se.Fragment,{children:[Object(se.jsx)("h3",{children:"Checkpoint Text Loader"}),Object(se.jsx)("b",{children:"Step 1: Choose default checkpoint"}),Object(se.jsx)(Cl,{s3TxtFiles:e,storageName:vl.gameTxtStorageName.defaultChapter}),Object(se.jsx)("b",{children:"Step 2: Choose checkpoint text"}),Object(se.jsx)(Cl,{s3TxtFiles:e,storageName:vl.gameTxtStorageName.checkpointTxt}),Object(se.jsx)("br",{}),Object(se.jsx)(h.b,{onClick:function(){zo.getInstance().getCurrentSceneRef().simulateCheckpoint()},icon:"play",children:"Simulate Checkpoint"}),Object(se.jsx)("br",{}),Object(se.jsx)("br",{}),Object(se.jsx)(h.b,{onClick:El,children:"Reset All Files"}),Object(se.jsx)("br",{})]})}function El(e){sessionStorage.setItem(vl.gameTxtStorageName.checkpointTxt,""),sessionStorage.setItem(vl.gameTxtStorageName.defaultChapter,"")}var Tl={storySimBg:{type:Fa.Image,key:"student-room",path:"/locations/deathCube_ext/shields-down.png"},shortButton:{type:Fa.Image,key:"short-button",path:"/ui/shortButton.png"},invertedButton:{type:Fa.Image,key:"inverted-button",path:"/ui/invertedColorButton.png"},blueUnderlay:{type:Fa.Image,key:"blue-underlay",path:"/ui/blueUnderlay.png"},topButton:{type:Fa.Image,key:"top-button",path:"/ui/topButton.png"},colorIcon:{type:Fa.Image,key:"color-icon",path:"/ui/colorIcon.png"},imageIcon:{type:Fa.Image,key:"image-icon",path:"/ui/imageIcon.png"},bboxIcon:{type:Fa.Image,key:"bbox-icon",path:"/ui/bboxIcon.png"},handIcon:{type:Fa.Image,key:"hand-icon",path:"/ui/handIcon.png"},listIcon:{type:Fa.Image,key:"list-icon",path:"/ui/listIcon.png"},eraseIcon:{type:Fa.Image,key:"erase-icon",path:"/ui/eraserIcon.png"},iconBg:{type:Fa.Image,key:"icon-bg",path:"/ui/modeIconBg.png"}};class kl extends Phaser.Scene{constructor(){super("StorySimulatorMenu"),this.layerManager=void 0,this.getLayerManager=()=>Za(this.layerManager)}preload(){zo.getInstance().setCurrentSceneRef(this),this.layerManager=new xi(this),li(this),Object.values(Va).forEach((e=>this.load.image(e.key,Ja(e.path,!1)))),Object.values(Tl).forEach((e=>this.load.image(e.key,Ja(e.path,!1)))),Object.values(ba).forEach((e=>this.load.bitmapFont(e.key,e.pngPath,e.fntPath))),zo.getInstance().getSoundManager().loadSoundAssetMap($a)}async create(){"student"!==zo.getInstance().getAccountInfo().role?(this.renderBackground(),this.renderOptionButtons()):console.log("Students cannot use story sim")}renderOptionButtons(){const e=new Phaser.GameObjects.Container(this,0,0),t=this.getOptionButtons(),s=Ca({numOfItems:t.length,maxXSpace:vl.optButton.xSpace,maxYSpace:vl.optButton.ySpace,numItemLimit:vl.maxOptButtonsRow,redistributeLast:!0});e.add(t.map(((e,t)=>this.createOptButton(e.text,s[t][0],s[t][1],e.callback)))),this.getLayerManager().addToLayer(qa.UI,e)}getOptionButtons(){return[{text:"Object Placement",callback:()=>{zo.getInstance().setStorySimState(Wc.ObjectPlacement),this.getLayerManager().clearAllLayers(),this.scene.start("ObjectPlacement")}},{text:"Checkpoint Simulator",callback:()=>{zo.getInstance().setStorySimState(Wc.CheckpointSim)}},{text:"Asset Uploader",callback:()=>{zo.getInstance().setStorySimState(Wc.AssetUploader)}},{text:"Chapter Simulator",callback:()=>{zo.getInstance().setStorySimState(Wc.ChapterSim)}}]}createOptButton(e,t,s,a){return Cn(this,{assetKey:Tl.invertedButton.key,message:e,textConfig:{x:0,y:0,oriX:.5,oriY:.5},bitMapTextStyle:fl,onUp:a}).setPosition(t,s)}simulateCheckpoint(){const e=sessionStorage.getItem(vl.gameTxtStorageName.defaultChapter)||"",t=sessionStorage.getItem(vl.gameTxtStorageName.checkpointTxt)||"";if(""===e&&""===t)return;this.getLayerManager().clearAllLayers(),ho.parse(e),t&&ho.parse(t,!0);const s=ho.checkpoint;this.scene.start("GameManager",{gameCheckpoint:s,chapterNum:-1,checkpointNum:-1})}renderBackground(){const e=new Phaser.GameObjects.Image(this,Oa.x,Oa.y,Tl.storySimBg.key);e.setDisplaySize(ya.x,ya.y);const t=new Phaser.GameObjects.Image(this,Oa.x,Oa.y,Tl.blueUnderlay.key).setAlpha(.5);this.getLayerManager().addToLayer(qa.Background,e),this.getLayerManager().addToLayer(qa.Background,t)}}var Al=kl;class Il{constructor(){this.backgroundAssetPath=void 0,this.objectPlacement=void 0,this.x=void 0,this.y=void 0,this.getObjectPlacement=()=>Za(this.objectPlacement),this.x=Oa.x,this.y=Oa.y}initialise(e){this.objectPlacement=e}async loadBackground(){const e=sessionStorage.getItem("selectedAsset");if(!e||!e.startsWith("/locations/"))return;this.backgroundAssetPath=e;const t=`!${e}`;this.getObjectPlacement().addAsset(t,e);const s=await Ar(this.getObjectPlacement(),t,Ja(e,!0));this.renderBackground(s)}renderBackground(e){if("!"!==e[0])return;this.getObjectPlacement().getLayerManager().clearLayerContents(qa.Background);const t=new Phaser.GameObjects.Image(this.getObjectPlacement(),Oa.x,Oa.y,e).setInteractive();this.getObjectPlacement().getLayerManager().addToLayer(qa.Background,t)}getBackgroundAssetPath(){return this.backgroundAssetPath}screenLog(){return this.backgroundAssetPath+"\n"}}let Nl;!function(e){e[e.DrawBBox=0]="DrawBBox",e[e.DragResizeObj=1]="DragResizeObj"}(Nl||(Nl={}));class Ml{constructor(){this.checkpointTitle="boundingBoxes",this.objectPlacement=void 0,this.bboxBeingDrawn=void 0,this.startingCoordinates=void 0,this.bboxDetailMap=void 0,this.getObjectPlacement=()=>Za(this.objectPlacement),this.bboxDetailMap=new Map}initialise(e){this.objectPlacement=e,this.addBBoxListeners(e)}addBBoxListeners(e){this.getObjectPlacement().getInputManager().registerEventListener("pointerdown",(()=>{this.getObjectPlacement().isCursorMode(Nl.DrawBBox)&&(this.bboxBeingDrawn=this.createNewBBox())})),this.getObjectPlacement().getInputManager().registerEventListener("pointerup",(()=>{if(this.getObjectPlacement().isCursorMode(Nl.DrawBBox)&&this.bboxBeingDrawn){if(this.bboxBeingDrawn.displayWidth<=2||this.bboxBeingDrawn.displayHeight<=2)return void this.bboxBeingDrawn.destroy();this.bboxBeingDrawn.x+=this.bboxBeingDrawn.displayWidth/2,this.bboxBeingDrawn.y+=this.bboxBeingDrawn.displayHeight/2,this.bboxBeingDrawn.setOrigin(.5),this.registerBBox(this.bboxBeingDrawn),e.input.setDraggable(this.bboxBeingDrawn),this.getObjectPlacement().setActiveSelection(this.bboxBeingDrawn),this.startingCoordinates=void 0,this.bboxBeingDrawn=void 0}}))}createNewBBox(){const[e,t]=this.getObjectPlacement().getCoordinates(),s=new Phaser.GameObjects.Rectangle(this.getObjectPlacement(),e,t,1,1,va.white).setOrigin(0).setAlpha(.1).setInteractive().setDataEnabled();return this.startingCoordinates=[e,t],this.getObjectPlacement().getLayerManager().addToLayer(qa.BBox,s),s}registerBBox(e){const t="bbox"+this.getObjectPlacement().generateItemIdNumber(),s={id:t,x:e.x,y:e.y,width:e.displayWidth,height:e.displayHeight};this.bboxDetailMap.set(t,s),e.data.set("itemId",t),e.data.set("type","bbox")}getLoggables(){return[...this.bboxDetailMap.values()]}getItemById(e){return this.bboxDetailMap.get(e)}resizeWhileBeingDrawn(e){if(!this.getObjectPlacement().isCursorMode(Nl.DrawBBox)||!this.startingCoordinates||!this.bboxBeingDrawn)return;const[t,s]=this.startingCoordinates,a=e.input.x,n=e.input.y;Gn(this.bboxBeingDrawn,a-t,n-s)}checkpointTxtLog(){const e=[];return this.bboxDetailMap.forEach((t=>{const s=["+"+t.id,ti.toIntString(t.x),ti.toIntString(t.y),ti.toIntString(t.width),ti.toIntString(t.height)];e.push(s.join(", ")),e.push("    show_dialogue*(click)")})),e}setAttribute(e,t,s){const a=e.data.get("itemId"),n=this.bboxDetailMap.get(a);n&&(n[t]=s)}deleteAll(){this.bboxDetailMap.clear()}delete(e){const t=e.data.get("itemId");this.bboxDetailMap.delete(t)}}var Pl={icon:{bgSize:55,size:40,yInterval:15},alpha:{inactive:.7,hover:1,active:.9}};class Rl extends Phaser.GameObjects.Container{constructor(e,t,s){let a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:Nl.DragResizeObj;super(e,t,s),this.isModes=void 0,this.currCursorMode=void 0,this.cursorModes=void 0,this.currActiveModeIdx=void 0,this.currCursorMode=a,this.isModes=new Array,this.cursorModes=new Array,this.currActiveModeIdx=ja.nullSequenceNumber}getCurrCursorMode(){return this.currCursorMode}setCursorMode(e){this.currCursorMode=e}addCursorMode(e,t){let s=!(arguments.length>2&&void 0!==arguments[2])||arguments[2],a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"",n=arguments.length>4&&void 0!==arguments[4]?arguments[4]:ja.nullFunction,i=arguments.length>5&&void 0!==arguments[5]?arguments[5]:ja.nullFunction,r=arguments.length>6&&void 0!==arguments[6]?arguments[6]:ja.nullFunction;const o=new Phaser.GameObjects.Container(e,0,0);this.isModes.push(s),this.cursorModes.push(o);const c=this.cursorModes.length-1,l=new ka(e,0,0,a),d=Cn(e,{assetKey:Tl.iconBg.key,onUp:()=>{this.isModes[c]&&(this.currActiveModeIdx=c),n(),this.renderCursorModesContainer()},onHover:()=>{""!==a&&l.setVisible(!0),o.setAlpha(Pl.alpha.hover),i()},onOut:()=>{l.setVisible(!1);const e=c===this.currActiveModeIdx&&this.isModes[c];o.setAlpha(e?Pl.alpha.active:Pl.alpha.inactive),r()},onPointerMove:e=>{l.x=e.x-o.x-100,l.y=e.y-o.y-100},onHoverEffect:!1}),u=new Phaser.GameObjects.Sprite(e,0,0,t).setDisplaySize(Pl.icon.size,Pl.icon.size);d.add(u),o.add([d,l])}renderCursorModesContainer(){this.removeAll(!1);let e=0;this.cursorModes.forEach(((t,s)=>{t.setPosition(0,e);const a=s===this.currActiveModeIdx&&this.isModes[s];t.setAlpha(a?Pl.alpha.active:Pl.alpha.inactive),this.add(t),e+=Pl.icon.bgSize+Pl.icon.yInterval}))}}const _l={key:ba.zektonFont.key,size:27,align:Phaser.GameObjects.BitmapText.ALIGN_LEFT};function Ll(e){return e.split("/").pop().split(".")[0]}const Dl=e=>"    "+e;class Bl{constructor(){this.detailMapContainer=void 0,this.objectPlacement=void 0,this.getObjectPlacement=()=>Za(this.objectPlacement)}initialise(e){this.objectPlacement=e}printCheckpoint(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"/locations/yourRoom-dim/normal.png",t=arguments.length>1?arguments[1]:void 0;const s=""===e?"default":Ll(e),a=t.map((e=>{const t=e.checkpointTxtLog();if(!t)return"";return`${e.checkpointTitle}\n${t.map(Dl).map(Dl).join("\n")}`})),n=`\nstartingLoc: ${s}\n\nobjectives\n    talk\n\nlocations\n    ${s}, ${e}, ${ti.toCapitalizedWords(e)}\n\n${s}\n    modes: explore\n    actions\n        show_dialogue(welcome)\n${a.map(Dl).join("\n")}\n\ndialogues\n    welcome\n        Congrats on creating your scene\n    click\n        Invisible bounding box is right here\n`;alert("Chapter ready!"),console.log(n)}showDetailMap(e){this.detailMapContainer=new Phaser.GameObjects.Container(this.getObjectPlacement(),0,0),e.forEach((e=>{const t=new Phaser.GameObjects.Rectangle(this.getObjectPlacement(),e.x,e.y,400,210,va.darkBlue).setOrigin(0,.5).setAlpha(.9),s=Aa(this.getObjectPlacement(),this.formatObjectDetails(e),{x:e.x+20,y:e.y+10,oriX:0,oriY:.6},_l).setLetterSpacing(3);this.detailMapContainer.add([t,s])})),this.getObjectPlacement().add.existing(this.detailMapContainer)}formatObjectDetails(e){return Object.entries(e).map((e=>{let[t,s]=e;return`${t}: ${"number"===typeof s?ti.toIntString(s):s.toString()}`})).join("\n")}hideDetailMap(){this.detailMapContainer&&this.detailMapContainer.destroy()}}class Ul{constructor(){this.checkpointTitle="objects",this.objectPlacement=void 0,this.objectDetailMap=void 0,this.getObjectPlacement=()=>Za(this.objectPlacement),this.objectDetailMap=new Map}initialise(e){this.objectPlacement=e,this.objectDetailMap=new Map}async loadObject(){const e=sessionStorage.getItem("selectedAsset");if(!e)return;const t=`#${e}`;this.getObjectPlacement().addAsset(t,e);const s=await Ar(this.getObjectPlacement(),t,Ja(e,!0));this.renderObject(s)}renderObject(e){if("#"!==e[0])return;const t=new Phaser.GameObjects.Image(this.getObjectPlacement(),Oa.x,Oa.y,e).setInteractive().setDataEnabled();this.getObjectPlacement().input.setDraggable(t),this.getObjectPlacement().getLayerManager().addToLayer(qa.Objects,t),this.registerObject(e,t)}registerObject(e,t){const s=this.generateItemId(e,this.getObjectPlacement().generateItemIdNumber()),a={id:s,assetKey:e,assetPath:Za(this.getObjectPlacement().getAssetPath(e)),x:Oa.x,y:Oa.y};this.objectDetailMap.set(s,a),t.data.set("itemId",s),t.data.set("type","object"),this.getObjectPlacement().setActiveSelection(t)}generateItemId(e,t){return`${Ll(e)}${t}`}getLoggables(){return[...this.objectDetailMap.values()]}checkpointTxtLog(){return Array.from(this.objectDetailMap.values()).map((e=>{const t=["+"+e.id,e.assetPath,ti.toIntString(e.x),ti.toIntString(e.y)];return e.width&&(t.push(ti.toIntString(e.width)),t.push(ti.toIntString(e.height))),t.join(", ")}))}setAttribute(e,t,s){const a=e.data.get("itemId"),n=this.objectDetailMap.get(a);n&&(n[t]=s)}deleteAll(){this.objectDetailMap.clear()}delete(e){const t=e.data.get("itemId");this.objectDetailMap.delete(t)}}var Gl={activeSelectMargin:30,scaleFactor:1.02};class Fl{constructor(){this.activeSelection=void 0,this.activeSelectRect=void 0,this.objectPlacement=void 0,this.getObjectPlacement=()=>Za(this.objectPlacement)}initialise(e){this.objectPlacement=e,this.trackDraggables(e),this.drawActiveSelectRect(),this.bindDeleteKey()}drawActiveSelectRect(){this.activeSelectRect=new Phaser.GameObjects.Rectangle(this.getObjectPlacement(),0,0,1,1,0).setAlpha(.3),this.getObjectPlacement().getLayerManager().addToLayer(qa.Selector,this.activeSelectRect)}trackDraggables(e){e.getInputManager().registerEventListener("drag",((t,s,a,n)=>{e.isCursorMode(Nl.DrawBBox)||(e.getCursorManager().setCursorMode(Nl.DragResizeObj),s.x=a,s.y=n),"object"===s.data.get("type")&&(e.setObjAttribute(s,"x",a),e.setObjAttribute(s,"y",n),this.setActiveSelection(s)),"bbox"===s.data.get("type")&&(e.setBBoxAttribute(s,"x",a),e.setBBoxAttribute(s,"y",n),this.setActiveSelection(s))}))}resizeActive(e){const t=this.getObjectPlacement();if(!this.activeSelection||!this.activeSelectRect)return;const s=e?Gl.scaleFactor:1/Gl.scaleFactor;!function(e,t){e.displayWidth*=t,e.displayHeight*=t}(this.activeSelection,s),this.activeSelectRect.displayHeight=this.activeSelection.displayHeight+Gl.activeSelectMargin,this.activeSelectRect.displayWidth=this.activeSelection.displayWidth+Gl.activeSelectMargin,"object"===this.activeSelection.data.get("type")&&(t.setObjAttribute(this.activeSelection,"width",Math.abs(this.activeSelection.displayWidth)),t.setObjAttribute(this.activeSelection,"height",Math.abs(this.activeSelection.displayHeight))),"bbox"===this.activeSelection.data.get("type")&&(t.setBBoxAttribute(this.activeSelection,"width",Math.abs(this.activeSelection.displayWidth)),t.setBBoxAttribute(this.activeSelection,"height",Math.abs(this.activeSelection.displayHeight)))}setActiveSelection(e){this.activeSelectRect&&(this.activeSelectRect.setAlpha(.3),this.activeSelection=e,this.activeSelectRect.x=e.x,this.activeSelectRect.y=e.y,this.activeSelectRect.displayHeight=e.displayHeight+Gl.activeSelectMargin,this.activeSelectRect.displayWidth=e.displayWidth+Gl.activeSelectMargin)}deselect(){this.activeSelectRect.setAlpha(0),this.activeSelection=void 0}bindDeleteKey(){[Phaser.Input.Keyboard.KeyCodes.BACKSPACE,Phaser.Input.Keyboard.KeyCodes.DELETE].forEach((e=>this.getObjectPlacement().getInputManager().registerKeyboardListener(e,"up",(()=>{this.deleteActiveSelection(),this.deselect()}))))}deleteActiveSelection(){if(this.activeSelection){switch(this.getType(this.activeSelection)){case"object":this.getObjectPlacement().deleteObj(this.activeSelection);break;case"bbox":this.getObjectPlacement().deleteBBox(this.activeSelection)}this.activeSelection.destroy()}}getType(e){var t;return null===(t=this.activeSelection)||void 0===t?void 0:t.data.get("type")}}var Hl={cursor:{x:100,y:100}};class Vl extends Phaser.Scene{constructor(){super("ObjectPlacement"),this.layerManager=void 0,this.inputManager=void 0,this.transformManager=void 0,this.cursorModes=void 0,this.bboxManager=void 0,this.objectManager=void 0,this.backgroundManager=void 0,this.logManager=void 0,this.assetMap=void 0,this.itemIdNumber=void 0,this.openBracket=void 0,this.closedBracket=void 0,this.getCursorManager=()=>Za(this.cursorModes),this.getInputManager=()=>Za(this.inputManager),this.getLayerManager=()=>Za(this.layerManager),this.objectManager=new Ul,this.bboxManager=new Ml,this.backgroundManager=new Il,this.logManager=new Bl,this.transformManager=new Fl,this.cursorModes=void 0,this.itemIdNumber=0,this.assetMap=new Map}init(){this.layerManager=new xi(this),this.inputManager=new vi(this),this.objectManager=new Ul,this.bboxManager=new Ml,this.backgroundManager=new Il,this.logManager=new Bl,this.transformManager=new Fl,this.cursorModes=void 0,this.itemIdNumber=0,this.assetMap=new Map}create(){zo.getInstance().setCurrentSceneRef(this),this.renderBackground(),this.createUIButtons(),this.backgroundManager.initialise(this),this.objectManager.initialise(this),this.bboxManager.initialise(this),this.transformManager.initialise(this),this.logManager.initialise(this),this.openBracket=this.input.keyboard.addKey(Phaser.Input.Keyboard.KeyCodes.OPEN_BRACKET),this.closedBracket=this.input.keyboard.addKey(Phaser.Input.Keyboard.KeyCodes.CLOSED_BRACKET)}update(){this.openBracket&&this.openBracket.isDown&&this.transformManager.resizeActive(!1),this.closedBracket&&this.closedBracket.isDown&&this.transformManager.resizeActive(!0),this.bboxManager.resizeWhileBeingDrawn(this)}createUIButtons(){const e=new Phaser.GameObjects.Container(this,0,0),t=new Xi(this,(()=>{this.cleanUp(),zo.getInstance().setStorySimState(Wc.Default),this.scene.start("StorySimulatorMenu")}));this.cursorModes=new Rl(this,Hl.cursor.x,Hl.cursor.y),this.populateCursorModes(),e.add(this.cursorModes),e.add(t),this.getLayerManager().addToLayer(qa.UI,e)}renderBackground(){const e=new Phaser.GameObjects.Image(this,Oa.x,Oa.y,Tl.storySimBg.key);e.setDisplaySize(ya.x,ya.y),this.getLayerManager().addToLayer(qa.Background,e)}populateCursorModes(){this.cursorModes&&(this.cursorModes.addCursorMode(this,Tl.colorIcon.key,!1,"Set background",(async()=>await this.backgroundManager.loadBackground())),this.cursorModes.addCursorMode(this,Tl.imageIcon.key,!1,"Add selected object",(async()=>await this.objectManager.loadObject())),this.cursorModes.addCursorMode(this,Tl.bboxIcon.key,!0,"Draw bounding boxes",(()=>this.cursorModes.setCursorMode(Nl.DrawBBox))),this.cursorModes.addCursorMode(this,Tl.handIcon.key,!0,"Drag or resize",(()=>this.cursorModes.setCursorMode(Nl.DragResizeObj))),this.cursorModes.addCursorMode(this,Tl.listIcon.key,!1,"Print coordinates",(()=>this.logManager.printCheckpoint(this.backgroundManager.getBackgroundAssetPath(),[this.objectManager,this.bboxManager])),(()=>this.logManager.showDetailMap([...this.objectManager.getLoggables(),...this.bboxManager.getLoggables()])),(()=>this.logManager.hideDetailMap())),this.cursorModes.addCursorMode(this,Tl.eraseIcon.key,!1,"Erase all",(()=>{window.confirm("Are you sure you want to delete?")&&(this.getLayerManager().clearSeveralLayers([qa.Background,qa.BBox,qa.Objects]),this.objectManager.deleteAll(),this.bboxManager.deleteAll(),this.transformManager.deselect(),this.renderBackground())})),this.cursorModes.renderCursorModesContainer())}getCoordinates(){return[this.input.x,this.input.y]}isCursorMode(e){return this.getCursorManager().getCurrCursorMode()===e}cleanUp(){this.getInputManager().clearListeners(),this.getLayerManager().clearAllLayers()}addAsset(e,t){this.assetMap.set(e,t)}getAssetPath(e){return this.assetMap.get(e)}generateItemIdNumber(){return this.itemIdNumber++}setActiveSelection(e){this.transformManager.setActiveSelection(e)}setObjAttribute(e,t,s){this.objectManager.setAttribute(e,t,s)}deleteObj(e){this.objectManager.delete(e)}setBBoxAttribute(e,t,s){this.bboxManager.setAttribute(e,t,s)}deleteBBox(e){this.bboxManager.delete(e)}}const Wl={debug:!0,type:ma.CANVAS,width:ya.x,height:ya.y,physics:{default:"arcade"},scale:{mode:ma.Scale.FIT,parent:"game-display"},fps:{target:24}};var Xl=function(){const e=Object(v.f)((e=>e.session)),[t,s]=j.useState(Wc.Default);return j.useEffect((()=>{(()=>{const e=new zo(Wl,qo.Simulator);return e.scene.add("StorySimulatorMenu",Al,!0),e.scene.add("ObjectPlacement",Vl),e.scene.add("GameManager",or),e.scene.add("CheckpointTransition",xo),e})().setStorySimStateSetter(s)}),[]),j.useEffect((()=>{zo.getInstance().setAccountInfo({accessToken:e.accessToken,refreshToken:e.refreshToken,role:e.role,name:e.name})}),[e]),Object(se.jsx)(se.Fragment,{children:Object(se.jsxs)("div",{className:"StorySimulatorWrapper",children:[Object(se.jsx)("div",{id:"game-display"}),Object(se.jsxs)("div",{className:"LeftAlign StorySimulatorPanel",children:[t===Wc.Default&&Object(se.jsx)(se.Fragment,{children:Object(se.jsx)("h3",{children:"Welcome to story simulator!"})}),t===Wc.CheckpointSim&&Object(se.jsx)(wl,{}),t===Wc.ObjectPlacement&&Object(se.jsxs)(se.Fragment,{children:[Object(se.jsx)("h3",{children:"Asset Selection"}),Object(se.jsx)(dl,{})]}),t===Wc.AssetUploader&&Object(se.jsxs)(se.Fragment,{children:[Object(se.jsx)("h3",{children:"Asset uploader"}),Object(se.jsx)(nl,{}),Object(se.jsx)("h3",{children:"Asset Viewer"}),Object(se.jsx)(dl,{})]}),t===Wc.ChapterSim&&Object(se.jsx)(Ol,{})]})]})})};const $l=[{field:"name"},{field:"NUS Net ID"},{field:"Assessment Xp"},{field:"Achievement Xp"}],ql={resizable:!0,sortable:!0},zl=(e,t,s,a)=>0===s?"(none)":t!==s?`(#${e*t-19} - #${e*t})`:`(#${e*t-19} - #${a})`;var Yl=()=>{const e=Object(r.c)(),t=Object(v.f)((e=>e.session.allUserXp)),[s,a]=Object(j.useState)([]),[n,i]=Object(j.useState)(),[o,c]=Object(j.useState)({currPage:1,maxPages:1,rowCountString:"(none)",isBackDisabled:!0,isForwardDisabled:!0});Object(j.useEffect)((()=>{if(t){const e=t.map((e=>{const[t,s,a,n]=e;return{name:null!==t&&void 0!==t?t:"","NUS Net ID":null!==s&&void 0!==s?s:"","Assessment Xp":null!==a&&void 0!==a?a:"0","Achievement Xp":null!==n&&void 0!==n?n:"0"}}));a(e)}}),[t]);const l=Object(j.useCallback)((()=>{n&&n.exportDataAsCsv({fileName:`SA XP Count (${(new Date).toISOString()}).csv`,columnKeys:["name","NUS Net ID","Assessment Xp","Achievement Xp"]})}),[n]),d=Object(j.useCallback)((()=>{n&&n.sizeColumnsToFit()}),[n]),p=Object(j.useCallback)((e=>()=>{if(n)switch(e){case"first":return n.paginationGoToFirstPage();case"prev":return n.paginationGoToPreviousPage();case"next":return n.paginationGoToNextPage();case"last":return n.paginationGoToLastPage()}}),[n]),g=Object(j.useCallback)((()=>{if(n){const e=n.paginationGetTotalPages(),t=0===e?0:n.paginationGetCurrentPage()+1;c({currPage:t,maxPages:e,rowCountString:zl(25,t,e,n.paginationGetRowCount()),isBackDisabled:0===e||1===t,isForwardDisabled:0===e||t===e})}}),[n,c]),m=Object(j.useCallback)((e=>{i(e.api),g()}),[i,g]),b=()=>Object(se.jsx)("div",{className:"grading-controls",children:Object(se.jsxs)("div",{className:"GridControls ag-grid-controls",children:[Object(se.jsx)("div",{style:{width:"130px"},className:"left-controls"}),Object(se.jsxs)("div",{className:"centre-controls",children:[Object(se.jsx)(h.b,{icon:w.a.CHEVRON_BACKWARD,onClick:p("first"),minimal:!0,disabled:o.isBackDisabled}),Object(se.jsx)(h.b,{icon:w.a.CHEVRON_LEFT,onClick:p("prev"),minimal:!0,disabled:o.isBackDisabled}),Object(se.jsxs)(h.b,{className:"pagination-details hidden-xs",disabled:!0,minimal:!0,children:[Object(se.jsx)("div",{children:`Page ${o.currPage} of ${o.maxPages}`}),Object(se.jsx)("div",{children:o.rowCountString})]}),Object(se.jsx)(h.b,{icon:w.a.CHEVRON_RIGHT,onClick:p("next"),minimal:!0,disabled:o.isForwardDisabled}),Object(se.jsx)(h.b,{icon:w.a.CHEVRON_FORWARD,onClick:p("last"),minimal:!0,disabled:o.isForwardDisabled})]}),Object(se.jsx)("div",{className:"right-controls",children:Object(se.jsx)(h.b,{icon:w.a.EXPORT,onClick:l,children:Object(se.jsx)("span",{className:"hidden-xs",children:"Export to CSV"})})})]})}),y=Object(se.jsx)(h.G,{className:"Grading",description:"Fetching XP...",icon:Object(se.jsx)(h.R,{size:h.S.LARGE})}),O=Object(se.jsxs)("div",{className:"Grading",children:[Object(se.jsx)(b,{}),Object(se.jsx)(h.i,{}),Object(se.jsx)(_s.AgGridReact,{domLayout:"autoHeight",className:"ag-grid-parent ag-theme-balham",columnDefs:$l,onGridReady:m,onPaginationChanged:g,onGridSizeChanged:d,defaultColDef:ql,rowData:s,rowHeight:30,pagination:!0,paginationPageSize:20,suppressCellSelection:!0,suppressMovableColumns:!0,suppressPaginationPanel:!0})]});return Object(se.jsx)(_e.a,{loadContentDispatch:()=>e(Object(u.fetchAllUserXp)()),display:t?O:y,fullWidth:!1})};const Kl=()=>{const{path:e,url:t}=Object(o.k)(),s=Object(r.c)();j.useEffect((()=>{s(Object(u.fetchNotifications)())}),[s]);const a=Object(v.f)((e=>e.session.assessmentConfigurations)),n=Object(v.f)((e=>e.session.enableGame)),i=Object(v.f)((e=>e.session.role)),c="student"!==i?[Object(se.jsx)(o.c,{path:`${e}/groundcontrol`,component:Nc},0),Object(se.jsx)(o.c,{path:`${e}/grading/${Ye.e}`,component:yc},1),Object(se.jsx)(o.c,{path:`${e}/xpcalculation`,component:Yl},2),Object(se.jsx)(o.c,{path:`${e}/sourcereel`,component:Vc},3),Object(se.jsx)(o.c,{path:`${e}/storysimulator`,component:Xl},4),Object(se.jsx)(o.c,{path:`${e}/dashboard`,component:ga},5)]:null;return Object(se.jsx)("div",{className:"Academy",children:Object(se.jsxs)(o.e,{children:[null===a||void 0===a?void 0:a.map((t=>Object(se.jsx)(o.c,{path:`${e}/${Object(Ee.a)(t.type)}/${Ye.d}`,children:Object(se.jsx)(ze,{assessmentConfiguration:t})},t.type))),n&&Object(se.jsx)(o.c,{path:`${e}/game`,component:Jo}),Object(se.jsx)(o.c,{path:`${e}/sourcecast/:sourcecastId?`,component:Ks}),Object(se.jsx)(o.c,{path:`${e}/achievements`,component:fs}),Object(se.jsx)(o.c,{exact:!0,path:e,children:Object(se.jsx)(o.b,{push:!1,to:n?`${t}/game`:a&&a.length>0?`${t}/${Object(Ee.a)(a[0].type)}`:"admin"===i?`${t}/adminpanel`:"/404"})}),c,"admin"===i&&Object(se.jsx)(o.c,{path:`${e}/adminpanel`,component:da}),Object(se.jsx)(o.c,{component:Ke})]})})};var Ql=()=>{const e=Object(r.c)(),t=Object(v.f)((e=>e.session.courseId)),{courseId:s}=Object(o.j)(),a=null!=s?parseInt(s,10):void 0;return j.useEffect((()=>{void 0!==a&&t!==a&&e(Object(u.updateLatestViewedCourse)(a))}),[t,e,a]),a===t?Object(se.jsx)(Kl,{}):Object(se.jsx)("div",{className:f()("Academy-switching-courses",p.a.DARK),children:Object(se.jsx)(h.e,{className:p.a.ELEVATION_4,children:Object(se.jsx)(h.G,{description:"Switching courses...",icon:Object(se.jsx)(h.R,{size:h.S.LARGE})})})})};const Jl=Object(se.jsx)("span",{className:"dot",children:"\u2022"});var Zl=()=>Object(se.jsx)("div",{className:"outsideDetails",children:Object(se.jsxs)(h.e,{className:"contributorsDetails",elevation:C.a.ONE,children:[Object(se.jsx)(h.q,{children:"The Team behind the Source Academy"}),Object(se.jsxs)("p",{className:"description",children:["The ",Object(se.jsx)("i",{children:"Source Academy"})," is designed and developed by a team of students, most of who have used the system to learn the fundamentals of computing and enjoyed it. This page includes all developers who contributed to the Source Academy ",Object(se.jsx)("i",{children:"Merlin"})," (2023) and its precursors"," ",Object(se.jsx)("i",{children:"Rook"})," (2022), ",Object(se.jsx)("i",{children:"Knight"})," (2020) and ",Object(se.jsx)("i",{children:"Cadet"})," (2018). These versions succeeded Source Academy 2 (2017) and ultimately the original Source Academy (2016)."]}),Object(se.jsxs)("div",{className:"leadership",children:[Object(se.jsx)(h.s,{children:Object(se.jsx)("strong",{children:Object(se.jsx)("u",{children:"2023 Leadership (Merlin)"})})}),Object(se.jsxs)("p",{children:["Chow En Rong,",Object(se.jsx)("br",{}),"Shen Yi Hong",Object(se.jsx)("br",{}),Object(se.jsx)("strong",{children:"(Frontend)"})]}),Jl,Object(se.jsxs)("p",{children:["Chen Yanyu",Object(se.jsx)("br",{}),Object(se.jsx)("strong",{children:"(Backend)"})]}),Jl,Object(se.jsxs)("p",{children:["Gokul Rajiv,",Object(se.jsx)("br",{}),"Lee Hyung Woon",Object(se.jsx)("br",{}),Object(se.jsx)("strong",{children:"(Game)"})]}),Jl,Object(se.jsxs)("p",{children:["Shen Yi Hong,",Object(se.jsx)("br",{}),"Zhan Jie,",Object(se.jsx)("br",{}),Object(se.jsx)("strong",{children:"(Source)"})]}),Jl,Object(se.jsxs)("p",{children:["Lee Yi,",Object(se.jsx)("br",{}),"Joel Leow",Object(se.jsx)("br",{}),Object(se.jsx)("strong",{children:"(Modules)"})]}),Jl,Object(se.jsxs)("p",{children:["Richard Dominick",Object(se.jsx)("br",{}),Object(se.jsx)("strong",{children:"(Robotics)"})]}),Jl,Object(se.jsxs)("p",{children:["Boyd Anderson,",Object(se.jsx)("br",{}),"Martin Henz,",Object(se.jsx)("br",{}),"Eldric Liew,",Object(se.jsx)("br",{}),"Low Kok Lim,",Object(se.jsx)("br",{}),"Sanka Rasnayaka",Object(se.jsx)("br",{}),Object(se.jsx)("strong",{children:"(Coordination)"})]})]}),Object(se.jsxs)("div",{className:"hallOfFame",children:[Object(se.jsx)(h.s,{children:Object(se.jsx)("strong",{children:Object(se.jsx)("u",{children:"Hall of Fame"})})}),Object(se.jsx)("p",{children:Object(se.jsx)("strong",{children:"Cadet architect"})}),Object(se.jsx)("p",{children:"Evan Sebastian"}),Object(se.jsx)("p",{children:Object(se.jsx)("strong",{children:"Cadet core team"})}),Object(se.jsxs)("p",{children:["Julius Putra Tanu Setiaji ",Jl," Lee Ning Yuan ",Jl," Vignesh Shankar ",Jl," Thomas Tan ",Jl," ","Chen Shaowei"]}),Object(se.jsx)("p",{children:Object(se.jsx)("strong",{children:"Graphic design"})}),Object(se.jsxs)("p",{children:["Ng Tse Pei ",Jl," Joey Yeo ",Jl," Tan Yu Wei ",Jl," Sigmund Chianasta"]})]}),Object(se.jsxs)("div",{className:"leadership",children:[Object(se.jsx)("p",{children:Object(se.jsx)("strong",{children:"2019 Leadership"})}),Object(se.jsx)("br",{}),Object(se.jsxs)("p",{children:["Liow Jia Chen",Object(se.jsx)("br",{}),"(Backend)"]}),Jl,Object(se.jsxs)("p",{children:["Ge Shuming",Object(se.jsx)("br",{}),"(Frontend)"]}),Jl,Object(se.jsxs)("p",{children:["Rahul Rajesh",Object(se.jsx)("br",{}),"(DevOps)"]}),Jl,Object(se.jsxs)("p",{children:["Daryl Tan",Object(se.jsx)("br",{}),"(Source)"]}),Jl,Object(se.jsxs)("p",{children:["She Jiayu",Object(se.jsx)("br",{}),"(Tools)"]})]}),Object(se.jsxs)("div",{className:"leadership",children:[Object(se.jsx)("p",{className:"evenWider",children:Object(se.jsx)("strong",{children:"2020 Leadership (Knight)"})}),Object(se.jsx)("br",{}),Object(se.jsxs)("p",{children:["Tiffany Chong",Object(se.jsx)("br",{}),"(Game)"]}),Jl,Object(se.jsxs)("p",{children:["Anthony Halim",Object(se.jsx)("br",{}),"(Architecture)"]}),Jl,Object(se.jsxs)("p",{children:["Kan Yip Keng, Jet",Object(se.jsx)("br",{}),"(Frontend)"]}),Jl,Object(se.jsxs)("p",{children:["Low Jun Kai, Sean",Object(se.jsx)("br",{}),"(Frontend)"]}),Jl,Object(se.jsxs)("p",{children:["Daryl Tan",Object(se.jsx)("br",{}),"(Source)"]}),Jl,Object(se.jsxs)("p",{className:"wider",children:["Tee Hao Wei",Object(se.jsx)("br",{}),"(Backend & DevOps)"]})]}),Object(se.jsxs)("div",{className:"leadership",children:[Object(se.jsx)("p",{children:Object(se.jsx)("strong",{children:"2021 Leadership"})}),Object(se.jsx)("br",{}),Object(se.jsxs)("p",{children:["Tiffany Chong",Object(se.jsx)("br",{}),"(Game)"]}),Jl,Object(se.jsxs)("p",{children:["Anthony Halim",Object(se.jsx)("br",{}),"(Frontend)"]}),Jl,Object(se.jsxs)("p",{className:"evenWider",children:["Daryl Tan, Thomas Tan",Object(se.jsx)("br",{}),"(Source)"]}),Jl,Object(se.jsxs)("p",{className:"wider",children:["Tee Hao Wei",Object(se.jsx)("br",{}),"(Backend & DevOps)"]})]}),Object(se.jsxs)("div",{className:"leadership",children:[Object(se.jsx)("p",{className:"evenWider",children:Object(se.jsx)("strong",{children:"2022 Leadership (Rook)"})}),Object(se.jsx)("br",{}),Object(se.jsxs)("p",{children:["Tee Hao Wei",Object(se.jsx)("br",{}),"(CTO)"]}),Jl,Object(se.jsxs)("p",{children:["Chow En Rong",Object(se.jsx)("br",{}),"(Frontend)"]}),Jl,Object(se.jsxs)("p",{children:["Chen Yanyu",Object(se.jsx)("br",{}),"(Backend)"]}),Jl,Object(se.jsxs)("p",{children:["Samuel Fang",Object(se.jsx)("br",{}),"(SICP JS)"]}),Jl,Object(se.jsxs)("p",{children:["Gokul Rajiv,",Object(se.jsx)("br",{}),"Lee Hyung Woon",Object(se.jsx)("br",{}),"(Game)"]}),Jl,Object(se.jsxs)("p",{children:["Shen Yi Hong,",Object(se.jsx)("br",{}),"Zhan Jie,",Object(se.jsx)("br",{}),"Thomas Tan",Object(se.jsx)("br",{}),"(Source)"]}),Jl,Object(se.jsxs)("p",{children:["Bryan Loh,",Object(se.jsx)("br",{}),"Marcus Tang",Object(se.jsx)("br",{}),"(Modules)"]})]}),Object(se.jsxs)("div",{className:"contributors",children:[Object(se.jsx)(h.s,{children:Object(se.jsx)("strong",{children:Object(se.jsx)("u",{children:"All Contributors"})})}),Object(se.jsxs)("p",{children:["Below are all contributors to the"," ",Object(se.jsx)("a",{href:Se.a.githubOrg,children:"GitHub repositories of the Source Academy"}),". Feel free to join us!"]})]})]})});const ed=["assessments","tools","source-academy2"],td=["dependabot[bot]","dependabot-preview[bot]"];var sd=()=>{const[e,t]=Object(j.useState)([]),[s,a]=Object(j.useState)([]);Object(j.useEffect)((()=>{(async()=>{const e=await fetch("https://api.github.com/orgs/source-academy/repos"),t=await e.json();return await t.filter((e=>!ed.includes(e.name))).map((e=>({key:e.id,name:e.name,description:e.description,link:e.contributors_url})))})().then((e=>{(async e=>{const t=await Promise.all(e.map((e=>fetch(e.link)))),s=await Promise.all(t.map((e=>e.json())));return await Promise.all(s.map((e=>e.filter((e=>!td.includes(e.login))).map((e=>({key:e.id,photo:e.avatar_url,githubPage:e.html_url,githubName:e.login,commits:e.contributions}))))))})(e).then((s=>{t(e),a(s)}))}))}),[]);const n=s.length?s.map(((t,s)=>{const a=e[s],n=t.map((e=>Object(se.jsxs)("div",{children:[Object(se.jsx)("img",{src:e.photo,alt:"Contributor"}),Object(se.jsx)("p",{children:Object(se.jsx)("a",{href:e.githubPage,rel:"noopener noreferrer",target:"_blank",children:e.githubName})}),Object(se.jsxs)("p",{children:["Commits: ",e.commits]})]},e.key)));return Object(se.jsxs)(h.e,{className:"containerPermalink",elevation:C.a.ONE,children:[Object(se.jsxs)("div",{className:"repoDetailsPermalink",children:[Object(se.jsx)(h.q,{children:a.name}),Object(se.jsx)(h.s,{children:a.description})]}),Object(se.jsx)("div",{className:"inPermalink",children:n})]},a.key)})):Object(se.jsx)(h.p,{children:"Loading..."});return Object(se.jsx)("div",{children:n})};var ad=()=>Object(se.jsx)("div",{className:"fullpage",children:Object(se.jsxs)(h.e,{className:"fullpage-content",elevation:C.a.THREE,children:[Object(se.jsx)(Zl,{}),Object(se.jsx)(sd,{})]})});var nd=e=>{let{reason:t}=e;return Object(se.jsx)("div",{className:f()("NoPage",p.a.DARK),children:Object(se.jsx)(h.G,{icon:w.a.ERROR,title:"Disabled",description:`The Source Academy has been disabled${t?` for this reason: ${t}`:""}.`})})},id=s(522),rd=s(215),od=s(279);function cd(e){const t=rd.parse(e);for(const[s,a]of Object.entries(t))Object(od.isArray)(a)?t[s]=a.join(","):null===a&&delete t[s];return t}var ld=s(72);function dd(e){let{title:t,children:s}=e;return Object(se.jsx)("div",{className:f()("NoPage",p.a.DARK),children:Object(se.jsx)(h.G,{icon:w.a.ERROR,title:t,description:s})})}var ud=function(e){let{location:t}=e;const s=cd(t.search).code,[a,n]=Object(j.useState)("initial");return Object(j.useEffect)((()=>{"initial"===a&&Se.b.githubClientId&&s&&(n("loading"),async function(e,t,s){const a=await ld.e(Se.b.githubOAuthProxyUrl,rd.stringify({code:e,clientId:t}));let n;try{if(n=await a.json(),"undefined"===typeof n.access_token)throw new Error("Access Token not found in payload")}catch(i){return void s()}try{new BroadcastChannel("GitHubOAuthAccessToken").postMessage(n.access_token),window.close()}catch(i){}}(s,Se.b.githubClientId,(()=>n("error"))))}),[s,a]),Se.b.githubClientId?s?"error"===a?Object(se.jsx)(dd,{title:"We couldn't authenticate you with GitHub",children:"Connection with server was denied, or incorrect payload received. Please try again or contact the website administrator."}):Object(se.jsx)("div",{className:f()("NoPage",p.a.DARK),children:Object(se.jsx)(h.G,{description:"Logging In...",icon:Object(se.jsx)(h.R,{size:h.S.LARGE})})}):Object(se.jsx)(dd,{title:"We couldn't authenticate you with GitHub",children:"Access code not found in callback URL. Please try again or contact the website administrator."}):Object(se.jsx)(dd,{title:"We couldn't authenticate you with GitHub",children:"Client ID not included with deployment. Please try again or contact the website administrator."})};const hd=[...Se.b.authProviders.entries()].map((e=>{let[t,{name:s}]=e;return{id:t,name:s}})),pd=e=>{let{handleClick:t,id:s,name:a}=e;return Object(se.jsx)(h.b,{className:p.a.LARGE,rightIcon:w.a.LOG_IN,onClick:j.useCallback((()=>t(s)),[t,s]),children:`Log in with ${a}`})};var gd=()=>{const e=Object(r.c)(),t=Object(o.i)(),{code:s,provider:a}=cd(t.search),n=j.useCallback((t=>e(Object(u.login)(t))),[e]);return j.useEffect((()=>{s&&e(Object(u.fetchAuth)(s,a))}),[s,a,e]),s?Object(se.jsx)("div",{className:f()("Login",p.a.DARK),children:Object(se.jsx)(h.e,{className:f()("login-card",p.a.ELEVATION_4),children:Object(se.jsx)("div",{className:"login-body",children:Object(se.jsx)(h.G,{description:"Logging In...",icon:Object(se.jsx)(h.R,{size:h.S.LARGE})})})})}):Object(se.jsx)("div",{className:f()("Login",p.a.DARK),children:Object(se.jsxs)(h.e,{className:f()("login-card",p.a.ELEVATION_4),children:[Object(se.jsx)("div",{className:"login-header",children:Object(se.jsxs)(h.r,{children:[Object(se.jsx)(h.w,{icon:w.a.LOCK}),"LOGIN"]})}),Object(se.jsx)("div",{className:"login-body",children:Object(se.jsx)(h.c,{fill:!0,vertical:!0,children:hd.map((e=>{let{id:t,name:s}=e;return Object(se.jsx)(pd,{handleClick:n,name:s,id:t},t)}))})})]})})},md=s(297),bd=s(295);const jd=e=>e.charAt(0).toUpperCase()+e.slice(1),yd=()=>{const e=localStorage.getItem("MissionEditingAssessmentSA");return e?JSON.parse(e):null},Od=e=>{localStorage.setItem("MissionEditingAssessmentSA",JSON.stringify(e))},fd=e=>{localStorage.setItem("MissionEditingOverviewSA",JSON.stringify(e))},vd=(e,t)=>{const s=e.CONTENT.TASK[0],a=s.$;return{type:jd(a.kind),isManuallyGraded:!0,closeAt:a.duedate,coverImage:a.coverimage,id:-1,maxXp:t,number:a.number||"",openAt:a.startdate,title:a.title,reading:s.READING?s.READING[0]:"",shortSummary:s.WEBSUMMARY?s.WEBSUMMARY[0]:"",status:H.a.attempting,story:a.story,xp:0,gradingStatus:"none"}},xd=e=>{const t=e.CONTENT.TASK[0],s=t.$,a=Sd(t);return[{type:jd(s.kind),id:-1,globalDeployment:Cd(t.DEPLOYMENT),graderDeployment:Cd(t.GRADERDEPLOYMENT),longSummary:t.TEXT[0],missionPDF:"google.com",questions:a[0],title:s.title},a[1]]},Cd=e=>{if(void 0===e)return Object(H.h)();{const t=e[0],s=t.IMPORT||t.EXTERNAL;return{external:{name:s?s[0].$.name:"NONE",symbols:s&&s[0].SYMBOL||[]},globals:t.GLOBAL?t.GLOBAL.map((e=>{return[e.IDENTIFIER[0],(t=e.VALUE[0],Function('"use strict";return ('+t+")")()),e.VALUE[0]];var t})):[]}}},Sd=e=>{let t=0;const s=[];return e.PROBLEMS[0].PROBLEM.forEach(((e,a)=>{const n=e.$.maxxp?parseInt(e.$.maxxp,10):0,i={answer:null,content:e.TEXT[0],id:a,library:Cd(e.DEPLOYMENT),graderLibrary:Cd(e.GRADERDEPLOYMENT),type:e.$.type,xp:0,maxXp:n};t+=n,"programming"===i.type&&s.push(Ed(e,i)),"mcq"===i.type&&s.push(wd(e,i))})),[s,t]},wd=(e,t)=>{const s=[],a=e.SNIPPET?e.SNIPPET[0].SOLUTION:void 0;let n=0;return e.CHOICE.forEach(((e,t)=>{s.push({content:e.TEXT[0],hint:null}),n="true"===e.$.correct?t:n})),{...t,type:"mcq",answer:a?parseInt(a[0],10):0,choices:s,solution:n}},Ed=(e,t)=>{const s=e.SNIPPET[0].TESTCASES,a=s&&s[0].PUBLIC||[],n=s&&s[0].PRIVATE||[],i=e.SNIPPET[0].PREPEND,r=e.SNIPPET[0].POSTPEND,o=e.SNIPPET[0].SOLUTION,c={...t,autogradingResults:[],prepend:i?i[0].trim():"",solutionTemplate:e.SNIPPET[0].TEMPLATE[0].trim(),postpend:r?r[0].trim():"",testcases:a.map((e=>Td(e))),testcasesPrivate:n.map((e=>Td(e))),answer:o?o[0].trim():"",type:"programming"};return e.SNIPPET[0].GRADER&&(c.graderTemplate=e.SNIPPET[0].GRADER[0]),c},Td=e=>({type:H.f.public,answer:e.$.answer,score:parseInt(e.$.score,10),program:e._}),kd=(e,t)=>{const s=document.createElement("a");s.setAttribute("href","data:text/plain;charset=utf-8,"+encodeURIComponent(t)),s.setAttribute("download",e),s.style.display="none",document.body.appendChild(s),s.click(),document.body.removeChild(s)},Ad=e=>{const t={$:{interpreter:M.Chapter.CALC.toString()},EXTERNAL:{$:{name:e.external.name}}};return 0!==e.external.symbols.length&&(t.EXTERNAL.SYMBOL=e.external.symbols),0!==e.globals.length&&(t.GLOBAL=e.globals.map((e=>({IDENTIFIER:e[0],VALUE:e[2]})))),t},Id=(e,t)=>{const s={},a={coverimage:t.coverImage,duedate:t.closeAt,kind:t.type.toLowerCase(),number:t.number||"",startdate:t.openAt,story:t.story,title:t.title};return s.$=a,t.reading&&""!==t.reading&&(s.READING=t.reading),s.WEBSUMMARY=t.shortSummary,s.TEXT=e.longSummary,s.PROBLEMS={PROBLEM:[]},s.DEPLOYMENT=Ad(e.globalDeployment),s.GRADERDEPLOYMENT=Ad(e.graderDeployment),e.questions.forEach((e=>{const t={$:{type:e.type},SNIPPET:{SOLUTION:e.answer},TEXT:e.content,CHOICE:[]};if(t.$.DEPLOYMENT=Ad(e.library),t.$.GRADERDEPLOYMENT=Ad(e.graderLibrary),e.maxXp&&(t.$.maxxp=e.maxXp),"programming"===e.type){e.graderTemplate&&(t.SNIPPET.GRADER=e.graderTemplate);const s={...t.SNIPPET,TEMPLATE:e.solutionTemplate,PREPEND:e.prepend,POSTPEND:e.postpend,TESTCASES:""};if(e.testcases.length||e.testcasesPrivate.length){if(s.TESTCASES={},e.testcases.length){const t=e.testcases.map((e=>({$:{answer:e.answer,score:e.score},_:e.program})));s.TESTCASES.PUBLIC=t}if(e.testcasesPrivate&&e.testcasesPrivate.length){const t=e.testcasesPrivate.map((e=>({$:{answer:e.answer,score:e.score},_:e.program})));s.TESTCASES.PRIVATE=t}}t.SNIPPET=s}"mcq"===e.type&&e.choices.forEach(((s,a)=>{t.CHOICE.push({$:{correct:e.solution===a?"true":"false"},TEXT:s.content})})),s.PROBLEMS.PROBLEM.push(t)})),s};class Nd extends j.Component{constructor(e){var t;super(e),t=this,this.saveEditOverview=e=>t=>{const s={...this.props.overview,[e]:this.state.fieldValue};this.setState({editingOverviewField:"",fieldValue:""}),fd(s),this.props.updateEditingOverview(s)},this.handleEditOverview=()=>e=>{this.setState({fieldValue:e.target.value})},this.toggleEditField=e=>t=>{this.state.editingOverviewField!==e&&this.setState({editingOverviewField:e,fieldValue:this.props.overview[e]})},this.toggleOptionsOverlay=()=>{this.setState({showOptionsOverlay:!this.state.showOptionsOverlay})},this.handleExportXml=e=>{(()=>{const e=localStorage.getItem("MissionEditingAssessmentSA"),t=localStorage.getItem("MissionEditingOverviewSA");if(e&&t){const s=JSON.parse(e),a=JSON.parse(t),n=a.fileName||a.title,i=new bd.Builder,r={CONTENT:{$:{"xmlns:xsi":"http://www.w3.org/2001/XMLSchema-instance"},TASK:Id(s,a)}};let o=i.buildObject(r);o=o.replace(/(&#xD;)+/g,""),kd(n+".xml",o)}})()},this.makeEditingOverviewTextarea=e=>Object(se.jsx)(md.a,{autoFocus:!0,className:"editing-textarea",onChange:this.handleEditOverview(),onBlur:this.saveEditOverview(e),value:this.state.fieldValue}),this.makeEditingOverviewCard=e=>Object(se.jsx)("div",{children:Object(se.jsxs)(h.e,{className:"row listing",elevation:C.a.ONE,children:[Object(se.jsx)("div",{className:"col-xs-3 listing-picture",onClick:this.toggleEditField("coverImage"),children:"coverImage"===this.state.editingOverviewField?this.makeEditingOverviewTextarea("coverImage"):Object(se.jsx)("img",{alt:"Assessment cover",className:`cover-image-${e.status}`,src:e.coverImage?e.coverImage:I.a})}),Object(se.jsxs)("div",{className:"col-xs-9 listing-text",children:[this.makeEditingOverviewCardTitle(e,e.title),Object(se.jsx)("div",{className:"row listing-xp",children:Object(se.jsxs)(h.t,{children:[" ",`Max XP: ${e.maxXp}`," "]})}),Object(se.jsx)("div",{className:"row listing-description",onClick:this.toggleEditField("shortSummary"),children:"shortSummary"===this.state.editingOverviewField?this.makeEditingOverviewTextarea("shortSummary"):Object(se.jsx)(ee.a,{content:Md(e.shortSummary)})}),Object(se.jsxs)("div",{className:"listing-controls",children:[Object(se.jsxs)(h.Y,{className:"listing-due-date",children:[Object(se.jsx)(h.w,{className:"listing-due-icon",iconSize:12,icon:w.a.TIME}),Object(se.jsx)("div",{className:"date-container",children:"Opens at:\xa0"}),Object(se.jsx)("div",{className:"date-container",onClick:this.toggleEditField("openAt"),children:"openAt"===this.state.editingOverviewField?this.makeEditingOverviewTextarea("openAt"):`${Ae(e.openAt)}`}),Object(se.jsx)("div",{className:"date-container",children:"\xa0\xa0Due:\xa0"}),Object(se.jsx)("div",{className:"date-container",onClick:this.toggleEditField("closeAt"),children:"closeAt"===this.state.editingOverviewField?this.makeEditingOverviewTextarea("closeAt"):`${Ae(e.closeAt)}`})]}),Object(se.jsx)(h.b,{icon:w.a.WRENCH,minimal:!0,onClick:this.toggleOptionsOverlay,children:"Other Options"}),Object(se.jsx)(A.b,{to:`${this.props.listingPath}/${e.id.toString()}/${Se.b.defaultQuestionId}`,children:Object(se.jsx)(J.a,{label:"Edit mission",icon:w.a.EDIT})})]})]})]})}),this.makeEditingOverviewCardTitle=(e,t)=>Object(se.jsxs)("div",{className:"row listing-title",children:[Object(se.jsx)(h.Y,{ellipsize:!0,className:"col-xs-10",children:Object(se.jsx)(h.r,{onClick:this.toggleEditField("title"),children:"title"===this.state.editingOverviewField?this.makeEditingOverviewTextarea("title"):Md(t)})}),Object(se.jsx)("div",{className:"col-xs-2",children:this.makeExportButton(e)})]}),this.makeExportButton=e=>Object(se.jsx)(h.b,{icon:w.a.EXPORT,intent:g.a.DANGER,minimal:!0,onClick:this.handleExportXml,children:"Save as XML"}),this.saveCategory=(e,t)=>{const s={...this.props.overview,category:e};fd(s),this.props.updateEditingOverview(s)},this.optionsOverlay=()=>Object(se.jsx)(h.h,{canOutsideClickClose:!1,className:"assessment-reset",icon:w.a.WRENCH,isCloseButtonShown:!0,isOpen:this.state.showOptionsOverlay,onClose:this.toggleOptionsOverlay,title:"Other options",children:Object(se.jsxs)("div",{className:p.a.DIALOG_BODY,children:[Object(se.jsx)(h.q,{children:"Assessment Type"}),this.assessmentTypeSelect(this.props.overview.type,this.saveCategory),Object(se.jsx)(h.q,{children:"Number"}),Object(se.jsx)("div",{onClick:this.toggleEditField("number"),children:"number"===this.state.editingOverviewField?this.makeEditingOverviewTextarea("number"):Md(this.props.overview.number||"")}),Object(se.jsx)(h.q,{children:"Story"}),Object(se.jsx)("div",{onClick:this.toggleEditField("story"),children:"story"===this.state.editingOverviewField?this.makeEditingOverviewTextarea("story"):Md(this.props.overview.story||"")}),Object(se.jsx)("br",{}),Object(se.jsx)(h.q,{children:"Filename"}),Object(se.jsx)("div",{onClick:this.toggleEditField("fileName"),children:"fileName"===this.state.editingOverviewField?this.makeEditingOverviewTextarea("fileName"):Md(this.props.overview.fileName||"")})]})}),this.assessmentTypeSelect=function(e){let s=arguments.length>1&&void 0!==arguments[1]?arguments[1]:(e,t)=>{};return Object(se.jsx)(Pd,{className:p.a.MINIMAL,items:t.props.assessmentTypes,onItemSelect:s,itemRenderer:Rd,filterable:!1,children:Object(se.jsx)(h.b,{className:p.a.MINIMAL,text:e,rightIcon:w.a.DOUBLE_CARET_VERTICAL})})},this.state={editingOverviewField:"",fieldValue:"",showOptionsOverlay:!1}}render(){return Object(se.jsxs)("div",{children:[this.optionsOverlay(),this.makeEditingOverviewCard(this.props.overview)]})}}const Md=e=>e.match("^(\n| )*$")?"Enter Value Here (If Applicable)":e,Pd=ct.a.ofType(),Rd=(e,t)=>{let{handleClick:s,modifiers:a,query:n}=t;return Object(se.jsx)(h.B,{active:!1,onClick:s,text:e},e)},_d=e=>{let{toggleEditMode:t,editingMode:s}=e;const a="question"===s?"Global":"Question Specific";return Object(se.jsx)(E.a,{content:"Switch to "+a+" Editing Mode",children:Object(se.jsx)(J.a,{label:a+" Editing Mode",icon:w.a.REFRESH,onClick:t})})},Ld=(e,t)=>{for(const s of e)t=t[s];return t},Dd=(e,t,s)=>{let a=0;for(a=0;a<e.length-1;a++)s=s[e[a]];s[e[a]]=t},Bd=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;return s=>{let a;return s="string"===typeof s?parseInt(s,10):s,a=null!==e&&s<e?e:null!==t&&s>t?t:s,a}},Ud=e=>{const t=e.isNumber||!1,[s,a]=Object(j.useState)(!1),[n]=Object(j.useState)(t),[i,r]=Object(j.useState)(""),[o]=Object(j.useState)(e.useRawValue||t),c=t=>{let s;n?(s=parseInt(i,10),isNaN(s)&&(s=Ld(e.path,e.assessment))):s=i;const r=Ld(e.path,e.assessment);if(e.processResults&&(s=e.processResults(s)),s!==r){const t=e.assessment;Dd(e.path,s,t),e.updateAssessment(t)}a(!1)},l=e=>{r(e.target.value)};let d;if(s)d=Object(se.jsx)(md.a,{autoFocus:!0,className:"editing-textarea",onChange:l,onBlur:c,value:i});else{const t="Please enter value (if applicable)";let s=Ld(e.path,e.assessment);e.isNumber||(s=s||"",s=s.match(/^\s*$/)?t:s),d=o?s:Object(se.jsx)(ee.a,{content:s})}return Object(se.jsx)("div",{onClick:t=>{if(!s){const t=Ld(e.path,e.assessment)||"";a(!0),r("string"===typeof t?t:t.toString())}},children:d})};var Gd=Ud;const Fd=e=>{const t=t=>()=>{t.push(Object(H.l)()),e.updateAssessment(e.assessment)},s=(t,s)=>{const a=Ld(t,e.assessment),n=a[s];return Object(se.jsx)("div",{children:Object(se.jsx)(h.e,{className:"row listing",elevation:C.a.ONE,children:Object(se.jsxs)("div",{className:"col-xs-9 listing-text",children:[Object(se.jsx)("div",{className:"row listing-program",children:Object(se.jsxs)(h.t,{children:["Test Program:",Object(se.jsx)(Gd,{assessment:e.assessment,path:t.concat([s,"program"]),useRawValue:!0,updateAssessment:e.updateAssessment})]})}),Object(se.jsx)("div",{className:"row listing-expected",children:Object(se.jsxs)(h.t,{children:["Score:",Object(se.jsx)(Gd,{assessment:e.assessment,isNumber:!0,path:t.concat([s,"score"]),updateAssessment:e.updateAssessment})]})}),Object(se.jsx)("div",{className:"row listing-expected",children:Object(se.jsxs)(h.t,{children:["Expected Answer:",Object(se.jsx)(Gd,{assessment:e.assessment,path:t.concat([s,"answer"]),useRawValue:!0,updateAssessment:e.updateAssessment})]})}),Object(se.jsx)("div",{className:"listing-controls",children:Object(se.jsxs)("div",{children:[Object(se.jsx)(J.a,{label:"Test",icon:w.a.PLAY,onClick:()=>e.handleTestcaseEval(n)}),Object(se.jsx)(J.a,{label:"Delete",icon:w.a.DELETE,onClick:()=>((t,s)=>{t.splice(s,1),e.updateAssessment(e.assessment)})(a,s)})]})})]})})})},a=e.assessment.questions[e.questionId],n=["questions",e.questionId,"testcases"],i=a.testcases.map(((e,t)=>Object(se.jsx)("div",{children:s(n,t)},t))),r=["questions",e.questionId,"testcasesPrivate"],o=a.testcasesPrivate.map(((e,t)=>Object(se.jsx)("div",{children:s(r,t)},t)));return Object(se.jsxs)("div",{children:["Public Testcases",i,Object(se.jsx)(J.a,{label:"New public testcase",icon:w.a.PLUS,onClick:t(a.testcases)}),Object(se.jsx)("br",{}),Object(se.jsx)("br",{}),"Private Testcases",o,Object(se.jsx)(J.a,{label:"New private testcase",icon:w.a.PLUS,onClick:t(a.testcasesPrivate)})]})};var Hd=s(71);class Vd extends j.Component{constructor(){var e;super(...arguments),e=this,this.deploymentTab=()=>{const e=this.props.pathToLibrary,t=Ld(e,this.props.assessment),s=t.external.symbols.map(((t,s)=>Object(se.jsxs)("tr",{children:[Object(se.jsx)("td",{children:this.textareaContent(e.concat(["external","symbols",s]))}),Object(se.jsx)("td",{style:{width:"100px"},children:Object(se.jsx)(J.a,{label:"Delete",icon:w.a.MINUS,onClick:this.handleSymbolDelete(s)})})]},s))),a=t.globals.map(((t,s)=>Object(se.jsxs)("tr",{children:[Object(se.jsx)("td",{style:{width:"170px"},children:this.textareaContent(e.concat(["globals",s,0]))}),Object(se.jsx)("td",{children:this.globalValueTextareaContent(s)}),Object(se.jsx)("td",{style:{width:"90px"},children:Object(se.jsx)(J.a,{label:"Delete",icon:w.a.MINUS,onClick:this.handleGlobalDelete(s)})})]},s))),n=Object(se.jsx)(J.a,{label:"Use this Library",icon:w.a.REFRESH,onClick:()=>this.props.handleRefreshLibrary(t)}),i=Object(se.jsxs)(j.Fragment,{children:["External Library:",Object(se.jsx)("br",{}),Kd(t.external.name,this.handleExternalSelect),Object(se.jsx)(h.i,{}),Object(se.jsx)("div",{children:"Symbols:"}),Object(se.jsx)("br",{}),Object(se.jsx)("table",{style:{width:"100%"},children:Object(se.jsx)("tbody",{children:s})}),Object(se.jsx)(J.a,{label:"New Symbol",icon:w.a.PLUS,onClick:this.handleNewSymbol})]}),r=Object(se.jsxs)(j.Fragment,{children:[Object(se.jsx)("div",{children:"Globals:"}),Object(se.jsx)("br",{}),Object(se.jsx)("table",{style:{width:"100%",borderSpacing:"5px"},children:Object(se.jsx)("tbody",{children:a})}),Object(se.jsx)(J.a,{label:"New Global",icon:w.a.PLUS,onClick:this.handleNewGlobal})]});return Object(se.jsxs)("div",{children:[Object(se.jsx)(h.i,{}),n,Object(se.jsx)(h.i,{}),"Interpreter:",Object(se.jsx)("br",{}),$d(t.variant,this.handleChapterSelect),Object(se.jsx)(h.i,{}),i,Object(se.jsx)(h.i,{}),r]})},this.textareaContent=e=>Object(se.jsx)(Gd,{assessment:this.props.assessment,path:e,processResults:Wd,updateAssessment:this.props.updateAssessment,useRawValue:!0}),this.globalValueTextareaContent=e=>{const t=this.props.pathToLibrary.concat(["globals",e,2]);return Object(se.jsx)(Gd,{assessment:this.props.assessment,path:t,updateAssessment:this.handleGlobalValueUpdate(e),useRawValue:!0})},this.handleGlobalValueUpdate=e=>t=>{const s=Ld(this.props.pathToLibrary,this.props.assessment).globals[e];try{s[1]=Xd(s[2]),this.props.updateAssessment(t)}catch(a){s[2]='"Invalid Expression"'}},this.handleSymbolDelete=e=>()=>{const t=this.props.assessment;Ld(this.props.pathToLibrary,t).external.symbols.splice(e,1),this.props.updateAssessment(t)},this.handleNewSymbol=()=>{const e=this.props.assessment;Ld(this.props.pathToLibrary,e).external.symbols.push("new_symbol"),this.props.updateAssessment(e)},this.handleGlobalDelete=e=>()=>{const t=this.props.assessment;Ld(this.props.pathToLibrary,t).globals.splice(e,1),this.props.updateAssessment(t)},this.handleNewGlobal=()=>{const e=this.props.assessment;Ld(this.props.pathToLibrary,e).globals.push(["new_global",null,"null"]),this.props.updateAssessment(e)},this.handleChapterSelect=(e,t)=>{const s=this.props.assessment;this.props.updateAssessment(s)},this.handleExternalSelect=(e,t)=>{const s=this.props.assessment,a=Ld(this.props.pathToLibrary,s);a.external.name=e.name,a.external.symbols=JSON.parse(JSON.stringify(Hd.b.get(e.name))),this.props.updateAssessment(s)},this.handleSwitchDeployment=()=>{const e=this.props.assessment;if(this.isEmptyLibrary()){let t=Ld(this.props.pathToCopy||["globalDeployment"],e);t=JSON.parse(JSON.stringify(t)),Dd(this.props.pathToLibrary,t,e)}else Dd(this.props.pathToLibrary,Object(H.h)(),e);this.props.updateAssessment(e)},this.isEmptyLibrary=function(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:e.props.pathToLibrary;return-1===Ld(t.concat(["chapter"]),e.props.assessment)}}render(){return this.props.isOptionalDeployment?Object(se.jsxs)("div",{children:[Object(se.jsx)(h.T,{checked:!this.isEmptyLibrary(),label:"Enable "+this.props.label+" Deployment",onChange:this.handleSwitchDeployment}),this.isEmptyLibrary()?null:this.deploymentTab()]}):Object(se.jsxs)("div",{children:[this.props.label+" Deployment",Object(se.jsx)("br",{}),this.deploymentTab()]})}}const Wd=e=>"string"===typeof e?e.replace(/\s+/g,""):e,Xd=e=>Function('"use strict";return ('+e+")")(),$d=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:M.Variant.DEFAULT,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:(e,t)=>{};return Object(se.jsx)(qd,{className:p.a.MINIMAL,items:x.n,onItemSelect:t,itemRenderer:zd,filterable:!1,children:Object(se.jsx)(h.b,{className:p.a.MINIMAL,text:Object(x.o)(M.Chapter.CALC,e),rightIcon:w.a.DOUBLE_CARET_VERTICAL})})},qd=ct.a.ofType(),zd=(e,t)=>{let{handleClick:s,modifiers:a,query:n}=t;return Object(se.jsx)(h.B,{active:!1,onClick:s,text:e.displayName},e.displayName)},Yd=Array.from(Hd.b.entries()).map(((e,t)=>({name:e[0],key:t,symbols:e[1]}))),Kd=(e,t)=>Object(se.jsx)(Qd,{className:p.a.MINIMAL,items:Yd,onItemSelect:t,itemRenderer:Jd,filterable:!1,children:Object(se.jsx)(h.b,{className:p.a.MINIMAL,text:e,rightIcon:w.a.DOUBLE_CARET_VERTICAL})}),Qd=ct.a.ofType(),Jd=(e,t)=>{let{handleClick:s,modifiers:a,query:n}=t;return Object(se.jsx)(h.B,{active:!1,onClick:s,text:e.name},e.key)};var Zd=Vd;var eu=e=>{return Object(se.jsxs)("div",{children:["Max Xp:",(t=e.path.concat(["maxXp"]),Object(se.jsx)(Gd,{assessment:e.assessment,isNumber:!0,path:t,processResults:Bd(0),updateAssessment:e.updateAssessment}))]});var t};const tu=e=>JSON.parse(JSON.stringify(e));var su=e=>{const[t,s]=Object(j.useState)(!1),[a,n]=Object(j.useState)((()=>{})),i=t=>Object(se.jsxs)("div",{children:[Object(se.jsx)(J.a,{label:"Clone",icon:w.a.DOCUMENT,onClick:l(o((()=>tu(e.assessment.questions[t])),t))}),Object(se.jsx)(J.a,{label:"Delete",icon:w.a.REMOVE,onClick:l(c(t))}),Object(se.jsx)(J.a,{label:"Shift Up",icon:w.a.CARET_UP,onClick:l(r(-1,t)),isDisabled:0===t}),Object(se.jsx)(J.a,{label:"Shift Down",icon:w.a.CARET_DOWN,onClick:l(r(1,t)),isDisabled:t>=e.assessment.questions.length-1}),Object(se.jsx)("br",{}),Object(se.jsx)(J.a,{label:"Insert Programming Question",icon:w.a.FONT,onClick:l(o(H.k,t))}),Object(se.jsx)(J.a,{label:"Insert MCQ Question",icon:w.a.CONFIRM,onClick:l(o(H.i,t))})]}),r=(t,s)=>()=>{const a=e.assessment,n=s+t;if(n>=0&&n<a.questions.length){const t=a.questions[s],i=a.questions;i[s]=i[n],i[n]=t,a.questions=i,e.updateAssessment(a),we.a.push("/mission-control/-1/"+n.toString())}},o=(t,s)=>()=>{const a=e.assessment;s+=1;const n=a.questions;n.splice(s,0,t()),a.questions=n,e.updateAssessment(a),we.a.push("/mission-control/-1/"+s.toString())},c=t=>()=>{const s=e.assessment;let a=s.questions;a.length>1&&(a=a.slice(0,t).concat(a.slice(t+1))),s.questions=a,e.updateAssessment(s)},l=t=>()=>{e.hasUnsavedChanges?(s(!0),n(t)):t()},d=Object(se.jsxs)(h.h,{className:"assessment-reset",icon:w.a.ERROR,isCloseButtonShown:!0,isOpen:t,title:"Confirmation: Save unsaved changes?",children:[Object(se.jsx)("div",{className:p.a.DIALOG_BODY,children:Object(se.jsx)(ee.a,{content:"Are you sure you want to save over your unsaved changes?"})}),Object(se.jsx)("div",{className:p.a.DIALOG_FOOTER,children:Object(se.jsxs)(h.c,{children:[Object(se.jsx)(J.a,{label:"Cancel",onClick:()=>s(!1),options:{minimal:!1}}),Object(se.jsx)(J.a,{label:"Confirm",onClick:()=>{a(),s(!1)},options:{minimal:!1,intent:g.a.DANGER}})]})})]});return Object(se.jsxs)("div",{children:[d,e.assessment.questions.map(((e,t)=>Object(se.jsxs)("div",{children:["Question ",t+1,Object(se.jsx)("br",{}),Object(se.jsx)(h.b,{className:"mcq-option col-xs-12",minimal:!0,children:Object(se.jsx)(ee.a,{content:e.content.length>200?e.content.substring(0,300)+"...":e.content})}),i(t),Object(se.jsx)("br",{}),Object(se.jsx)("br",{})]},t)))]})};var au=e=>{const t=function(t){let s=arguments.length>1&&void 0!==arguments[1]&&arguments[1],a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[0];return s?Object(se.jsx)(Gd,{assessment:e.assessment,isNumber:!0,path:t,processResults:Bd(a[0],a[1]),updateAssessment:e.updateAssessment}):Object(se.jsx)(Gd,{assessment:e.assessment,path:t,updateAssessment:e.updateAssessment})},{questionId:s}=e,a=e.assessment.questions[s],n=a.choices.map(((e,a)=>Object(se.jsxs)("div",{className:"mcq-option col-xs-12",children:["Option ",a,":",t(["questions",s,"choices",a,"content"]),Object(se.jsx)("br",{}),"Hint:",t(["questions",s,"choices",a,"hint"])]},a))),i=Object(se.jsx)(J.a,{label:"Delete Option",icon:w.a.REMOVE,onClick:()=>{const{assessment:t,questionId:s}=e,a=t.questions[s],n=a.choices.slice(0,a.choices.length-1);a.choices=n,t.questions[s]=a,e.updateAssessment(t)}});return Object(se.jsx)("div",{className:"MCQChooser row",children:Object(se.jsx)(h.e,{className:"mcq-content-parent col-xs-12 middle-xs",children:Object(se.jsxs)("div",{className:"row mcq-options-parent between-xs",children:[n,"Solution:",t(["questions",s,"solution"],!0,[0,a.choices.length]),Object(se.jsx)("br",{}),Object(se.jsx)(J.a,{label:"Add Option",icon:w.a.CONFIRM,onClick:()=>{const{assessment:t,questionId:s}=e,a=t.questions[s],n=a.choices.concat([{content:"A",hint:null}]);a.choices=n,t.questions[s]=a,e.updateAssessment(t)}}),a.choices.length>0?i:void 0]})})})},nu=s(148),iu=s.n(nu);const ru=ct.a.ofType(),ou=[{label:"Prepend",icon:w.a.CHEVRON_UP,id:"prepend"},{label:"Postpend",icon:w.a.CHEVRON_DOWN,id:"postpend"},{label:"Solution Template",icon:w.a.MANUAL,id:"solutionTemplate"},{label:"Suggested Answer",icon:w.a.TICK,id:"answer"}];var cu=e=>{const[t,s]=Object(j.useState)(ou[0]),[a,n]=Object(j.useState)(""),[i,r]=Object(j.useState)(!1),o=t=>{const s=i?a:Ld(t,e.assessment);return Object(se.jsx)("div",{onClick:c(t),onBlur:l(t),children:Object(se.jsx)(iu.a,{className:"react-ace",editorProps:{$blockScrolling:1/0},fontSize:14,highlightActiveLine:!1,mode:"javascript",onChange:n,theme:"source",value:s,width:"100%"})})},c=t=>s=>{i||(n(Ld(t,e.assessment)),r(!0))},l=s=>o=>{if(i){if(Ld(s,e.assessment)!==a){const t=e.assessment;Dd(s,a,t),e.updateAssessment(t)}if("prepend"===t.id){const t=a;e.handleUpdateActiveEditorTab({prependValue:t})}else if("postpend"===t.id){const t=a;e.handleUpdateActiveEditorTab({postpendValue:t})}n(""),r(!1)}},d=t=>()=>{const s=e.assessment;Dd(t,e.editorValue,s),e.updateAssessment(s)},u=t=>()=>{const s=Ld(t,e.assessment);e.handleEditorValueChange(s)};return(()=>{const a=["questions",e.questionId].concat(t.id),n=Object(se.jsx)(J.a,{label:"Copy from Editor",icon:w.a.IMPORT,onClick:d(a)}),i=Object(se.jsx)(J.a,{label:"Copy to Editor",icon:w.a.EXPORT,onClick:u(a)}),r=Object(se.jsxs)("div",{children:[n,i,Object(se.jsx)(h.i,{}),o(a)]}),c=(e,t)=>{let{handleClick:s}=t;return Object(se.jsx)(h.B,{active:!1,onClick:s,text:e.label,icon:e.icon},e.id)};return Object(se.jsx)("div",{className:"side-content",children:Object(se.jsxs)(h.e,{children:[(l=t,g=s,Object(se.jsx)(ru,{className:p.a.MINIMAL,items:ou,itemRenderer:c,onItemSelect:g,filterable:!1,children:Object(se.jsx)(h.b,{className:p.a.MINIMAL,text:l.label,icon:w.a.EDIT,rightIcon:w.a.DOUBLE_CARET_VERTICAL})})),Object(se.jsx)(h.i,{}),Object(se.jsx)("div",{className:"side-content-text",children:r})]})});var l,g})()};function lu(e){const t={};return e.filter((e=>!t.hasOwnProperty(e)&&(t[e]=!0)))}var du=e=>{var t,s;const[a,n]=Object(j.useState)(yd()),[i,r]=Object(j.useState)("question"),[o,c]=Object(j.useState)(!1),[l,d]=Object(j.useState)(!1),[u,m]=Object(j.useState)(0);if(Object(j.useEffect)((()=>{a&&(O(),m(S()))}),[]),Object(j.useEffect)((()=>function(){if(void 0===a)return;const t=-1,s=b();e.storedAssessmentId===t&&e.storedQuestionId===s||(O(),e.handleUpdateCurrentAssessmentId(t,s),e.handleUpdateHasUnsavedChanges(!1),o&&(n(yd()),c(!1)),y())}())),null===a||0===a.questions.length)return Object(se.jsx)(h.G,{className:f()("WorkspaceParent",p.a.DARK),description:"Getting mission ready...",icon:Object(se.jsx)(h.R,{size:h.S.LARGE})});const b=()=>{let t=e.questionId;return t<0?t=0:t>=a.questions.length&&(t=a.questions.length-1),t};const y=function(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:void 0;const s=a.questions[b()];if(t||(t=s.library),t&&t.globals.length>0){const e=t.globals.map((e=>e[0])),s=t.external.symbols.concat(e);t={...t,external:{name:t.external.name,symbols:lu(s)}}}e.handleClearContext(t,!0)},O=()=>{const t=a.questions[b()];let s,n="",i="";t.type===H.d.programming?(s=t.editorValue?t.editorValue:t.solutionTemplate,n=t.prepend,i=t.postpend):s="//If you see this, this is a bug. Please report bug.",e.handleResetWorkspace({editorTabs:[{value:s,prependValue:n,postpendValue:i,highlightedLines:[],breakpoints:[]}]}),e.handleEditorValueChange(s)},v=t=>{const s=[t];e.handleUpdateWorkspace({editorTestcases:s}),e.handleTestcaseEval(0)},x=()=>{a.questions[b()].editorValue=e.editorTabs[0].value,n(a),c(!1),Od(a),C()},C=()=>{const t=S(),s=t-u;if(0!==s){const a=e.assessmentOverview;0!==s&&(a.maxXp=t),m(t),e.updateAssessmentOverview(a),fd(a)}},S=()=>{let e=0;const t=a.questions;for(const s of t)e+=s.maxXp;return e},E=e=>{n(e),c(!0)},T=e=>{n(e),y(),x(),O()},k=()=>{r("question"===i?"global":"question")};const A=b(),I=a.questions[A],N={controlBarProps:(t=>{const s="/mission-control",n=`/mission-control/${a.id.toString()}`,r=[t+1,a.questions.length],c=Object(se.jsx)($.a,{onClickNext:()=>we.a.push(n+`/${(t+1).toString()}`),onClickReturn:()=>we.a.push(s),questionProgress:r},"next_question"),l=Object(se.jsx)(q.a,{onClick:()=>we.a.push(n+`/${(t-1).toString()}`),questionProgress:r},"previous_question"),u=Object(se.jsx)(z.a,{questionProgress:r},"question_view"),h=Object(se.jsx)(Y.a,{onClick:()=>{d((()=>o))}},"reset_template");return{editorButtons:[Object(se.jsx)(K.a,{handleEditorEval:e.handleEditorEval},"run"),Object(se.jsx)(Q.a,{hasUnsavedChanges:o,onClickSave:x},"save"),h],flowButtons:[l,u,c],editingWorkspaceButtons:[Object(se.jsx)(_d,{editingMode:i,toggleEditMode:k},"toggle_edit_mode")]}})(A),editorContainerProps:I.type===H.d.programming?{editorVariant:"normal",editorTabs:e.editorTabs.map(Z.a).map(((e,t)=>0!==t?e:{...e,editorValue:e.editorValue||I.editorValue||I.solutionTemplate})),editorSessionId:"",handleDeclarationNavigate:e.handleDeclarationNavigate,handleEditorEval:e.handleEditorEval,handleEditorValueChange:e.handleEditorValueChange,handleEditorUpdateBreakpoints:e.handleEditorUpdateBreakpoints,handleUpdateHasUnsavedChanges:e.handleUpdateHasUnsavedChanges,handlePromptAutocomplete:e.handlePromptAutocomplete,isEditorAutorun:!1}:void 0,handleSideContentHeightChange:e.handleSideContentHeightChange,hasUnsavedChanges:o,mcqProps:{mcq:I,handleMCQSubmit:t=>e.handleSave(a.questions[A].id,t)},sideBarProps:{tabs:[]},sideContentHeight:e.sideContentHeight,sideContentProps:((e,t)=>{const s=a;let n;if("question"===i){const a=s.questions[e.questionId].type,i="mcq"===a?Object(se.jsx)(au,{assessment:s,questionId:t,updateAssessment:E}):Object(se.jsx)(cu,{assessment:s,questionId:t,updateAssessment:E,editorValue:e.editorTabs[0].value,handleEditorValueChange:e.handleEditorValueChange,handleUpdateActiveEditorTab:e.handleUpdateActiveEditorTab});n=[{label:`Question ${t+1}`,iconName:w.a.NINJA,body:Object(se.jsx)(Ud,{assessment:s,path:["questions",t,"content"],updateAssessment:E}),id:Ce.b.editorQuestionOverview},{label:"Question Template",iconName:w.a.DOCUMENT,body:i,id:Ce.b.editorQuestionTemplate},{label:"Manage Local Deployment",iconName:w.a.HOME,body:Object(se.jsx)(Zd,{assessment:s,label:"Question Specific",handleRefreshLibrary:y,pathToLibrary:["questions",t,"library"],updateAssessment:E,isOptionalDeployment:!0}),id:Ce.b.editorLocalDeployment},{label:"Manage Local Grader Deployment",iconName:w.a.CONFIRM,body:Object(se.jsx)(Zd,{assessment:s,label:"Question Specific Grader",handleRefreshLibrary:y,pathToLibrary:["questions",t,"graderLibrary"],pathToCopy:["questions",t,"library"],updateAssessment:E,isOptionalDeployment:!0}),id:Ce.b.editorLocalGraderDeployment},{label:"Grading",iconName:w.a.TICK,body:Object(se.jsx)(eu,{assessment:s,path:["questions",t],updateAssessment:E}),id:Ce.b.editorGrading}],"programming"===a&&n.push({label:"Autograder",iconName:w.a.AIRPLANE,body:Object(se.jsx)(Fd,{assessment:s,questionId:t,handleTestcaseEval:v,updateAssessment:E}),id:Ce.b.editorAutograder});s.globalDeployment.external.symbols.includes("get_matrix")&&n.push({label:"Tone Matrix",iconName:w.a.GRID_VIEW,body:Object(se.jsx)(xe,{}),id:Ce.b.toneMatrix})}else n=[{label:`${s.type} Briefing`,iconName:w.a.BRIEFCASE,body:Object(se.jsx)(Ud,{assessment:s,path:["longSummary"],updateAssessment:E}),id:Ce.b.editorBriefing},{label:"Manage Question",iconName:w.a.WRENCH,body:Object(se.jsx)(su,{assessment:s,hasUnsavedChanges:o,questionId:t,updateAssessment:T}),id:Ce.b.editorManageQuestion},{label:"Manage Global Deployment",iconName:w.a.GLOBE,body:Object(se.jsx)(Zd,{assessment:s,label:"Global",handleRefreshLibrary:y,pathToLibrary:["globalDeployment"],updateAssessment:E,isOptionalDeployment:!1}),id:Ce.b.editorGlobalDeployment},{label:"Manage Global Grader Deployment",iconName:w.a.CONFIRM,body:Object(se.jsx)(Zd,{assessment:s,label:"Global Grader",handleRefreshLibrary:y,pathToLibrary:["graderDeployment"],updateAssessment:E,isOptionalDeployment:!0}),id:Ce.b.editorGlobalGraderDeployment}];return{tabs:{beforeDynamicTabs:n,afterDynamicTabs:[]}}})(e,A),replProps:{handleBrowseHistoryDown:e.handleBrowseHistoryDown,handleBrowseHistoryUp:e.handleBrowseHistoryUp,handleReplEval:e.handleReplEval,handleReplValueChange:e.handleReplValueChange,output:e.output,replValue:e.replValue,sourceChapter:M.Chapter.CALC,sourceVariant:M.Variant.DEFAULT,externalLibrary:(null===I||void 0===I||null===(t=I.library)||void 0===t||null===(s=t.external)||void 0===s?void 0:s.name)||"NONE",replButtons:function(){const t=Object(se.jsx)(W.a,{handleReplOutputClear:e.handleReplOutputClear},"clear_repl");return[Object(se.jsx)(X.a,{handleReplEval:e.handleReplEval,isRunning:e.isRunning},"eval_repl"),t]}()}};return Object(se.jsxs)("div",{className:f()("WorkspaceParent",p.a.DARK),children:[Object(se.jsxs)(h.h,{className:"assessment-reset",icon:w.a.ERROR,isCloseButtonShown:!0,isOpen:l,title:"Confirmation: Reset editor?",children:[Object(se.jsx)("div",{className:p.a.DIALOG_BODY,children:Object(se.jsx)(ee.a,{content:"Are you sure you want to reset to your last save?"})}),Object(se.jsx)("div",{className:p.a.DIALOG_FOOTER,children:Object(se.jsxs)(h.c,{children:[Object(se.jsx)(J.a,{label:"Cancel",onClick:()=>d(!1),options:{minimal:!1}}),Object(se.jsx)(J.a,{label:"Confirm",onClick:()=>{const e=yd();n(e),c(!1),d(!1),m(S()),y(),O()},options:{minimal:!1,intent:g.a.DANGER}})]})})]}),Object(se.jsx)(Te.a,{...N})]})};const uu="assessment";var hu=Object(r.b)(((e,t)=>({activeEditorTabIndex:e.workspaces.assessment.activeEditorTabIndex,editorTabs:e.workspaces.assessment.editorTabs,hasUnsavedChanges:e.workspaces.assessment.hasUnsavedChanges,isRunning:e.workspaces.assessment.isRunning,isDebugging:e.workspaces.assessment.isDebugging,enableDebugging:e.workspaces.assessment.enableDebugging,output:e.workspaces.assessment.output,replValue:e.workspaces.assessment.replValue,sideContentHeight:e.workspaces.assessment.sideContentHeight,storedAssessmentId:e.workspaces.assessment.currentAssessment,storedQuestionId:e.workspaces.assessment.currentQuestion})),(e=>Object(c.b)({handleBrowseHistoryDown:()=>Object(N.browseReplHistoryDown)(uu),handleBrowseHistoryUp:()=>Object(N.browseReplHistoryUp)(uu),handleChapterSelect:(e,t)=>Object(N.chapterSelect)(e,M.Variant.DEFAULT,uu),handleClearContext:(e,t)=>Object(N.beginClearContext)(uu,e,t),handleDeclarationNavigate:e=>Object(N.navigateToDeclaration)(uu,e),handleEditorEval:()=>Object(N.evalEditor)(uu),handleEditorValueChange:e=>Object(N.updateEditorValue)(e,uu),handleEditorUpdateBreakpoints:e=>Object(N.setEditorBreakpoint)(e,uu),handleInterruptEval:()=>Object(xs.beginInterruptExecution)(uu),handleReplEval:()=>Object(N.evalRepl)(uu),handleReplOutputClear:()=>Object(N.clearReplOutput)(uu),handleReplValueChange:e=>Object(N.updateReplValue)(e,uu),handleResetWorkspace:e=>Object(N.resetWorkspace)(uu,e),handleUpdateWorkspace:e=>Object(N.updateWorkspace)(uu,e),handleUpdateActiveEditorTab:e=>Object(N.updateActiveEditorTab)(uu,e),handleSave:u.submitAnswer,handleSideContentHeightChange:e=>Object(N.changeSideContentHeight)(e,uu),handleTestcaseEval:e=>Object(N.evalTestcase)(uu,e),handleUpdateHasUnsavedChanges:e=>Object(N.updateHasUnsavedChanges)(uu,e),handleUpdateCurrentAssessmentId:N.updateCurrentAssessmentId,handleDebuggerPause:()=>Object(xs.beginDebuggerPause)(uu),handleDebuggerResume:()=>Object(xs.debuggerResume)(uu),handleDebuggerReset:()=>Object(xs.debuggerReset)(uu),handlePromptAutocomplete:(e,t,s)=>Object(N.promptAutocomplete)(uu,e,t,s)},e)))(du);class pu extends j.Component{constructor(e){super(e),this.fileReader=void 0,this.handleFileRead=e=>t=>{if(!this.fileReader)return;const s=this.fileReader.result;s&&Object(bd.parseString)(s,((t,s)=>{console.dir(e);try{const t=(e=>{const t=xd(e);return[vd(e,t[1]),t[0]]})(s);t[0].fileName=e.name.slice(0,-4),fd(t[0]),this.props.updateEditingOverview(t[0]),Od(t[1]),this.props.newAssessment(t[1]),this.setState({fileInputText:"Success!"})}catch(t){console.log(t),this.setState({fileInputText:"Invalid XML!"})}}))},this.handleChangeFile=e=>{const t=e.target.files;e.target.files&&(this.fileReader=new FileReader,this.fileReader.onloadend=this.handleFileRead(t[0]),this.fileReader.readAsText(t[0]))},this.makeMission=()=>{fd(Object(H.j)()),this.props.updateEditingOverview(Object(H.j)()),Od(Object(H.g)()),this.props.newAssessment(Object(H.g)())},this.handleFileRead=this.handleFileRead.bind(this),this.handleChangeFile=this.handleChangeFile.bind(this),this.makeMission=this.makeMission.bind(this),this.state={fileInputText:"Import XML"}}componentDidMount(){const e=yd();e&&this.props.newAssessment(e)}render(){return Object(se.jsxs)("div",{children:[Object(se.jsx)("div",{children:"Please ensure that the xml uploaded is trustable."}),Object(se.jsx)("div",{children:Object(se.jsx)(h.m,{text:this.state.fileInputText,inputProps:{accept:".xml"},onChange:this.handleChangeFile})}),Object(se.jsx)("div",{children:Object(se.jsx)(J.a,{label:"Make New Mission",icon:w.a.NEW_OBJECT,onClick:this.makeMission})})]})}}var gu=pu;var mu=Object(r.b)(((e,t)=>t),(e=>Object(c.b)({newAssessment:u.updateAssessment},e)))(gu);const bu=()=>{};var ju=e=>{const[t,s]=Object(j.useState)((()=>{const e=localStorage.getItem("MissionEditingOverviewSA");return e?JSON.parse(e):null})()),a=Object(Ee.b)(e.match.params.assessmentId),n=Object(Ee.b)(e.match.params.questionId)||Se.b.defaultQuestionId;if(-1===a&&t){const e=t,i={assessmentId:a,questionId:n,assessmentOverview:e,updateAssessmentOverview:s,notAttempted:e.status===H.a.not_attempted,closeDate:e.closeAt};return Object(se.jsx)("div",{className:"Academy",children:Object(se.jsx)(hu,{...i})})}const i=Object(se.jsxs)(se.Fragment,{children:[Object(se.jsx)(mu,{updateEditingOverview:s}),t&&Object(se.jsx)(Nd,{overview:t,updateEditingOverview:s,listingPath:"/mission-control",assessmentTypes:e.assessmentTypes})]});return Object(se.jsx)("div",{className:"Assessment Academy",children:Object(se.jsx)(_e.a,{display:i,loadContentDispatch:bu})})};var yu=Object(o.l)(Object(r.b)((e=>{var t;return{assessmentTypes:(null===(t=e.session.assessmentConfigurations)||void 0===t?void 0:t.map((e=>e.type)))||[]}}))(ju)),Ou=s(134),fu=s(184),vu=s(248),xu=s(127);const Cu=e=>Object(se.jsx)(E.a,{content:"Execution Time",placement:S.a.TOP,children:Object(se.jsx)(h.H,{leftIcon:w.a.TIME,style:{width:80},min:1e3,value:e.execTime,onValueChange:e.handleChangeExecTime})});var Su=s(221);function wu(e){Object(me.e)(`Could not connect: ${e&&e.message||e||"Unknown error"}`)}class Eu extends j.PureComponent{constructor(e){super(e),this.inviteInputElem=void 0,this.state={joinElemValue:""},this.handleChange=this.handleChange.bind(this),this.inviteInputElem=j.createRef(),this.selectInviteInputText=this.selectInviteInputText.bind(this)}render(){const e=Object(se.jsxs)(se.Fragment,{children:[Object(se.jsx)("input",{value:this.props.editorSessionId,readOnly:!0,ref:this.inviteInputElem}),Object(se.jsx)(Us,{text:""+this.props.editorSessionId,children:Object(se.jsx)(J.a,{icon:w.a.DUPLICATE,onClick:this.selectInviteInputText})})]}),t=Object(se.jsx)(Le.a,{popoverClassName:"Popover-share",inheritDarkTheme:!1,content:e,children:Object(se.jsx)(J.a,{label:"Invite",icon:w.a.GRAPH,onClick:()=>{""===this.props.editorSessionId&&Object(Su.b)(this.props.editorValue||"").then((e=>{this.props.handleSetEditorSessionId(e)}),wu)}})}),s=Object(se.jsxs)("form",{onSubmit:e=>{e.preventDefault(),Object(Su.a)(this.state.joinElemValue).then((e=>{e?this.props.handleSetEditorSessionId(this.state.joinElemValue):(this.props.handleSetEditorSessionId(""),Object(me.e)("Could not find a session with that ID."))}),(e=>{this.props.handleSetEditorSessionId(""),wu(e)}))},children:[Object(se.jsx)("input",{type:"text",value:this.state.joinElemValue,onChange:this.handleChange}),Object(se.jsx)("span",{className:p.a.POPOVER_DISMISS,children:Object(se.jsx)(J.a,{icon:w.a.KEY_ENTER,options:{type:"submit"}})})]}),a=Object(se.jsx)(Le.a,{popoverClassName:"Popover-share",inheritDarkTheme:!1,content:s,children:Object(se.jsx)(J.a,{label:"Join",icon:w.a.LOG_IN})}),n=Object(se.jsx)(J.a,{label:"Leave",icon:w.a.FEED,onClick:()=>{this.props.handleSetEditorSessionId(""),this.setState({joinElemValue:""})}});return Object(se.jsx)(Le.a,{content:Object(se.jsxs)(h.A,{large:!0,children:[t,""===this.props.editorSessionId?a:n]}),children:Object(se.jsx)(J.a,{label:"Session",icon:w.a.SOCIAL_MEDIA,options:{iconColor:""===this.props.editorSessionId?void 0:this.props.sharedbConnected?Zo.Colors.GREEN3:Zo.Colors.RED3}})})}selectInviteInputText(){null!==this.inviteInputElem.current&&(this.inviteInputElem.current.focus(),this.inviteInputElem.current.select())}handleChange(e){this.setState({joinElemValue:e.target.value})}}class Tu extends j.PureComponent{constructor(e){super(e),this.shareInputElem=void 0,this.selectShareInputText=this.selectShareInputText.bind(this),this.handleChange=this.handleChange.bind(this),this.toggleButton=this.toggleButton.bind(this),this.shareInputElem=j.createRef(),this.state={keyword:"",isLoading:!1}}render(){const e=void 0===this.props.queryString?Object(se.jsx)(h.Y,{children:"Share your programs! Type something into the editor (left), then click on this button again."}):this.props.isSicp?Object(se.jsxs)("div",{children:[Object(se.jsx)("input",{defaultValue:this.props.queryString,readOnly:!0,ref:this.shareInputElem}),Object(se.jsx)(E.a,{content:"Copy link to clipboard",children:Object(se.jsx)(Us,{text:this.props.queryString,children:Object(se.jsx)(J.a,{icon:w.a.DUPLICATE,onClick:this.selectShareInputText})})})]}):Object(se.jsx)(se.Fragment,{children:this.props.shortURL&&"ERROR"!==this.props.shortURL?Object(se.jsxs)("div",{children:[Object(se.jsx)("input",{defaultValue:this.props.shortURL,readOnly:!0,ref:this.shareInputElem}),Object(se.jsx)(E.a,{content:"Copy link to clipboard",children:Object(se.jsx)(Us,{text:this.props.shortURL,children:Object(se.jsx)(J.a,{icon:w.a.DUPLICATE,onClick:this.selectShareInputText})})})]},this.props.shortURL):this.state.isLoading&&"ERROR"!==this.props.shortURL?Object(se.jsx)("div",{children:Object(se.jsx)(h.G,{description:"Generating Shareable Link...",icon:Object(se.jsx)(h.R,{size:h.S.SMALL})})}):Object(se.jsxs)("div",{children:[Se.b.urlShortenerBase,"\xa0",Object(se.jsx)("input",{placeholder:"custom string (optional)",onChange:this.handleChange,style:{width:175}}),Object(se.jsx)(J.a,{label:"Get Link",icon:w.a.SHARE,onClick:()=>{this.props.handleShortenURL(this.state.keyword),this.setState({isLoading:!0})}})]})});return Object(se.jsx)(Le.a,{popoverClassName:"Popover-share",inheritDarkTheme:!1,content:e,children:Object(se.jsx)(E.a,{content:"Get shareable link",placement:S.a.TOP,children:Object(se.jsx)(J.a,{label:"Share",icon:w.a.SHARE,onClick:()=>this.toggleButton()})})})}componentDidUpdate(e){this.props.shortURL!==e.shortURL&&this.setState({keyword:"",isLoading:!1})}toggleButton(){this.props.handleGenerateLz&&this.props.handleGenerateLz(),this.props.handleUpdateShortURL(""),this.setState({keyword:"",isLoading:!1})}handleChange(e){this.setState({keyword:e.currentTarget.value})}selectShareInputText(){null!==this.shareInputElem.current&&(this.shareInputElem.current.focus(),this.shareInputElem.current.select())}}const ku=e=>Object(se.jsx)(E.a,{content:"Step Limit",placement:S.a.TOP,children:Object(se.jsx)(h.H,{leftIcon:w.a.VERTICAL_BAR_CHART_ASC,style:{width:80},min:500,max:5e3,value:e.stepLimit,onValueChange:e.handleChangeStepLimit})}),Au=`\n\nIn the editor on the left, you can use the [_Ace keyboard shortcuts_](${Se.a.aceHotkeys}) \nand also the [_Source Academy keyboard shortcuts_](${Se.a.sourceHotkeys}).\n\n`,Iu=(e,t)=>"\nWelcome to the Source Academy playground!\n"+Au,Nu={goGreen:"h u l k"};const Mu=[Ce.b.mobileEditor,Ce.b.mobileEditorRun],Pu=[Ce.b.introduction];var Ru=e=>{let{workspaceLocation:t="playground",...s}=e;const{isSicpEditor:a}=s,{isMobileBreakpoint:n}=Object(v.e)(),i=j.useRef(s);i.current=s;const c=Object(r.c)(),[l,d]=j.useState(),u=Object(o.i)(),h=Object(o.h)(),g=new URLSearchParams(u.search).get("add_device");g&&!l&&(d(g),h.replace(u.pathname));const[,m]=j.useState(new Date),[b,y]=j.useState(!1),[O,C]=j.useState(g?Ce.b.remoteExecution:Ce.b.introduction),[S,E]=j.useState(!1),[A,I]=j.useState((()=>B("playground",{editorValue:i.current.editorTabs[0].value,chapter:i.current.playgroundSourceChapter}))),P=Object(v.f)((e=>!!e.session.remoteExecutionSession))&&!a,R=Object(v.f)((e=>e.workspaces.playground.externalLibrary));j.useEffect((()=>{I(B("playground",{editorValue:i.current.editorTabs[0].value,chapter:i.current.playgroundSourceChapter}))}),[s.editorSessionId]);const _=a?s.initialEditorValueHash:s.location.hash;j.useEffect((()=>{_?async function(e,t){var s,a,n;const i=cd(e),r=Object(Ee.b)(i.chap)||void 0,o=null!==(s=i.lz)&&void 0!==s?s:i.prgrm,c=o&&Object(fu.decompressFromEncodedURIComponent)(o);c&&t.handleEditorValueChange(c);const l=null!==(a=null===(n=x.n.find((e=>e.chapter===r&&e.variant===i.variant)))||void 0===n?void 0:n.variant)&&void 0!==a?a:M.Variant.DEFAULT;r&&t.handleChapterSelect(r,l);const d=Math.max(Object(Ee.b)(i.exec||"1000")||1e3,1e3);d&&t.handleChangeExecTime(d)}(_,i.current):s.courseSourceChapter&&s.courseSourceVariant&&i.current.handleChapterSelect(s.courseSourceChapter,s.courseSourceVariant)}),[_,s.courseSourceChapter,s.courseSourceVariant]),j.useEffect((()=>{n&&Pu.includes(O)?C(Ce.b.mobileEditor):!n&&Mu.includes(O)&&C(Ce.b.introduction)}),[n,O]);const L=j.useMemo((()=>({goGreen:()=>y(!b)})),[b]),U=j.useCallback((e=>{m(new Date),i.current.handleEditorValueChange(e)}),[]),G=j.useCallback(((e,t,s)=>{if(e===t)return;const{handleUsingSubst:a,handleReplOutputClear:n,playgroundSourceChapter:r}=i.current;t===Ce.b.substVisualizer&&e===Ce.b.mobileEditorRun||(r<=2&&e===Ce.b.substVisualizer&&a(!0),t!==Ce.b.substVisualizer||S||(n(),a(!1)),C(e))}),[S]),F=j.useCallback((e=>{D(A,e)}),[A]),H=j.useCallback((()=>c(Object(N.evalEditor)(t))),[c,t]),$=j.useMemo((()=>Object(j.createElement)(Ss,{...k.a.pick(s,"isDebugging","isEditorAutorun","isRunning"),handleInterruptEval:()=>c(Object(xs.beginInterruptExecution)(t)),handleToggleEditorAutorun:()=>c(Object(N.toggleEditorAutorun)(t)),handleEditorEval:H,handleDebuggerPause:()=>c(Object(xs.beginDebuggerPause)(t)),handleDebuggerReset:()=>c(Object(xs.debuggerReset)(t)),handleDebuggerResume:()=>c(Object(xs.debuggerResume)(t)),key:"autorun",autorunDisabled:P,sourceChapter:s.playgroundSourceChapter,pauseDisabled:P||!Object(x.m)(s.playgroundSourceChapter)})),[c,H,s,P,t]),q=j.useCallback(((e,t)=>{let{chapter:s,variant:a}=e;const{handleUsingSubst:n,handleReplOutputClear:r,handleChapterSelect:o}=i.current;(s<=2&&S||O===Ce.b.substVisualizer)&&n(!0),s>2&&(r(),n(!1));const c={time:Date.now(),type:"chapterSelect",data:s};F(c),o(s,a)}),[S,O,F]),z=j.useMemo((()=>Object(se.jsx)(V.a,{handleChapterSelect:q,sourceChapter:s.playgroundSourceChapter,sourceVariant:s.playgroundSourceVariant,disabled:P},"chapter")),[q,s.playgroundSourceChapter,s.playgroundSourceVariant,P]),Y=j.useMemo((()=>O===Ce.b.substVisualizer?null:Object(se.jsx)(W.a,{handleReplOutputClear:s.handleReplOutputClear},"clear_repl")),[s.handleReplOutputClear,O]),K=j.useMemo((()=>O===Ce.b.substVisualizer?null:Object(se.jsx)(X.a,{handleReplEval:s.handleReplEval,isRunning:s.isRunning},"eval_repl")),[s.handleReplEval,s.isRunning,O]),Q=j.useMemo((()=>Object(se.jsx)(Cu,{execTime:s.execTime,handleChangeExecTime:s.handleChangeExecTime},"execution_time")),[s.execTime,s.handleChangeExecTime]),J=j.useMemo((()=>Object(se.jsx)(ku,{stepLimit:s.stepLimit,handleChangeStepLimit:e=>c(Object(N.changeStepLimit)(e,t))},"step_limit")),[c,s.stepLimit,t]),{handleEditorValueChange:ae}=s,ne=Object(se.jsx)(Eu,{editorSessionId:s.editorSessionId,editorValue:s.editorTabs[0].value,handleSetEditorSessionId:e=>c(Object(vu.setEditorSessionId)(t,e)),sharedbConnected:s.sharedbConnected},"session"),ie=j.useMemo((()=>{const e=a?Se.a.playground+"#"+s.initialEditorValueHash:s.queryString;return Object(se.jsx)(Tu,{handleGenerateLz:()=>c(Object(xu.generateLzString)()),handleShortenURL:e=>c(Object(xu.shortenURL)(e)),handleUpdateShortURL:e=>c(Object(xu.updateShortURL)(e)),queryString:e,shortURL:s.shortURL,isSicp:a},"share")}),[c,a,s.initialEditorValueHash,s.queryString,s.shortURL]),re=j.useMemo((()=>({label:"Introduction",iconName:w.a.HOME,body:Object(se.jsx)(ee.a,{content:Iu(s.playgroundSourceChapter,s.playgroundSourceVariant),openLinksInNewWindow:!0}),id:Ce.b.introduction})),[s.playgroundSourceChapter,s.playgroundSourceVariant]),oe=j.useMemo((()=>[re]),[re]),ce=[...oe].filter((e=>{let{id:t}=e;return!(t&&Pu.includes(t))})),le=j.useCallback((e=>{const t=()=>{e.getSession().addFold("    ",new Ou.Range(1,0,s.prependLength,0)),e.renderer.off("afterRender",t)};e.renderer.on("afterRender",t)}),[s.prependLength]),de=j.useCallback(((e,t)=>{ae(e);const s={time:Date.now(),type:"codeDelta",data:t};F(s)}),[ae,F]),ue=j.useCallback((e=>{const t={time:Date.now(),type:"cursorPositionChange",data:e.getCursor()};F(t)}),[F]),he=j.useCallback((e=>{const t=e.getRange(),s=e.isBackwards();if(!Object(T.isEqual)(t.start,t.end)){const e={time:Date.now(),type:"selectionRangeData",data:{range:t,isBackwards:s}};F(e)}}),[F]),pe=j.useCallback((e=>{const t=e.filter((e=>!!e)).length;t>0&&(E(!0),i.current.playgroundSourceChapter<=2&&i.current.handleUsingSubst(!0)),0===t&&(E(!1),O!==Ce.b.substVisualizer&&(i.current.handleReplOutputClear(),i.current.handleUsingSubst(!1))),i.current.handleEditorUpdateBreakpoints(e)}),[O]),ge=P,me={...k.a.pick(s,"editorSessionId","isEditorAutorun"),editorVariant:"normal",editorTabs:s.editorTabs.map(Z.a),handleDeclarationNavigate:e=>c(Object(N.navigateToDeclaration)(t,e)),handleEditorEval:H,handlePromptAutocomplete:(e,s,a)=>c(Object(N.promptAutocomplete)(t,e,s,a)),handleSendReplInputToOutput:e=>c(Object(N.sendReplInputToOutput)(e,t)),handleSetSharedbConnected:e=>c(Object(vu.setSharedbConnected)(t,e)),onChange:de,onCursorChange:ue,onSelectionChange:he,onLoad:a&&s.prependLength?le:void 0,sourceChapter:s.playgroundSourceChapter,externalLibraryName:R,sourceVariant:s.playgroundSourceVariant,handleEditorValueChange:U,handleEditorUpdateBreakpoints:pe},be={...k.a.pick(s,"output","replValue","handleReplEval","usingSubst"),handleBrowseHistoryDown:()=>c(Object(N.browseReplHistoryDown)(t)),handleBrowseHistoryUp:()=>c(Object(N.browseReplHistoryUp)(t)),handleReplValueChange:e=>c(Object(N.updateReplValue)(e,t)),sourceChapter:s.playgroundSourceChapter,sourceVariant:s.playgroundSourceVariant,externalLibrary:Hd.a.NONE,hidden:O===Ce.b.substVisualizer,inputHidden:ge,replButtons:[ge?null:K,Y],disableScrolling:a},je={tabs:[]},ye={controlBarProps:{editorButtons:[$,z,P||!Object(x.m)(s.playgroundSourceChapter)?null:s.usingSubst?J:Q]},editorContainerProps:me,handleSideContentHeightChange:e=>c(Object(N.changeSideContentHeight)(e,t)),replProps:be,sideBarProps:je,sideContentHeight:s.sideContentHeight,sideContentProps:{selectedTabId:O,onChange:G,tabs:{beforeDynamicTabs:oe,afterDynamicTabs:[]},workspaceLocation:a?"sicp":"playground",sideContentHeight:s.sideContentHeight},sideContentIsResizeable:O!==Ce.b.substVisualizer},Oe={editorContainerProps:me,replProps:be,sideBarProps:je,mobileSideContentProps:{mobileControlBarProps:{editorButtons:[$,z,ie,a?null:ne]},selectedTabId:O,onChange:G,tabs:{beforeDynamicTabs:ce,afterDynamicTabs:[]},workspaceLocation:a?"sicp":"playground"}};return n?Object(se.jsx)("div",{className:f()("Playground",p.a.DARK,b?"GreenScreen":void 0),children:Object(se.jsx)(te.a,{...Oe})}):Object(se.jsx)(ws.HotKeys,{className:f()("Playground",p.a.DARK,b?"GreenScreen":void 0),keyMap:Nu,handlers:L,children:Object(se.jsx)(Te.a,{...ye})})};const _u=e=>({...k.a.pick(e.workspaces.playground,"activeEditorTabIndex","editorTabs","editorSessionId","execTime","stepLimit","isEditorAutorun","isRunning","isDebugging","enableDebugging","output","replValue","sideContentHeight","sharedbConnected","usingSubst"),queryString:e.playground.queryString,shortURL:e.playground.shortURL,playgroundSourceChapter:M.Chapter.CALC,playgroundSourceVariant:e.workspaces.playground.context.variant,courseSourceChapter:e.session.sourceChapter,courseSourceVariant:e.session.sourceVariant,persistenceUser:e.session.googleUser,persistenceFile:e.playground.persistenceFile,githubOctokitObject:e.session.githubOctokitObject,githubSaveInfo:e.playground.githubSaveInfo}),Lu="playground",Du=e=>Object(c.b)({handleChangeExecTime:e=>Object(N.changeExecTime)(e,Lu),handleChapterSelect:(e,t)=>Object(N.chapterSelect)(e,t,Lu),handleEditorValueChange:e=>Object(N.updateEditorValue)(e,Lu),handleEditorUpdateBreakpoints:e=>Object(N.setEditorBreakpoint)(e,Lu),handleReplEval:()=>Object(N.evalRepl)(Lu),handleReplOutputClear:()=>Object(N.clearReplOutput)(Lu),handleUsingSubst:e=>Object(N.toggleUsingSubst)(e,Lu)},e);var Bu=()=>{const e=Object(o.l)(Object(r.b)(_u,Du)(Ru));return Object(se.jsx)(e,{workspaceLocation:Lu})};var Uu=()=>{const e=Object(v.f)((e=>e.session.name));return Object(se.jsx)("div",{className:"fullpage",children:Object(se.jsx)(h.e,{className:"fullpage-content",children:Object(se.jsx)("div",{style:{marginTop:"20px",display:"flex",justifyContent:"center"},children:Object(se.jsxs)("div",{children:[Object(se.jsxs)(h.p,{children:["Welcome to ",Se.b.sourceAcademyDeploymentName]}),Object(se.jsxs)("div",{children:["You have logged in as ",Object(se.jsx)("strong",{children:e}),". ",Se.b.sourceAcademyDeploymentName," ","does not have any course information for this account."]}),Object(se.jsx)("div",{style:{display:"flex",justifyContent:"center"},children:Object(se.jsxs)(h.cb,{style:{textAlign:"left"},children:[Object(se.jsx)("li",{children:"If you are enrolled in a course, check with the course staff to make sure your account is added to the course."}),Object(se.jsxs)("li",{children:["If you are looking for a course to join, check"," ",Object(se.jsx)("a",{href:Se.a.resourcesForLearners,children:"here"})," to find a course that suits your needs."]}),Object(se.jsxs)("li",{children:["If you are an instructor and want to create a course, click"," ",Object(se.jsx)("a",{href:Se.a.resourcesForEducators,children:"here"})," for a list of resources to get started."]})]})})]})})})})},Gu=s(1308),Fu=s(242);var Hu=e=>{const{item:t}=e,s=t.maxXp<=0&&0===t.xp,a=Object(se.jsxs)("div",{className:"xp-details",children:[Object(se.jsx)("div",{className:"title",children:"XP"}),Object(se.jsxs)("div",{className:"value",children:[t.xp," / ",t.maxXp]}),Object(se.jsx)(h.N,{animate:!1,className:"value-bar"+e.parseColour(e.getFrac(t.xp,t.maxXp)),stripes:!1,value:e.getFrac(t.xp,t.maxXp)})]});return Object(se.jsx)(A.b,{className:"profile-summary-navlink",target:"_blank",to:`/courses/${e.courseId}/${Object(Ee.a)(t.type)}/${t.id}/0`,activeClassName:"profile-summary-navlink",children:Object(se.jsx)(h.d,{className:"profile-summary-callout",icon:e.renderIcon(t.type),title:t.title,children:s?"":a},`${t.title}-${t.id}`)},`${t.title}-${t.id}`)};var Vu=e=>{const{name:t,role:s,assessmentOverviews:a,assessmentConfigurations:n,xp:i,courseId:o}=Object(v.f)((e=>e.session)),c=Object(r.c)();Object(j.useEffect)((()=>{t&&s&&!a&&c(Object(u.fetchAssessmentOverviews)())}),[a,c,t,s,i]),Object(j.useEffect)((()=>{o&&!i&&c(Object(u.fetchTotalXp)())}),[o,c,i]);const[l,d]=Object(j.useState)(t&&s&&a);let p;if(Object(j.useEffect)((()=>{d(t&&s&&a)}),[a,t,s]),l){const e=a.filter((e=>e.status===H.a.submitted)).length,r=i||0,c=Se.b.caFulfillmentLevel,l=1e3*c,d=Object(se.jsx)("div",{className:"profile-header",children:Object(se.jsxs)("div",{className:"profile-username",children:[Object(se.jsx)("div",{className:"name",children:t}),Object(se.jsx)("div",{className:"role",children:s})]})});if(0===e)p=Object(se.jsxs)("div",{className:"profile-content",children:[d,Object(se.jsx)("div",{className:"profile-placeholder",children:"There are no closed assessments to render grade and XP of."})]});else{const e=(e,t)=>t<=0||e/t>1?1:e/t,t=e=>e<0?"":e>=.8?" progress-steelblue":e>=.45?" progress-deepskyblue":" progress-skyblue",s=e=>{const t=[w.a.FLAME,w.a.LIGHTBULB,w.a.PREDICTIVE_ANALYSIS,w.a.COMPARISON,w.a.MANUAL];if(n){const s=n.findIndex((t=>t.type===e));return s>0?t[s]:w.a.PULSE}return w.a.PULSE},i=a.filter((e=>e.status===H.a.submitted&&(e.gradingStatus===H.c.graded||e.gradingStatus===H.c.excluded))).map(((a,n)=>Object(se.jsx)(Hu,{item:a,getFrac:e,parseColour:t,renderIcon:s,courseId:o},n)));p=Object(se.jsxs)("div",{className:"profile-content",children:[d,Object(se.jsx)("div",{className:"profile-progress",children:Object(se.jsxs)("div",{className:"profile-xp",children:[Object(se.jsx)(h.R,{className:"profile-spinner"+t(e(r,l)),size:144,value:e(r,l)}),Object(se.jsx)("div",{className:"type",children:"XP Progress"}),Object(se.jsxs)("div",{className:"total-value",children:[r," / ",l,"*"]}),Object(se.jsxs)("div",{className:"percentage",children:[(100*e(r,l)).toFixed(2),"%"]})]})}),Object(se.jsxs)("div",{className:"profile-xp-footer",children:["*",l,"XP needed to reach full CA level of ",c]}),Object(se.jsx)("div",{className:"profile-callouts",children:i})]})}}else p=Object(se.jsx)(h.G,{description:"Loading...",icon:Object(se.jsx)(h.R,{})});return Object(se.jsx)(h.j,{className:"profile",icon:w.a.USER,isCloseButtonShown:!0,isOpen:e.isOpen,onClose:e.onClose,title:"User Profile",position:"left",size:h.k.SMALL,children:p})};var Wu=e=>Object(se.jsx)(h.h,{className:"about",icon:w.a.HELP,isCloseButtonShown:!0,isOpen:e.isOpen,onClose:e.onClose,title:"About",children:Object(se.jsx)("div",{className:p.a.DIALOG_BODY,children:Object(se.jsxs)("div",{className:"abt",children:[Object(se.jsxs)("p",{children:["The ",Object(se.jsx)("i",{children:"Source Academy"})," is a computer-mediated learning environment for studying the structure and interpretation of computer programs. Students write and run their programs in their web browser, using sublanguages of JavaScript called"," ",Object(se.jsx)("a",{href:Se.a.sourceDocs,children:"Source"}),", designed for the textbook"," ",Object(se.jsx)("a",{href:Se.a.textbook,children:"Structure and Interpretation of Computer Programs, JavaScript Edition"}),"."]}),Object(se.jsxs)("p",{children:["The Source Academy is available under the Apache License 2.0 at the GitHub organisation"," ",Object(se.jsx)("a",{href:Se.a.githubOrg,children:"source-academy"}),". More information and resources are available at the ",Object(se.jsx)("a",{href:Se.a.about,children:"about pages"})," of the Source Academy."]})]})})});var Xu=e=>{const{courses:t}=e,s=t.map((e=>({value:e.courseId,label:e.courseName.concat(e.viewable?"":" - disabled"),disabled:!e.viewable&&e.role!==x.a.Admin})));return Object(se.jsx)(h.h,{className:"my-courses",icon:w.a.PROPERTIES,isCloseButtonShown:!0,isOpen:e.isOpen,onClose:e.onClose,title:"My Courses",children:Object(se.jsxs)("div",{className:p.a.DIALOG_BODY,children:[Object(se.jsx)("div",{children:"Select a course to switch to:"}),Object(se.jsx)(h.u,{value:e.courseId,options:s,fill:!0,onChange:t=>{we.a.push(`/courses/${t.currentTarget.value}`),e.onClose()},disabled:t.length<=1})]})})};var $u=e=>{const[t,s]=j.useState({courseName:"",courseShortName:"",viewable:!0,enableGame:!0,enableAchievements:!0,enableSourcecast:!0,sourceChapter:M.Chapter.CALC,sourceVariant:M.Variant.DEFAULT,moduleHelpText:""}),[a,n]=j.useState(na.WRITE),i=[{value:M.Chapter.CALC}],r=j.useCallback(((e,t,s)=>{e!==t&&n(e)}),[n]);return Object(se.jsx)(h.h,{className:"create-course",icon:w.a.ADD,isCloseButtonShown:!0,canOutsideClickClose:!1,isOpen:e.isOpen,onClose:e.onClose,title:"Create Course",children:Object(se.jsxs)("div",{className:p.a.DIALOG_BODY,children:[Object(se.jsx)("div",{children:Object(se.jsx)("b",{children:"Create your own Source Academy course and manage your own learners!"})}),Object(se.jsx)("br",{}),Object(se.jsx)(h.n,{helperText:"Please enter the course name that will be used for course selection",label:"Course Name",labelInfo:"(* required)",labelFor:"courseName",children:Object(se.jsx)(h.y,{id:"courseName",value:t.courseName,onChange:e=>s({...t,courseName:e.target.value})})}),Object(se.jsx)(h.n,{helperText:"Usually the module code of the course. This will be displayed on the top left.",label:"Course Short Name",labelInfo:"(optional)",labelFor:"courseShortName",children:Object(se.jsx)(h.y,{id:"courseShortName",value:t.courseShortName,onChange:e=>s({...t,courseShortName:e.target.value})})}),Object(se.jsxs)(h.n,{helperText:"The module help text will be used in the course help dialog.",labelFor:"moduleHelpText",children:[Object(se.jsx)(h.Y,{tagName:"span",children:"Module Help Text\xa0"}),Object(se.jsx)(h.Y,{tagName:"span",className:"optional-text",children:"(optional)"}),Object(se.jsxs)(h.V,{selectedTabId:a,onChange:r,className:"module-help-text-tabs",children:[Object(se.jsx)(h.U,{id:na.WRITE,title:"Write"}),Object(se.jsx)(h.U,{id:na.PREVIEW,title:"Preview"})]}),a===na.WRITE&&Object(se.jsx)(h.Z,{id:"moduleHelpText",className:"input-textarea",fill:!0,value:t.moduleHelpText,onChange:e=>s({...t,moduleHelpText:e.target.value})}),a===na.PREVIEW&&Object(se.jsx)("div",{className:"input-markdown",children:Object(se.jsx)(ee.a,{content:t.moduleHelpText||"",openLinksInNewWindow:!0})})]}),Object(se.jsxs)("div",{className:"boolean-container",children:[Object(se.jsxs)("div",{children:[Object(se.jsx)(h.T,{checked:t.viewable,inline:!0,label:"Viewable",onChange:e=>s({...t,viewable:e.target.checked})}),Object(se.jsx)(h.T,{checked:t.enableAchievements,inline:!0,label:"Enable Achievements",onChange:e=>s({...t,enableAchievements:e.target.checked})})]}),Object(se.jsxs)("div",{children:[Object(se.jsx)(h.T,{checked:t.enableGame,inline:!0,label:"Enable Game",onChange:e=>s({...t,enableGame:e.target.checked})}),Object(se.jsx)(h.T,{checked:t.enableSourcecast,inline:!0,label:"Enable Sourcecast",onChange:e=>s({...t,enableSourcecast:e.target.checked})})]})]}),Object(se.jsxs)("div",{children:[Object(se.jsx)(h.n,{label:"Default Source Chapter",labelInfo:"(configurable later on)",labelFor:"source-chapter",children:Object(se.jsx)(h.u,{id:"source-chapter",options:i,value:t.sourceChapter,onChange:e=>{s({...t,sourceChapter:parseInt(e.target.value)})},fill:!0})}),Object(se.jsx)(h.n,{label:"Default Source Variant",labelInfo:"(configurable later on)",labelFor:"source-variant",children:Object(se.jsx)(h.u,{id:"source-variant",options:(o=t.sourceChapter,x.n.filter((e=>e.chapter===o)).map((e=>({label:e.variant.replace(/^\w/,(e=>e.toUpperCase())),value:e.variant})))),value:t.sourceVariant,onChange:e=>{s({...t,sourceVariant:e.target.value})},fill:!0})})]}),Object(se.jsx)("div",{className:"create-course-button-container",children:Object(se.jsx)(h.b,{text:"Create Course",onClick:()=>{""!==t.courseName?(e.handleCreateCourse(t),e.onClose()):Object(me.e)("Course Name cannot be empty!")}})})]})});var o};var qu=e=>{const t=Object(v.f)((e=>e.session.moduleHelpText));return Object(se.jsx)(h.h,{className:"help",icon:w.a.ERROR,isCloseButtonShown:!0,isOpen:e.isOpen,onClose:e.onClose,title:"Help",children:Object(se.jsx)("div",{className:p.a.DIALOG_BODY,children:t?Object(se.jsx)(ee.a,{content:t,openLinksInNewWindow:!0}):Object(se.jsxs)(se.Fragment,{children:[Object(se.jsxs)("p",{children:["We recommend recent updates of the browsers ",Object(se.jsx)("b",{children:"Google Chrome"}),","," ",Object(se.jsx)("b",{children:"Microsoft Edge"}),", or ",Object(se.jsx)("b",{children:"Mozilla Firefox"})," to visit the Source Academy."]}),Object(se.jsxs)("p",{children:["If you encounter issues with the Source Academy using these browsers, please use the issue system of the"," ",Object(se.jsx)("a",{href:Se.a.githubIssues,children:"Source Academy frontend repository on GitHub"}),"."]})]})})})},zu=s(150);var Yu=e=>{const[t,s]=Object(j.useContext)(zu.b),a=Object(j.useMemo)((()=>[{label:"None",value:zu.a.NONE},{label:"Vim",value:zu.a.VIM},{label:"Emacs",value:zu.a.EMACS}]),[]);return Object(se.jsx)(h.h,{className:"settings",icon:w.a.COG,isCloseButtonShown:!0,isOpen:e.isOpen,onClose:e.onClose,title:"Settings",children:Object(se.jsx)("div",{className:p.a.DIALOG_BODY,children:Object(se.jsxs)(h.n,{label:"Editor Binding: ",labelFor:"editor-binding",inline:!0,children:[Object(se.jsx)(h.u,{id:"editor-binding",options:a,value:t.editorBinding,onChange:e=>{s({...t,editorBinding:e.target.value})}}),Object(se.jsx)(E.a,{position:h.L.TOP,className:"form-field-help-text",content:"Optional editor bindings for advanced users. Set to 'None' for default text editor behaviour.",children:Object(se.jsx)(h.w,{icon:"help"})})]})})})};const Ku=e=>e.replace(/\w\S*/g,(e=>e.charAt(0).toUpperCase()+e.substr(1).toLowerCase()));var Qu=e=>{const[t,s]=Object(j.useState)(!1),[a,n]=Object(j.useState)(!1),[i,r]=Object(j.useState)(!1),[o,c]=Object(j.useState)(!1),[l,d]=Object(j.useState)(!1),[u,p]=Object(j.useState)(!1);const g=()=>{s((e=>!e))},m=()=>{n((e=>!e))},b=()=>r((e=>!e)),y=()=>c((e=>!e)),O=()=>d((e=>!e)),f=()=>p((e=>!e));return Object(se.jsxs)(se.Fragment,{children:[Object(se.jsx)(Le.a,{content:function(e){const t=e.name&&null!=e.courseId?Object(se.jsx)(h.B,{icon:w.a.USER,onClick:y,text:Ku(e.name)}):null,s=e.name?Object(se.jsx)(h.B,{icon:w.a.PROPERTIES,onClick:O,text:"My Courses"}):null,a=e.name?Object(se.jsx)(h.B,{icon:w.a.ADD,onClick:f,text:"Create Course"}):null,n=e.name?Object(se.jsx)(h.B,{icon:w.a.LOG_OUT,text:"Logout",onClick:e.handleLogOut}):null;return Object(se.jsxs)(h.A,{children:[t,s,a,Object(se.jsx)(h.B,{icon:w.a.COG,onClick:g,text:"Settings"}),Object(se.jsx)(h.B,{icon:w.a.HELP,onClick:m,text:"About"}),Object(se.jsx)(h.B,{icon:w.a.ERROR,onClick:b,text:"Help"}),n]})}(e),inheritDarkTheme:!1,placement:S.a.BOTTOM,children:Object(se.jsx)(J.a,{icon:w.a.CARET_DOWN})}),Object(se.jsx)(Yu,{isOpen:t,onClose:g}),Object(se.jsx)(Wu,{isOpen:a,onClose:m}),Object(se.jsx)(qu,{isOpen:i,onClose:b}),e.name?Object(se.jsx)(Xu,{isOpen:l,onClose:O,courses:e.courses,courseId:e.courseId}):null,e.name?Object(se.jsx)($u,{isOpen:u,onClose:f,handleCreateCourse:e.handleCreateCourse}):null,e.name?Object(se.jsx)(Vu,{isOpen:o,onClose:y}):null]})};const Ju=[w.a.FLAME,w.a.LIGHTBULB,w.a.PREDICTIVE_ANALYSIS,w.a.COMPARISON,w.a.MANUAL,w.a.GRAPH,w.a.LAB_TEST,w.a.CALCULATOR];var Zu=e=>{var t;return Object(se.jsxs)(h.C,{className:"NavigationBar secondary-navbar",children:[Object(se.jsx)(h.E,{align:Fu.a.LEFT,children:null===(t=e.assessmentTypes)||void 0===t?void 0:t.map(((t,s)=>Object(se.jsxs)(A.b,{to:`/courses/${e.courseId}/${Object(Ee.a)(t)}`,activeClassName:p.a.ACTIVE,className:f()("NavigationBar__link",p.a.BUTTON,p.a.MINIMAL),children:[Object(se.jsx)(h.w,{icon:Ju[s]}),Object(se.jsx)("div",{className:"navbar-button-text hidden-xs hidden-sm",children:t}),Object(se.jsx)(Ve,{notificationFilter:Ue(t),disableHover:!0})]},s)))}),e.role===x.a.Admin||e.role===x.a.Staff?Object(se.jsxs)(h.E,{align:Fu.a.RIGHT,children:[Object(se.jsxs)(A.b,{to:`/courses/${e.courseId}/groundcontrol`,activeClassName:p.a.ACTIVE,className:f()("NavigationBar__link",p.a.BUTTON,p.a.MINIMAL),children:[Object(se.jsx)(h.w,{icon:w.a.SATELLITE}),Object(se.jsx)("div",{className:"navbar-button-text hidden-xs hidden-sm",children:"Ground Control"})]}),Object(se.jsxs)(A.b,{to:`/courses/${e.courseId}/dashboard`,activeClassName:p.a.ACTIVE,className:f()("NavigationBar__link",p.a.BUTTON,p.a.MINIMAL),children:[Object(se.jsx)(h.w,{icon:w.a.GLOBE}),Object(se.jsx)("div",{className:"navbar-button-text hidden-xs hidden-sm",children:"Dashboard"})]}),Object(se.jsxs)(A.b,{to:`/courses/${e.courseId}/sourcereel`,activeClassName:p.a.ACTIVE,className:f()("NavigationBar__link",p.a.BUTTON,p.a.MINIMAL),children:[Object(se.jsx)(h.w,{icon:w.a.MOBILE_VIDEO}),Object(se.jsx)("div",{className:"navbar-button-text hidden-xs hidden-sm hidden-md",children:"Sourcereel"})]}),e.role===x.a.Admin&&Object(se.jsxs)(A.b,{to:`/courses/${e.courseId}/xpcalculation`,activeClassName:p.a.ACTIVE,className:f()("NavigationBar__link",p.a.BUTTON,p.a.MINIMAL),children:[Object(se.jsx)(h.w,{icon:w.a.CALCULATOR}),Object(se.jsx)("div",{className:"navbar-button-text hidden-xs hidden-sm",children:"XP Calculation"})]}),Object(se.jsxs)(A.b,{to:`/courses/${e.courseId}/grading`,activeClassName:p.a.ACTIVE,className:f()("NavigationBar__link",p.a.BUTTON,p.a.MINIMAL),children:[Object(se.jsx)(h.w,{icon:w.a.ENDORSED}),Object(se.jsx)("div",{className:"navbar-button-text hidden-xs hidden-sm hidden-md",children:"Grading"}),Object(se.jsx)(Ve,{notificationFilter:Ue("Grading"),disableHover:!0})]}),Object(se.jsxs)(A.b,{to:`/courses/${e.courseId}/storysimulator`,activeClassName:p.a.ACTIVE,className:f()("NavigationBar__link",p.a.BUTTON,p.a.MINIMAL),children:[Object(se.jsx)(h.w,{icon:w.a.CROWN}),Object(se.jsx)("div",{className:"navbar-button-text hidden-xs hidden-sm hidden-md",children:"Story Simulator"})]}),e.role===x.a.Admin&&Object(se.jsxs)(A.b,{to:`/courses/${e.courseId}/adminpanel`,activeClassName:p.a.ACTIVE,className:f()("NavigationBar__link",p.a.BUTTON,p.a.MINIMAL),children:[Object(se.jsx)(h.w,{icon:w.a.SETTINGS}),Object(se.jsx)("div",{className:"navbar-button-text hidden-xs hidden-sm hidden-md hidden-lg",children:"Admin Panel"})]})]}):null]})};var eh=e=>{var t;return Object(se.jsxs)(h.j,{isOpen:e.isOpen,position:"left",onClose:e.onClose,title:"",className:p.a.DARK,children:[e.role?null===(t=e.assessmentTypes)||void 0===t?void 0:t.map(((t,s)=>Object(se.jsxs)(A.b,{to:`/courses/${e.courseId}/${Object(Ee.a)(t)}`,activeClassName:p.a.ACTIVE,className:f()("NavigationBar__link__mobile",p.a.BUTTON,p.a.MINIMAL,p.a.LARGE),onClick:e.onClose,children:[Object(se.jsx)(h.w,{icon:Ju[s]}),Object(se.jsx)("div",{children:t}),Object(se.jsx)(Ve,{notificationFilter:Ue(t),disableHover:!0})]},s))):Object(se.jsx)(se.Fragment,{}),e.role&&e.enableSourcecast&&Object(se.jsxs)(A.b,{activeClassName:p.a.ACTIVE,className:f()("NavigationBar__link__mobile",p.a.BUTTON,p.a.MINIMAL,p.a.LARGE),to:`/courses/${e.courseId}/sourcecast`,onClick:e.onClose,children:[Object(se.jsx)(h.w,{icon:w.a.MUSIC}),Object(se.jsx)("div",{children:"Sourcecast"})]}),e.role&&Object(se.jsxs)(A.b,{activeClassName:p.a.ACTIVE,className:f()("NavigationBar__link__mobile",p.a.BUTTON,p.a.MINIMAL,p.a.LARGE),to:"/playground",onClick:e.onClose,children:[Object(se.jsx)(h.w,{icon:w.a.CODE}),Object(se.jsx)("div",{children:"Playground"})]}),Se.b.enableGitHubAssessments&&Object(se.jsxs)(A.b,{activeClassName:p.a.ACTIVE,className:f()("NavigationBar__link_mobile",p.a.BUTTON,p.a.MINIMAL,p.a.LARGE),to:"/githubassessments",onClick:e.onClose,children:[Object(se.jsx)(h.w,{icon:w.a.BRIEFCASE}),Object(se.jsx)("div",{className:"navbar-button-text",children:"Classroom"})]}),e.name&&Object(se.jsxs)(A.b,{activeClassName:p.a.ACTIVE,className:f()("NavigationBar__link_mobile",p.a.BUTTON,p.a.MINIMAL,p.a.LARGE),to:"/sicpjs/",onClick:e.onClose,children:[Object(se.jsx)(h.w,{icon:w.a.BOOK}),Object(se.jsx)("div",{className:"navbar-button-text",children:"SICP JS"})]}),e.role&&e.enableAchievements&&Object(se.jsxs)(A.b,{activeClassName:p.a.ACTIVE,className:f()("NavigationBar__link__mobile",p.a.BUTTON,p.a.MINIMAL,p.a.LARGE),to:`/courses/${e.courseId}/achievements`,onClick:e.onClose,children:[Object(se.jsx)(h.w,{icon:w.a.MOUNTAIN}),Object(se.jsx)("div",{children:"Achievements"})]})]})};const th=/^\/courses\/\d+\/(sourcecast|achievements)/,sh=(e,t)=>!!e&&!th.test(t.pathname);var ah=e=>{var t;const[s,a]=j.useState(!1),{isMobileBreakpoint:n}=Object(v.e)(),i=Object(o.i)();Gu.a.onlyShowFocusOnTabs();const r=Se.b.enableGitHubAssessments?n?Object(se.jsx)(se.Fragment,{children:Object(se.jsxs)(h.E,{align:Fu.a.LEFT,children:[Object(se.jsx)(h.b,{onClick:()=>a(!s),icon:w.a.MENU,large:!0,minimal:!0}),Object(se.jsxs)(A.b,{className:f()("NavigationBar__link",p.a.BUTTON,p.a.MINIMAL),to:"/",children:[Object(se.jsx)(h.w,{icon:w.a.SYMBOL_DIAMOND}),Object(se.jsx)(h.F,{style:{paddingBottom:"0px"},children:"Source Academy"})]}),Object(se.jsxs)(h.j,{isOpen:s,position:"left",onClose:()=>a(!1),title:"",className:p.a.DARK,children:[Object(se.jsxs)(A.b,{activeClassName:p.a.ACTIVE,className:f()("NavigationBar__link__mobile",p.a.BUTTON,p.a.MINIMAL,p.a.LARGE),to:"/playground",onClick:()=>a(!1),children:[Object(se.jsx)(h.w,{icon:w.a.CODE}),Object(se.jsx)("div",{children:"Playground"})]}),Object(se.jsxs)(A.b,{activeClassName:p.a.ACTIVE,className:f()("NavigationBar__link__mobile",p.a.BUTTON,p.a.MINIMAL,p.a.LARGE),to:"/githubassessments/missions",onClick:()=>a(!1),children:[Object(se.jsx)(h.w,{icon:w.a.BRIEFCASE}),Object(se.jsx)("div",{children:"Classroom"})]})]})]})}):Object(se.jsxs)(h.E,{align:Fu.a.LEFT,children:[Object(se.jsxs)(A.b,{activeClassName:p.a.ACTIVE,className:f()("NavigationBar__link__mobile",p.a.BUTTON,p.a.MINIMAL),to:"/playground",children:[Object(se.jsx)(h.w,{icon:w.a.CODE}),Object(se.jsx)("div",{children:"Playground"})]}),Object(se.jsxs)(A.b,{activeClassName:p.a.ACTIVE,className:f()("NavigationBar__link__mobile",p.a.BUTTON,p.a.MINIMAL),to:"/githubassessments",children:[Object(se.jsx)(h.w,{icon:w.a.BRIEFCASE}),Object(se.jsx)("div",{children:"Classroom"})]})]}):Object(se.jsx)(h.E,{align:Fu.a.LEFT,children:Object(se.jsxs)(A.b,{activeClassName:p.a.ACTIVE,className:f()("NavigationBar__link__mobile",p.a.BUTTON,p.a.MINIMAL),to:"/playground",children:[Object(se.jsx)(h.w,{icon:w.a.CODE}),Object(se.jsx)("div",{children:"Playground"})]})}),c=Object(se.jsxs)(h.E,{align:Fu.a.LEFT,children:[(e.role||Se.b.enableGitHubAssessments)&&Object(se.jsx)(h.b,{onClick:()=>a(!s),icon:w.a.MENU,large:!0,minimal:!0}),Object(se.jsxs)(A.b,{className:f()("NavigationBar__link",p.a.BUTTON,p.a.MINIMAL),activeClassName:p.a.ACTIVE,to:null==e.courseId?"/welcome":`/courses/${e.courseId}`,children:[Object(se.jsx)(h.w,{icon:w.a.SYMBOL_DIAMOND}),Object(se.jsx)(h.F,{style:{paddingBottom:"0px"},children:e.courseShortName||"Source Academy @ NUS"})]}),(e.role||Se.b.enableGitHubAssessments)&&Object(se.jsx)(eh,{name:e.name,role:e.role,courseId:e.courseId,enableAchievements:e.enableAchievements,enableSourcecast:e.enableSourcecast,assessmentTypes:e.assessmentTypes,isOpen:s,onClose:()=>a(!1),handleGitHubLogIn:()=>e.handleGitHubLogIn,handleGitHubLogOut:()=>e.handleGitHubLogOut})]}),l=Object(se.jsx)(h.C,{children:Object(se.jsx)(h.E,{children:null===(t=e.assessmentTypes)||void 0===t?void 0:t.map(((t,s)=>Object(se.jsxs)(A.b,{to:`/courses/${e.courseId}/${Object(Ee.a)(t)}`,activeClassName:p.a.ACTIVE,className:f()("NavigationBar__link",p.a.BUTTON,p.a.MINIMAL),children:[Object(se.jsx)(h.w,{icon:Ju[s]}),Object(se.jsx)("div",{className:"navbar-button-text",children:t}),Object(se.jsx)(Ve,{notificationFilter:Ue(t),disableHover:!0})]},t)))})}),d=Object(se.jsxs)(A.b,{activeClassName:p.a.ACTIVE,className:f()("NavigationBar__link",p.a.BUTTON,p.a.MINIMAL),to:null==e.courseId?"/welcome":`/courses/${e.courseId}`,isActive:sh,children:[Object(se.jsx)(h.w,{icon:w.a.SYMBOL_DIAMOND}),Object(se.jsx)(h.F,{style:{paddingBottom:"0px"},children:e.courseShortName||"Source Academy @ NUS"})]}),u=["/playground","/contributors",`/courses/${e.courseId}/sourcecast`,`/courses/${e.courseId}/achievements`],g=null!=e.courseId&&!!u.find((e=>i.pathname.startsWith(e))),m=Object(se.jsxs)(h.E,{align:Fu.a.LEFT,children:[g?Object(se.jsx)(Le.a,{position:S.a.BOTTOM_RIGHT,interactionKind:"hover",content:l,popoverClassName:"desktop-navbar-popover",children:d}):d,e.role&&e.enableSourcecast&&Object(se.jsxs)(A.b,{activeClassName:p.a.ACTIVE,className:f()("NavigationBar__link",p.a.BUTTON,p.a.MINIMAL),to:`/courses/${e.courseId}/sourcecast`,children:[Object(se.jsx)(h.w,{icon:w.a.MUSIC}),Object(se.jsx)("div",{className:"navbar-button-text",children:"Sourcecast"})]}),e.role&&Object(se.jsxs)(A.b,{activeClassName:p.a.ACTIVE,className:f()("NavigationBar__link",p.a.BUTTON,p.a.MINIMAL),to:"/playground",children:[Object(se.jsx)(h.w,{icon:w.a.CODE}),Object(se.jsx)("div",{className:"navbar-button-text",children:"Playground"})]}),Se.b.enableGitHubAssessments&&Object(se.jsxs)(A.b,{activeClassName:p.a.ACTIVE,className:f()("NavigationBar__link",p.a.BUTTON,p.a.MINIMAL),to:"/githubassessments",children:[Object(se.jsx)(h.w,{icon:w.a.BRIEFCASE}),Object(se.jsx)("div",{className:"navbar-button-text",children:"Classroom"})]}),e.name,e.role&&e.enableAchievements&&Object(se.jsxs)(A.b,{activeClassName:p.a.ACTIVE,className:f()("NavigationBar__link",p.a.BUTTON,p.a.MINIMAL),to:`/courses/${e.courseId}/achievements`,children:[Object(se.jsx)(h.w,{icon:w.a.MOUNTAIN}),Object(se.jsx)("div",{className:"navbar-button-text",children:"Achievements"})]})]}),b=Object(se.jsxs)(h.E,{align:Fu.a.RIGHT,children:[Object(se.jsx)(A.b,{activeClassName:p.a.ACTIVE,className:f()("NavigationBar__link",p.a.BUTTON,p.a.MINIMAL),to:"/contributors",children:Object(se.jsx)(h.w,{icon:w.a.HEART})}),Object(se.jsx)("div",{className:"visible-xs",children:Object(se.jsx)(h.D,{className:"thin-divider"})}),Object(se.jsx)("div",{className:"hidden-xs",children:Object(se.jsx)(h.D,{className:"default-divider"})}),Object(se.jsx)(Qu,{handleLogOut:e.handleLogOut,handleCreateCourse:e.handleCreateCourse,courses:e.courses,courseId:e.courseId,name:e.name})]});return Object(se.jsxs)(se.Fragment,{children:[Object(se.jsxs)(h.C,{className:f()("NavigationBar","primary-navbar",p.a.DARK),children:[Se.b.playgroundOnly?r:n?c:m,b]}),Object(se.jsxs)(o.e,{children:[Object(se.jsx)(o.c,{path:"/playground"}),Object(se.jsx)(o.c,{path:"/githubassessments"}),Object(se.jsx)(o.c,{path:"/contributors"}),Object(se.jsx)(o.c,{path:"/courses/:courseId/sourcecast"}),Object(se.jsx)(o.c,{path:"/courses/:courseId/achievements"}),Object(se.jsx)(o.c,{children:!Se.b.playgroundOnly&&e.role&&!n&&Object(se.jsx)(Zu,{role:e.role,assessmentTypes:e.assessmentTypes,courseId:e.courseId})})]})]})};const nh=Object(se.jsx)(o.c,{path:"/login",component:gd},"login"),ih=()=>Object(se.jsx)(o.b,{to:"/login"}),rh=()=>Object(se.jsx)(o.b,{to:"/welcome"}),oh=e=>{let{name:t,role:s}=e;return void 0===t?ih:void 0===s?rh:()=>Object(se.jsx)(Ql,{})},ch=(e,t)=>{let{name:s}=e;return void 0===s?ih:()=>t},lh=(e,t)=>{let{name:s,role:a}=e;return void 0===s?ih:void 0===a?rh:()=>t};function dh(){const e=b()();for(const{start:t,end:s,reason:a}of Se.b.disablePeriods)if(t.isBefore(e)&&s.isAfter(e))return a||!0;return!1}var uh=e=>{const t=j.useRef(void 0),[s,a]=j.useState(dh()),n=/iPhone|iPad|Android/.test(navigator.userAgent),i=window.matchMedia("(display-mode: standalone)").matches,r=j.useRef({height:0,width:0}),[c,l]=Object(v.c)(Se.b.workspaceSettingsLocalStorageKey,zu.c),d="string"===typeof e.name&&"string"===typeof e.role;j.useEffect((()=>{e.name&&e.fetchUserAndCourse()}),[]),j.useEffect((()=>(Se.b.disablePeriods.length>0&&(t.current=window.setInterval((()=>{const e=dh();s!==e&&a(e)}),5e3)),()=>{t.current&&window.clearInterval(t.current)})),[s]),j.useEffect((()=>{const e=()=>{window.innerHeight<r.current.height&&window.innerWidth===r.current.width||document.documentElement.style.setProperty("--application-height",window.innerHeight+"px"),r.current={height:window.innerHeight,width:window.innerWidth}};return!i&&n&&(e(),window.addEventListener("resize",e)),()=>{!i&&n&&window.removeEventListener("resize",e)}}),[i,n]);const u=[Object(se.jsx)(o.c,{path:"/contributors",component:ad},"contributors"),Object(se.jsx)(o.c,{path:"/callback/github",component:ud},"githubCallback"),Se.b.enableGitHubAssessments?Object(se.jsx)(o.c,{path:"/githubassessments",render:()=>Object(se.jsx)(id.a,{handleGitHubLogIn:e.handleGitHubLogIn,handleGitHubLogOut:e.handleGitHubLogOut})},"githubAssessments"):null],m=!["staff","admin"].includes(e.role)&&s;return Object(se.jsx)(zu.b.Provider,{value:[c,l],children:Object(se.jsxs)("div",{className:"Application",children:[Object(se.jsx)(ah,{handleLogOut:e.handleLogOut,handleGitHubLogIn:e.handleGitHubLogIn,handleGitHubLogOut:e.handleGitHubLogOut,handleCreateCourse:e.handleCreateCourse,role:e.role,name:e.name,courses:e.courses,courseId:e.courseId,courseShortName:e.courseShortName,enableAchievements:e.enableAchievements,enableSourcecast:e.enableSourcecast,assessmentTypes:j.useMemo((()=>{var t;return null===(t=e.assessmentConfigurations)||void 0===t?void 0:t.map((e=>e.type))}),[e.assessmentConfigurations])}),Object(se.jsxs)("div",{className:"Application__main",children:[m&&Object(se.jsxs)(o.e,{children:[!Se.b.playgroundOnly&&nh,d||Se.b.playgroundOnly?[]:[Object(se.jsx)(o.c,{path:"/courses",render:ih},0),Object(se.jsx)(o.c,{exact:!0,path:"/",render:ih},1)],Object(se.jsx)(o.c,{children:Object(se.jsx)(nd,{reason:"string"===typeof s?s:void 0})})]}),!m&&Se.b.playgroundOnly&&Object(se.jsxs)(o.e,{children:[u,Object(se.jsx)(o.c,{path:"/playground",component:Bu}),Object(se.jsx)(o.c,{exact:!0,path:"/",children:Object(se.jsx)(o.b,{to:"/playground"})}),Object(se.jsx)(o.c,{component:Ke})]}),!m&&!Se.b.playgroundOnly&&Object(se.jsxs)(o.e,{children:[nh,u,Object(se.jsx)(o.c,{path:"/courses/:courseId(\\d+)?",render:oh(e)}),Object(se.jsx)(o.c,{path:"/welcome",render:ch(e,Object(se.jsx)(Uu,{}))}),Object(se.jsx)(o.c,{path:"/mission-control/:assessmentId(-?\\d+)?/:questionId(\\d+)?",component:yu}),Object(se.jsx)(o.c,{path:"/playground",render:lh(e,Object(se.jsx)(Bu,{}))}),Object(se.jsx)(o.b,{from:"/",exact:!0,to:null!=e.courseId?`/courses/${e.courseId}`:"/welcome"}),null!=e.courseId&&[Object(se.jsx)(o.b,{from:"/sourcecast/:splat?",to:`/courses/${e.courseId}/sourcecast/:splat?`},"legacy-sourcecast"),Object(se.jsx)(o.b,{from:"/achievements/:splat?",to:`/courses/${e.courseId}/achievements/:splat?`},"legacy-achievements"),Object(se.jsx)(o.b,{from:"/academy/:splat?",to:`/courses/${e.courseId}/:splat?`},"legacy-academy")],Object(se.jsx)(o.c,{component:Ke})]})]}),Se.b.showResearchPrompt&&null===e.agreedToResearch&&Object(se.jsx)("div",{className:"research-prompt",children:Object(se.jsxs)(h.h,{className:p.a.DARK,title:"Agreement to Participate in Educational Research",canOutsideClickClose:!1,canEscapeKeyClose:!1,isCloseButtonShown:!1,isOpen:!0,children:[Object(se.jsxs)("div",{className:p.a.DIALOG_BODY,children:[Object(se.jsx)(h.r,{children:"Welcome to your new Source Academy @ NUS course!"}),Object(se.jsx)("div",{children:"Here at Source Academy @ NUS, our mission is to bring out the beauty and fun in programming and the ideas behind programming, and to make these ideas universally accessible. This includes educational research!"}),Object(se.jsx)("br",{}),Object(se.jsx)("div",{children:"We collect programs that students run in Source Academy @ NUS and store them anonymously for our research. You are free to opt out of this collection, with no penalty for you whatsoever. Contact your course instructor if you have questions or concerns about this research."})]}),Object(se.jsx)("div",{className:p.a.DIALOG_FOOTER,children:Object(se.jsxs)("div",{className:p.a.DIALOG_FOOTER_ACTIONS,children:[Object(se.jsx)(h.b,{text:"I would like to opt out",onClick:()=>e.updateCourseResearchAgreement(!1)}),Object(se.jsx)(h.b,{text:"I consent!",intent:g.a.SUCCESS,onClick:()=>e.updateCourseResearchAgreement(!0)})]})})]})})]})})};var hh=Object(o.l)(Object(r.b)((e=>({role:e.session.role,name:e.session.name,courses:e.session.courses,courseId:e.session.courseId,courseShortName:e.session.courseShortName,enableAchievements:e.session.enableAchievements,enableSourcecast:e.session.enableSourcecast,assessmentConfigurations:e.session.assessmentConfigurations,agreedToResearch:e.session.agreedToResearch})),(e=>Object(c.b)({handleLogOut:d.logOut,handleGitHubLogIn:u.loginGitHub,handleGitHubLogOut:u.logoutGitHub,fetchUserAndCourse:u.fetchUserAndCourse,handleCreateCourse:l.createCourse,updateCourseResearchAgreement:u.updateCourseResearchAgreement},e)))(uh));const ph=Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));function gh(e,t){navigator.serviceWorker.register(e).then((e=>{setInterval((()=>{try{e.update()}catch{}}),3e5),e.onupdatefound=()=>{const s=e.installing;null!=s&&(s.onstatechange=()=>{"installed"===s.state&&(navigator.serviceWorker.controller?(console.log("New content is available and will be used when all tabs for this page are closed. See https://cra.link/PWA."),t&&t.onUpdate&&t.onUpdate(e)):(console.log("Content is cached for offline use."),t&&t.onSuccess&&t.onSuccess(e)))})}})).catch((e=>{console.error("Error during service worker registration:",e)}))}var mh=s(376);const bh=Object(j.createContext)(void 0);var jh=e=>{let{children:t}=e;const[s,a]=Object(j.useState)();return Object(mh.configure)({fs:"MountableFileSystem",options:{"/playground":{fs:"IndexedDB",options:{storeName:"playground"}}}},(e=>{e&&console.error(e),a(Object(mh.BFSRequire)("fs"))})),Object(se.jsx)(bh.Provider,{value:s,children:t})};if(Se.b.sentryDsn){a.a({dsn:Se.b.sentryDsn,environment:Se.b.sourceAcademyEnvironment,release:`cadet-frontend@${Se.b.sourceAcademyVersion}`});const e=Ya.a.getState().session.userId;n.b("undefined"!==typeof e?{id:e.toString()}:null)}const yh=document.getElementById("root");if(window.__REDUX_STORE__=Ya.a,console.log(`%cSource Academy ${Se.b.sourceAcademyEnvironment}-${Se.b.sourceAcademyVersion}; Please visit ${Se.a.githubIssues} to report bugs or issues.`,"font-weight: bold;"),Object(i.render)(Object(se.jsx)(r.a,{store:Ya.a,children:Object(se.jsx)(jh,{children:Object(se.jsx)(o.d,{history:we.a,children:Object(se.jsx)(hh,{})})})}),yh),function(e){if("serviceWorker"in navigator){if(new URL("/CS4215-frontend",window.location.href).origin!==window.location.origin)return;window.addEventListener("load",(()=>{const t="/CS4215-frontend/service-worker.js";ph?(!function(e,t){fetch(e,{headers:{"Service-Worker":"script"}}).then((s=>{const a=s.headers.get("content-type");404===s.status||null!=a&&-1===a.indexOf("javascript")?navigator.serviceWorker.ready.then((e=>{e.unregister().then((()=>{window.location.reload()}))})):gh(e,t)})).catch((()=>{console.log("No internet connection found. App is running in offline mode.")}))}(t,e),navigator.serviceWorker.ready.then((()=>{console.log("This web app is being served cache-first by a service worker. To learn more, visit https://cra.link/PWA")}))):gh(t,e)}))}}({onUpdate:()=>{Object(me.e)("A new version of Source Academy is available. Please refresh the browser.",0)}}),Se.b.cadetLoggerUrl){const e=()=>function(e){var t;e&&(null===(t=navigator.serviceWorker.controller)||void 0===t||t.postMessage({type:"SYNC_LOGS",accessToken:e}))}(Ya.a.getState().session.accessToken);navigator.serviceWorker.ready.then((()=>{setInterval(e,Se.b.cadetLoggerInterval)}))}},13:function(e,t,s){"use strict";s.r(t),s.d(t,"browseReplHistoryDown",(function(){return c})),s.d(t,"browseReplHistoryUp",(function(){return l})),s.d(t,"changeExternalLibrary",(function(){return d})),s.d(t,"changeExecTime",(function(){return u})),s.d(t,"changeSideContentHeight",(function(){return h})),s.d(t,"changeStepLimit",(function(){return p})),s.d(t,"chapterSelect",(function(){return g})),s.d(t,"externalLibrarySelect",(function(){return m})),s.d(t,"toggleEditorAutorun",(function(){return b})),s.d(t,"beginClearContext",(function(){return j})),s.d(t,"clearReplInput",(function(){return y})),s.d(t,"clearReplOutput",(function(){return O})),s.d(t,"clearReplOutputLast",(function(){return f})),s.d(t,"endClearContext",(function(){return v})),s.d(t,"evalEditor",(function(){return x})),s.d(t,"evalRepl",(function(){return C})),s.d(t,"evalTestcase",(function(){return S})),s.d(t,"runAllTestcases",(function(){return w})),s.d(t,"updateActiveEditorTab",(function(){return E})),s.d(t,"updateEditorValue",(function(){return T})),s.d(t,"setEditorBreakpoint",(function(){return k})),s.d(t,"highlightEditorLine",(function(){return A})),s.d(t,"updateReplValue",(function(){return I})),s.d(t,"sendReplInputToOutput",(function(){return N})),s.d(t,"resetTestcase",(function(){return M})),s.d(t,"navigateToDeclaration",(function(){return P})),s.d(t,"moveCursor",(function(){return R})),s.d(t,"resetWorkspace",(function(){return _})),s.d(t,"updateWorkspace",(function(){return L})),s.d(t,"setIsEditorReadonly",(function(){return D})),s.d(t,"updateCurrentAssessmentId",(function(){return B})),s.d(t,"updateCurrentSubmissionId",(function(){return U})),s.d(t,"updateHasUnsavedChanges",(function(){return G})),s.d(t,"changeSublanguage",(function(){return F})),s.d(t,"updateSublanguage",(function(){return H})),s.d(t,"promptAutocomplete",(function(){return V})),s.d(t,"notifyProgramEvaluated",(function(){return W})),s.d(t,"toggleUsingSubst",(function(){return X})),s.d(t,"addHtmlConsoleError",(function(){return $}));var a=s(7),n=s(135),i=s(59),r=s(24),o=s(31);const c=e=>Object(a.action)(o.c,{workspaceLocation:e}),l=e=>Object(a.action)(o.d,{workspaceLocation:e}),d=(e,t)=>Object(a.action)(o.f,{newExternal:e,workspaceLocation:t}),u=(e,t)=>Object(a.action)(o.e,{execTime:e,workspaceLocation:t}),h=(e,t)=>Object(a.action)(o.g,{height:e,workspaceLocation:t}),p=(e,t)=>Object(a.action)(o.h,{stepLimit:e,workspaceLocation:t}),g=(e,t,s)=>Object(a.action)(o.j,{chapter:e,variant:t,workspaceLocation:s}),m=(e,t,s)=>Object(a.action)(o.v,{externalLibraryName:e,workspaceLocation:t,initialise:s||!1}),b=e=>Object(a.action)(o.A,{workspaceLocation:e}),j=(e,t,s)=>Object(a.action)(o.b,{library:t,workspaceLocation:e,shouldInitLibrary:s}),y=e=>Object(a.action)(o.k,{workspaceLocation:e}),O=e=>Object(a.action)(o.l,{workspaceLocation:e}),f=e=>Object(a.action)(o.m,{workspaceLocation:e}),v=(e,t)=>Object(a.action)(o.n,{library:e,workspaceLocation:t}),x=e=>Object(a.action)(o.o,{workspaceLocation:e}),C=e=>Object(a.action)(o.q,{workspaceLocation:e}),S=(e,t)=>Object(a.action)(o.s,{workspaceLocation:e,testcaseId:t}),w=e=>Object(a.action)(o.p,{workspaceLocation:e}),E=(e,t)=>Object(a.action)(o.C,{workspaceLocation:e,activeEditorTabOptions:t}),T=(e,t)=>Object(a.action)(o.G,{newEditorValue:e,workspaceLocation:t}),k=(e,t)=>Object(a.action)(o.F,{breakpoints:e,workspaceLocation:t}),A=(e,t)=>Object(a.action)(i.l,{highlightedLines:e,workspaceLocation:t}),I=(e,t)=>Object(a.action)(o.I,{newReplValue:e,workspaceLocation:t}),N=(e,t)=>Object(a.action)(o.z,{type:"code",workspaceLocation:t,value:e}),M=(e,t)=>Object(a.action)(o.x,{workspaceLocation:e,index:t}),P=(e,t)=>Object(a.action)(o.u,{workspaceLocation:e,cursorPosition:t}),R=(e,t)=>Object(a.action)(o.t,{workspaceLocation:e,cursorPosition:t}),_=(e,t)=>Object(a.action)(o.y,{workspaceLocation:e,workspaceOptions:t}),L=(e,t)=>Object(a.action)(o.K,{workspaceLocation:e,workspaceOptions:t}),D=(e,t)=>Object(a.action)(n.b,{workspaceLocation:e,isEditorReadonly:t}),B=(e,t)=>Object(a.action)(o.D,{assessmentId:e,questionId:t}),U=(e,t)=>Object(a.action)(o.E,{submissionId:e,questionId:t}),G=(e,t)=>Object(a.action)(o.H,{workspaceLocation:e,hasUnsavedChanges:t}),F=e=>Object(a.action)(o.i,{sublang:e}),H=e=>Object(a.action)(o.J,{sublang:e}),V=(e,t,s,n)=>Object(a.action)(o.w,{workspaceLocation:e,row:t,column:s,callback:n}),W=(e,t,s,n,i)=>Object(a.action)(r.a,{result:e,lastDebuggerResult:t,code:s,context:n,workspaceLocation:i}),X=(e,t)=>Object(a.action)(o.B,{usingSubst:e,workspaceLocation:t}),$=(e,t)=>Object(a.action)(o.a,{errorMsg:e,workspaceLocation:t})},135:function(e,t,s){"use strict";s.d(t,"a",(function(){return a})),s.d(t,"b",(function(){return n})),s.d(t,"c",(function(){return i}));const a="FETCH_SOURCECAST_INDEX",n="SET_IS_EDITOR_READONLY",i="UPDATE_SOURCECAST_INDEX"},146:function(e,t,s){"use strict";s.d(t,"a",(function(){return a}));const a="LOG_OUT"},147:function(e,t,s){"use strict";s.d(t,"a",(function(){return c}));var a=s(63),n=s(122),i=s(303),r=(s(1),s(12)),o=s(0);const c=e=>Object(o.jsx)(i.a,{content:"...or press shift-enter in the editor",placement:a.a.TOP,children:Object(o.jsx)(r.a,{label:"Run",icon:n.a.PLAY,onClick:e.handleEditorEval,options:{iconColor:e.color,className:e.className}})})},15:function(e,t,s){"use strict";s.d(t,"j",(function(){return a})),s.d(t,"q",(function(){return n})),s.d(t,"k",(function(){return i})),s.d(t,"f",(function(){return r})),s.d(t,"g",(function(){return o})),s.d(t,"i",(function(){return c})),s.d(t,"e",(function(){return l})),s.d(t,"o",(function(){return d})),s.d(t,"p",(function(){return u})),s.d(t,"l",(function(){return h})),s.d(t,"m",(function(){return p})),s.d(t,"r",(function(){return g})),s.d(t,"u",(function(){return m})),s.d(t,"s",(function(){return b})),s.d(t,"t",(function(){return j})),s.d(t,"G",(function(){return y})),s.d(t,"H",(function(){return O})),s.d(t,"A",(function(){return f})),s.d(t,"B",(function(){return v})),s.d(t,"z",(function(){return x})),s.d(t,"y",(function(){return C})),s.d(t,"F",(function(){return S})),s.d(t,"D",(function(){return w})),s.d(t,"E",(function(){return E})),s.d(t,"C",(function(){return T})),s.d(t,"I",(function(){return k})),s.d(t,"J",(function(){return A})),s.d(t,"K",(function(){return I})),s.d(t,"L",(function(){return N})),s.d(t,"w",(function(){return M})),s.d(t,"v",(function(){return P})),s.d(t,"x",(function(){return R})),s.d(t,"M",(function(){return _})),s.d(t,"Q",(function(){return L})),s.d(t,"X",(function(){return D})),s.d(t,"N",(function(){return B})),s.d(t,"O",(function(){return U})),s.d(t,"U",(function(){return G})),s.d(t,"T",(function(){return F})),s.d(t,"n",(function(){return H})),s.d(t,"a",(function(){return V})),s.d(t,"W",(function(){return W})),s.d(t,"V",(function(){return X})),s.d(t,"R",(function(){return $})),s.d(t,"h",(function(){return q})),s.d(t,"P",(function(){return z})),s.d(t,"b",(function(){return Y})),s.d(t,"d",(function(){return K})),s.d(t,"Y",(function(){return Q})),s.d(t,"S",(function(){return J})),s.d(t,"c",(function(){return Z}));const a="FETCH_AUTH",n="FETCH_USER_AND_COURSE",i="FETCH_COURSE_CONFIG",r="FETCH_ASSESSMENT",o="FETCH_ASSESSMENT_ADMIN",c="FETCH_ASSESSMENT_OVERVIEWS",l="FETCH_ALL_USER_XP",d="FETCH_TOTAL_XP",u="FETCH_TOTAL_XP_ADMIN",h="FETCH_GRADING",p="FETCH_GRADING_OVERVIEWS",g="LOGIN",m="LOGOUT_GOOGLE",b="LOGIN_GITHUB",j="LOGOUT_GITHUB",y="SET_TOKENS",O="SET_USER",f="SET_COURSE_CONFIGURATION",v="SET_COURSE_REGISTRATION",x="SET_ASSESSMENT_CONFIGURATIONS",C="SET_ADMIN_PANEL_COURSE_REGISTRATIONS",S="SET_GOOGLE_USER",w="SET_GITHUB_ASSESSMENT",E="SET_GITHUB_OCTOKIT_OBJECT",T="SET_GITHUB_ACCESS_TOKEN",k="SUBMIT_ANSWER",A="SUBMIT_ASSESSMENT",I="SUBMIT_GRADING",N="SUBMIT_GRADING_AND_CONTINUE",M="REAUTOGRADE_SUBMISSION",P="REAUTOGRADE_ANSWER",R="REMOVE_GITHUB_OCTOKIT_OBJECT_AND_ACCESS_TOKEN",_="UNSUBMIT_SUBMISSION",L="UPDATE_ASSESSMENT_OVERVIEWS",D="UPDATE_TOTAL_XP",B="UPDATE_ALL_USER_XP",U="UPDATE_ASSESSMENT",G="UPDATE_GRADING_OVERVIEWS",F="UPDATE_GRADING",H="FETCH_NOTIFICATIONS",V="ACKNOWLEDGE_NOTIFICATIONS",W="UPDATE_NOTIFICATIONS",X="UPDATE_LATEST_VIEWED_COURSE",$="UPDATE_COURSE_CONFIG",q="FETCH_ASSESSMENT_CONFIGS",z="UPDATE_ASSESSMENT_CONFIGS",Y="DELETE_ASSESSMENT_CONFIG",K="FETCH_ADMIN_PANEL_COURSE_REGISTRATIONS",Q="UPDATE_USER_ROLE",J="UPDATE_COURSE_RESEARCH_AGREEMENT",Z="DELETE_USER_COURSE_REGISTRATION"},150:function(e,t,s){"use strict";s.d(t,"a",(function(){return i})),s.d(t,"c",(function(){return r})),s.d(t,"b",(function(){return o}));var a=s(1),n=s.n(a);let i;!function(e){e.NONE="",e.VIM="vim",e.EMACS="emacs"}(i||(i={}));const r={editorBinding:i.NONE},o=n.a.createContext(null)},151:function(e,t,s){"use strict";s.d(t,"a",(function(){return a})),s.d(t,"b",(function(){return n})),s.d(t,"c",(function(){return i})),s.d(t,"d",(function(){return r}));const a="CHANGE_DATE_ASSESSMENT",n="DELETE_ASSESSMENT",i="PUBLISH_ASSESSMENT",r="UPLOAD_ASSESSMENT"},152:function(e,t,s){"use strict";s.d(t,"b",(function(){return a})),s.d(t,"d",(function(){return n})),s.d(t,"c",(function(){return i})),s.d(t,"a",(function(){return r}));const a="PERSISTENCE_OPEN_PICKER",n="PERSISTENCE_SAVE_FILE_AS",i="PERSISTENCE_SAVE_FILE",r="PERSISTENCE_INITIALISE"},153:function(e,t,s){"use strict";(function(e){s.d(t,"f",(function(){return r})),s.d(t,"e",(function(){return d})),s.d(t,"c",(function(){return p})),s.d(t,"d",(function(){return g})),s.d(t,"b",(function(){return m})),s.d(t,"a",(function(){return b}));var a=s(33),n=s(27),i=s(10);const r=20,o=e=>JSON.stringify(e,null,4),c=e=>e,l={taskDescription:{fileName:"Problem.md",isDefaultValue:e=>""===e,fromStringConverter:c,toStringConverter:c},starterCode:{fileName:"StarterCode.js",isDefaultValue:e=>""===e,fromStringConverter:c,toStringConverter:c},savedCode:{fileName:"SavedCode.js",isDefaultValue:e=>""===e,fromStringConverter:c,toStringConverter:c},testPrepend:{fileName:"TestPrepend.js",isDefaultValue:e=>""===e,fromStringConverter:c,toStringConverter:c},testPostpend:{fileName:"TestPostpend.js",isDefaultValue:e=>""===e,fromStringConverter:c,toStringConverter:c},testCases:{fileName:"TestCases.json",isDefaultValue:e=>0===e.length,fromStringConverter:JSON.parse,toStringConverter:e=>{const t=e.map((e=>({answer:e.answer,program:e.program,score:e.score?e.score:0,type:e.type?e.type:"public"})));return o(t)}}};async function d(e,t){const s=u(e.repoOwner,e.repoName,"README.md",t),a=u(e.repoOwner,e.repoName,".metadata",t),o=async function(e,t,s){const a=[];if(void 0===s)return a;const n=(await s.repos.getContent({owner:e,repo:t,path:""})).data;if(!Array.isArray(n))return a;const o=[];for(let c=1;c<=r;c++){const r="Q"+c;if(void 0===n.find((e=>e.name===r)))break;o.push(s.repos.getContent({owner:e,repo:t,path:r}).then((n=>{if(!Array.isArray(n.data))return;const i=n.data.map((e=>e.name)),o=Object.keys(l).filter((e=>i.includes(l[e].fileName))),d=o.map((async a=>{const n=l[a].fileName,i=await u(e,t,r+"/"+n,s);return l[a].fromStringConverter(i)}));return Promise.all(d).then((e=>{const t={questionNumber:c,taskDescription:"",starterCode:"",savedCode:"",testPrepend:"",testPostpend:"",testCases:[]};for(let s=0;s<e.length;s++)t[o[s]]=e[s];""===t.savedCode&&(t.savedCode=t.starterCode),a.push(t)}))})).catch((e=>{Object(i.e)("Error occurred while trying to retrieve file content",1e3),console.error(e)})))}return await Promise.all(o),a.sort(((e,t)=>e.questionNumber-t.questionNumber)),a}(e.repoOwner,e.repoName,t),[c,d,h]=await Promise.all([s,a,o]),p=function(e){try{return JSON.parse(e)}catch(t){return console.error(t),{sourceVersion:n.Chapter.CALC}}}(d);return{missionRepoData:e,missionBriefing:c,missionMetadata:p,tasksData:h}}async function u(t,s,a,n){let r="";if(void 0===n)return r;try{const i=await n.repos.getContent({owner:t,repo:s,path:a});r=e.from(i.data.content,"base64").toString()}catch(o){Object(i.e)("Error occurred while trying to retrieve file content",1e3),console.error(o)}return r}function h(e){return o(e)}function p(e,t,s,n,i,r,o){const c={},d=[];e!==t&&(c[".metadata"]=h(e)),s!==n&&(c["README.md"]=s);let u=0;for(;u<i.length;){const e=u+1,t="Q"+e;if(e>r.length){c[t+"/StarterCode.js"]=i[u].savedCode,c[t+"/Problem.md"]=i[u].taskDescription;const e=["testCases","testPrepend","testPostpend"];for(const s of e){const e=i[u][s];if(!l[s].isDefaultValue(e)){const e=t+"/"+l[s].fileName,a=l[s].toStringConverter(i[u][s]);c[e]=a}}}else{const e=Object.keys(l);for(const s of e){const e=i[u][s],n=r[u][s];if(!Object(a.isEqual)(e,n)){const e=t+"/"+l[s].fileName,a=l[s].toStringConverter(i[u][s]);c[e]=a}}if(o&&c[t+"/"+l.savedCode.fileName]){const e=c[t+"/"+l.savedCode.fileName];delete c[t+"/"+l.savedCode.fileName],c[t+"/"+l.starterCode.fileName]=e}}u++}for(;u<r.length;){const e=u+1;d.push("Q"+e),u++}return[c,d]}function g(e,t,s){const a={};a[".metadata"]=h(e),a["README.md"]=t;const n=["testCases","testPrepend","testPostpend"];for(let i=0;i<s.length;i++){const e="Q"+(i+1);a[e+"/"+l.starterCode.fileName]=s[i].savedCode,a[e+"/"+l.taskDescription.fileName]=s[i].taskDescription,n.forEach((t=>{const n=s[i][t];if(!l[t].isDefaultValue(n)){const n=e+"/"+l[t].fileName,r=l[t].toStringConverter(s[i][t]);a[n]=r}}))}return a}function m(e){let t=!1;const s={answer:0,choices:[],solution:-1,type:"mcq",content:"",grade:0,id:0,library:{chapter:n.Chapter.CALC,external:{name:"NONE",symbols:[]},globals:[]},maxGrade:0,xp:0,maxXp:0},a=e.trim();if("mcq"===a.substring(0,3).toLowerCase()&&(t=!0),t){const e=a.substring(3,a.length);try{const t=JSON.parse(e),a=t.answer,n=t.choices.map((e=>({content:e.option,hint:e.hint}))),i=t.solution;s.answer=a,s.choices=n,s.solution=i}catch(i){t=!1}}return[t,s]}function b(e){const t=e.answer,s=e.choices.map((e=>({option:e.content,hint:e.hint}))),a=e.solution;return"MCQ\n"+o({choices:s,answer:t,solution:a})}}).call(this,s(74).Buffer)},157:function(e,t,s){"use strict";s.d(t,"a",(function(){return a})),s.d(t,"b",(function(){return n}));const a="FETCH_GROUP_GRADING_SUMMARY",n="UPDATE_GROUP_GRADING_SUMMARY"},16:function(e,t,s){"use strict";s.d(t,"a",(function(){return P}));var a=s(27),n=s(65),i=s.n(n);function r(e,t){return"undefined"===typeof e&&"undefined"!==typeof t?t:"string"===typeof e&&"TRUE"===e.toUpperCase()}const o=Object({NODE_ENV:"production",PUBLIC_URL:"/CS4215-frontend",WDS_SOCKET_HOST:void 0,WDS_SOCKET_PATH:void 0,WDS_SOCKET_PORT:void 0,FAST_REFRESH:!0,REACT_APP_SW_EXCLUDE_REGEXES:void 0}).REACT_APP_VERSION||"local",c=Object({NODE_ENV:"production",PUBLIC_URL:"/CS4215-frontend",WDS_SOCKET_HOST:void 0,WDS_SOCKET_PATH:void 0,WDS_SOCKET_PORT:void 0,FAST_REFRESH:!0,REACT_APP_SW_EXCLUDE_REGEXES:void 0}).REACT_APP_ENVIRONMENT||"dev",l=Object({NODE_ENV:"production",PUBLIC_URL:"/CS4215-frontend",WDS_SOCKET_HOST:void 0,WDS_SOCKET_PATH:void 0,WDS_SOCKET_PORT:void 0,FAST_REFRESH:!0,REACT_APP_SW_EXCLUDE_REGEXES:void 0}).REACT_APP_DEPLOYMENT_NAME||"Source Academy",d=r(Object({NODE_ENV:"production",PUBLIC_URL:"/CS4215-frontend",WDS_SOCKET_HOST:void 0,WDS_SOCKET_PATH:void 0,WDS_SOCKET_PORT:void 0,FAST_REFRESH:!0,REACT_APP_SW_EXCLUDE_REGEXES:void 0}).REACT_APP_SHOW_RESEARCH_PROMPT),u=Object({NODE_ENV:"production",PUBLIC_URL:"/CS4215-frontend",WDS_SOCKET_HOST:void 0,WDS_SOCKET_PATH:void 0,WDS_SOCKET_PORT:void 0,FAST_REFRESH:!0,REACT_APP_SW_EXCLUDE_REGEXES:void 0}).REACT_APP_BACKEND_URL,h=Object({NODE_ENV:"production",PUBLIC_URL:"/CS4215-frontend",WDS_SOCKET_HOST:void 0,WDS_SOCKET_PATH:void 0,WDS_SOCKET_PORT:void 0,FAST_REFRESH:!0,REACT_APP_SW_EXCLUDE_REGEXES:void 0}).REACT_APP_CADET_LOGGER,p=parseInt(Object({NODE_ENV:"production",PUBLIC_URL:"/CS4215-frontend",WDS_SOCKET_HOST:void 0,WDS_SOCKET_PATH:void 0,WDS_SOCKET_PORT:void 0,FAST_REFRESH:!0,REACT_APP_SW_EXCLUDE_REGEXES:void 0}).REACT_APP_CADET_LOGGER_INTERVAL||"10000",10),g=r(Object({NODE_ENV:"production",PUBLIC_URL:"/CS4215-frontend",WDS_SOCKET_HOST:void 0,WDS_SOCKET_PATH:void 0,WDS_SOCKET_PORT:void 0,FAST_REFRESH:!0,REACT_APP_SW_EXCLUDE_REGEXES:void 0}).REACT_APP_USE_BACKEND),m=a.Chapter.CALC,b=a.Variant.DEFAULT,j=Object({NODE_ENV:"production",PUBLIC_URL:"/CS4215-frontend",WDS_SOCKET_HOST:void 0,WDS_SOCKET_PATH:void 0,WDS_SOCKET_PORT:void 0,FAST_REFRESH:!0,REACT_APP_SW_EXCLUDE_REGEXES:void 0}).REACT_APP_URL_SHORTENER_BASE,y=Object({NODE_ENV:"production",PUBLIC_URL:"/CS4215-frontend",WDS_SOCKET_HOST:void 0,WDS_SOCKET_PATH:void 0,WDS_SOCKET_PORT:void 0,FAST_REFRESH:!0,REACT_APP_SW_EXCLUDE_REGEXES:void 0}).REACT_APP_URL_SHORTENER_SIGNATURE,O=Object({NODE_ENV:"production",PUBLIC_URL:"/CS4215-frontend",WDS_SOCKET_HOST:void 0,WDS_SOCKET_PATH:void 0,WDS_SOCKET_PORT:void 0,FAST_REFRESH:!0,REACT_APP_SW_EXCLUDE_REGEXES:void 0}).REACT_APP_MODULE_BACKEND_URL||"modules",f=Object({NODE_ENV:"production",PUBLIC_URL:"/CS4215-frontend",WDS_SOCKET_HOST:void 0,WDS_SOCKET_PATH:void 0,WDS_SOCKET_PORT:void 0,FAST_REFRESH:!0,REACT_APP_SW_EXCLUDE_REGEXES:void 0}).REACT_APP_SHAREDB_BACKEND_URL||"",v=r(Object({NODE_ENV:"production",PUBLIC_URL:"/CS4215-frontend",WDS_SOCKET_HOST:void 0,WDS_SOCKET_PATH:void 0,WDS_SOCKET_PORT:void 0,FAST_REFRESH:!0,REACT_APP_SW_EXCLUDE_REGEXES:void 0}).REACT_APP_PLAYGROUND_ONLY,!0),x=r(Object({NODE_ENV:"production",PUBLIC_URL:"/CS4215-frontend",WDS_SOCKET_HOST:void 0,WDS_SOCKET_PATH:void 0,WDS_SOCKET_PORT:void 0,FAST_REFRESH:!0,REACT_APP_SW_EXCLUDE_REGEXES:void 0}).REACT_APP_ENABLE_GITHUB_ASSESSMENTS),C=Object({NODE_ENV:"production",PUBLIC_URL:"/CS4215-frontend",WDS_SOCKET_HOST:void 0,WDS_SOCKET_PATH:void 0,WDS_SOCKET_PORT:void 0,FAST_REFRESH:!0,REACT_APP_SW_EXCLUDE_REGEXES:void 0}).REACT_APP_SENTRY_DSN,S=Object({NODE_ENV:"production",PUBLIC_URL:"/CS4215-frontend",WDS_SOCKET_HOST:void 0,WDS_SOCKET_PATH:void 0,WDS_SOCKET_PORT:void 0,FAST_REFRESH:!0,REACT_APP_SW_EXCLUDE_REGEXES:void 0}).REACT_APP_GOOGLE_CLIENT_ID,w=Object({NODE_ENV:"production",PUBLIC_URL:"/CS4215-frontend",WDS_SOCKET_HOST:void 0,WDS_SOCKET_PATH:void 0,WDS_SOCKET_PORT:void 0,FAST_REFRESH:!0,REACT_APP_SW_EXCLUDE_REGEXES:void 0}).REACT_APP_GOOGLE_API_KEY,E=Object({NODE_ENV:"production",PUBLIC_URL:"/CS4215-frontend",WDS_SOCKET_HOST:void 0,WDS_SOCKET_PATH:void 0,WDS_SOCKET_PORT:void 0,FAST_REFRESH:!0,REACT_APP_SW_EXCLUDE_REGEXES:void 0}).REACT_APP_GOOGLE_APP_ID,T=Object({NODE_ENV:"production",PUBLIC_URL:"/CS4215-frontend",WDS_SOCKET_HOST:void 0,WDS_SOCKET_PATH:void 0,WDS_SOCKET_PORT:void 0,FAST_REFRESH:!0,REACT_APP_SW_EXCLUDE_REGEXES:void 0}).REACT_APP_GITHUB_CLIENT_ID||"",k=Object({NODE_ENV:"production",PUBLIC_URL:"/CS4215-frontend",WDS_SOCKET_HOST:void 0,WDS_SOCKET_PATH:void 0,WDS_SOCKET_PORT:void 0,FAST_REFRESH:!0,REACT_APP_SW_EXCLUDE_REGEXES:void 0}).REACT_APP_GITHUB_OAUTH_PROXY_URL||"",A=Object({NODE_ENV:"production",PUBLIC_URL:"/CS4215-frontend",WDS_SOCKET_HOST:void 0,WDS_SOCKET_PATH:void 0,WDS_SOCKET_PORT:void 0,FAST_REFRESH:!0,REACT_APP_SW_EXCLUDE_REGEXES:void 0}).REACT_APP_SICPJS_BACKEND_URL||"https://sicp.sourceacademy.org/",I=parseInt(Object({NODE_ENV:"production",PUBLIC_URL:"/CS4215-frontend",WDS_SOCKET_HOST:void 0,WDS_SOCKET_PATH:void 0,WDS_SOCKET_PORT:void 0,FAST_REFRESH:!0,REACT_APP_SW_EXCLUDE_REGEXES:void 0}).REACT_APP_CA_FULFILLMENT_LEVEL||"0"),N=new Map;for(let _=1;;++_){const e=Object({NODE_ENV:"production",PUBLIC_URL:"/CS4215-frontend",WDS_SOCKET_HOST:void 0,WDS_SOCKET_PATH:void 0,WDS_SOCKET_PORT:void 0,FAST_REFRESH:!0,REACT_APP_SW_EXCLUDE_REGEXES:void 0})[`REACT_APP_OAUTH2_PROVIDER${_}`];if(!e)break;const t=Object({NODE_ENV:"production",PUBLIC_URL:"/CS4215-frontend",WDS_SOCKET_HOST:void 0,WDS_SOCKET_PATH:void 0,WDS_SOCKET_PORT:void 0,FAST_REFRESH:!0,REACT_APP_SW_EXCLUDE_REGEXES:void 0})[`REACT_APP_OAUTH2_PROVIDER${_}_NAME`]||"Unnamed provider",s=Object({NODE_ENV:"production",PUBLIC_URL:"/CS4215-frontend",WDS_SOCKET_HOST:void 0,WDS_SOCKET_PATH:void 0,WDS_SOCKET_PORT:void 0,FAST_REFRESH:!0,REACT_APP_SW_EXCLUDE_REGEXES:void 0})[`REACT_APP_OAUTH2_PROVIDER${_}_ENDPOINT`]||"";N.set(e,{name:t,endpoint:s,isDefault:1===_})}const M=[];for(let _=1;;++_){const e=Object({NODE_ENV:"production",PUBLIC_URL:"/CS4215-frontend",WDS_SOCKET_HOST:void 0,WDS_SOCKET_PATH:void 0,WDS_SOCKET_PORT:void 0,FAST_REFRESH:!0,REACT_APP_SW_EXCLUDE_REGEXES:void 0})[`REACT_APP_DISABLE${_}_START`],t=Object({NODE_ENV:"production",PUBLIC_URL:"/CS4215-frontend",WDS_SOCKET_HOST:void 0,WDS_SOCKET_PATH:void 0,WDS_SOCKET_PORT:void 0,FAST_REFRESH:!0,REACT_APP_SW_EXCLUDE_REGEXES:void 0})[`REACT_APP_DISABLE${_}_END`];if(!e||!t)break;const s=Object({NODE_ENV:"production",PUBLIC_URL:"/CS4215-frontend",WDS_SOCKET_HOST:void 0,WDS_SOCKET_PATH:void 0,WDS_SOCKET_PORT:void 0,FAST_REFRESH:!0,REACT_APP_SW_EXCLUDE_REGEXES:void 0})[`REACT_APP_DISABLE${_}_REASON`],a=i()(e),n=i()(t);n.isBefore(a)||i()().isAfter(n)||M.push({start:a,end:n,reason:s})}let P;!function(e){e.githubIssues="https://github.com/source-academy/frontend/issues",e.githubOrg="https://github.com/source-academy",e.about="https://about.sourceacademy.org",e.moduleDetails="https://www.comp.nus.edu.sg/~cs1101s",e.luminus="https://luminus.nus.edu.sg/modules/41d42e9a-5880-43b5-8ee6-75f5a41355e3/announcements/active",e.piazza="https://piazza.com/class/kas136yscf8605",e.resourcesForEducators="https://about.sourceacademy.org/educator/README.html",e.resourcesForLearners="https://about.sourceacademy.org/learner/README.html",e.sourceAcademyAssets="https://source-academy-assets.s3-ap-southeast-1.amazonaws.com/",e.sourceDocs="https://docs.sourceacademy.org/",e.techSVC="mailto:techsvc@comp.nus.edu.sg",e.techSVCNumber="6516 2736",e.textbook="https://sourceacademy.org/sicpjs/",e.playground="https://sourceacademy.org/playground",e.textbookChapter2_2="https://sourceacademy.org/sicpjs/2.2",e.textbookChapter3_2="https://sourceacademy.org/sicpjs/3.2",e.aceHotkeys="https://github.com/ajaxorg/ace/wiki/Default-Keyboard-Shortcuts",e.sourceHotkeys="https://github.com/source-academy/frontend/wiki/Source-Academy-Keyboard-Shortcuts",e.source_1="https://docs.sourceacademy.org/source_1/",e.source_1_Lazy="https://docs.sourceacademy.org/source_1_lazy/",e.source_1_Wasm="https://docs.sourceacademy.org/source_1_wasm/",e.source_2="https://docs.sourceacademy.org/source_2/",e.source_2_Lazy="https://docs.sourceacademy.org/source_2_lazy/",e.source_3="https://docs.sourceacademy.org/source_3/",e.source_3_Concurrent="https://docs.sourceacademy.org/source_3_concurrent/",e.source_3_Nondet="https://docs.sourceacademy.org/source_3_non-det/",e.source_4="https://docs.sourceacademy.org/source_4/",e.source_4_Gpu="https://docs.sourceacademy.org/source_4_gpu/",e.ecmaScript_2021="https://262.ecma-international.org/12.0/"}(P||(P={}));const R={sourceAcademyVersion:o,sourceAcademyEnvironment:c,sourceAcademyDeploymentName:l,showResearchPrompt:d,backendUrl:u,cadetLoggerUrl:h,useBackend:g,defaultSourceChapter:m,defaultSourceVariant:b,defaultQuestionId:0,maxBrowseIndex:50,mobileBreakpoint:768,urlShortenerBase:j,urlShortenerSignature:y,moduleBackendUrl:O,authProviders:N,playgroundOnly:v,enableGitHubAssessments:x,sentryDsn:C,googleClientId:S,googleApiKey:w,googleAppId:E,githubClientId:T,githubOAuthProxyUrl:k,sharedbBackendUrl:f,disablePeriods:M,cadetLoggerInterval:p,sicpBackendUrl:A,workspaceSettingsLocalStorageKey:"workspace-settings",caFulfillmentLevel:I};t.b=R},169:function(e,t,s){"use strict";s.d(t,"a",(function(){return r}));var a=s(122),n=(s(1),s(12)),i=s(0);const r=e=>e.questionProgress[0]<=1?null:Object(i.jsx)(n.a,{label:"Previous",icon:a.a.ARROW_LEFT,onClick:e.onClick})},170:function(e,t,s){"use strict";s.d(t,"a",(function(){return i}));s(1);var a=s(12),n=s(0);const i=e=>{let{questionProgress:t}=e;return Object(n.jsx)(a.a,{label:`Question ${t[0]} of ${t[1]}  `,isDisabled:!0})}},171:function(e,t,s){"use strict";var a=s(33),n=s(305),i=s(26),r=s(10),o=s(75);class c{constructor(e){this.achievement=void 0,this.displayDeadline=void 0,this.xp=void 0,this.progressFrac=void 0,this.status=void 0,this.children=void 0,this.descendant=void 0,this.parents=void 0;const{deadline:t,prerequisiteUuids:s}=e;this.achievement=e,this.displayDeadline=t,this.xp=0,this.progressFrac=0,this.status=i.b.ACTIVE,this.children=new Set(s),this.descendant=new Set(s),this.parents=new Set}}t.a=class{constructor(e,t){this.nodeList=new Map,this.goalList=new Map,this.textToUuid=new Map,this.titleToUuid=new Map,this.achievementsToDelete=[],this.goalsToDelete=[],this.invalidGoal={uuid:"invalid",text:"invalid",achievementUuids:[],meta:{type:i.l.MANUAL,targetCount:0},count:0,targetCount:0,completed:!1},this.invalidAchievement={uuid:"invalid",title:"invalid",xp:0,isVariableXp:!1,deadline:void 0,release:void 0,isTask:!1,position:0,prerequisiteUuids:[],goalUuids:[],cardBackground:"invalid",view:{coverImage:"invalid",description:"invalid",completionText:"invalid"}},this.nodeList=this.constructNodeList(e),this.goalList=this.constructGoalList(t),this.processNodes(),this.processGoals()}getAllAchievements(){return[...this.nodeList.values()].map((e=>e.achievement))}getAllReleasedAchievements(){return[...this.nodeList.values()].filter((e=>e.status!==i.b.UNRELEASED)).map((e=>e.achievement))}getAllCompletedAchievements(){return[...this.nodeList.values()].filter((e=>e.status===i.b.COMPLETED)).map((e=>e.achievement))}getAllAchievementUuids(){return[...this.nodeList.keys()]}getAllGoals(){return[...this.goalList.values()]}getAllGoalUuids(){return[...this.goalList.keys()]}hasAchievement(e){return this.nodeList.has(e)}isPrerequisite(e){const t=this.nodeList.get(e);return!!t&&t.parents.size>0}getAchievement(e){const t=this.nodeList.get(e);return t?t.achievement:this.invalidAchievement}hasGoal(e){return this.goalList.has(e)}getGoal(e){return this.goalList.get(e)||this.invalidGoal}getGoalDefinition(e){return this.getGoal(e)}getGoalProgress(e){return this.getGoal(e)}getAchievementPositionByUuid(e){return this.getAchievement(e).position}getAchievementsToDelete(){return this.achievementsToDelete}getGoalsToDelete(){return this.goalsToDelete}resetToDelete(){this.achievementsToDelete=[],this.goalsToDelete=[]}getAchievementsByGoal(e){return this.getGoal(e).achievementUuids}listSortedAchievementUuids(){return this.getAllAchievements().sort(((e,t)=>e.position-t.position)).map((e=>e.uuid))}isInvalidGoal(e){return e===this.invalidGoal}isInvalidAchievement(e){return e===this.invalidAchievement}insertAchievement(e){let t=Object(n.a)();for(;this.nodeList.has(t);)t=Object(n.a)();return e.uuid=t,this.nodeList.set(t,new c(e)),this.processNodes(),this.normalizePositions(e.uuid,e.position),t}insertFakeAchievement(e){return this.nodeList.set(e.uuid,new c(e)),this.processNodes(),this.normalizePositions(e.uuid,e.position),e.uuid}insertGoalDefinition(e){let t=Object(n.a)();for(;this.goalList.has(t);)t=Object(n.a)();return e.uuid=t,this.goalList.set(t,{...e,...i.v}),this.processGoals(),t}insertFakeGoalDefinition(e,t){return t?this.goalList.set(e.uuid,{...e,count:1,targetCount:1,completed:!0}):this.goalList.set(e.uuid,{...e,count:0,targetCount:1,completed:!1}),this.processGoals(),e.uuid}modifyAchievement(e){this.nodeList.set(e.uuid,new c(e)),this.processNodes(),this.normalizePositions(e.uuid,e.position)}modifyGoalDefinition(e){this.goalList.set(e.uuid,{...e,...i.v}),this.processNodes(),this.processGoals()}modifyGoalProgress(e){const t=this.getGoal(e.uuid);if(this.isInvalidGoal(t))return;this.goalList.set(e.uuid,{...t,...e});const s=t.achievementUuids;for(const a in s){const e=this.nodeList.get(a);e&&(this.generateXp(e),this.generateProgressFrac(e),this.generateStatus(e))}}removeAchievement(e){this.nodeList.delete(e),this.nodeList.forEach(((t,s)=>{(t=>t.children.has(e))(t)&&this.nodeList.set(s,(t=>{const s=t.achievement.prerequisiteUuids.filter((t=>t!==e));return t.achievement.prerequisiteUuids=s,new c(t.achievement)})(t))})),this.achievementsToDelete.push(e),this.processNodes(),this.normalizePositions()}removeGoalDefinition(e){const t=t=>{const s=(t=>t.achievement.goalUuids.findIndex((t=>t===e)))(t);-1!==s&&t.achievement.goalUuids.splice(s,1)};this.goalList.delete(e),this.nodeList.forEach((e=>t(e))),this.goalsToDelete.push(e),this.processNodes(),this.processGoals()}listTaskUuids(){return this.getAllAchievements().filter((e=>e.isTask||this.isCompleted(e))).map((e=>e.uuid))}listSortedTaskUuids(){return this.getAllAchievements().filter((e=>e.isTask||this.isCompleted(e))).sort(((e,t)=>e.position-t.position)).map((e=>e.uuid))}listSortedReleasedTaskUuids(){return this.getAllReleasedAchievements().filter((e=>e.isTask||this.isCompleted(e))).sort(((e,t)=>e.position-t.position)).map((e=>e.uuid))}listAllSortedAchievementUuids(){return this.getAllAchievements().sort(((e,t)=>e.position-t.position)).map((e=>e.uuid))}isCompleted(e){const t=e.goalUuids.length,s=e.prerequisiteUuids.length;if(0===t&&0===s)return!1;for(let a=0;a<t;a++)if(!this.getGoal(e.goalUuids[a]).completed)return!1;for(let a=0;a<s;a++)if(!this.isCompleted(this.getAchievement(e.prerequisiteUuids[a])))return!1;return!0}listGoals(e){const{goalUuids:t}=this.getAchievement(e);return t.map((e=>this.getGoal(e)))}listPrerequisiteGoals(e){const t=[];for(const s of this.getImmediateChildren(e)){const{goalUuids:e}=this.getAchievement(s);e.forEach((e=>t.push(e)))}return t.map((e=>this.getGoal(e)))}getUuidByText(e){return this.textToUuid.get(e)}getTextByUuid(e){return this.getGoal(e).text}getUuidByTitle(e){return this.titleToUuid.get(e)}getTitleByUuid(e){return this.getAchievement(e).title}getAchievementXp(e){const t=this.getAchievement(e);return t.isVariableXp?this.listGoals(t.uuid).reduce(((e,t)=>e+t.count),0):t.xp}getTotalXp(){return this.getAllCompletedAchievements().reduce(((e,t)=>e+this.getAchievementXp(t.uuid)),0)}getProgressFrac(e){return this.nodeList.has(e)?this.nodeList.get(e).progressFrac:0}getStatus(e){return this.nodeList.has(e)?this.nodeList.get(e).status:i.b.ACTIVE}getDisplayDeadline(e){return this.nodeList.has(e)?this.nodeList.get(e).displayDeadline:void 0}isImmediateChild(e,t){return!!this.nodeList.has(e)&&this.nodeList.get(e).children.has(t)}getImmediateChildren(e){return this.nodeList.has(e)?this.nodeList.get(e).children:new Set}isDescendant(e,t){return!!this.nodeList.has(e)&&this.nodeList.get(e).descendant.has(t)}getDescendants(e){return this.nodeList.has(e)?this.nodeList.get(e).descendant:new Set}getDescendantXp(e){let t=this.getAchievementXp(e);return this.getDescendants(e).forEach((e=>{this.isCompleted(this.getAchievement(e))&&(t+=this.getAchievementXp(e))})),t}listAvailablePrerequisiteUuids(e){return this.getAllAchievementUuids().filter((t=>t!==e&&!this.isDescendant(e,t)&&!this.isDescendant(t,e)))}processNodes(){this.titleToUuid=new Map,this.nodeList.forEach((e=>{const{title:t,uuid:s}=e.achievement;this.titleToUuid.set(t,s),e.achievement.prerequisiteUuids=Object(a.uniq)(e.achievement.prerequisiteUuids),e.achievement.goalUuids=Object(a.uniq)(e.achievement.goalUuids),this.generateParentReference(e),this.generateDescendant(e),this.generateDisplayDeadline(e),this.generateXp(e),this.generateProgressFrac(e),this.generateStatus(e)}))}processGoals(){this.textToUuid=new Map,this.goalList.forEach((e=>{const{text:t,uuid:s}=e;this.textToUuid.set(t,s),e.achievementUuids=Object(a.uniq)(e.achievementUuids)}))}constructNodeList(e){const t=new Map;return e.forEach((e=>t.set(e.uuid,new c(Object(a.cloneDeep)(e))))),t}constructGoalList(e){const t=new Map;return e.forEach((e=>t.set(e.uuid,Object(a.cloneDeep)(e)))),t}generateParentReference(e){for(const s of e.children){var t;null===(t=this.nodeList.get(s))||void 0===t||t.parents.add(e.achievement.uuid)}}generateDescendant(e){for(const t of e.descendant){if(t===e.achievement.uuid){const{title:t}=e.achievement;Object(r.b)(`Circular dependency detected in achievement ${t}`,3e4)}for(const s of this.getDescendants(t))e.descendant.add(s)}}generateDisplayDeadline(e){const t=[];for(const s of e.descendant){const e=this.getAchievement(s).deadline;t.push(e)}e.displayDeadline=t.reduce(((e,t)=>void 0===t||Object(o.a)(t)?e:void 0===e||Object(o.a)(e)||t<e?t:e),e.displayDeadline)}generateXp(e){const{goalUuids:t,isVariableXp:s}=e.achievement,a=t.reduce(((e,t)=>e&&this.getGoal(t).completed),!0);e.xp=a?s?t.reduce(((e,t)=>e+this.getGoal(t).count),0):e.achievement.xp:0}generateProgressFrac(e){const{goalUuids:t}=e.achievement;if(0===t.length)e.progressFrac=0;else{const s=t.reduce(((e,t)=>e+this.getGoal(t).count),0),a=t.reduce(((e,t)=>e+this.getGoal(t).targetCount),0);e.progressFrac=Math.min(0===a?0:s/a,1)}}generateStatus(e){const t=this.isCompleted(e.achievement),s=Object(o.b)(e.achievement.release),a=!Object(o.a)(e.displayDeadline);e.status=t?i.b.COMPLETED:s?a?i.b.ACTIVE:i.b.EXPIRED:i.b.UNRELEASED}normalizePositions(e,t){let s=1;if(this.getAllAchievements().filter((e=>e.isTask)).filter((e=>e.position>=0)).sort(((e,t)=>e.position-t.position)).forEach((e=>e.position=s++)),this.getAllAchievements().filter((e=>!e.isTask)).forEach((e=>e.position=0)),e&&t&&0!==t){const s=this.getAchievement(e),a=s.position;if(a!==t){const e=this.getAllAchievements().find((e=>e.position===t));e&&(e.position=a,s.position=t)}}}}},172:function(e,t,s){"use strict";var a=s(1308),n=s(122),i=s(1),r=s.n(i),o=s(208),c=s(25),l=s(288),d=s(97),u=s(289),h=s(24),p=s(290),g=s.n(p),m=s(300),b=s(0);var j=e=>Object(b.jsx)(g.a,{axis:"y",handle:"#dragHandle",position:e.position,bounds:{top:-500,left:0,right:0,bottom:0},onDrag:e.onDrag,disabled:e.disabled,children:Object(b.jsxs)("div",{className:"mobile-draggable",children:[e.disabled?Object(b.jsx)("div",{className:"handle disabled",id:"draghandle",children:["1","2","3"].map((e=>Object(b.jsx)("div",{className:"circle"},e)))}):Object(b.jsx)("div",{className:"handle enabled",id:"dragHandle",children:["1","2","3"].map((e=>Object(b.jsx)("div",{className:"circle"},e)))}),Object(b.jsx)("div",{className:"REPL-content",children:Object(b.jsx)(m.a,{...e.replProps})})]})}),y=s(515),O=s.n(y);var f=e=>{const[t,s]=r.a.useState(!1),[a,n]=r.a.useState("\u1438"),[i,o]=r.a.useState({x:0,y:0}),[c,l]=r.a.useState(1),d=e=>{e.preventDefault()},u={onKeyPress:t=>{if(!e.targetKeyboardInput)return;const s=e.targetKeyboardInput;"{arrowleft}"===t?s.navigateLeft():"{arrowright}"===t?s.navigateRight():"{bksp}"===t?s.remove("left"):"{tab}"===t?s.insert("\t"):["+","-","*","/","%","=>","===","&&","||"].includes(t)?s.insert(" "+t+" "):s.insert(t)},baseClass:"simple-keyboard-shortcut",layout:{default:["{ } ( ) \" ' _ => ;","{tab} && || ! < > = ===","+ - * / % // {arrowleft} {arrowright}"]},buttonTheme:[{class:"mobile-navigation",buttons:"{arrowleft} {arrowright}"},{class:"big-buttons",buttons:"=== &&"}],theme:"hg-theme-default",preventMouseDownDefault:!0,disableCaretPositioning:!1};return Object(b.jsx)(g.a,{axis:"y",handle:"#floating-dragHandle",position:i,bounds:{top:-200,left:0,right:0,bottom:200},onDrag:(e,t)=>{o(t)},children:Object(b.jsxs)("div",{className:"mobile-floating-keyboard",id:"mobile-floating-toggle",children:[Object(b.jsx)("button",{className:"mobile-floating-toggle",onClick:e=>{t?(document.getElementById("mobile-keyboard-toggle").style.setProperty("display","none"),document.getElementById("mobile-floating-toggle").style.setProperty("width","42px"),document.getElementById("mobile-floating-toggle").style.setProperty("opacity","0.6"),n("\u1438"),s(!1)):(document.getElementById("mobile-keyboard-toggle").style.setProperty("display","flex"),document.getElementById("mobile-floating-toggle").style.setProperty("width","99%"),document.getElementById("mobile-floating-toggle").style.setProperty("opacity","1"),n("\u1433"),s(!0))},onMouseDown:d,children:a}),Object(b.jsxs)("div",{className:"mobile-keyboard-toggle-container",id:"mobile-keyboard-toggle",children:[Object(b.jsx)("div",{className:"mobile-keyboard-container",children:Object(b.jsx)(O.a,{...u})}),Object(b.jsx)("button",{className:"mobile-keyboard-row-toggle",onClick:e=>{l((c+1)%3);const t=document.getElementsByClassName("simple-keyboard-shortcut");Array.from(t)[0].style.top=45*-c+"px"},onMouseDown:d,children:"\u2938"})]}),Object(b.jsx)("div",{id:"floating-dragHandle",children:":"})]})})},v=s(42),x=s(3),C=s(303),S=s(20),w=s.n(S),E=s(189),T=s(291),k=s(377);var A=e=>{const t=Object(b.jsxs)("div",{className:"mobile-control-bar",children:[e.editorButtons,e.flowButtons,e.editingWorkspaceButtons]});return Object(b.jsx)(k.a,{content:t,autoFocus:!1,children:Object(b.jsx)(v.b,{icon:n.a.COG,className:w()(x.a.MINIMAL,"mobile-control-bar-button")})})};var I=r.a.memo((e=>{let{selectedTabId:t,renderActiveTabPanelOnly:s,mobileControlBarProps:a,...n}=e;const i=/iPhone|iPod/.test(navigator.platform),r=e=>e.map((e=>((e,s)=>{if(!e.body)return;const a=s?{...e.body,props:{...e.body.props,workspaceLocation:s}}:e.body;return Object(b.jsx)("div",{className:e.id===t?"mobile-selected-panel":"mobile-unselected-panel",children:a},e.id)})(e,n.workspaceLocation)));return Object(b.jsx)(E.a,{...n,renderFunction:(e,o)=>Object(b.jsxs)(b.Fragment,{children:[r(e),Object(b.jsx)("div",{className:"mobile-tabs-container",children:Object(b.jsxs)(v.V,{id:"mobile-side-content",onChange:o,renderActiveTabPanelOnly:s,selectedTabId:t,className:w()(x.a.DARK,"mobile-side-content"),children:[e.map((e=>((e,t,s)=>{const a=void 0===e.id?e.label:e.id,n=Object(b.jsx)(C.a,{content:e.label,onOpening:()=>{var e;t&&(null===(e=document.getElementById(Object(E.b)(a)))||void 0===e||e.click())},children:Object(b.jsx)("div",{className:"side-content-tooltip",id:Object(E.b)(a),children:Object(b.jsx)(v.w,{icon:e.iconName,iconSize:20})})});return Object(b.jsx)(v.U,{id:a,title:n,disabled:e.disabled,className:"side-content-tab"},a)})(e,i,n.workspaceLocation))),("playground"===n.workspaceLocation||"sicp"===n.workspaceLocation)&&Object(b.jsx)(A,{...a})]})})]})})}),T.a);t.a=e=>{const t=/Android/.test(navigator.userAgent),s=Object(o.useMediaQuery)({orientation:"portrait"}),[i,p]=r.a.useState({x:0,y:0}),[g,m]=r.a.useState(!1);a.a.onlyShowFocusOnTabs(),r.a.useEffect((()=>("assessment"===e.mobileSideContentProps.workspaceLocation&&document.documentElement.style.setProperty("--mobile-panel-height","calc(100% - 100px - 1.1rem)"),()=>{document.documentElement.style.setProperty("--mobile-panel-height","calc(100% - 70px)")})),[]),r.a.useEffect((()=>{if(s&&t){document.documentElement.style.setProperty("overflow","auto");document.querySelector("meta[name=viewport]").setAttribute("content","height="+window.innerHeight+", width=device-width")}return()=>{if(t){document.documentElement.style.setProperty("overflow","hidden");document.querySelector("meta[name=viewport]").setAttribute("content","width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0")}S()}}),[s,t]);const[y,O]=r.a.useState(null),v=()=>O(null),x=e=>({...e,onFocus:(t,s)=>{e.onFocus&&e.onFocus(t,s),s&&O(s)},onBlur:(t,s)=>{e.onBlur&&e.onBlur(t,s),v()}}),C=e=>{document.documentElement.style.setProperty("--mobile-repl-height",Math.max(-e,0)+"px"),p({x:0,y:e})},S=()=>{p({x:0,y:0}),document.documentElement.style.setProperty("--mobile-repl-height","0px")},w=e.sideBarProps.tabs.filter((e=>void 0!==e.id)),E=r.a.useMemo((()=>({label:"Editor",iconName:n.a.EDIT,body:null,id:h.b.mobileEditor})),[]),T=r.a.useMemo((()=>({label:"Run",iconName:n.a.PLAY,body:null,id:h.b.mobileEditorRun})),[]),k="assessment"===e.mobileSideContentProps.workspaceLocation||"githubAssessment"===e.mobileSideContentProps.workspaceLocation;return Object(b.jsxs)("div",{className:"workspace mobile-workspace",children:[e.hasUnsavedChanges?Object(b.jsx)(c.a,{message:"You have changes that may not be saved. Are you sure you want to leave?"}):null,k&&Object(b.jsx)(l.a,{...e.mobileSideContentProps.mobileControlBarProps}),Object(b.jsxs)("div",{children:[Object(b.jsx)("div",{className:"mobile-editor-panel",children:(()=>{if(e.editorContainerProps){const t={...e.editorContainerProps};return"sourcecast"===t.editorVariant&&(t.setDraggableReplPosition=()=>C(-100)),Object(b.jsx)(d.b,{...x(e.editorContainerProps)})}return Object(b.jsx)(u.a,{...e.mcqProps})})()}),Object(b.jsx)(I,{...{...e.mobileSideContentProps,onChange:(t,s,a)=>{e.mobileSideContentProps.onChange(t,s,a),((t,s)=>{var a;t===h.b.mobileEditorRun&&(null===(a=e.editorContainerProps)||void 0===a||a.handleEditorEval()),t===h.b.mobileEditorRun&&s!==h.b.substVisualizer&&s!==h.b.autograder&&s!==h.b.testcases?C(-300):S(),t===h.b.files||t===h.b.substVisualizer||s===h.b.substVisualizer&&t===h.b.mobileEditorRun?m(!0):m(!1)})(t,s)},tabs:{beforeDynamicTabs:[...w,E,...e.mobileSideContentProps.tabs.beforeDynamicTabs],afterDynamicTabs:[...e.mobileSideContentProps.tabs.afterDynamicTabs,T]}}})]}),Object(b.jsx)(j,{position:i,onDrag:(e,t)=>{document.documentElement.style.setProperty("--mobile-repl-height",Math.max(-t.y,0)+"px"),p(t)},disabled:g,replProps:(e=>({...e,onFocus:t=>{e.onFocus&&e.onFocus(t),O(t)},onBlur:()=>{e.onBlur&&e.onBlur(),v()}}))(e.replProps)},"repl"),Object(b.jsx)(f,{targetKeyboardInput:y})]})}},173:function(e,t,s){"use strict";s.d(t,"a",(function(){return o}));var a=s(122),n=(s(1),s(12)),i=s(0);const r=e=>{let{onClick:t}=e;return Object(i.jsx)(n.a,{label:"Return to Academy",icon:a.a.ARROW_RIGHT,onClick:t,options:{iconOnRight:!0}})},o=e=>e.questionProgress[0]===e.questionProgress[1]?Object(i.jsx)(r,{onClick:e.onClickReturn},"return_to_academy"):Object(i.jsx)(n.a,{label:"Next",icon:a.a.ARROW_RIGHT,onClick:e.onClickNext,options:{iconOnRight:!0}})},174:function(e,t,s){"use strict";s.d(t,"a",(function(){return Me}));var a=s(42),n=s(1),i=s.n(n),r=s(14);class o{constructor(){this._x=0,this._y=0,this._width=0,this._height=0,this._isDrawn=!1,this.ref=i.a.createRef()}x(){return this._x}y(){return this._y}width(){return this._width}height(){return this._height}isDrawn(){return this._isDrawn}reset(){this._isDrawn=!1}}let c;!function(e){e[e.CanvasMinHeight=300]="CanvasMinHeight",e[e.CanvasMinWidth=300]="CanvasMinWidth",e[e.CanvasPaddingX=30]="CanvasPaddingX",e[e.CanvasPaddingY=30]="CanvasPaddingY",e[e.LevelPaddingX=10]="LevelPaddingX",e[e.LevelPaddingY=10]="LevelPaddingY",e[e.FrameMinWidth=100]="FrameMinWidth",e[e.FramePaddingX=20]="FramePaddingX",e[e.FramePaddingY=30]="FramePaddingY",e[e.FrameMarginX=30]="FrameMarginX",e[e.FrameMarginY=10]="FrameMarginY",e[e.FrameCornerRadius=3]="FrameCornerRadius",e[e.FnRadius=15]="FnRadius",e[e.FnInnerRadius=3]="FnInnerRadius",e[e.FnTooltipOpacity=.3]="FnTooltipOpacity",e[e.DataMinWidth=20]="DataMinWidth",e[e.DataUnitWidth=40]="DataUnitWidth",e[e.DataUnitHeight=40]="DataUnitHeight",e[e.DataCornerRadius=3]="DataCornerRadius",e[e.DataHitStrokeWidth=5]="DataHitStrokeWidth",e[e.TextPaddingX=10]="TextPaddingX",e[e.TextPaddingY=30]="TextPaddingY",e[e.TextMargin=5]="TextMargin",e[e.TextMinWidth=30]="TextMinWidth",e.FontFamily="monospace, monospace",e[e.FontSize=15]="FontSize",e.FontStyle="normal",e.FontVariant="normal",e.HoveredColor="#32CD32",e[e.ArrowHeadSize=10]="ArrowHeadSize",e[e.ArrowStrokeWidth=1]="ArrowStrokeWidth",e[e.ArrowHitStrokeWidth=5]="ArrowHitStrokeWidth",e[e.ArrowHoveredStrokeWidth=2]="ArrowHoveredStrokeWidth",e[e.ArrowCornerRadius=40]="ArrowCornerRadius",e.SA_WHITE="#999999",e.SA_BLUE="#2c3e50",e.PRINT_BACKGROUND="white",e.ConstantColon=":= ",e.VariableColon=": ",e.Ellipsis="\u2026",e.UnassignedData="",e.GlobalFrameDefaultText=":::pre-declared names::",e.GlobalEnvId="-1"}(c||(c={}));const l={preventDefault:!1};var d=s(149),u=s(33);let h;!function(e){e[e.CanvasMinHeight=300]="CanvasMinHeight",e[e.CanvasMinWidth=300]="CanvasMinWidth",e[e.CanvasPaddingX=30]="CanvasPaddingX",e[e.CanvasPaddingY=30]="CanvasPaddingY",e[e.LevelPaddingX=10]="LevelPaddingX",e[e.LevelPaddingY=10]="LevelPaddingY",e[e.FrameMinWidth=100]="FrameMinWidth",e[e.FramePaddingX=20]="FramePaddingX",e[e.FramePaddingY=30]="FramePaddingY",e[e.FrameMarginX=60]="FrameMarginX",e[e.FrameMarginY=100]="FrameMarginY",e[e.FrameCornerRadius=3]="FrameCornerRadius",e[e.FnRadius=15]="FnRadius",e[e.FnInnerRadius=3]="FnInnerRadius",e[e.FnTooltipOpacity=.6]="FnTooltipOpacity",e[e.DataMinWidth=20]="DataMinWidth",e[e.DataUnitWidth=40]="DataUnitWidth",e[e.DataUnitPaddingY=40]="DataUnitPaddingY",e[e.DataUnitPaddingX=50]="DataUnitPaddingX",e[e.DataUnitHeight=40]="DataUnitHeight",e[e.DataCornerRadius=3]="DataCornerRadius",e[e.DataHitStrokeWidth=5]="DataHitStrokeWidth",e[e.DataGroupMaxDist=500]="DataGroupMaxDist",e[e.TextPaddingX=10]="TextPaddingX",e[e.TextPaddingY=20]="TextPaddingY",e[e.TextMargin=5]="TextMargin",e[e.TextMinWidth=30]="TextMinWidth",e.FontFamily="monospace, monospace",e[e.FontSize=15]="FontSize",e.FontStyle="normal",e.FontVariant="normal",e.HoveredColor="#32CD32",e[e.ArrowHeadSize=10]="ArrowHeadSize",e[e.ArrowStrokeWidth=1]="ArrowStrokeWidth",e[e.ArrowHitStrokeWidth=5]="ArrowHitStrokeWidth",e[e.ArrowHoveredStrokeWidth=2]="ArrowHoveredStrokeWidth",e[e.ArrowUnhoveredOpacity=.8]="ArrowUnhoveredOpacity",e[e.ArrowCornerRadius=10]="ArrowCornerRadius",e[e.ArrowMinHeight=100]="ArrowMinHeight",e[e.ArrowNumLanes=5]="ArrowNumLanes",e[e.ArrowLaneInterval=1]="ArrowLaneInterval",e[e.FrameArrowStrokeWidth=2]="FrameArrowStrokeWidth",e[e.FrameArrowHoveredStrokeWidth=2.5]="FrameArrowHoveredStrokeWidth",e[e.MaxExportWidth=2e4]="MaxExportWidth",e[e.MaxExportHeight=12e3]="MaxExportHeight",e.SA_WHITE="#999999",e.SA_BLUE="#2c3e50",e.PRINT_BACKGROUND="white",e.ConstantColon=":= ",e.VariableColon=": ",e.Ellipsis="\u2026",e.UnassignedData="",e.GlobalFrameDefaultText=":::pre-declared names::",e.GlobalEnvId="-1"}(h||(h={}));const p={preventDefault:!1};var g=s(0);const m={maxWidth:Number.MAX_VALUE,fontFamily:h.FontFamily.toString(),fontSize:Number(h.FontSize),fontStyle:h.FontStyle.toString(),fontVariant:h.FontVariant.toString(),isStringIdentifiable:!1};class b extends o{constructor(e,t,s){let a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{},n=arguments.length>4?arguments[4]:void 0;super(),this.data=e,this._hoveredWidth=void 0,this.partialStr=void 0,this.fullStr=void 0,this.options=m,this.frame=void 0,this.updatePosition=(e,t)=>{this._x=e,this._y=t},this.onMouseEnter=e=>{var t;let{currentTarget:s}=e;Me.getPrintableMode()||(ae(s),this.ref.current.moveToTop(),this.ref.current.show(),null===(t=s.getLayer())||void 0===t||t.draw())},this.onMouseLeave=e=>{var t;let{currentTarget:s}=e;Me.getPrintableMode()||(ne(s),this.ref.current.hide(),null===(t=s.getLayer())||void 0===t||t.draw())},this._x=t,this._y=s,this.frame=n,this.options={...this.options,...a};const{fontSize:i,fontStyle:r,fontFamily:o,maxWidth:c,isStringIdentifiable:l}=this.options;this.fullStr=this.partialStr=l&&JSON.stringify(e)||String(e),this._height=i;const d=e=>ee(e,`${r} ${i}px ${o}`);if(this._hoveredWidth=d(this.partialStr),this._hoveredWidth>c){let e=h.Ellipsis.toString(),t=0;for(;d(this.partialStr.substring(0,t)+h.Ellipsis.toString())<c;)e=this.partialStr.substring(0,t++)+h.Ellipsis.toString();this._width=d(e),this.partialStr=e}else this._width=Math.max(h.TextMinWidth,d(this.partialStr))}hoveredWidth(){return this._hoveredWidth}draw(){const e={fontFamily:this.options.fontFamily,fontSize:this.options.fontSize,fontStyle:this.options.fontStyle,fill:Me.getPrintableMode()?h.SA_BLUE.toString():h.SA_WHITE.toString()};return Object(g.jsxs)(r.c,{onMouseEnter:this.onMouseEnter,onMouseLeave:this.onMouseLeave,children:[Object(g.jsx)(r.d,{x:this.x(),y:this.y(),children:Object(n.createElement)(r.l,{...p,key:Ne.key++,text:this.partialStr,...e})}),Object(g.jsxs)(r.d,{x:this.x(),y:this.y(),ref:this.ref,visible:!1,listening:!1,children:[Object(g.jsx)(r.k,{...p,fill:Me.getPrintableMode()?"white":"black",opacity:.5,listening:!1}),Object(n.createElement)(r.l,{...p,key:Ne.key++,text:this.fullStr,...e,listening:!1})]})]},Ne.key++)}}class j extends o{constructor(e){super(),this.points=[],this.source=void 0,this.target=void 0,this._path="",this.selected=!1,this.unhovered_opacity=h.ArrowUnhoveredOpacity,this.hovered_opacity=1,this.source=e,this._x=e.x(),this._y=e.y()}path(){return this._path}to(e){return this.target=e,this._width=Math.abs(e.x()-this.source.x()),this._height=Math.abs(e.y()-this.source.y()),this}isSelected(){return this.selected}calculateSteps(){const e=this.target;return e?[()=>[e.x(),e.y()]]:[]}getStrokeWidth(){return Number(h.ArrowStrokeWidth)}onMouseEnter(e){ae(e.target),ie(e.currentTarget,{strokeWidth:Number(h.ArrowHoveredStrokeWidth)}),this.ref.current.opacity=this.unhovered_opacity}onClick(e){let{currentTarget:t}=e;var s;(this.selected=!this.selected,this.isSelected())||(this.source instanceof b&&null!==(s=this.source.frame)&&void 0!==s&&s.isSelected()||this.source instanceof N&&this.source.isSelected()?(ie(t,{strokeWidth:Number(h.ArrowHoveredStrokeWidth)*this.unhovered_opacity}),this.ref.current.opacity=this.hovered_opacity):(re(t,{strokeWidth:this.getStrokeWidth()}),this.ref.current.opacity=this.unhovered_opacity))}onMouseLeave(e){var t;(ne(e.target),this.isSelected())||(this.source instanceof b&&null!==(t=this.source.frame)&&void 0!==t&&t.isSelected()||this.source instanceof N&&this.source.isSelected()?(ie(e.currentTarget,{strokeWidth:Number(h.ArrowHoveredStrokeWidth)*this.unhovered_opacity}),this.ref.current.opacity=this.hovered_opacity):(re(e.currentTarget,{strokeWidth:this.getStrokeWidth()}),this.ref.current.opacity=this.unhovered_opacity))}draw(){const e=this.calculateSteps().reduce(((e,t)=>[...e,...t(e[e.length-2],e[e.length-1])]),[this.source.x(),this.source.y()]);e.splice(0,2);let t="";if(t+=`M ${e[0]} ${e[1]} `,4===e.length)t+=`L ${e[2]} ${e[3]} `;else{let s=0;for(;s<e.length-4;){const[a,n,i,r,o,c]=e.slice(s,s+6),l=(i-a)/2,d=(o-i)/2,u=(r-n)/2,p=(c-r)/2,g=Math.sqrt(Math.pow(l,2)+Math.pow(u,2))/2,m=Math.sqrt(Math.pow(d,2)+Math.pow(p,2))/2,b=Math.min(h.ArrowCornerRadius,g,m);t+=`L ${i-b*l/g} ${r-b*u/g} Q ${i} ${r} ${i+b*d/m} ${r+b*p/m} `,s+=2}}return t+=`L ${e[e.length-2]} ${e[e.length-1]} `,this._path=t,Object(g.jsxs)(r.c,{ref:this.ref,onMouseEnter:e=>this.onMouseEnter(e),onMouseLeave:e=>this.onMouseLeave(e),onClick:e=>this.onClick(e),opacity:this.unhovered_opacity,children:[Object(n.createElement)(r.g,{...p,stroke:Me.getPrintableMode()?h.SA_BLUE.toString():h.SA_WHITE.toString(),strokeWidth:this.getStrokeWidth(),hitStrokeWidth:Number(h.ArrowHitStrokeWidth),data:t,key:Ne.key++}),Object(n.createElement)(r.a,{...p,points:e.slice(e.length-4),fill:Me.getPrintableMode()?h.SA_BLUE.toString():h.SA_WHITE.toString(),strokeEnabled:!1,pointerWidth:Number(h.ArrowHeadSize),pointerLength:Number(h.ArrowHeadSize),key:Ne.key++})]},Ne.key++)}}class y extends j{calculateSteps(){const e=this.target;if(!e)return[];const t=[(e,t)=>[e+h.FramePaddingX,t]];return e instanceof N&&(t.push(((t,s)=>[t,L.getHorizontalLaneAfterSource(e,s).getPosition(e)])),t.push(((t,s)=>[e.x()+h.FramePaddingX,s]))),t.push(((t,s)=>[e.x()+h.FramePaddingX,e.y()+e.height()])),t}getStrokeWidth(){return Number(h.FrameArrowStrokeWidth)}onClick(e){super.onClick(e),ie(e.currentTarget,{strokeWidth:Number(h.FrameArrowHoveredStrokeWidth)})}onMouseEnter(e){super.onMouseEnter(e),ie(e.currentTarget,{strokeWidth:Number(h.FrameArrowHoveredStrokeWidth)})}onMouseLeave(e){super.onMouseLeave(e),this.isSelected()||this.source.isSelected()?ie(e.currentTarget,{strokeWidth:Number(h.FrameArrowStrokeWidth)}):re(e.currentTarget,{strokeWidth:Number(h.FrameArrowStrokeWidth)})}}class O extends o{constructor(e){super(),this.parent=e,this.value=null,this.data=[],this.ref=i.a.createRef(),this.updatePosition=()=>{this._x=this.parent.x(),this._y=this.parent.y()},this._x=this.parent.x(),this._y=this.parent.y(),this._height=this.parent.height(),this._width=this.parent.width()}draw(){return Object(n.createElement)(r.h,{...p,key:Ne.key++,x:this.x(),y:this.y(),width:this.width(),height:this.height(),stroke:Me.getPrintableMode()?h.SA_BLUE.toString():h.SA_WHITE.toString(),ref:this.ref})}}class f extends j{calculateSteps(){const e=this.source,t=this.target;if(!t)return[];const s=[(e,t)=>[e+3*h.FnRadius,t]];return t.y()<e.y()&&e.y()<t.y()+t.height()?(s.push(((e,t)=>[e,t-2*h.FnRadius])),s.push(((s,a)=>[t.x()+(e.x()<t.x()?0:t.width()),a]))):(s.push(((e,t)=>[e,t-2*h.FnRadius])),s.push(((t,s)=>[L.getVerticalLaneBeforeTarget(e,t).getPosition(e),s])),s.push(((e,s)=>[e,L.getHorizontalLaneBeforeTarget(t,s).getPosition(t)])),s.push(((e,s)=>[t.x()+(t.x()<e?t.width():0),s])),s.push(((s,a)=>[s,t.y()+(t.y()<e.y()?t.height():0)]))),s}}class v extends o{constructor(){super(...arguments),this.referencedBy=void 0,this.data=void 0}addReference(e){this.referencedBy.push(e)}}class x extends v{constructor(e,t){super(),this.data=e,this.referencedBy=t,this.centerX=void 0,this.tooltipWidth=void 0,this.exportTooltipWidth=void 0,this.radius=h.FnRadius,this.innerRadius=h.FnInnerRadius,this.fnName=void 0,this.paramsText=void 0,this.bodyText=void 0,this.exportBodyText=void 0,this.tooltip=void 0,this.exportTooltip=void 0,this.selected=!1,this._arrow=void 0,this.enclosingEnvNode=void 0,this.ref=i.a.createRef(),this.labelRef=i.a.createRef(),this.onMouseEnter=e=>{let{currentTarget:t}=e;Me.getPrintableMode()||(this.labelRef.current.moveToTop(),this.labelRef.current.show(),ie(t))},this.onMouseLeave=e=>{let{currentTarget:t}=e;if(!Me.getPrintableMode())if(this.selected){var s;const e=null===(s=t.getStage())||void 0===s?void 0:s.container();e&&(e.style.cursor="default")}else this.labelRef.current.hide(),re(t)},this.onClick=e=>{let{currentTarget:t}=e;Me.getPrintableMode()||(this.selected=!this.selected,this.selected?(this.labelRef.current.show(),ie(t)):(this.labelRef.current.hide(),re(t)))},Ne.memoizeValue(this);const s=this.referencedBy[0];s instanceof U?(this._x=s.frame.x()+s.frame.width()+h.FrameMarginX/4,this._y=s.y(),this.centerX=this._x+2*this.radius):(s.isLastUnit?(this._x=s.x()+2*h.DataUnitWidth,this._y=s.y()+h.DataUnitHeight/2-this.radius):(this._x=s.x(),this._y=s.y()+s.parent.height()+h.DataUnitHeight),this.centerX=this._x+h.DataUnitWidth/2,this._x=this.centerX-2*this.radius),this._y+=this.radius,this._width=4*this.radius,this._height=2*this.radius,this.enclosingEnvNode=Ne.environmentTree.getTreeNode(oe(this.data.environment)),this.fnName=this.data.functionName,this.paramsText=`params: (${te(this.data)})`,this.bodyText=`body: ${se(this.data)}`,this.exportBodyText=(this.bodyText.length>23?this.bodyText.slice(0,20):this.bodyText).split("\n").slice(0,2).join("\n")+" ...",this.tooltip=`${this.paramsText}\n${this.bodyText}`,this.exportTooltip=`${this.paramsText}\n${this.exportBodyText}`,this.tooltipWidth=Math.max(ee(this.paramsText),ee(this.bodyText)),this.exportTooltipWidth=Math.max(ee(this.paramsText),ee(this.exportBodyText))}isSelected(){return this.selected}arrow(){return this._arrow}updatePosition(){const e=this.referencedBy.find((e=>e instanceof U&&e.frame.envTreeNode===this.enclosingEnvNode))||this.referencedBy[0];e instanceof U?(this._x=e.frame.x()+e.frame.width()+h.FrameMarginX/4,this._y=e.y(),this.centerX=this._x+2*this.radius):(e.isLastUnit?(this._x=e.x()+2*h.DataUnitWidth,this._y=e.y()+h.DataUnitHeight/2-this.radius):(this._x=e.x(),this._y=e.y()+e.parent.height()+h.DataUnitHeight),this.centerX=this._x+h.DataUnitWidth/2,this._x=this.centerX-2*this.radius),this._y+=this.radius}reset(){super.reset(),this.referencedBy.length=0}draw(){var e;return this._isDrawn=!0,this._arrow=this.enclosingEnvNode.frame&&new f(this).to(this.enclosingEnvNode.frame),Object(g.jsxs)(i.a.Fragment,{children:[Object(g.jsxs)(r.c,{onMouseEnter:e=>this.onMouseEnter(e),onMouseLeave:e=>this.onMouseLeave(e),onClick:e=>this.onClick(e),ref:this.ref,children:[Object(n.createElement)(r.b,{...p,key:Ne.key++,x:this.centerX-this.radius,y:this.y(),radius:this.radius,stroke:Me.getPrintableMode()?h.SA_BLUE.toString():h.SA_WHITE.toString()}),Object(n.createElement)(r.b,{...p,key:Ne.key++,x:this.centerX-this.radius,y:this.y(),radius:this.innerRadius,fill:Me.getPrintableMode()?h.SA_BLUE.toString():h.SA_WHITE.toString()}),Object(n.createElement)(r.b,{...p,key:Ne.key++,x:this.centerX+this.radius,y:this.y(),radius:this.radius,stroke:Me.getPrintableMode()?h.SA_BLUE.toString():h.SA_WHITE.toString()}),Object(n.createElement)(r.b,{...p,key:Ne.key++,x:this.centerX+this.radius,y:this.y(),radius:this.innerRadius,fill:Me.getPrintableMode()?h.SA_BLUE.toString():h.SA_WHITE.toString()})]}),Me.getPrintableMode()?Object(g.jsxs)(r.d,{x:this.x()+this.width()+2*h.TextPaddingX,y:this.y()-h.TextPaddingY,visible:!0,ref:this.labelRef,children:[Object(g.jsx)(r.k,{stroke:"black",fill:"white",opacity:Number(h.FnTooltipOpacity)}),Object(g.jsx)(r.l,{text:this.exportTooltip,fontFamily:h.FontFamily.toString(),fontSize:Number(h.FontSize),fontStyle:h.FontStyle.toString(),fill:h.SA_BLUE.toString(),padding:5})]}):Object(g.jsxs)(r.d,{x:this.x()+this.width()+2*h.TextPaddingX,y:this.y()-h.TextPaddingY,visible:!1,ref:this.labelRef,children:[Object(g.jsx)(r.k,{stroke:"black",fill:"black",opacity:Number(h.FnTooltipOpacity)}),Object(g.jsx)(r.l,{text:this.tooltip,fontFamily:h.FontFamily.toString(),fontSize:Number(h.FontSize),fontStyle:h.FontStyle.toString(),fill:h.SA_WHITE.toString(),padding:5})]}),null===(e=this._arrow)||void 0===e?void 0:e.draw()]},Ne.key++)}}class C extends v{constructor(e,t){super(),this.data=e,this.referencedBy=t,this.centerX=void 0,this.tooltipWidth=void 0,this.exportTooltipWidth=void 0,this.radius=h.FnRadius,this.innerRadius=h.FnInnerRadius,this._arrow=void 0,this.paramsText=void 0,this.bodyText=void 0,this.exportBodyText=void 0,this.tooltip=void 0,this.exportTooltip=void 0,this.selected=!1,this.ref=i.a.createRef(),this.labelRef=i.a.createRef(),this.onMouseEnter=e=>{let{currentTarget:t}=e;Me.getPrintableMode()||(this.labelRef.current.show(),ie(t))},this.onMouseLeave=e=>{let{currentTarget:t}=e;if(!Me.getPrintableMode())if(this.selected){var s;const e=null===(s=t.getStage())||void 0===s?void 0:s.container();e&&(e.style.cursor="default")}else this.labelRef.current.hide(),re(t)},this.onClick=e=>{let{currentTarget:t}=e;Me.getPrintableMode()||(this.selected=!this.selected,this.selected?(this.labelRef.current.show(),ie(t)):(this.labelRef.current.hide(),re(t)))},Ne.memoizeValue(this);const s=this.referencedBy[0];s instanceof U?(this._x=s.frame.x()+s.frame.width()+h.FrameMarginX/4,this._y=s.y(),this.centerX=this._x+2*this.radius):(s.isLastUnit?(this._x=s.x()+2*h.DataUnitWidth,this._y=s.y()+h.DataUnitHeight/2-this.radius):(this._x=s.x(),this._y=s.y()+s.parent.height()+h.DataUnitHeight),this.centerX=this._x+h.DataUnitWidth/2,this._x=this.centerX-2*this.radius),this._y+=this.radius,this._width=4*this.radius,this._height=2*this.radius,this.paramsText=`params: ${te(this.data)}`,this.bodyText=`body: ${se(this.data)}`,this.exportBodyText=(this.bodyText.length>23?this.bodyText.slice(0,20):this.bodyText).split("\n").slice(0,2).join("\n")+" ...",this.tooltip=`${this.paramsText}\n${this.bodyText}`,this.exportTooltip=`${this.paramsText}\n${this.exportBodyText}`,this.tooltipWidth=Math.max(ee(this.paramsText),ee(this.bodyText))+h.TextPaddingX,this.exportTooltipWidth=Math.max(ee(this.paramsText),ee(this.exportBodyText))}isSelected(){return this.selected}arrow(){return this._arrow}updatePosition(){const e=this.referencedBy.find((e=>e instanceof U))||this.referencedBy[0];e instanceof U?(this._x=e.frame.x()+e.frame.width()+h.FrameMarginX/4,this._y=e.y(),this.centerX=this._x+2*this.radius):(e.isLastUnit?(this._x=e.x()+2*h.DataUnitWidth,this._y=e.y()+h.DataUnitHeight/2-this.radius):(this._x=e.x(),this._y=e.y()+e.parent.height()+h.DataUnitHeight),this.centerX=this._x+h.DataUnitWidth/2,this._x=this.centerX-2*this.radius),this._y+=this.radius}draw(){var e;return this._isDrawn=!0,this._arrow=Ne.globalEnvNode.frame&&new f(this).to(Ne.globalEnvNode.frame),Object(g.jsxs)(i.a.Fragment,{children:[Object(g.jsxs)(r.c,{onMouseEnter:e=>this.onMouseEnter(e),onMouseLeave:e=>this.onMouseLeave(e),onClick:e=>this.onClick(e),ref:this.ref,children:[Object(n.createElement)(r.b,{...p,key:Ne.key++,x:this.centerX-this.radius,y:this.y(),radius:this.radius,stroke:Me.getPrintableMode()?h.SA_BLUE.toString():h.SA_WHITE.toString()}),Object(n.createElement)(r.b,{...p,key:Ne.key++,x:this.centerX-this.radius,y:this.y(),radius:this.innerRadius,fill:Me.getPrintableMode()?h.SA_BLUE.toString():h.SA_WHITE.toString()}),Object(n.createElement)(r.b,{...p,key:Ne.key++,x:this.centerX+this.radius,y:this.y(),radius:this.radius,stroke:Me.getPrintableMode()?h.SA_BLUE.toString():h.SA_WHITE.toString()}),Object(n.createElement)(r.b,{...p,key:Ne.key++,x:this.centerX+this.radius,y:this.y(),radius:this.innerRadius,fill:Me.getPrintableMode()?h.SA_BLUE.toString():h.SA_WHITE.toString()})]}),Me.getPrintableMode()?Object(g.jsxs)(r.d,{x:this.x()+this.width()+2*h.TextPaddingX,y:this.y()-h.TextPaddingY,visible:!0,ref:this.labelRef,children:[Object(g.jsx)(r.k,{stroke:"black",fill:"white",opacity:Number(h.FnTooltipOpacity)}),Object(g.jsx)(r.l,{text:this.exportTooltip,fontFamily:h.FontFamily.toString(),fontSize:Number(h.FontSize),fontStyle:h.FontStyle.toString(),fill:h.SA_BLUE.toString(),padding:5})]}):Object(g.jsxs)(r.d,{x:this.x()+this.width()+2*h.TextPaddingX,y:this.y()-h.TextPaddingY,visible:!1,ref:this.labelRef,children:[Object(g.jsx)(r.k,{stroke:"black",fill:"black",opacity:Number(h.FnTooltipOpacity)}),Object(g.jsx)(r.l,{text:this.tooltip,fontFamily:h.FontFamily.toString(),fontSize:Number(h.FontSize),fontStyle:h.FontStyle.toString(),fill:h.SA_WHITE.toString(),padding:5})]}),null===(e=this._arrow)||void 0===e?void 0:e.draw()]},Ne.key++)}}class S extends j{static emergeFromTopOrBottom(e,t,s){e.push(((e,a)=>[e,a+(s.y()>t.y()||s.y()===t.y()&&s.x()<=t.x()?.9:-.9)*h.DataUnitHeight]))}calculateSteps(){const e=this.source,t=this.target;if(!t)return[];const s=[(e,t)=>[e+h.DataUnitWidth/2,t+h.DataUnitHeight/2]];if(t instanceof x||t instanceof C)Math.abs(t.y()-e.y())<2*h.DataUnitHeight?(S.emergeFromTopOrBottom(s,e,t),s.push((()=>[t.centerX+2*h.FnRadius+h.FnRadius,t.y()])),s.push(((e,t)=>[e-h.FnRadius,t]))):s.push((()=>[t.centerX+2*h.FnRadius,t.y()]));else if(t instanceof A)if(e.parent===t)s.push(((e,t)=>[e,t-3*h.DataUnitHeight/4])),s.push(((e,t)=>[e+h.DataUnitHeight/3,t])),s.push(((e,t)=>[e,t+h.DataUnitHeight/4]));else if(e.isLastUnit&&t.x()-e.x()<=3*h.DataUnitWidth&&t.x()>e.x()&&t.level===e.parent.level)s.push((()=>[t.x(),t.y()+h.DataUnitHeight/2]));else{S.emergeFromTopOrBottom(s,e,t);const a=L.getVerticalLaneAfterSource(t,e.x()).getPosition(t);(a-e.x())*(a-t.x())<0&&s.push(((e,t)=>[a,t]));const n=L.getHorizontalLaneBeforeTarget(t,e.y()).getPosition(t);(n-e.y())*(n-t.y())<0&&s.push(((e,s)=>(n-s)*(n-t.y())>0?[e,s]:[e,L.getHorizontalLaneBeforeTarget(t,s).getPosition(t)])),s.push(((e,s)=>{let a,n=t.y()+h.DataUnitHeight/2-s;const i=t.y()+h.DataUnitHeight/2-Math.sign(n)*h.DataUnitHeight/2;if(n=i-s,e<t.x()-h.DataUnitWidth)a=Math.max(e+h.DataUnitWidth,t.x()-Math.abs(n));else{if(!(e>=t.x()+t.units.length*h.DataUnitWidth+h.DataUnitWidth)){if(e<t.x())a=t.x();else if(e>=t.x()+t.units.length*h.DataUnitWidth+h.DataUnitWidth)a=t.x()+t.units.length*h.DataUnitWidth+h.DataUnitWidth;else{const s=Math.floor((e-t.x())/h.DataUnitWidth);a=t.x()+h.DataUnitWidth*s}return[(e+a)/2,(s+i)/2]}a=t.x()+t.units.length*h.DataUnitWidth,a=Math.min(e-h.DataUnitWidth,a+Math.abs(n))}return[a,s]})),s.push(((e,s)=>{const a=Math.floor((e-t.x())/h.DataUnitWidth),n=t.y()+h.DataUnitHeight/2-s,i=t.y()+h.DataUnitHeight/2-Math.sign(n)*h.DataUnitHeight/2;return e<t.x()?[t.x(),i]:e>=t.x()+t.units.length*h.DataUnitWidth?[t.x()+t.units.length*h.DataUnitWidth,i]:[t.x()+h.DataUnitWidth*a,i]}))}else s.push((()=>[t.x(),t.y()]));return s}}const w=e=>{let{x:t,y:s,width:a,height:n,cornerRadius:i,forwardRef:o,...c}=e;return Object(g.jsx)(r.i,{sceneFunc:(e,r)=>{const{upperLeft:o,lowerLeft:c,upperRight:l,lowerRight:d}=i;e.beginPath(),e.moveTo(t+o,s),e.lineTo(t+a-l,s),e.quadraticCurveTo(t+a,s,t+a,s+l),e.lineTo(t+a,s+n-d),e.quadraticCurveTo(t+a,s+n,t+a-d,s+n),e.lineTo(t+c,s+n),e.quadraticCurveTo(t,s+n,t,s+n-c),e.lineTo(t,s+o),e.quadraticCurveTo(t,s,t+o,s),e.closePath(),e.fillStrokeShape(r)},...p,ref:o,...c})};class E extends o{constructor(e){super(),this.arrayUnit=void 0,this.referencedBy=void 0,this.updatePosition=()=>{this._x=this.arrayUnit.x(),this._y=this.arrayUnit.y()},this.referencedBy=e,this.arrayUnit=e[0],this._x=this.arrayUnit.x(),this._y=this.arrayUnit.y(),this._height=this.arrayUnit.height(),this._width=this.arrayUnit.width()}draw(){return Object(n.createElement)(r.f,{...p,key:Ne.key++,points:[this.x(),this.y()+this.height(),this.x()+this.width(),this.y()],stroke:Me.getPrintableMode()?h.SA_BLUE.toString():h.SA_WHITE.toString(),hitStrokeWidth:Number(h.DataHitStrokeWidth),ref:this.ref,listening:!1})}}class T extends v{constructor(e,t){super(),this.data=e,this.referencedBy=t,this.text=void 0,this.updatePosition=()=>{const e=this.referencedBy[0];if(e instanceof U)this._x=e.x()+ee(e.keyString)+h.TextPaddingX,this._y=e.y();else{const t=e.width(),s=Math.min(ee(String(this.data)),t);this._x=e.x()+(e.width()-s)/2,this._y=e.y()+(e.height()-h.FontSize)/2}this.text instanceof b?this.text.updatePosition(this.x(),this.y()):this.text.updatePosition()};const s=this.referencedBy[0];if(s instanceof U)this._x=s.x()+ee(s.keyString)+h.TextPaddingX,this._y=s.y(),this.text=new b(this.data,this._x,this._y,{isStringIdentifiable:!0});else{const e=s.width(),t=Math.min(ee(String(this.data)),e);this._x=s.x()+(s.width()-t)/2,this._y=s.y()+(s.height()-h.FontSize)/2,this.text=z(this.data)?new E([s]):new b(this.data,this.x(),this.y(),{maxWidth:e,isStringIdentifiable:!0})}this._width=this.text.width(),this._height=this.text.height()}reset(){super.reset(),this.referencedBy.length=0}onMouseEnter(){}onMouseLeave(){}draw(){return this._isDrawn=!0,Object(g.jsx)(i.a.Fragment,{children:this.text.draw()},Ne.key++)}}class k extends o{constructor(e,t,s){super(),this.idx=e,this.data=t,this.value=void 0,this.isFirstUnit=void 0,this.isLastUnit=void 0,this.isMainReference=void 0,this.parent=void 0,this.arrow=void 0,this.updatePosition=()=>{this._x=this.parent.x()+this.idx*h.DataUnitWidth,this._y=this.parent.y(),this.value instanceof T&&this.value.updatePosition()},this.onMouseEnter=()=>{this.parent.units.forEach((e=>{ie(e.ref.current)}))},this.onMouseLeave=e=>{let{currentTarget:t}=e;if(this.parent.isSelected()){var s;const e=null===(s=t.getStage())||void 0===s?void 0:s.container();e&&(e.style.cursor="default")}else this.parent.units.forEach((e=>{re(e.ref.current)}))},this.onClick=()=>{this.parent.onClick()},this.parent=s,this._x=this.parent.x()+this.idx*h.DataUnitWidth,this._y=this.parent.y(),this._height=h.DataUnitHeight,this._width=h.DataUnitWidth,this.isFirstUnit=0===this.idx,this.isLastUnit=this.idx===this.parent.data.length-1,this.value=Ne.createValue(this.data,this),this.isMainReference=this.value.referencedBy.length>1}draw(){if(this._isDrawn)return null;this._isDrawn=!0;const e={upperLeft:0,lowerLeft:0,upperRight:0,lowerRight:0};return this.isFirstUnit&&(e.upperLeft=e.lowerLeft=Number(h.DataCornerRadius)),this.isLastUnit&&(e.upperRight=e.lowerRight=Number(h.DataCornerRadius)),this.value instanceof T||(this.arrow=new S(this).to(this.value),this.parent.addArrow(this.arrow),this.value instanceof A&&this.value.addArrow(this.arrow)),Object(g.jsxs)(i.a.Fragment,{children:[Object(g.jsx)(w,{x:this.x(),y:this.y(),width:this.width(),height:this.height(),stroke:Me.getPrintableMode()?h.SA_BLUE.toString():h.SA_WHITE.toString(),hitStrokeWidth:Number(h.DataHitStrokeWidth),fillEnabled:!1,forwardRef:this.ref,cornerRadius:e,onClick:this.onClick,onMouseEnter:this.onMouseEnter,onMouseLeave:this.onMouseLeave},Ne.key++),!(this.value instanceof x||this.value instanceof C)&&this.value.draw(),this.arrow&&this.arrow.draw()]},Ne.key++)}}class A extends v{constructor(e,t){super(),this.data=e,this.referencedBy=t,this.units=[],this.emptyUnit=void 0,this.level=void 0,this._arrows=[],this.selected=!1,this.ref=i.a.createRef(),this.parentArray=void 0,this.arrayLevelY=-1,this.onClick=()=>{this.selected=!this.selected,this.selected||(this.units.forEach((e=>{re(e.ref.current)})),this.emptyUnit&&re(this.emptyUnit.ref.current))},this.addArrow=e=>{this._arrows.push(e)},Ne.memoizeValue(this);const s=this.referencedBy[0];s instanceof U?(this._x=s.frame.x()+s.frame.width()+h.FrameMarginX,this._y=s.y()):(this.parentArray=s.parent,s.isLastUnit?(this._x=s.x()+2*h.DataUnitWidth,this._y=s.y()):(this._x=s.x(),this._y=s.y()+s.parent.height()+h.DataUnitHeight)),this._width=this.data.length*h.DataUnitWidth+h.DataMinWidth,this._height=h.DataUnitHeight;for(let a=this.data.length-1;a>=0;a--){const e=new k(a,this.data[a],this);this.units=[e,...this.units]}}onMouseEnter(){}onMouseLeave(){}isSelected(){return this.selected}arrows(){return this._arrows}reset(){super.reset(),this.units.map((e=>e.reset())),this.referencedBy.length=0,this._arrows=[]}setLevel(e,t){this.level=e,this.arrayLevelY=t}updatePosition(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{x:-1,y:-1};this._x=e.x>0?e.x:this._x,this._y=e.y>0?e.y:this._y,this.units.forEach((e=>{e.updatePosition()}))}draw(){return this.isDrawn()?null:(this._isDrawn=!0,this._arrows=this.referencedBy.filter((e=>e instanceof U)).map((e=>{const t=new D(e.key).to(this);return e.frame.trackObjects(this),e.frame.trackObjects(t),t})),0===this.units.length&&(this.emptyUnit=new O(this)),Object(g.jsxs)(r.c,{ref:this.ref,children:[this._arrows.map((e=>e.draw())),this.units.length>0&&this.units.map((e=>e.draw())),this.emptyUnit&&this.emptyUnit.draw(),Object(g.jsx)(r.h,{width:this.width(),height:this.height()})]},Ne.key++))}}const I=new Map([["global","Global"],["programEnvironment","Program"],["forLoopEnvironment","Body of for-loop"],["forBlockEnvironment","Control variable of for-loop"],["blockEnvironment","Block"],["functionBodyEnvironment","Function Body"]]);class N extends o{constructor(e,t,s){var a;super(),this.envTreeNode=e,this.xCoord=t,this.yCoord=s,this.totalHeight=void 0,this.totalWidth=void 0,this.totalHoveredWidth=void 0,this.bindings=[],this.name=void 0,this.level=void 0,this.environment=void 0,this.parentFrame=void 0,this.offsetY=void 0,this.values=[],this.selected=!1,this.updatePosition=(e,t)=>{this._x=e,this._y=t+this.offsetY,this.name.updatePosition(this.x(),t),this.bindings.forEach((e=>{e.updatePosition(this.x(),t)}))},this.update=e=>{this.level=e.level,this.environment=e.environment,this.offsetY=this.name.height()+h.TextPaddingY/3,this._y=this.level.y()+this.offsetY;let t=0;for(const[l,d]of Object.entries(this.environment.head)){const e=Math.max(h.TextMinWidth,ee(l+h.ConstantColon))+h.TextPaddingX+(Y(d)?Math.max(h.TextMinWidth,ee(h.UnassignedData.toString())):K(d)?Math.max(h.TextMinWidth,ee(String(d))):0);t=Math.max(t,e)}this._width=t+2*h.FramePaddingX,this.values=[];let s=null,a=this._width,n=this._width;this.totalHoveredWidth=Math.max(a,this.name.hoveredWidth());const i=Object.getOwnPropertyDescriptors(this.environment.head),r=[],o=[];for(const l of Object.entries(i))if(Z(l[0])){const e=oe(l[1].value.environment);(this.environment.id===h.GlobalEnvId||e&&e.id===this.environment.id)&&o.push(l)}else r.push(l);r.push(...o);for(const[l,d]of r){const e=new U(l,d.value,this,s,!d.writable);-1===this.bindings.findIndex((t=>t.value===e.value&&(e.isDummyBinding||t.keyString===e.keyString)))&&(this.bindings.push(e),s=e,a=Math.max(a,e.width()+h.FramePaddingX),n=Math.max(n,e.exportWidth()+h.FramePaddingX),this.totalHoveredWidth=Math.max(this.totalHoveredWidth,e.hoveredWidth()+h.FramePaddingX))}Me.getPrintableMode()?this.totalWidth=n:this.totalWidth=a,this._height=s?s.y()+s.height()+h.FramePaddingY-this.y():2*h.FramePaddingY,this.totalHeight=this.height()+this.name.height()+h.TextPaddingY/2;const c=N.cumWidths[this.xCoord]+this.totalWidth+h.FrameMarginX+h.FnRadius;N.cumWidths[this.xCoord+1]=void 0===N.cumWidths[this.xCoord+1]?c:Math.max(N.cumWidths[this.xCoord+1],c),N.maxX=Math.max(N.maxX,N.cumWidths[this.xCoord]+(Me.getPrintableMode()?this.totalWidth:this.totalHoveredWidth),N.cumWidths[N.cumWidths.length-1]),N.heights[this.yCoord]=Math.max(N.heights[this.yCoord]||0,this.totalHeight)},this.isSelected=()=>this.selected,this.onMouseEnter=()=>{ae(this.ref.current),ie(this.ref.current),this.bindings.forEach((e=>{const t=e.getArrow();t&&ie(t.ref.current)})),this.values.forEach((e=>{e&&ie(e.ref.current)}))},this.onMouseLeave=()=>{ne(this.ref.current),this.selected||(re(this.ref.current),this.bindings.forEach((e=>{const t=e.getArrow();t&&!t.isSelected()&&re(t.ref.current)})),this.values.forEach((e=>{e instanceof A&&e.isSelected()||e&&re(e.ref.current)})))},this.onClick=e=>{this.selected=!this.selected,this.selected?(ie(this.ref.current),this.bindings.forEach((e=>{const t=e.getArrow();t&&ie(t.ref.current)})),this.values.forEach((e=>{e&&ie(e.ref.current)}))):(re(this.ref.current),this.bindings.forEach((e=>{const t=e.getArrow();t&&!t.isSelected()&&re(t.ref.current)})),this.values.forEach((e=>{e instanceof A&&e.isSelected()||e&&re(e.ref.current)})))},this._width=h.FrameMinWidth,this.level=e.level,this.environment=e.environment,this.parentFrame=null===(a=e.parent)||void 0===a?void 0:a.frame,this.xCoord=t,this.yCoord=s,N.maxXCoord=Math.max(t,N.maxXCoord),this._x=0===t?h.CanvasPaddingX:N.cumWidths[t],this.name=new b(I.get(this.environment.name)||this.environment.name,this.x(),this.level.y(),{maxWidth:this.width()}),this.offsetY=this.name.height()+h.TextPaddingY/3,this._y=this.level.y()+this.offsetY,this._width=2*h.FramePaddingX,this.totalWidth=this.width(),this.totalHoveredWidth=this.totalWidth,this._height=2*h.FramePaddingY,this.totalHeight=this.height()+this.name.height()+h.TextPaddingY/2,this.update(e)}static lastXCoordBelow(e){let t=N.cumWidths.length;for(;t--;)if(N.cumWidths[t]<=e)return t;return 0}trackObjects(e){const t=this.values.includes(e);return!t&&this.values.push(e),!t}draw(){let e;return void 0!==this.parentFrame&&(e=new y(this).to(this.parentFrame),this.trackObjects(e)),Object(g.jsxs)(r.c,{ref:this.ref,children:[e&&e.draw(),this.bindings.map((e=>!(e.data instanceof A)&&e.draw())),this.name.draw(),Object(n.createElement)(r.h,{...p,x:this.x(),y:this.y(),width:this.width(),height:this.height(),stroke:Me.getPrintableMode()?h.SA_BLUE.toString():h.SA_WHITE.toString(),cornerRadius:Number(h.FrameCornerRadius),key:Ne.key++,onClick:e=>this.onClick(e),onMouseEnter:()=>this.onMouseEnter(),onMouseLeave:()=>this.onMouseLeave()})]},Ne.key++)}}N.maxXCoord=-1,N.maxX=h.CanvasPaddingX.valueOf(),N.cumWidths=[h.CanvasPaddingX.valueOf()],N.heights=[h.CanvasPaddingY.valueOf()],N.reset=()=>{N.maxX=h.CanvasPaddingX.valueOf(),N.maxXCoord=-1,N.cumWidths=[h.CanvasPaddingX.valueOf()],N.heights=[h.CanvasPaddingY.valueOf()]};class M extends o{constructor(e){super(),this.parentLevel=e}}class P extends M{constructor(e){super(e),this.parentLevel=e,this._minX=1/0,this._count=0,this.position=[[]],this._rowCount=0,this.arrays=[],this.getNumLanes=()=>this._rowCount,this.addArray=(e,t)=>{var s,a;t=t||0;let n=null!==(s=null===(a=e.parentArray)||void 0===a?void 0:a.arrayLevelY)&&void 0!==s?s:0,i=0,r=e;const o=[];for(;r instanceof A&&!o.includes(r);)o.push(r),i+=h.DataUnitPaddingX+r.units.length*h.DataUnitWidth,r.units.length>0&&r.units[r.units.length-1].value instanceof A&&(r=r.units[r.units.length-1].value);e:for(const d of this.position.slice(n)){for(const e of d)if(e[0]<t+i+h.DataMinWidth&&e[1]>t){n++;continue e}break}this._minX=Math.min(t,this._minX),this._count++,this._rowCount=Math.max(this._rowCount,n),this.position[n]=this.position[n]||[],this.position[n].push([t,t+e.width()+h.DataUnitWidth/2]),this.position[n].sort(((e,t)=>e[0]-t[0]));const c=h.DataUnitPaddingY,l=this._y+n*h.DataUnitHeight+(n+1)*c;e.updatePosition({x:t,y:l}),e.setLevel(this,n),this._height=Math.max(this._height,l+c),this.arrays.push(e),this._width=Math.max(this._width,t+e.width())},this.setY=e=>{this.arrays.forEach((t=>t.updatePosition({x:t.x(),y:t.y()-this.y()+e}))),this._y=e},this.reset=()=>{this._minX=1/0,this._count=0},this._x=h.CanvasPaddingX,this._y=0,this._width=0,this._rowCount=0}minX(){return this._minX}count(){return this._count}draw(){return Object(g.jsxs)(r.c,{ref:this.ref,children:[Object(n.createElement)(r.h,{...p,x:this.x(),y:this.y(),width:this.width(),height:this.height(),key:Ne.key++,listening:!1}),this.arrays.map((e=>e.draw()))]},Ne.key++)}}class R extends M{constructor(e){super(e),this.parentLevel=e,this.lastXcoord=void 0,this.yCoord=void 0,this.frames=[],this.addFrame=e=>{var t;const s=Math.max(null!==(t=e.xCoord)&&void 0!==t?t:0,R.maxXcoord,this.lastXcoord+1);this.lastXcoord=s,R.maxXcoord=Math.max(R.maxXcoord,s),e.level=this,void 0!==this.frames[s]?this.frames[s].update(e):(this.frames[s]=new N(e,s,this.yCoord),e.frame=this.frames[s]),this._width=N.maxX},this.setY=e=>{this._y=e,this.frames.forEach((t=>{t.updatePosition(t.x(),e)}))},this._x=h.CanvasPaddingX,this._y=0,this._width=0,this.lastXcoord=-1,this.yCoord=R.maxYcoord++}height(){return N.heights[this.yCoord]+h.FrameMarginY}draw(){return Object(g.jsxs)(r.c,{ref:this.ref,children:[Object(n.createElement)(r.h,{...p,x:this.x(),y:this.y(),width:this.width(),height:this.height(),key:Ne.key++,listening:!1}),this.frames.reverse().map((e=>e.draw()))]},Ne.key++)}}R.maxXcoord=0,R.maxYcoord=0,R.reset=()=>{R.maxXcoord=0,R.maxYcoord=0};class _ extends o{constructor(e){super(),this.envTreeNodes=e,this.frameLevels=void 0,this.arrayLevels=void 0,this.levels=void 0,this.widths=void 0,this.destroy=()=>{this.frameLevels.forEach((e=>e.ref.current.destroyChildren()))},this._x=0,this._y=0,this.frameLevels=[],this.arrayLevels=[],this.levels=[],this.widths=[],_.cumHeights=[],this._height=0,this._width=0,this.update(e)}update(e){N.reset(),R.reset(),L.reset(),this.arrayLevels.forEach((e=>e.reset())),this.frameLevels=[],this.arrayLevels=[],this.levels=[];const t=e.reduce(((e,t,s)=>(0===s?(this.frameLevels[s]=new R(null),this.arrayLevels[s]=new P(this.frameLevels[s])):(this.frameLevels[s]=new R(this.arrayLevels[s-1]),this.arrayLevels[s]=new P(this.frameLevels[s])),this.levels.push(this.frameLevels[s]),this.levels.push(this.arrayLevels[s]),[...e,...t.map((e=>[s,e]))])),new Array);t.sort(((e,t)=>parseInt(e[1].environment.id)-parseInt(t[1].environment.id))),this.widths=[],_.cumHeights=[];const s=[];t.forEach((e=>{var t,a,n;if(s[e[0]]=null!==(t=s[e[0]])&&void 0!==t?t:[],e[1].xCoord=Math.max(s[e[0]].length-1+1,null!==(a=null===(n=e[1].parent)||void 0===n?void 0:n.xCoord)&&void 0!==a?a:0),s[e[0]][e[1].xCoord]=e[1],e[1].parent){let t=e[1],a=e[0],n=!0;for(;n;){const e=t.parent;if(e.xCoord&&e.children.flatMap((e=>de(e)))[0]===t)if(void 0===t.xCoord||void 0===e.xCoord)n=!1;else{const i=t.xCoord-e.xCoord,r=e.xCoord;i>0&&s[a].slice(r,t.xCoord).every((t=>{var s;return void 0===t||parseInt(null!==(s=t.parent.environment.id)&&void 0!==s?s:0)<parseInt(e.environment.id)}))?(s[a-1].slice(r).forEach((e=>{void 0!==e&&(e.xCoord=e.xCoord?e.xCoord+i:e.xCoord)})),s[a-1]=[...s[a-1].slice(0,r),...Array(i).fill(void 0),...s[a-1].slice(r)],a-=1,t=e):n=!1}else n=!1}}})),t.sort(((e,t)=>{var s,a;return(null!==(s=e[1].xCoord)&&void 0!==s?s:0)-(null!==(a=t[1].xCoord)&&void 0!==a?a:0)})),t.forEach((e=>this.frameLevels[e[0]].addFrame(e[1]))),Ne.values.forEach(((e,t,s)=>{if(e instanceof A){let t=e.referencedBy.filter((e=>e instanceof U)),s=e.referencedBy.find((e=>e instanceof k));const r=e.referencedBy[0]instanceof U;for(;0===t.length;)t=s.parent.referencedBy.filter((e=>e instanceof U)),s=s.parent.referencedBy.find((e=>e instanceof k));if(r){const t=e.referencedBy[0].frame.yCoord,s=N.cumWidths[e.referencedBy[0].frame.xCoord+1]+.8*h.FrameMarginX;this.arrayLevels[Math.floor(t)].addArray(e,s)}else if(e.referencedBy[0]instanceof k){var a,n,i;const t=null!==(a=null===(n=e.referencedBy[0].parent.level)||void 0===n||null===(i=n.parentLevel)||void 0===i?void 0:i.yCoord)&&void 0!==a?a:0,s=e.referencedBy[0].x()+(e.referencedBy[0]instanceof k&&e.referencedBy[0].isLastUnit?h.DataUnitWidth+h.DataUnitPaddingX:0);this.arrayLevels[Math.floor(t)].addArray(e,s)}}})),_.cumHeights=this.levels.reduce(((e,t,s)=>{let a;if(s%2===0){const e=this.arrayLevels[Math.floor(s/2)];a=N.cumWidths[t.lastXcoord+1]<=e.minX()?0:N.heights[Math.floor(s/2)]+(N.heights[Math.floor(s/2)],h.FrameMarginY/2)}else{const e=this.frameLevels[Math.floor(s/2)];a=N.heights[Math.floor(s/2)]+(N.heights[Math.floor(s/2)]>0?h.FrameMarginY:0),t.count()>0&&(a=N.cumWidths[e.lastXcoord+1]<=t.minX()?Math.max(a,this.arrayLevels[Math.floor((s-1)/2)].height()+(this.arrayLevels[Math.floor((s-1)/2)].height()>0?h.FrameMarginY:h.FrameMarginY/2)):this.arrayLevels[Math.floor((s-1)/2)].height()+h.FrameMarginY)}return[...e,e[e.length-1]+a]}),[h.CanvasPaddingY.valueOf()]),this.levels.forEach(((e,t)=>{e.setY(_.cumHeights[t])})),this._height=_.cumHeights[_.cumHeights.length-1],this._width=Math.max(this.frameLevels.reduce(((e,t)=>Math.max(e,t.width())),0),this.arrayLevels.reduce(((e,t)=>Math.max(e,t.width())),0))+h.FrameMarginX}static lastYCoordBelow(e){let t=_.cumHeights.length;for(;t--;)if(_.cumHeights[t]<=e)return t;return 0}draw(){return Object(g.jsxs)(r.c,{children:[Object(n.createElement)(r.h,{...p,x:this.x(),y:this.y(),width:this.width(),height:this.height(),key:Ne.key++,listening:!1}),this.arrayLevels.reverse().map((e=>e.draw())),this.frameLevels.reverse().map((e=>e.draw()))]},Ne.key++)}}_.cumHeights=void 0;class L{constructor(e,t){this.id=void 0,this.objects=[],this.frames=[],this.isVertical=!0,this.getPosition=e=>{if(e instanceof N){let t=this.frames.indexOf(e);-1===t&&(t=this.frames.push(e)-1);const s=t*h.ArrowLaneInterval%h.ArrowNumLanes;return _.cumHeights[this.id]-.45*h.FrameMarginY-s/h.ArrowNumLanes*h.FrameMarginY*.35}{let t=this.objects.indexOf(e instanceof v?e.data:e);-1===t&&(t=this.objects.push(e instanceof v?e.data:e)-1);const s=t*h.ArrowLaneInterval%h.ArrowNumLanes;return this.isVertical?N.cumWidths[this.id]-.9*h.FrameMarginX+h.FnRadius+s/(h.ArrowNumLanes+1)*h.FrameMarginX*.7:(this.id,_.cumHeights[this.id]-.1*h.FrameMarginY-s/h.ArrowNumLanes*h.FrameMarginY*.35)}},this.id=e,this.isVertical=t}}L.verticalLanes=[],L.horizontalLanes=[],L.arrayLevelLanes=[],L.reset=()=>{L.verticalLanes=[],L.horizontalLanes=[],L.arrayLevelLanes=[]},L.getVerticalLaneBeforeTarget=(e,t)=>{let s=N.lastXCoordBelow(e.x())+(t>e.x()?0:1);const a=N.cumWidths[s];return e.x()>a&&t>a&&s++,void 0===L.verticalLanes[s]&&(L.verticalLanes[s]=new L(s,!0)),L.verticalLanes[s]},L.getVerticalLaneAfterSource=(e,t)=>{let s=N.lastXCoordBelow(t)+(t>e.x()?0:1);const a=N.cumWidths[s];return e.x()>a&&t>a&&s++,void 0===L.verticalLanes[s]&&(L.verticalLanes[s]=new L(s,!0)),L.verticalLanes[s]},L.getHorizontalLaneBeforeTarget=(e,t)=>{const s=_.lastYCoordBelow(e.y())+(t>e.y()?1:0);return void 0===L.horizontalLanes[s]&&(L.horizontalLanes[s]=new L(s,!1)),L.horizontalLanes[s]},L.getHorizontalLaneAfterSource=(e,t)=>{const s=_.lastYCoordBelow(t)+(t>e.y()?0:1);return void 0===L.horizontalLanes[s]&&(L.horizontalLanes[s]=new L(s,!1)),L.horizontalLanes[s]};class D extends j{calculateSteps(){const e=this.source,t=this.target;if(!t)return[];const s=[(t,s)=>[t+e.width(),s+e.height()/2]];if(t instanceof A){s.push(((e,t)=>[e+h.TextMargin+h.TextPaddingX,t])),s.push(((s,a)=>L.getVerticalLaneAfterSource(t,s).getPosition(t)<s?[s,a-Math.sign(e.y()-t.y())*(e.height()+h.TextMargin)]:[s,a])),s.push(((e,s)=>[L.getVerticalLaneAfterSource(t,e).getPosition(t),s]));const a=L.getHorizontalLaneBeforeTarget(t,e.y()).getPosition(t);(a-e.y())*(a-t.y())<0&&s.push(((e,s)=>{const a=L.getHorizontalLaneBeforeTarget(t,s).getPosition(t);return(a-s)*(a-t.y())>0?[e,s]:[e,L.getHorizontalLaneBeforeTarget(t,s).getPosition(t)]})),s.push(((e,s)=>{let a,n=t.y()+h.DataUnitHeight/2-s;if(n=Math.abs(n-Math.sign(n)*h.DataUnitHeight/2),e<t.x())a=Math.max(e+h.DataUnitWidth,t.x()-n);else{if(!(e>=t.x()+t.units.length*h.DataUnitWidth)){const n=Math.floor((e-t.x())/h.DataUnitWidth);return a=t.x()+h.DataUnitWidth*n,[(e+a)/2,(s+t.y())/2]}a=t.x()+t.units.length*h.DataUnitWidth,a=Math.min(e-h.DataUnitWidth,a+n)}return[a,s]})),s.push(((s,a)=>{const n=Math.floor((s-t.x())/h.DataUnitWidth),i=e.y()-(t.y()+h.DataUnitHeight/2),r=t.y()+h.DataUnitHeight/2+(Math.abs(i)<h.DataUnitHeight?0:Math.sign(i))*h.DataUnitHeight/2;return s<t.x()?[t.x(),r]:s>=t.x()+t.units.length*h.DataUnitWidth?[t.x()+t.units.length*h.DataUnitWidth,r]:[t.x()+h.DataUnitWidth*n,r]}))}else t instanceof x||t instanceof C?t.x()<e.x()?(s.push(((e,t)=>[e+h.TextMargin,t])),s.push(((s,a)=>[s,a-Math.sign(e.y()-t.y())*e.height()])),_.lastYCoordBelow(t.y())===_.lastYCoordBelow(e.y())&&N.lastXCoordBelow(e.x())===N.lastXCoordBelow(t.x())+1?(s.push(((e,s)=>[t.centerX+3*h.FnRadius,s])),s.push(((e,s)=>[e,t.y()])),s.push(((e,t)=>[e-h.FnRadius,t]))):(s.push(((e,s)=>[L.getVerticalLaneAfterSource(t,e).getPosition(t),s])),s.push(((e,s)=>[e,L.getHorizontalLaneBeforeTarget(t,s).getPosition(t)])),s.push(((e,s)=>[L.getVerticalLaneBeforeTarget(t,e).getPosition(t),s])),s.push(((e,s)=>[e,t.y()])),s.push(((e,s)=>[t.centerX+2*h.FnRadius,s])))):_.lastYCoordBelow(t.y())===_.lastYCoordBelow(e.y())&&N.lastXCoordBelow(e.x())===N.lastXCoordBelow(t.x())?(s.push(((e,s)=>[t.x(),s])),s.push(((e,s)=>[e,t.y()]))):(s.push(((e,s)=>[L.getVerticalLaneAfterSource(t,e).getPosition(t),s])),s.push(((e,s)=>[e,L.getHorizontalLaneBeforeTarget(t,s).getPosition(t)])),s.push(((e,s)=>[L.getVerticalLaneBeforeTarget(t,e).getPosition(t),s])),s.push(((e,s)=>[e,t.y()])),s.push(((e,s)=>[t.centerX+2*h.FnRadius,s]))):(s.push(((e,s)=>[e,t.y()])),s.push(((e,s)=>[t.x(),s])));return s}}class B extends v{constructor(e){super(),this.referencedBy=e,this.data=Symbol(),this.text=void 0;const t=this.referencedBy[0];if(t instanceof U)this._x=t.x()+ee(t.keyString)+h.TextPaddingX,this._y=t.y(),this.text=new b(h.UnassignedData.toString(),this._x,this._y,{isStringIdentifiable:!1});else{const e=t.width(),s=Math.min(ee(String(this.data)),e);this._x=t.x()+(t.width()-s)/2,this._y=t.y()+(t.height()-h.FontSize)/2,this.text=new b(h.UnassignedData.toString(),this._x,this._y,{maxWidth:e,isStringIdentifiable:!1})}this._width=this.text.width(),this._height=this.text.height()}reset(){super.reset(),this.referencedBy.length=0}updatePosition(){const e=this.referencedBy[0];if(e instanceof U)this._x=e.x()+ee(e.keyString)+h.TextPaddingX,this._y=e.y();else{const t=e.width(),s=Math.min(ee(String(this.data)),t);this._x=e.x()+(e.width()-s)/2,this._y=e.y()+(e.height()-h.FontSize)/2}this.text.updatePosition(this._x,this._y)}onMouseEnter(){}onMouseLeave(){}draw(){return this._isDrawn=!0,Object(g.jsx)(i.a.Fragment,{children:this.text.draw()},Ne.key++)}}class U extends o{constructor(e,t,s,a){let n=arguments.length>4&&void 0!==arguments[4]&&arguments[4];super(),this.keyString=e,this.data=t,this.frame=s,this.prevBinding=a,this.isConstant=n,this.offsetY=void 0,this._hoveredWidth=void 0,this.isMainReference=void 0,this.value=void 0,this.key=void 0,this.isDummyBinding=!1,this.keyYOffset=void 0,this.arrow=void 0,this.getArrow=()=>this.arrow,this.updatePosition=(e,t)=>{this._x=e+h.FramePaddingX,this._y=t+this.offsetY,this.key.updatePosition(this.x(),this.y()+this.keyYOffset),Q(this.value,this)&&this.value.updatePosition()},this.isDummyBinding=Z(this.keyString),this.prevBinding?(this._x=this.prevBinding.x(),this.offsetY=this.prevBinding.offsetY+this.prevBinding.height()+h.TextPaddingY):(this._x=this.frame.x()+h.FramePaddingX,this.offsetY=this.frame.y()+h.FramePaddingY),this._y=this.offsetY,this.keyString+=n?h.ConstantColon:h.VariableColon,this.value=Ne.createValue(t,this),this.isMainReference=Q(this.value,this),this.isMainReference&&this.value.updatePosition(),this.keyYOffset=(this.value instanceof x||this.value instanceof C)&&this.isMainReference?(this.value.height()-h.FontSize)/2:0,this.key=new b(this.keyString,this.x(),this.offsetY+this.keyYOffset,{},s),this._width=this.value instanceof A||!this.isMainReference?this.key.width():this.value.x()+this.value.width()-this.x(),this._hoveredWidth=this._width+(this.value instanceof x||this.value instanceof C?this.value.tooltipWidth:0),this._height=Math.max(this.key.height(),(this.value instanceof x||this.value instanceof C)&&this.isMainReference?this.value.height():0),this.isDummyBinding&&!this.isMainReference&&this.prevBinding&&(this.offsetY=this.prevBinding.offsetY,this._width=this.prevBinding.width(),this._height=this.prevBinding.height()),this._y=this.offsetY}hoveredWidth(){return Me.getPrintableMode()?this._hoveredWidth:this._width+(this.value instanceof x||this.value instanceof C?this.value.tooltipWidth:0)}exportWidth(){return this._width+(this.value instanceof x||this.value instanceof C?this.value.exportTooltipWidth:0)}draw(){return this.isDummyBinding||this.value instanceof T||this.value instanceof B||this.value instanceof A||(this.arrow=new D(this.key).to(this.value)),Object(g.jsxs)(i.a.Fragment,{children:[this.isDummyBinding?null:this.key.draw(),this.arrow&&this.arrow.draw(),this.value instanceof A||!this.isMainReference?null:this.value.draw()]},Ne.key++)}}function G(e){return"head"in e&&"tail"in e&&"name"in e}function F(e){return"parent"in e&&"children"in e}function H(e){return"root"in e}function V(e){return null===e||(t=e.head,0===Object.keys(t).length);var t}function W(e){return Array.isArray(e)}function X(e){return e&&"[object Function]"==={}.toString.call(e)}function $(e){return X(e)&&"environment"in e&&"functionName"in e}function q(e){return X(e)&&!$(e)}function z(e){return null===e}function Y(e){return"symbol"===typeof e}function K(e){return function(e){return void 0===e}(e)||z(e)||function(e){return"string"===typeof e}(e)||function(e){return"number"===typeof e}(e)||function(e){return"boolean"===typeof e}(e)}function Q(e,t){return e instanceof x?t instanceof U&&e.enclosingEnvNode===t.frame.envTreeNode&&-1!==e.referencedBy.findIndex((e=>e instanceof U&&e===t)):e instanceof C?e.referencedBy.find((e=>e instanceof U))===t:e.referencedBy[0]===t}function J(e,t){return e.referencedBy[0]===t}function Z(e){return/^-?\d+$/.test(e)}function ee(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:`${h.FontStyle} ${h.FontSize}px ${h.FontFamily}`;const s=document.createElement("canvas"),a=s.getContext("2d");if(!a||!e)return 0;a.font=t;const n=e.split("\n").reduce(((e,t)=>a.measureText(e).width>a.measureText(t).width?e:t),""),i=a.measureText(n);return i.width}function te(e){if($(e))return e.node.params.map((e=>e.name)).join(",");{const t=e.toString();return t.substring(t.indexOf("("),t.indexOf("{")).trim()}}function se(e){const t=e.toString();if($(e)){let s="FunctionDeclaration"===e.node.type||"function"===t.substring(0,8)?t.substring(t.indexOf("{")):t.substring(t.indexOf("=")+3);return"{"!==s[0]&&(s="{\n  return "+s+";\n}"),s}return t.substring(t.indexOf("{"))}function ae(e){var t;const s=null===(t=e.getStage())||void 0===t?void 0:t.container();s&&(s.style.cursor="pointer")}function ne(e){var t;const s=null===(t=e.getStage())||void 0===t?void 0:t.container();s&&(s.style.cursor="default")}function ie(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};const s=e instanceof d.a?Array.from(e.children||[]):[];s.push(e),s.forEach((e=>{e.setAttrs({stroke:e.attrs.stroke?h.HoveredColor.toString():e.attrs.stroke,fill:e.attrs.fill?h.HoveredColor.toString():e.attrs.fill,...t})}))}function re(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};const s=e instanceof d.a?Array.from(e.children||[]):[];s.push(e),s.forEach((e=>{e.setAttrs({stroke:e.attrs.stroke?Me.getPrintableMode()?h.SA_BLUE.toString():h.SA_WHITE.toString():e.attrs.stroke,fill:e.attrs.fill?Me.getPrintableMode()?h.SA_BLUE.toString():h.SA_WHITE.toString():e.attrs.fill,...t})}))}function oe(e){return null===e?null:V(e)?oe(e.tail):e}function ce(e,t){X(e)||K(e)||(H(e)&&H(t)?ce(e.root,t.root):F(e)&&F(t)?(ce(e.children,t.children),ce(e.environment,t.environment)):W(e)&&W(t)?e.forEach(((e,s)=>ce(e,t[s]))):G(e)&&G(t)&&(Object.defineProperties(t.head,Object.getOwnPropertyDescriptors(e.head)),ce(e.tail,t.tail)))}function le(e){const t=Object(u.cloneDeep)(e);return ce(e,t),t}function de(e){if(V(e.environment)){const t=[];return e.children.forEach((e=>{t.push(...de(e))})),t}return[e]}class ue extends o{constructor(e){super(),this._path="",this.points=[],this.source=void 0,this.target=void 0,this.onMouseEnter=e=>{let{currentTarget:t}=e;ie(t,{strokeWidth:Number(c.ArrowHoveredStrokeWidth)})},this.onMouseLeave=e=>{let{currentTarget:t}=e;re(t,{strokeWidth:Number(c.ArrowStrokeWidth)})},this.source=e,this.target=void 0,this._x=e.x(),this._y=e.y()}path(){return this._path}to(e){return this.target=e,this._width=Math.abs(e.x()-this.source.x()),this._height=Math.abs(e.y()-this.source.y()),this}calculateSteps(){const e=this.target;return e?[()=>[e.x(),e.y()]]:[]}onClick(){}draw(){const e=this.calculateSteps().reduce(((e,t)=>[...e,...t(e[e.length-2],e[e.length-1])]),[this.source.x(),this.source.y()]);if(e.splice(0,2),this._path+=`M ${e[0]} ${e[1]} `,4===e.length)this._path+=`L ${e[2]} ${e[3]} `;else{let t=0;for(;t<e.length-4;){const[s,a,n,i,r,o]=e.slice(t,t+6),l=n-s,d=r-n,u=i-a,h=o-i,p=Math.min(c.ArrowCornerRadius,Math.max(Math.abs(l),Math.abs(u))/2,Math.max(Math.abs(d),Math.abs(h))/2),g=n-p*Math.sign(l),m=i-p*Math.sign(u),b=n+p*Math.sign(d),j=i+p*Math.sign(h);this._path+=`L ${g} ${m} Q ${n} ${i} ${b} ${j}`,t+=2}}return this._path+=`L ${e[e.length-2]} ${e[e.length-1]} `,Object(g.jsxs)(r.c,{onMouseEnter:this.onMouseEnter,onMouseLeave:this.onMouseLeave,children:[Object(n.createElement)(r.g,{...l,stroke:Me.getPrintableMode()?c.SA_BLUE.toString():c.SA_WHITE.toString(),strokeWidth:Number(c.ArrowStrokeWidth),hitStrokeWidth:Number(c.ArrowHitStrokeWidth),data:this.path(),key:Ne.key++}),Object(n.createElement)(r.a,{...l,points:e.slice(e.length-4),fill:Me.getPrintableMode()?c.SA_BLUE.toString():c.SA_WHITE.toString(),strokeEnabled:!1,pointerWidth:Number(c.ArrowHeadSize),key:Ne.key++})]},Ne.key++)}}class he extends ue{calculateSteps(){const e=this.target;if(!e)return[];const t=[(e,t)=>[e+c.FramePaddingX,t]];return e instanceof Ae&&(t.push(((e,t)=>[e,t-c.FrameMarginY])),t.push(((t,s)=>[e.x()+c.FramePaddingX,s]))),t.push(((t,s)=>[e.x()+c.FramePaddingX,e.y()+e.height()])),t}}class pe extends o{constructor(e){super(),this.parent=e,this.value=null,this.data=[],this.updatePosition=()=>{this._x=this.parent.x(),this._y=this.parent.y()},this._x=this.parent.x(),this._y=this.parent.y(),this._height=this.parent.height(),this._width=this.parent.width()}x(){return this._x}y(){return this._y}height(){return this._height}width(){return this._width}reset(){}draw(){return Object(n.createElement)(r.h,{...l,key:Ne.key++,x:this.x(),y:this.y(),width:this.width(),height:this.height(),stroke:Me.getPrintableMode()?c.SA_BLUE.toString():c.SA_WHITE.toString(),ref:this.ref})}}class ge extends ue{calculateSteps(){const e=this.source,t=this.target;if(!t)return[];const s=[(e,t)=>[e+3*c.FnRadius,t]];return t.y()<e.y()&&e.y()<t.y()+t.height()?(s.push(((e,t)=>[e,t-2*c.FnRadius])),s.push(((s,a)=>[t.x()+(e.x()<t.x()?0:t.width()),a]))):s.push((()=>[t.x()+t.width()/2,t.y()+(t.y()<e.y()?t.height():0)])),s}}class me extends o{constructor(){super(...arguments),this.referencedBy=[],this.data=void 0}addReference(e){this.referencedBy.push(e)}}class be extends me{constructor(e,t){super(),this.data=e,this.referencedBy=t,this.radius=c.FnRadius,this.innerRadius=c.FnInnerRadius,this.tooltipWidth=void 0,this.centerX=void 0,this.fnName=void 0,this.paramsText=void 0,this.bodyText=void 0,this.exportBodyText=void 0,this.tooltip=void 0,this.exportTooltip=void 0,this.exportTooltipWidth=void 0,this._arrow=void 0,this.enclosingEnvNode=void 0,this.labelRef=i.a.createRef(),this.onMouseEnter=e=>{let{currentTarget:t}=e;Me.getPrintableMode()||(this.ref.current.moveToTop(),this.labelRef.current.show(),ie(t))},this.onMouseLeave=e=>{let{currentTarget:t}=e;Me.getPrintableMode()||(this.labelRef.current.hide(),re(t))},Ne.memoizeCompactValue(this);const s=this.referencedBy[0];s instanceof Te?(this._x=s.frame.x()+s.frame.width()+c.FrameMarginX/4,this._y=s.y(),this.centerX=this._x+2*this.radius):(s.isLastUnit?(this._x=s.x()+2*c.DataUnitWidth,this._y=s.y()+c.DataUnitHeight/2-this.radius):(this._x=s.x(),this._y=s.y()+s.parent.height()+c.DataUnitHeight),this.centerX=this._x+c.DataUnitWidth/2,this._x=this.centerX-2*this.radius),this._y+=this.radius,this._width=4*this.radius,this._height=2*this.radius,this.enclosingEnvNode=Ne.environmentTree.getTreeNode(oe(this.data.environment)),this.fnName=this.data.functionName,this.paramsText=`params: (${te(this.data)})`,this.bodyText=`body: ${se(this.data)}`,this.exportBodyText=(this.bodyText.length>23?this.bodyText.slice(0,20):this.bodyText).split("\n").slice(0,2).join("\n")+" ...",this.tooltip=`${this.paramsText}\n${this.bodyText}`,this.exportTooltip=`${this.paramsText}\n${this.exportBodyText}`,this.tooltipWidth=Math.max(ee(this.paramsText),ee(this.bodyText)),this.exportTooltipWidth=Math.max(ee(this.paramsText),ee(this.exportBodyText))}updatePosition(){}draw(){var e;return this._arrow=this.enclosingEnvNode.compactFrame&&new ge(this).to(this.enclosingEnvNode.compactFrame),Object(g.jsxs)(i.a.Fragment,{children:[Object(g.jsxs)(r.c,{onMouseEnter:e=>this.onMouseEnter(e),onMouseLeave:e=>this.onMouseLeave(e),ref:this.ref,children:[Object(n.createElement)(r.b,{...l,key:Ne.key++,x:this.centerX-this.radius,y:this.y(),radius:this.radius,stroke:Me.getPrintableMode()?c.SA_BLUE.toString():c.SA_WHITE.toString()}),Object(n.createElement)(r.b,{...l,key:Ne.key++,x:this.centerX-this.radius,y:this.y(),radius:this.innerRadius,fill:Me.getPrintableMode()?c.SA_BLUE.toString():c.SA_WHITE.toString()}),Object(n.createElement)(r.b,{...l,key:Ne.key++,x:this.centerX+this.radius,y:this.y(),radius:this.radius,stroke:Me.getPrintableMode()?c.SA_BLUE.toString():c.SA_WHITE.toString()}),Object(n.createElement)(r.b,{...l,key:Ne.key++,x:this.centerX+this.radius,y:this.y(),radius:this.innerRadius,fill:Me.getPrintableMode()?c.SA_BLUE.toString():c.SA_WHITE.toString()})]}),Me.getPrintableMode()?Object(g.jsxs)(r.d,{x:this.x()+this.width()+2*c.TextPaddingX,y:this.y()-c.TextPaddingY,visible:!0,ref:this.labelRef,children:[Object(g.jsx)(r.k,{stroke:"black",fill:"white",opacity:Number(c.FnTooltipOpacity)}),Object(g.jsx)(r.l,{text:this.exportTooltip,fontFamily:c.FontFamily.toString(),fontSize:Number(c.FontSize),fontStyle:c.FontStyle.toString(),fill:c.SA_BLUE.toString(),padding:5})]}):Object(g.jsxs)(r.d,{x:this.x()+this.width()+2*c.TextPaddingX,y:this.y()-c.TextPaddingY,visible:!1,ref:this.labelRef,children:[Object(g.jsx)(r.k,{stroke:"black",fill:"black",opacity:Number(c.FnTooltipOpacity)}),Object(g.jsx)(r.l,{text:this.tooltip,fontFamily:c.FontFamily.toString(),fontSize:Number(c.FontSize),fontStyle:c.FontStyle.toString(),fill:c.SA_WHITE.toString(),padding:5})]}),null===(e=this._arrow)||void 0===e?void 0:e.draw()]},Ne.key++)}}class je extends me{constructor(e,t){super(),this.data=e,this.referencedBy=t,this.centerX=void 0,this.tooltipWidth=void 0,this.exportTooltipWidth=void 0,this.radius=c.FnRadius,this.innerRadius=c.FnInnerRadius,this._arrow=void 0,this.paramsText=void 0,this.bodyText=void 0,this.exportBodyText=void 0,this.tooltip=void 0,this.exportTooltip=void 0,this.selected=!1,this.labelRef=i.a.createRef(),this.onMouseEnter=e=>{let{currentTarget:t}=e;Me.getPrintableMode()||(this.labelRef.current.show(),ie(t))},this.onMouseLeave=e=>{let{currentTarget:t}=e;if(!Me.getPrintableMode())if(this.selected){var s;const e=null===(s=t.getStage())||void 0===s?void 0:s.container();e&&(e.style.cursor="default")}else this.labelRef.current.hide(),re(t)},this.onClick=e=>{let{currentTarget:t}=e;Me.getPrintableMode()||(this.selected=!this.selected,this.selected?(this.labelRef.current.show(),ie(t)):(this.labelRef.current.hide(),re(t)))},Ne.memoizeCompactValue(this);const s=this.referencedBy[0];s instanceof Te?(this._x=s.frame.x()+s.frame.width()+c.FrameMarginX/4,this._y=s.y(),this.centerX=this._x+2*this.radius):(s.isLastUnit?(this._x=s.x()+2*c.DataUnitWidth,this._y=s.y()+c.DataUnitHeight/2-this.radius):(this._x=s.x(),this._y=s.y()+s.parent.height()+c.DataUnitHeight),this.centerX=this._x+c.DataUnitWidth/2,this._x=this.centerX-2*this.radius),this._y+=this.radius,this._width=4*this.radius,this._height=2*this.radius,this.paramsText=`params: ${te(this.data)}`,this.bodyText=`body: ${se(this.data)}`,this.exportBodyText=(this.bodyText.length>23?this.bodyText.slice(0,20):this.bodyText).split("\n").slice(0,2).join("\n")+" ...",this.tooltip=`${this.paramsText}\n${this.bodyText}`,this.exportTooltip=`${this.paramsText}\n${this.exportBodyText}`,this.tooltipWidth=Math.max(ee(this.paramsText),ee(this.bodyText))+c.TextPaddingX,this.exportTooltipWidth=Math.max(ee(this.paramsText),ee(this.exportBodyText))}isSelected(){return this.selected}arrow(){return this._arrow}updatePosition(){const e=this.referencedBy.find((e=>e instanceof Te))||this.referencedBy[0];e instanceof Te?(this._x=e.frame.x()+e.frame.width()+c.FrameMarginX/4,this._y=e.y(),this.centerX=this._x+2*this.radius):(e.isLastUnit?(this._x=e.x()+2*c.DataUnitWidth,this._y=e.y()+c.DataUnitHeight/2-this.radius):(this._x=e.x(),this._y=e.y()+e.parent.height()+c.DataUnitHeight),this.centerX=this._x+c.DataUnitWidth/2,this._x=this.centerX-2*this.radius),this._y+=this.radius}draw(){return this._isDrawn=!0,this._arrow=Ne.globalEnvNode.compactFrame&&new ge(this).to(Ne.globalEnvNode.compactFrame),Object(g.jsxs)(i.a.Fragment,{children:[Object(g.jsxs)(r.c,{onMouseEnter:e=>this.onMouseEnter(e),onMouseLeave:e=>this.onMouseLeave(e),onClick:e=>this.onClick(e),ref:this.ref,children:[Object(n.createElement)(r.b,{...l,key:Ne.key++,x:this.centerX-this.radius,y:this.y(),radius:this.radius,stroke:Me.getPrintableMode()?c.SA_BLUE.toString():c.SA_WHITE.toString()}),Object(n.createElement)(r.b,{...l,key:Ne.key++,x:this.centerX-this.radius,y:this.y(),radius:this.innerRadius,fill:Me.getPrintableMode()?c.SA_BLUE.toString():c.SA_WHITE.toString()}),Object(n.createElement)(r.b,{...l,key:Ne.key++,x:this.centerX+this.radius,y:this.y(),radius:this.radius,stroke:Me.getPrintableMode()?c.SA_BLUE.toString():c.SA_WHITE.toString()}),Object(n.createElement)(r.b,{...l,key:Ne.key++,x:this.centerX+this.radius,y:this.y(),radius:this.innerRadius,fill:Me.getPrintableMode()?c.SA_BLUE.toString():c.SA_WHITE.toString()})]}),Me.getPrintableMode()?Object(g.jsxs)(r.d,{x:this.x()+this.width()+2*c.TextPaddingX,y:this.y()-c.TextPaddingY,visible:!0,ref:this.labelRef,children:[Object(g.jsx)(r.k,{stroke:"black",fill:"white",opacity:Number(c.FnTooltipOpacity)}),Object(g.jsx)(r.l,{text:this.exportTooltip,fontFamily:c.FontFamily.toString(),fontSize:Number(c.FontSize),fontStyle:c.FontStyle.toString(),fill:c.SA_BLUE.toString(),padding:5})]}):Object(g.jsxs)(r.d,{x:this.x()+this.width()+2*c.TextPaddingX,y:this.y()-c.TextPaddingY,visible:!1,ref:this.labelRef,children:[Object(g.jsx)(r.k,{stroke:"black",fill:"black",opacity:Number(c.FnTooltipOpacity)}),Object(g.jsx)(r.l,{text:this.tooltip,fontFamily:c.FontFamily.toString(),fontSize:Number(c.FontSize),fontStyle:c.FontStyle.toString(),fill:c.SA_WHITE.toString(),padding:5})]}),Ne.globalEnvNode.compactFrame&&new ge(this).to(Ne.globalEnvNode.compactFrame).draw()]},Ne.key++)}}class ye extends ue{calculateSteps(){const e=this.source,t=this.target;if(!t)return[];const s=[(e,t)=>[e+c.DataUnitWidth/2,t+c.DataUnitHeight/2]];return t instanceof be||t instanceof je?s.push((()=>[e.x()<t.x()?t.x():t.centerX,t.y()])):t instanceof Se&&(e.y()===t.y()?Math.abs(e.x()-t.x())>2*c.DataUnitWidth?(s.push(((e,t)=>[e,t-c.DataUnitHeight])),s.push((()=>[t.x()+c.DataUnitWidth/2,t.y()-c.DataUnitHeight/2])),s.push(((e,t)=>[e,t+c.DataUnitHeight/2]))):s.push((()=>[t.x(),t.y()+c.DataUnitHeight/2])):s.push((()=>[t.x()+c.DataUnitWidth/2,t.y()+(e.y()>t.y()?c.DataUnitHeight:0)]))),s}}class Oe extends o{constructor(e){super(),this.arrayUnit=void 0,this.referencedBy=void 0,this.updatePosition=()=>{},this.referencedBy=e,this.arrayUnit=e[0],this._x=this.arrayUnit.x(),this._y=this.arrayUnit.y(),this._height=this.arrayUnit.height(),this._width=this.arrayUnit.width()}draw(){return Object(n.createElement)(r.f,{...l,key:Ne.key++,points:[this.x(),this.y()+this.height(),this.x()+this.width(),this.y()],stroke:Me.getPrintableMode()?c.SA_BLUE.toString():c.SA_WHITE.toString(),hitStrokeWidth:Number(c.DataHitStrokeWidth),ref:this.ref,listening:!1})}}const fe={maxWidth:Number.MAX_VALUE,fontFamily:c.FontFamily.toString(),fontSize:Number(c.FontSize),fontStyle:c.FontStyle.toString(),fontVariant:c.FontVariant.toString(),isStringIdentifiable:!1};class ve extends o{constructor(e,t,s){let a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};super(),this.data=e,this._x=t,this._y=s,this._height=void 0,this._width=void 0,this.partialStr=void 0,this.fullStr=void 0,this.options=fe,this.onMouseEnter=e=>{var t,s;let{currentTarget:a}=e;const n=null===(t=a.getStage())||void 0===t?void 0:t.container();n&&(n.style.cursor="pointer"),this.ref.current.moveToTop(),this.ref.current.show(),null===(s=a.getLayer())||void 0===s||s.draw()},this.onMouseLeave=e=>{var t,s;let{currentTarget:a}=e;const n=null===(t=a.getStage())||void 0===t?void 0:t.container();n&&(n.style.cursor="default"),this.ref.current.hide(),null===(s=a.getLayer())||void 0===s||s.draw()},this.options={...this.options,...a};const{fontSize:n,fontStyle:i,fontFamily:r,maxWidth:o,isStringIdentifiable:l}=this.options;this.fullStr=this.partialStr=l&&JSON.stringify(e)||String(e),this._height=n;const d=e=>ee(e,`${i} ${n}px ${r}`);if(d(this.partialStr)>o){let e=c.Ellipsis.toString(),t=0;for(;d(this.partialStr.substring(0,t)+c.Ellipsis.toString())<o;)e=this.partialStr.substring(0,t++)+c.Ellipsis.toString();this._width=d(e),this.partialStr=e}else this._width=Math.max(c.TextMinWidth,d(this.partialStr))}draw(){const e={fontFamily:this.options.fontFamily,fontSize:this.options.fontSize,fontStyle:this.options.fontStyle,fill:c.SA_WHITE.toString()};return Object(g.jsxs)(i.a.Fragment,{children:[Object(g.jsx)(r.d,{x:this.x(),y:this.y(),onMouseEnter:this.onMouseEnter,onMouseLeave:this.onMouseLeave,children:Object(n.createElement)(r.l,{...l,key:Ne.key++,text:this.partialStr,...e})}),Object(g.jsxs)(r.d,{x:this.x(),y:this.y(),ref:this.ref,visible:!1,onMouseEnter:this.onMouseEnter,onMouseLeave:this.onMouseLeave,children:[Object(g.jsx)(r.k,{...l,fill:"black",opacity:.5}),Object(n.createElement)(r.l,{...l,key:Ne.key++,text:this.fullStr,...e})]})]},Ne.key++)}}class xe extends me{constructor(e,t){super(),this.data=e,this.referencedBy=t,this.text=void 0;const s=this.referencedBy[0];if(s instanceof Te)this._x=s.x()+ee(s.keyString)+c.TextPaddingX,this._y=s.y(),this.text=new ve(this.data,this.x(),this.y(),{isStringIdentifiable:!0});else{const e=s.width(),t=Math.min(ee(String(this.data)),e);this._x=s.x()+(s.width()-t)/2,this._y=s.y()+(s.height()-c.FontSize)/2,this.text=z(this.data)?new Oe([s]):new ve(this.data,this.x(),this.y(),{maxWidth:e,isStringIdentifiable:!0})}this._width=this.text.width(),this._height=this.text.height()}updatePosition(){}draw(){return Object(g.jsx)(i.a.Fragment,{children:this.text.draw()},Ne.key++)}}class Ce extends o{constructor(e,t,s){super(),this.idx=e,this.data=t,this.value=void 0,this.isFirstUnit=void 0,this.isLastUnit=void 0,this.isMainReference=void 0,this.parent=void 0,this.arrow=void 0,this.updatePosition=()=>{},this.onMouseEnter=e=>{let{currentTarget:t}=e;ie(t)},this.onMouseLeave=e=>{let{currentTarget:t}=e;re(t)},this.parent=s,this._x=this.parent.x()+this.idx*c.DataUnitWidth,this._y=this.parent.y(),this._height=c.DataUnitHeight,this._width=c.DataUnitWidth,this.isFirstUnit=0===this.idx,this.isLastUnit=this.idx===this.parent.data.length-1,this.value=Ne.createCompactValue(this.data,this),this.isMainReference=this.value.referencedBy.length>1}draw(){if(this.isDrawn())return null;this._isDrawn=!0;const e={upperLeft:0,lowerLeft:0,upperRight:0,lowerRight:0};return this.isFirstUnit&&(e.upperLeft=e.lowerLeft=Number(c.DataCornerRadius)),this.isLastUnit&&(e.upperRight=e.lowerRight=Number(c.DataCornerRadius)),Object(g.jsxs)(i.a.Fragment,{children:[Object(g.jsx)(w,{x:this.x(),y:this.y(),width:this.width(),height:this.height(),stroke:Me.getPrintableMode()?c.SA_BLUE.toString():c.SA_WHITE.toString(),hitStrokeWidth:Number(c.DataHitStrokeWidth),fillEnabled:!1,onMouseEnter:this.onMouseEnter,onMouseLeave:this.onMouseLeave,cornerRadius:e,forwardRef:this.ref},Ne.key++),this.value.draw(),this.value instanceof xe||new ye(this).to(this.value).draw()]},Ne.key++)}}class Se extends me{constructor(e,t){super(),this.data=e,this.referencedBy=t,this.units=[],Ne.memoizeCompactValue(this);const s=this.referencedBy[0];s instanceof Te?(this._x=s.frame.x()+s.frame.width()+c.FrameMarginX,this._y=s.y()):s.isLastUnit?(this._x=s.x()+2*c.DataUnitWidth,this._y=s.y()):(this._x=s.x(),this._y=s.y()+s.parent.height()+c.DataUnitHeight),this._width=this.data.length*c.DataUnitWidth+c.DataMinWidth,this._height=c.DataUnitHeight;for(let a=this.data.length-1;a>=0;a--){const e=new Ce(a,this.data[a],this);this._width=Math.max(this.width(),e.value.width()+(e.value instanceof xe||a!==this.data.length-1?a*c.DataUnitWidth:(a+1)*c.DataUnitWidth+c.DataUnitWidth)),this._height=Math.max(this._height,e.value instanceof xe||e.isMainReference?c.DataUnitHeight:e.value.y()+e.value.height()-e.y()),this.units=[e,...this.units]}}reset(){super.reset(),this.units.map((e=>e.reset())),this.referencedBy.length=0}updatePosition(){}draw(){return this.isDrawn()?null:(this._isDrawn=!0,Object(g.jsx)(i.a.Fragment,{children:this.units.length>0?this.units.map((e=>e.draw())):new pe(this).draw()},Ne.key++))}}class we extends ue{calculateSteps(){const e=this.source,t=this.target;if(!t)return[];const s=[(t,s)=>[t+e.width(),s+e.height()/2]];return t.x()<e.x()?t instanceof Se?(s.push(((e,t)=>[e+c.TextMargin,t])),s.push(((e,s)=>[e,t.y()-c.DataUnitHeight/3])),s.push(((e,s)=>[t.x()+c.DataUnitWidth/2,s])),s.push(((e,s)=>[e,t.y()]))):(s.push(((e,t)=>[e+c.TextMargin,t])),s.push(((t,s)=>[t,s-e.height()/2-c.TextMargin])),s.push(((e,s)=>[t.x()+t.width()+c.ArrowHeadSize,s])),s.push(((e,s)=>[e,t.y()])),s.push(((e,t)=>[e-c.ArrowHeadSize,t]))):s.push(((e,s)=>[t.x(),t.y()+(t instanceof Se?c.DataUnitHeight/2:0)])),s}}class Ee extends me{constructor(e){super(),this.referencedBy=e,this.data=Symbol(),this.text=void 0;const t=this.referencedBy[0];if(t instanceof Te)this._x=t.x()+ee(t.keyString)+c.TextPaddingX,this._y=t.y(),this.text=new ve(c.UnassignedData.toString(),this._x,this._y,{isStringIdentifiable:!1});else{const e=t.width(),s=Math.min(ee(String(this.data)),e);this._x=t.x()+(t.width()-s)/2,this._y=t.y()+(t.height()-c.FontSize)/2,this.text=new ve(c.UnassignedData.toString(),this._x,this._y,{maxWidth:e,isStringIdentifiable:!1})}this._width=this.text.width(),this._height=this.text.height()}reset(){super.reset(),this.referencedBy.length=0}updatePosition(){}draw(){return this._isDrawn=!0,Object(g.jsx)(i.a.Fragment,{children:this.text.draw()},Ne.key++)}}class Te extends o{constructor(e,t,s,a){let n=arguments.length>4&&void 0!==arguments[4]&&arguments[4];super(),this.keyString=e,this.data=t,this.frame=s,this.prevBinding=a,this.isConstant=n,this.value=void 0,this.key=void 0,this.isDummyBinding=!1,this.arrow=void 0,this.getArrow=()=>this.arrow,this.isDummyBinding=Z(this.keyString),this.prevBinding?(this._x=this.prevBinding.x(),this._y=this.prevBinding.y()+this.prevBinding.height()+c.TextPaddingY):(this._x=this.frame.x()+c.FramePaddingX,this._y=this.frame.y()+c.FramePaddingY),this.keyString+=n?c.ConstantColon:c.VariableColon,this.value=Ne.createCompactValue(t,this);const i=this.value instanceof Se?(c.DataUnitHeight-c.FontSize)/2:(this.value.height()-c.FontSize)/2;this.key=new ve(this.keyString,this.x(),this.y()+i),this._width=J(this.value,this)?this.value.x()+this.value.width()-this.x()+(this.value instanceof be||this.value instanceof je?this.value.tooltipWidth:0):this.key.width(),this._height=Math.max(this.key.height(),this.value.height()),this.isDummyBinding&&!J(this.value,this)&&this.prevBinding&&(this._y=this.prevBinding.y(),this._width=this.prevBinding.width(),this._height=this.prevBinding.height())}draw(){return Object(g.jsxs)(i.a.Fragment,{children:[this.isDummyBinding?null:this.key.draw(),this.isDummyBinding||this.value instanceof xe||this.value instanceof Ee?null:new we(this.key).to(this.value).draw(),J(this.value,this)?this.value.draw():null]},Ne.key++)}}const ke=new Map([["global","Global"],["programEnvironment","Program"],["forLoopEnvironment","Body of for-loop"],["forBlockEnvironment","Control variable of for-loop"],["blockEnvironment","Block"],["functionBodyEnvironment","Function Body"]]);class Ae extends o{constructor(e,t){var s;super(),this.envTreeNode=e,this.leftSiblingFrame=t,this.totalHeight=void 0,this.totalWidth=void 0,this.bindings=[],this.name=void 0,this.level=void 0,this.environment=void 0,this.parentFrame=void 0,this.onMouseEnter=e=>{let{currentTarget:t}=e;ie(t)},this.onMouseLeave=e=>{let{currentTarget:t}=e;re(t)},this._width=c.FrameMinWidth,this.level=e.compactLevel,this.environment=e.environment,this.parentFrame=null===(s=e.parent)||void 0===s?void 0:s.compactFrame,this._x=this.level.x(),this.leftSiblingFrame&&(this._x+=this.leftSiblingFrame.x()+this.leftSiblingFrame.totalWidth+c.FrameMarginX),this.name=new ve(ke.get(this.environment.name)||this.environment.name,this.x(),this.level.y(),{maxWidth:this.width()}),this._y=this.level.y()+this.name.height()+c.TextPaddingY/2;let a=0;for(const[d,u]of Object.entries(this.environment.head)){const e=Math.max(c.TextMinWidth,ee(d+c.ConstantColon))+c.TextPaddingX+(Y(u)?Math.max(c.TextMinWidth,ee(c.UnassignedData.toString())):K(u)?Math.max(c.TextMinWidth,ee(String(u))):0);a=Math.max(a,e)}this._width=a+2*c.FramePaddingX;let n=null,i=this._width;const r=Object.getOwnPropertyDescriptors(this.environment.head),o=[],l=[];for(const d of Object.entries(r))if(Z(d[0])){const e=oe(d[1].value.environment);(this.environment.id===c.GlobalEnvId||e&&e.id===this.environment.id)&&l.push(d)}else o.push(d);o.push(...l);for(const[d,u]of o){const e=new Te(d,u.value,this,n,!u.writable);this.bindings.push(e),n=e,i=Math.max(i,e.width()+c.FramePaddingX)}this.totalWidth=i,this._height=n?n.y()+n.height()+c.FramePaddingY-this.y():2*c.FramePaddingY,this.totalHeight=this.height()+this.name.height()+c.TextPaddingY/2}draw(){return Object(g.jsxs)(r.c,{children:[this.name.draw(),Object(n.createElement)(r.h,{...l,x:this.x(),y:this.y(),width:this.width(),height:this.height(),stroke:Me.getPrintableMode()?c.SA_BLUE.toString():c.SA_WHITE.toString(),cornerRadius:Number(c.FrameCornerRadius),onMouseEnter:this.onMouseEnter,onMouseLeave:this.onMouseLeave,key:Ne.key++}),this.bindings.map((e=>e.draw())),this.parentFrame&&new he(this).to(this.parentFrame).draw()]},Ne.key++)}}class Ie extends o{constructor(e,t){super(),this.parentLevel=e,this.envTreeNodes=t,this.frames=[],this._x=c.CanvasPaddingX,this._y=c.CanvasPaddingY,this.parentLevel&&(this._y+=this.parentLevel.height()+this.parentLevel.y());let s=null;t.forEach((e=>{e.compactLevel=this;const t=new Ae(e,s);e.compactFrame=t,this.frames.push(t),s=t})),this._height=this.frames.reduce(((e,t)=>Math.max(e,t.totalHeight)),0);const a=this.frames[this.frames.length-1];this._width=a.x()+a.totalWidth-this.x()+c.LevelPaddingX}destroy(){this.ref.current.destroyChildren()}draw(){return Object(g.jsxs)(r.c,{ref:this.ref,children:[Object(n.createElement)(r.h,{...l,x:this.x(),y:this.y(),width:this.width(),height:this.height(),key:Ne.key++,listening:!1}),this.frames.map((e=>e.draw()))]},Ne.key++)}}class Ne{static updateDimensions(e,t){Ne.visibleWidth=e,Ne.visibleHeight=t,null!==Ne.stageRef.current&&(Math.min(Ne.width(),window.innerWidth)>Ne.stageWidth||Math.min(Ne.height(),window.innerHeight)>Ne.stageHeight)&&(Ne.currentLight=void 0,Ne.currentDark=void 0,Ne.currentCompactLight=void 0,Ne.currentCompactDark=void 0,Ne.stageWidth=Math.min(Ne.width(),window.innerWidth),Ne.stageHeight=Math.min(Ne.height(),window.innerHeight),Ne.stageRef.current.width(Ne.stageWidth),Ne.stageRef.current.height(Ne.stageHeight),Me.redraw()),Ne.stageHeight,Ne.visibleHeight,Ne.invisiblePaddingVertical=Ne.stageHeight>Ne.visibleHeight?(Ne.stageHeight-Ne.visibleHeight)/2:0,Ne.invisiblePaddingHorizontal=Ne.stageWidth>Ne.visibleWidth?(Ne.stageWidth-Ne.visibleWidth)/2:0;const s=this.scrollContainerRef.current;s&&(s.style.width=`${Ne.visibleWidth}px`,s.style.height=`${Ne.visibleHeight}px`)}static setContext(e){if(Ne.currentLight=void 0,Ne.currentDark=void 0,Ne.currentCompactLight=void 0,Ne.currentCompactDark=void 0,Ne.values.forEach(((e,t)=>{e.reset()})),Ne.values.clear(),Ne.compactValues.forEach(((e,t)=>{e.reset()})),Ne.compactValues.clear(),Ne.key=0,Ne.environmentTree=le(e),Ne.globalEnvNode=Ne.environmentTree.root,Ne.removeProgramEnv(),Ne.removeUnreferencedGlobalFns(),Ne.initializeGrid(),Me.getCompactLayout()){const e=Ne.compactLevels[Ne.compactLevels.length-1];Ne.compactHeight=Math.max(h.CanvasMinHeight,e.y()+e.height()+h.CanvasPaddingY),Ne.compactWidth=Math.max(h.CanvasMinWidth,Ne.compactLevels.reduce(((e,t)=>Math.max(e,t.width())),0)+2*h.CanvasPaddingX)}else Ne.nonCompactHeight=Math.max(h.CanvasMinHeight,this.grid.height()+h.CanvasPaddingY),Ne.nonCompactWidth=Math.max(h.CanvasMinWidth,this.grid.width()+2*h.CanvasPaddingX)}static removeProgramEnv(){if(!Ne.globalEnvNode.children)return;const e=Ne.globalEnvNode.children[0],t=Ne.globalEnvNode;t.environment.head={...e.environment.head,...t.environment.head},e.children&&t.resetChildren(e.children);for(const s of Object.values(t.environment.head))$(s)&&delete s.functionName}static removeUnreferencedGlobalFns(){const e=new Set,t=new Set,s=t=>{for(const s of Object.values(t.environment.head))q(s)?e.add(s):W(s)&&a(s);t.children&&t.children.forEach(s)},a=s=>{s.forEach((s=>{q(s)?e.add(s):W(s)&&!t.has(s)&&(t.add(s),a(s))}))};Ne.globalEnvNode.children&&Ne.globalEnvNode.children.forEach(s);const n={};for(const[i,r]of Object.entries(Ne.globalEnvNode.environment.head))(e.has(r)||Z(i))&&(n[i]=r);Ne.globalEnvNode.environment.head={[h.GlobalFrameDefaultText]:Symbol(),...n}}static width(){return Me.getCompactLayout()?Ne.compactWidth:Ne.nonCompactWidth}static height(){return Me.getCompactLayout()?Ne.compactHeight:Ne.nonCompactHeight}static initializeGrid(){if(Me.getCompactLayout()){this.compactLevels=[];let e,t=[Ne.globalEnvNode],s=null;for(;t.length>0;){e=new Ie(s,t),this.compactLevels.push(e);const a=[];t.forEach((e=>{e.children.forEach((t=>{const s=de(t);s.forEach((t=>t.parent=e)),a.push(...s)}))})),s=e,t=a}}else{const e=[];let t=[Ne.globalEnvNode];for(;t.length>0;){e.push(t);const s=[];t.forEach((e=>{e.children.forEach((t=>{const a=de(t);a.forEach((t=>t.parent=e)),s.push(...a)}))})),t=s}void 0===this.grid?this.grid=new _(e):this.grid.update(e)}}static memoizeValue(e){Ne.values.set(e.data,e)}static createValue(e,t){if(Y(e))return new B([t]);if(K(e))return new T(e,[t]);{const s=Ne.values.get(e);if(s)return s.addReference(t),s;let a=new T(null,[t]);return W(e)?a=new A(e,[t]):X(e)&&(a=$(e)?new x(e,[t]):new C(e,[t])),a}}static memoizeCompactValue(e){Ne.compactValues.set(e.data,e)}static createCompactValue(e,t){if(Y(e))return new Ee([t]);if(K(e))return new xe(e,[t]);{const s=Ne.compactValues.get(e);if(s)return s.addReference(t),s;let a=new xe(null,[t]);return W(e)?a=new Se(e,[t]):X(e)&&(a=$(e)?new be(e,[t]):new je(e,[t])),a}}static saveButtonText(){return"Save "+(Ne.width()>h.MaxExportWidth||Ne.height()>h.MaxExportHeight?Math.ceil(Ne.width()/h.MaxExportWidth)*Math.ceil(Ne.height()/h.MaxExportHeight)+" images":"image")}static handleScrollPosition(e,t){const s=e-Ne.invisiblePaddingHorizontal,a=t-Ne.invisiblePaddingVertical;this.stageRef.current.container().style.transform="translate("+s+"px, "+a+"px)",this.stageRef.current.x(-s),this.stageRef.current.y(-a)}static draw(){if(0!==Ne.key)return Ne.prevLayout;{const e=Object(g.jsx)("div",{className:"sa-env-visualizer",children:Object(g.jsx)("div",{id:"scroll-container",ref:Ne.scrollContainerRef,onScroll:e=>Ne.handleScrollPosition(e.currentTarget.scrollLeft,e.currentTarget.scrollTop),style:{width:Ne.visibleWidth,height:Ne.visibleHeight,overflow:"auto",margin:"10px"},children:Object(g.jsxs)("div",{id:"large-container",style:{width:Ne.width(),height:Ne.height(),overflow:"hidden",backgroundColor:Me.getPrintableMode()?h.PRINT_BACKGROUND.toString():h.SA_BLUE.toString()},children:[Object(g.jsx)("div",{style:{right:40,position:"absolute",display:"flex",alignSelf:"right"},children:Object(g.jsxs)(a.c,{vertical:!0,children:[Object(g.jsx)(a.b,{large:!0,outlined:!0,style:{backgroundColor:Me.getPrintableMode()?h.PRINT_BACKGROUND.toString():h.SA_BLUE.toString(),opacity:.8,borderColor:Me.getPrintableMode()?h.SA_BLUE.toString():h.PRINT_BACKGROUND.toString()},onMouseUp:()=>{Me.toggleCompactLayout(),Me.redraw()},children:Object(g.jsx)(a.f,{checked:!Me.getCompactLayout(),label:"Experimental",style:{marginBottom:"0px",color:Me.getPrintableMode()?h.SA_BLUE.toString():h.PRINT_BACKGROUND.toString()}})}),Object(g.jsx)(a.b,{large:!0,outlined:!0,style:{backgroundColor:Me.getPrintableMode()?h.PRINT_BACKGROUND.toString():h.SA_BLUE.toString(),opacity:.8,borderColor:Me.getPrintableMode()?h.SA_BLUE.toString():h.PRINT_BACKGROUND.toString()},onMouseUp:()=>{Me.togglePrintableMode(),Me.redraw()},children:Object(g.jsx)(a.f,{checked:Me.getPrintableMode(),label:"Printable",style:{marginBottom:"0px",color:Me.getPrintableMode()?h.SA_BLUE.toString():h.PRINT_BACKGROUND.toString()}})}),Object(g.jsx)(a.b,{outlined:!0,text:Ne.saveButtonText(),large:!0,onClick:this.exportImage,style:{color:Me.getPrintableMode()?h.SA_BLUE.toString():h.PRINT_BACKGROUND.toString(),backgroundColor:Me.getPrintableMode()?h.PRINT_BACKGROUND.toString():h.SA_BLUE.toString(),opacity:.8,borderColor:Me.getPrintableMode()?h.SA_BLUE.toString():h.PRINT_BACKGROUND.toString()}})]})}),Object(g.jsx)(r.j,{width:Ne.stageWidth,height:Ne.stageHeight,ref:this.stageRef,children:Object(g.jsxs)(r.e,{children:[Object(n.createElement)(r.h,{...p,x:0,y:0,width:Ne.width(),height:Ne.height(),fill:Me.getPrintableMode()?h.PRINT_BACKGROUND.toString():h.SA_BLUE.toString(),key:Ne.key++,listening:!1}),!Me.getCompactLayout()&&Ne.grid.draw(),Me.getCompactLayout()&&Ne.compactLevels.map((e=>e.draw()))]})})]})})});return Ne.prevLayout=e,Me.getCompactLayout()?Me.getPrintableMode()?Ne.currentCompactLight=e:Ne.currentCompactDark=e:Me.getPrintableMode()?Ne.currentLight=e:Ne.currentDark=e,e}}}Ne.nonCompactHeight=void 0,Ne.nonCompactWidth=void 0,Ne.compactWidth=void 0,Ne.compactHeight=void 0,Ne.visibleHeight=window.innerHeight,Ne.visibleWidth=window.innerWidth,Ne.stageHeight=window.innerHeight,Ne.stageWidth=window.innerWidth,Ne.key=0,Ne.environmentTree=void 0,Ne.globalEnvNode=void 0,Ne.grid=void 0,Ne.compactLevels=[],Ne.values=new Map,Ne.compactValues=new Map,Ne.prevLayout=void 0,Ne.currentDark=void 0,Ne.currentLight=void 0,Ne.currentCompactDark=void 0,Ne.currentCompactLight=void 0,Ne.stageRef=i.a.createRef(),Ne.invisiblePaddingVertical=300,Ne.invisiblePaddingHorizontal=300,Ne.scrollContainerRef=i.a.createRef(),Ne.exportImage=()=>{Ne.scrollContainerRef.current.scrollTo({left:0,top:0}),Ne.handleScrollPosition(0,0);const e=Ne.height(),t=Ne.width(),s=Math.ceil(t/h.MaxExportWidth),a=Math.ceil(e/h.MaxExportHeight);(()=>{const n=i=>{if(i>=s*a)return;const r=i%s,o=Math.floor(i/s),c=document.createElement("a");c.style.display="none",c.href=Ne.stageRef.current.toDataURL({x:r*h.MaxExportWidth+Ne.invisiblePaddingHorizontal,y:o*h.MaxExportHeight+Ne.invisiblePaddingVertical,width:Math.min(t-r*h.MaxExportWidth,h.MaxExportWidth),height:Math.min(e-o*h.MaxExportHeight,h.MaxExportHeight),mimeType:"image/jpeg"}),c.download=`diagram_${r}_${o}.jpg`,document.body.appendChild(c),c.click(),document.body.removeChild(c),setTimeout((function(){n(i+1)}),1e3)};n(0)})()};class Me{static togglePrintableMode(){Me.printableMode=!Me.printableMode}static toggleCompactLayout(){Me.compactLayout=!Me.compactLayout}static getPrintableMode(){return Me.printableMode}static getCompactLayout(){return Me.compactLayout}static init(e,t,s){Ne.visibleHeight=s,Ne.visibleWidth=t,this.setVis=e}static clear(){Ne.values.clear(),Ne.compactValues.clear()}static drawEnv(e){if(Me.environmentTree=le(e.runtime.environmentTree),!this.setVis)throw new Error("env visualizer not initialized");Ne.setContext(e.runtime.environmentTree),this.setVis(Ne.draw()),Ne.updateDimensions(Ne.visibleWidth,Ne.visibleHeight);const t=document.getElementById("env_visualizer-icon");t&&t.classList.add("side-content-tab-alert")}static redraw(){this.environmentTree&&(Me.getCompactLayout()&&Me.getPrintableMode()&&void 0!==Ne.currentCompactLight?this.setVis(Ne.currentCompactLight):Me.getCompactLayout()&&!Me.getPrintableMode()&&void 0!==Ne.currentCompactDark?this.setVis(Ne.currentCompactDark):!Me.getCompactLayout()&&Me.getPrintableMode()&&void 0!==Ne.currentLight?this.setVis(Ne.currentLight):Me.getCompactLayout()||Me.getPrintableMode()||void 0===Ne.currentDark?(Ne.setContext(Me.environmentTree),this.setVis(Ne.draw())):this.setVis(Ne.currentDark),Ne.updateDimensions(Ne.visibleWidth,Ne.visibleHeight))}static updateDimensions(e,t){null!=Ne.stageRef&&null!==e&&null!==t&&Ne.updateDimensions(e,t)}}Me.setVis=void 0,Me.printableMode=!1,Me.compactLayout=!0,Me.environmentTree=void 0},18:function(e,t,s){"use strict";s.d(t,"b",(function(){return a})),s.d(t,"e",(function(){return n})),s.d(t,"a",(function(){return i})),s.d(t,"c",(function(){return r})),s.d(t,"f",(function(){return o})),s.d(t,"d",(function(){return c})),s.d(t,"h",(function(){return l})),s.d(t,"j",(function(){return d})),s.d(t,"k",(function(){return u})),s.d(t,"l",(function(){return h})),s.d(t,"i",(function(){return p})),s.d(t,"g",(function(){return g}));const a="FETCH_ASSESSMENT_OVERVIEWS",n="SUBMIT_ASSESSMENT";let i,r,o,c;!function(e){e.attempting="attempting",e.attempted="attempted",e.not_attempted="not_attempted",e.submitted="submitted"}(i||(i={})),function(e){e.excluded="excluded",e.graded="graded",e.grading="grading",e.none="none"}(r||(r={})),function(e){e.public="public",e.opaque="opaque",e.secret="secret"}(o||(o={})),function(e){e.programming="programming",e.mcq="mcq",e.voting="voting"}(c||(c={}));const l=()=>({external:{name:"NONE",symbols:[]},globals:[]}),d=()=>({type:"Missions",isManuallyGraded:!0,closeAt:"2100-12-01T00:00+08",coverImage:"https://fakeimg.pl/300/",id:-1,maxXp:0,openAt:"2000-01-01T00:00+08",title:"Insert title here",reading:"",shortSummary:"Insert short summary here",status:i.not_attempted,story:"mission",xp:0,gradingStatus:"none"}),u=()=>({autogradingResults:[],answer:"// [Marking Scheme]\n// 1 mark for correct answer",content:"Enter content here",id:0,library:l(),graderLibrary:l(),prepend:"",solutionTemplate:"//This is a mock solution template",postpend:"",testcases:[],testcasesPrivate:[],type:"programming",xp:0,maxXp:0,blocking:!1}),h=()=>({type:o.public,answer:"",score:0,program:""}),p=()=>({answer:3,content:"This is a mock MCQ question",choices:[{content:"A",hint:null},{content:"B",hint:null},{content:"C",hint:null},{content:"D",hint:null}],id:2,library:l(),graderLibrary:l(),type:"mcq",solution:0,xp:0,maxXp:0,blocking:!1}),g=()=>({type:"Missions",globalDeployment:{external:{name:"NONE",symbols:[]},globals:[]},graderDeployment:l(),id:-1,longSummary:"Insert mission briefing here",missionPDF:"www.google.com",questions:[u()],title:"Insert title here"})},188:function(e,t,s){"use strict";s.r(t),s.d(t,"changeDateAssessment",(function(){return i})),s.d(t,"deleteAssessment",(function(){return r})),s.d(t,"publishAssessment",(function(){return o})),s.d(t,"uploadAssessment",(function(){return c}));var a=s(7),n=s(151);const i=(e,t,s)=>Object(a.action)(n.a,{id:e,openAt:t,closeAt:s}),r=e=>Object(a.action)(n.b,e),o=(e,t)=>Object(a.action)(n.c,{id:t,togglePublishTo:e}),c=(e,t,s)=>Object(a.action)(n.d,{file:e,forceUpdate:t,assessmentConfigId:s})},189:function(e,t,s){"use strict";s.d(t,"b",(function(){return u}));var a=s(1),n=s.n(a),i=s(35),r=s(53),o=s.n(r),c=s(24);const l=new Map,d=e=>{if(null==e.context)return[];const t=e.context.moduleContexts;if(null==t)return[];return Object.values(t).flatMap((e=>{var t,s;return null!==(t=null===(s=e.tabs)||void 0===s?void 0:s.map((e=>e(n.a,o.a))))&&void 0!==t?t:[]}))},u=e=>`${e}-icon`;t.a=e=>{const{tabs:t,onChange:s}=e,[a,r]=n.a.useState(t.beforeDynamicTabs.concat(t.afterDynamicTabs)),o=Object(i.f)((t=>e.workspaceLocation&&t.workspaces[e.workspaceLocation].debuggerContext));n.a.useEffect((()=>{const e=t.beforeDynamicTabs.concat((e=>{const t=[...d(e).filter((t=>t.toSpawn(e))).map((t=>({...t,body:t.body(e),id:c.b.module})))];return e.workspaceLocation&&l.set(e.workspaceLocation,t.map((e=>e.label))),t})(o||{})).concat(t.afterDynamicTabs);r(e)}),[t,o]);const h=n.a.useCallback(((e,t,a)=>{const n=e=>{const t=u(e),s=document.getElementById(t);s&&s.classList.remove("side-content-tab-alert")};void 0===s||s(e,t,a),n(t)}),[s]);return e.renderFunction(a,h)}},207:function(e,t,s){"use strict";s.r(t),s.d(t,"saveCanvas",(function(){return i})),s.d(t,"createCourse",(function(){return r})),s.d(t,"addNewUsersToCourse",(function(){return o}));var a=s(7),n=s(126);const i=e=>Object(a.action)(n.c,e),r=e=>Object(a.action)(n.b,e),o=(e,t)=>Object(a.action)(n.a,{users:e,provider:t})},211:function(e,t,s){"use strict";t.a=s.p+"static/media/default_cover_image.e2be0724.jpg"},212:function(e,t,s){"use strict";s.d(t,"a",(function(){return r}));var a=s(122),n=(s(1),s(12)),i=s(0);const r=e=>{let{onClick:t}=e;return Object(i.jsx)(n.a,{label:"Reset",icon:a.a.REPEAT,onClick:t})}},213:function(e,t,s){"use strict";s.d(t,"a",(function(){return o}));var a=s(103),n=s(122),i=(s(1),s(12)),r=s(0);const o=e=>{const t=e.hasUnsavedChanges?{intent:a.a.WARNING,minimal:!1}:{};return Object(r.jsx)(i.a,{label:"Save",icon:n.a.FLOPPY_DISK,onClick:e.onClickSave,options:t})}},214:function(e,t,s){"use strict";s.r(t),s.d(t,"fetchSourcecastIndex",(function(){return i})),s.d(t,"updateSourcecastIndex",(function(){return r}));var a=s(7),n=s(135);const i=e=>Object(a.action)(n.a,{workspaceLocation:e}),r=(e,t)=>Object(a.action)(n.c,{index:e,workspaceLocation:t})},216:function(e,t,s){"use strict";s.d(t,"a",(function(){return V}));var a=s(14);const n=2,i="white",r="white",o=45,c=15,l=30,d=22.5,u=60,h=15,p=4,g=13,m=-5,b=5,j=15,y=15,O=15,f=20;var v=s(371);function x(e){return function(e){return void 0===Array.isArray?e instanceof Array:Array.isArray(e)}(e)&&2===e.length}function C(e){if(x(e))return e[1];throw new Error("tail(xs) expects a pair as argument xs, but encountered "+e)}function S(e){return null===e}function w(e){for(;;e=C(e)){if(S(e))return!0;if(!x(e))return!1}}function E(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(t)return""+e;{const t=typeof e;if("function"!==t&&"object"!==t||null===e){if("string"===t){const t=e+"";return`"${t.substring(0,f)}${t.length>f?"...":""}"`}return`${e}`}return}}var T=s(1),k=s.n(T),A=s(0);class I extends k.a.PureComponent{render(){return Object(A.jsx)(a.a,{points:[this.props.from.x,this.props.from.y,this.props.to.x+g,this.props.to.y+m],pointerWidth:b,pointerLength:b,fill:r,stroke:i,strokeWidth:n,preventDefault:!1},this.props+"")}}class N extends T.PureComponent{render(){const e=this.props.from.y+l/2+y,t=this.props.to.x-O,s=this.props.to.y-j,o=[this.props.from.x,this.props.from.y,this.props.from.x,e,t,e,t,s,this.props.to.x+g,s,this.props.to.x+g,this.props.to.y+m];return Object(A.jsx)(a.a,{points:o,pointerLength:b,pointerWidth:b,fill:r,stroke:i,strokeWidth:n,preventDefault:!1})}}class M{constructor(){this.children=void 0,this.children=null}}class P extends M{constructor(e){super(),this.actualNode=void 0,this.actualNode=e}}class R extends M{constructor(e){super(),this.data=void 0,this.data=e}}class _ extends M{constructor(){super(...arguments),this._drawable=void 0,this.drawableX=void 0,this.drawableY=void 0}get drawable(){return this._drawable}}class L extends k.a.PureComponent{render(){return Object(A.jsx)(a.f,{x:this.props.x,y:this.props.y,points:[0,l,o,0],strokeWidth:n-1,stroke:i,preventDefault:!1})}}class D extends k.a.PureComponent{render(){const e=(e,t)=>{const s=e.data;if(w(s)){if(function(e){return null===e}(s)){const e={x:t*o,y:0};return Object(A.jsx)(L,{...e},t)}return null}{const n=E(s),i=null!==n&&void 0!==n?n:"*"+V.displaySpecialContent(e);return Object(A.jsx)(a.l,{text:i,align:"center",width:o,x:o*t,y:Math.floor((l-1.2*12)/2),fontStyle:void 0===n?"italic":"normal",fill:"white",preventDefault:!1},""+s+t)}};return Object(A.jsxs)(a.c,{x:this.props.x,y:this.props.y,children:[Object(A.jsx)(a.h,{width:Math.max(o*this.props.nodes.length,c),height:l,strokeWidth:n,stroke:i,fill:"#17181A",preventDefault:!1}),this.props.nodes.length>1&&Array.from(Array(this.props.nodes.length-1),((e,t)=>Object(A.jsx)(a.f,{points:[o*(t+1),0,o*(t+1),l],strokeWidth:n,stroke:i,preventDefault:!1},"line"+t))),this.props.nodes.map(((t,s)=>t instanceof R&&e(t,s)))]})}}class B extends k.a.PureComponent{render(){return Object(A.jsxs)(a.c,{...this.props,children:[Object(A.jsx)(a.b,{radius:h,strokeWidth:n,stroke:i,x:h,y:h,preventDefault:!1}),Object(A.jsx)(a.b,{radius:h,strokeWidth:n,stroke:i,x:3*h+n,y:h,preventDefault:!1}),Object(A.jsx)(a.b,{radius:p,strokeWidth:n,stroke:r,fill:r,x:h,y:h,preventDefault:!1}),Object(A.jsx)(a.b,{radius:p,strokeWidth:n,stroke:i,fill:r,x:3*h+n,y:h,preventDefault:!1})]})}}class U extends _{createDrawable(e,t,s,n){return this._drawable=Object(A.jsxs)(a.c,{children:[Object(A.jsx)(B,{x:e,y:t}),(s!==e||n!==t)&&Object(A.jsx)(I,{from:{x:s+o/2,y:n+l/2},to:{x:e,y:t}})]},e+", "+t),this.drawableX=e,this.drawableY=t,this._drawable}}class G extends _{createDrawable(e,t,s,n){var i;const r={nodes:null!==(i=this.children)&&void 0!==i?i:[],x:e,y:t},c=Object(A.jsx)(D,{...r});return this._drawable=Object(A.jsxs)(a.c,{children:[c,(s!==e||n!==t)&&Object(A.jsx)(I,{from:{x:s+o/2,y:n+l/2},to:{x:e,y:t}})]},e+", "+t),this.drawableX=e,this.drawableY=t,this._drawable}}class F{constructor(e,t){this._rootNode=void 0,this.nodes=void 0,this._rootNode=e,this.nodes=t}get rootNode(){return this._rootNode}getNodeById(e){return this.nodes[e]}static fromSourceStructure(e){let t=0;function s(e){const i=a.get(e);return void 0!==i?new P(i):(r=e,Array.isArray(r)?function(e){const i=new G;return a.set(e,i),n[t]=i,t++,i.children=e.map(s),i}(e):function(e){return"function"===typeof e}(e)?function(e){const s=new U;return a.set(e,s),n[t]=s,t++,s}(e):function(e){return new R(e)}(e));var r}const a=new Map,n=[],i=s(e);return new F(i,n)}draw(){return new H(this)}}class H{constructor(e){this.tree=void 0,this.drawables=void 0,this.nodeWidths=void 0,this.width=0,this.height=0,this.minX=0,this.minY=0,this.tree=e,this.drawables=[],this.nodeWidths=new Map}draw(e,t){if(this.tree.rootNode instanceof R){const e={text:E(this.tree.rootNode.data),align:"center",fontStyle:"normal",fontSize:20,fill:i},t=new v.a.Text(e);return this.width=t.width(),this.height=t.height(),Object(A.jsx)(a.e,{children:Object(A.jsx)(a.l,{...e})})}return this.drawNode(this.tree.rootNode,e,t,e,t),this.width=this.getNodeWidth(this.tree.rootNode)-this.minX,this.height=this.getNodeHeight(this.tree.rootNode)-this.minY+n,Object(A.jsx)(a.e,{offsetX:this.minX,offsetY:this.minY,children:this.drawables},e+", "+t)}drawNode(e,t,s,a,i){if(e instanceof P){const r=e.actualNode,c={from:{x:a+o/2,y:i+l/2},to:{x:r.drawableX,y:r.drawableY}};let d;c.from.y>=c.to.y?(this.minX=Math.min(this.minX,r.drawableX-O-n/2),this.minY=Math.min(this.minY,r.drawableY-j-n/2),d=Object(A.jsx)(N,{...c},"Arrow (back)"+a+t+i+s)):d=Object(A.jsx)(I,{...c},"Arrow"+a+t+i+s),this.drawables.push(d)}if(e instanceof _)if(e instanceof U){const n=e.createDrawable(t,s,a,i);this.drawables.push(n)}else if(e instanceof G){var r;const n=e.createDrawable(t,s,a,i);this.drawables.push(n);let c=t;null===(r=e.children)||void 0===r||r.forEach(((e,a)=>{const n=e instanceof P?s:s+u;this.drawNode(e,c,n,t+o*a,s);const i=this.getNodeWidth(e);c+=i?i+d:0}))}}getNodeWidth(e){if(e instanceof R||e instanceof P)return 0;if(e instanceof U)return 4*h+2*n;if(e instanceof G){var t;if(this.nodeWidths.has(e))return null!==(t=this.nodeWidths.get(e))&&void 0!==t?t:0;if(null!=e.children){const t=e.children.map((e=>this.getNodeWidth(e))).filter((e=>e>0)),s=t.length>0?t.reduce(((e,t)=>e+t+d)):0,a=Math.max(e.children.length*o+n,s,c+n);return this.nodeWidths.set(e,a),a}return 0}return 0}getNodeHeight(e){return e instanceof R?0:e instanceof U?l:e instanceof P?y:e instanceof G?(null!==(t=e.children)&&void 0!==t?t:[]).map((e=>this.getNodeHeight(e)+(e instanceof _?u/2:0))).filter((e=>e>0)).reduce(((e,t)=>Math.max(e,t)),0)+l:0;var t}}class V{static empty(e){}constructor(){this.steps=[],this.nodeLabel=0,this.nodeToLabelMap=new Map}static init(e){V.setSteps=e}static drawData(e){if(!V.setSteps)throw new Error("Data visualizer not initialized");V._instance.addStep(e),V.setSteps(V._instance.steps)}static clear(){V._instance=new V,V.setSteps(V._instance.steps)}static displaySpecialContent(e){return V._instance.displaySpecialContent(e)}displaySpecialContent(e){var t;return this.nodeToLabelMap.has(e)?null!==(t=this.nodeToLabelMap.get(e))&&void 0!==t?t:0:(console.log("*"+this.nodeLabel+": "+e.data),this.nodeToLabelMap.set(e,this.nodeLabel),this.nodeLabel++)}addStep(e){const t=e.map(this.createDrawing);this.steps.push(t)}createDrawing(e){const t=F.fromSourceStructure(e).draw(),s=n/2,i=n/2,r=t.draw(s,i);return Object(A.jsx)(a.j,{width:t.width+s,height:t.height+i,children:r},e)}}V.setSteps=V.empty,V._instance=new V},22:function(e,t,s){"use strict";s.d(t,"a",(function(){return l})),s.d(t,"o",(function(){return u})),s.d(t,"n",(function(){return h})),s.d(t,"h",(function(){return p})),s.d(t,"p",(function(){return g})),s.d(t,"m",(function(){return m})),s.d(t,"c",(function(){return b})),s.d(t,"e",(function(){return j})),s.d(t,"f",(function(){return y})),s.d(t,"d",(function(){return O})),s.d(t,"i",(function(){return f})),s.d(t,"g",(function(){return v})),s.d(t,"b",(function(){return x})),s.d(t,"l",(function(){return C})),s.d(t,"j",(function(){return S})),s.d(t,"k",(function(){return w}));var a=s(27),n=s(37),i=s(16),r=s(101),o=s(71);let c,l;!function(e){e.Development="development",e.Production="production",e.Test="test"}(c||(c={})),function(e){e.Student="student",e.Staff="staff",e.Admin="admin"}(l||(l={}));const d=new Map([[a.Variant.DEFAULT,"calc"]]),u=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:a.Variant.DEFAULT;return`Source \xa7${e}${d.has(t)?` ${d.get(t)}`:""}`},h=[{chapter:a.Chapter.CALC,variant:a.Variant.DEFAULT}].map((e=>({...e,displayName:u(e.chapter,e.variant)}))),p=h.filter((e=>e.variant===a.Variant.DEFAULT)),g=h.filter((e=>e.variant!==a.Variant.DEFAULT)),m=e=>[a.Chapter.CALC].includes(e),b={gameCanvas:void 0},j={environment:c.Production},y={gradingSummary:{cols:[],rows:[]}},O={achievements:[],goals:[],users:[],assessmentOverviews:[]},f={githubSaveInfo:{repoName:"",filePath:""}},v="1+1",x=e=>({autogradingResults:[],context:Object(r.a)([],e,i.b.defaultSourceVariant),activeEditorTabIndex:0,editorTabs:[{value:["playground","sourcecast","githubAssessments"].includes(e)?v:"",prependValue:"",postpendValue:"",highlightedLines:[],breakpoints:[]}],editorSessionId:"",isEditorReadonly:!1,editorTestcases:[],externalLibrary:o.a.NONE,execTime:1e3,output:[],replHistory:{browseIndex:null,records:[],originalValue:""},replValue:"",sharedbConnected:!1,stepLimit:1e3,globals:[],isEditorAutorun:!1,isRunning:!1,isDebugging:!1,enableDebugging:!0,debuggerContext:{}}),C={assessment:{...x("assessment"),currentAssessment:void 0,currentQuestion:void 0,hasUnsavedChanges:!1},grading:{...x("grading"),currentSubmission:void 0,currentQuestion:void 0,hasUnsavedChanges:!1},playground:{...x("playground"),usingSubst:!1},sourcecast:{...x("sourcecast"),audioUrl:"",codeDeltasToApply:null,currentPlayerTime:0,description:null,inputToApply:null,playbackData:{init:{editorValue:"",chapter:a.Chapter.CALC,externalLibrary:o.a.NONE},inputs:[]},playbackDuration:0,playbackStatus:n.b.paused,sourcecastIndex:null,title:null,uid:null},sourcereel:{...x("sourcereel"),playbackData:{init:{editorValue:"",chapter:a.Chapter.CALC,externalLibrary:o.a.NONE},inputs:[]},recordingStatus:n.c.notStarted,timeElapsedBeforePause:0,timeResumed:0},sicp:{...x("sicp"),usingSubst:!1},githubAssessment:{...x("githubAssessment"),hasUnsavedChanges:!1}},S={courses:[],group:null,gameState:{completed_quests:[],collectibles:{}},xp:0,allUserXp:void 0,story:{story:"",playStory:!1},assessments:new Map,assessmentOverviews:void 0,agreedToResearch:void 0,sessionId:Date.now(),githubOctokitObject:{octokit:void 0},gradingOverviews:void 0,gradings:new Map,notifications:[]},w={academy:b,achievement:O,application:j,dashboard:y,playground:f,session:S,workspaces:C}},221:function(e,t,s){"use strict";s.d(t,"c",(function(){return i})),s.d(t,"a",(function(){return r})),s.d(t,"b",(function(){return o}));var a=s(16);const n={"http:":"ws:","https:":"wss:"};function i(e,t){const s=new URL(e,a.b.sharedbBackendUrl);return t&&(s.protocol=n[s.protocol]),s.toString()}async function r(e){const t=await fetch(i(e));return t&&t.ok}async function o(e){const t=await fetch(a.b.sharedbBackendUrl,{method:"POST",body:e,headers:{"Content-Type":"text/plain"}});if(!t||!t.ok)throw new Error(t?`Could not create new session: ${await t.text()}`:"Unknown error creating session");return t.text()}},226:function(e,t,s){"use strict";s.d(t,"a",(function(){return a})),s.d(t,"b",(function(){return n}));const a="SET_EDITOR_SESSION_ID",n="SET_SHAREDB_CONNECTED"},227:function(e,t,s){"use strict";s.d(t,"b",(function(){return m})),s.d(t,"a",(function(){return b}));var a=s(513),n=s(134),i=s(27);function r(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:i.Variant.DEFAULT,s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"NONE";function a(t,s,a){const n=t("../lib/oop"),r=t("./doc_comment_highlight_rules").DocCommentHighlightRules,o=t("./text_highlight_rules").TextHighlightRules,c="[a-zA-Z\\$_\xa1-\uffff][a-zA-Z\\d\\$_\xa1-\uffff]*";i.Variant.DEFAULT,e.toString();const l=function(e){const t=this.createKeywordMapper({"variable.language":"implements|interface|package|private|protected|public|static|window|document",keyword:"Array|Boolean|Date|Function|Iterator|Number|Object|RegExp|String|Proxy|Namespace|QName|XML|XMLList|ArrayBuffer|Float32Array|Float64Array|Int16Array|Int32Array|Int8Array|Uint16Array|Uint32Array|Uint8Array|Uint8ClampedArray|Error|EvalError|InternalError|RangeError|ReferenceError|StopIteration|SyntaxError|TypeError|URIError|decodeURI|decodeURIComponent|encodeURI|encodeURIComponent|isFinite|isNaN|parseFloat|parseInt|Math|this|arguments|prototypeyield|get|set|async|await|enum|eval|true|false|null|Infinity|NaN|undefined|break|case|continue|default|delete|do|else|finally|for|if|in|of|instanceof|new|return|switch|throw|try|typeof|while|with|debugger|escape|with|extends|super|export","storage.type":"const|let|var|function|import|class|catch","support.function":"alert"},"identifier"),s="\\\\(?:x[0-9a-fA-F]{2}|u[0-9a-fA-F]{4}|u{[0-9a-fA-F]{1,6}}|[0-2][0-7]{0,2}|3[0-7][0-7]?|[4-7][0-7]?|.)";this.$rules={no_regex:[r.getStartRule("doc-start"),u("no_regex"),{token:"string",regex:"'(?=.)",next:"qstring"},{token:"string",regex:'"(?=.)',next:"qqstring"},{token:"constant.numeric",regex:/0(?:[xX][0-9a-fA-F]+|[oO][0-7]+|[bB][01]+)\b/},{token:"constant.numeric",regex:/(?:\d\d*(?:\.\d*)?|\.\d+)(?:[eE][+-]?\d+\b)?/},{token:["storage.type","punctuation.operator","support.function","punctuation.operator","entity.name.function","text","keyword.operator"],regex:"("+c+")(\\.)(prototype)(\\.)("+c+")(\\s*)(=)",next:"function_arguments"},{token:["storage.type","punctuation.operator","entity.name.function","text","keyword.operator","text","storage.type","text","paren.lparen"],regex:"("+c+")(\\.)("+c+")(\\s*)(=)(\\s*)(function)(\\s*)(\\()",next:"function_arguments"},{token:["entity.name.function","text","keyword.operator","text","storage.type","text","paren.lparen"],regex:"("+c+")(\\s*)(=)(\\s*)(function)(\\s*)(\\()",next:"function_arguments"},{token:["storage.type","punctuation.operator","entity.name.function","text","keyword.operator","text","storage.type","text","entity.name.function","text","paren.lparen"],regex:"("+c+")(\\.)("+c+")(\\s*)(=)(\\s*)(function)(\\s+)(\\w+)(\\s*)(\\()",next:"function_arguments"},{token:["storage.type","text","entity.name.function","text","paren.lparen"],regex:"(function)(\\s+)("+c+")(\\s*)(\\()",next:"function_arguments"},{token:["entity.name.function","text","punctuation.operator","text","storage.type","text","paren.lparen"],regex:"("+c+")(\\s*)(:)(\\s*)(function)(\\s*)(\\()",next:"function_arguments"},{token:["text","text","storage.type","text","paren.lparen"],regex:"(:)(\\s*)(function)(\\s*)(\\()",next:"function_arguments"},{token:"keyword",regex:"from(?=\\s*('|\"))"},{token:"keyword",regex:"(?:case|do|else|finally|in|instanceof|return|throw|try|typeof|yield|void)\\b",next:"start"},{token:["support.constant"],regex:/that\b/},{token:t,regex:c},{token:"variable.language",regex:/[.](?![.])/,next:"property"},{token:"storage.type",regex:/=>/},{token:"keyword.operator",regex:/--|\+\+|\.{3}|===|==|=|!=|!==|<+=?|>+=?|!|&&|\|\||\?:|[!$%&*+\-~\/^]=?/,next:"start"},{token:"punctuation.operator",regex:/[?:,;.]/,next:"start"},{token:"paren.lparen",regex:/[\[({]/,next:"start"},{token:"paren.rparen",regex:/[\])}]/},{token:"comment",regex:/^#!.*$/}],property:[{token:"text",regex:"\\s+"},{token:["storage.type","punctuation.operator","entity.name.function","text","keyword.operator","text","storage.type","text","entity.name.function","text","paren.lparen"],regex:"("+c+")(\\.)("+c+")(\\s*)(=)(\\s*)(function)(?:(\\s+)(\\w+))?(\\s*)(\\()",next:"function_arguments"},{token:"punctuation.operator",regex:/[.](?![.])/},{token:"variable.language",regex:/(s(?:h(?:ift|ow(?:Mod(?:elessDialog|alDialog)|Help))|croll(?:X|By(?:Pages|Lines)?|Y|To)?|t(?:op|rike)|i(?:n|zeToContent|debar|gnText)|ort|u(?:p|b(?:str(?:ing)?)?)|pli(?:ce|t)|e(?:nd|t(?:Re(?:sizable|questHeader)|M(?:i(?:nutes|lliseconds)|onth)|Seconds|Ho(?:tKeys|urs)|Year|Cursor|Time(?:out)?|Interval|ZOptions|Date|UTC(?:M(?:i(?:nutes|lliseconds)|onth)|Seconds|Hours|Date|FullYear)|FullYear|Active)|arch)|qrt|lice|avePreferences|mall)|h(?:ome|andleEvent)|navigate|c(?:har(?:CodeAt|At)|o(?:s|n(?:cat|textual|firm)|mpile)|eil|lear(?:Timeout|Interval)?|a(?:ptureEvents|ll)|reate(?:StyleSheet|Popup|EventObject))|t(?:o(?:GMTString|S(?:tring|ource)|U(?:TCString|pperCase)|Lo(?:caleString|werCase))|est|a(?:n|int(?:Enabled)?))|i(?:s(?:NaN|Finite)|ndexOf|talics)|d(?:isableExternalCapture|ump|etachEvent)|u(?:n(?:shift|taint|escape|watch)|pdateCommands)|j(?:oin|avaEnabled)|p(?:o(?:p|w)|ush|lugins.refresh|a(?:ddings|rse(?:Int|Float)?)|r(?:int|ompt|eference))|e(?:scape|nableExternalCapture|val|lementFromPoint|x(?:p|ec(?:Script|Command)?))|valueOf|UTC|queryCommand(?:State|Indeterm|Enabled|Value)|f(?:i(?:nd|le(?:ModifiedDate|Size|CreatedDate|UpdatedDate)|xed)|o(?:nt(?:size|color)|rward)|loor|romCharCode)|watch|l(?:ink|o(?:ad|g)|astIndexOf)|a(?:sin|nchor|cos|t(?:tachEvent|ob|an(?:2)?)|pply|lert|b(?:s|ort))|r(?:ou(?:nd|teEvents)|e(?:size(?:By|To)|calc|turnValue|place|verse|l(?:oad|ease(?:Capture|Events)))|andom)|g(?:o|et(?:ResponseHeader|M(?:i(?:nutes|lliseconds)|onth)|Se(?:conds|lection)|Hours|Year|Time(?:zoneOffset)?|Da(?:y|te)|UTC(?:M(?:i(?:nutes|lliseconds)|onth)|Seconds|Hours|Da(?:y|te)|FullYear)|FullYear|A(?:ttention|llResponseHeaders)))|m(?:in|ove(?:B(?:y|elow)|To(?:Absolute)?|Above)|ergeAttributes|a(?:tch|rgins|x))|b(?:toa|ig|o(?:ld|rderWidths)|link|ack))\b(?=\()/},{token:"variable.language.dom",regex:/(s(?:ub(?:stringData|mit)|plitText|e(?:t(?:NamedItem|Attribute(?:Node)?)|lect))|has(?:ChildNodes|Feature)|namedItem|c(?:l(?:ick|o(?:se|neNode))|reate(?:C(?:omment|DATASection|aption)|T(?:Head|extNode|Foot)|DocumentFragment|ProcessingInstruction|E(?:ntityReference|lement)|Attribute))|tabIndex|i(?:nsert(?:Row|Before|Cell|Data)|tem)|open|delete(?:Row|C(?:ell|aption)|T(?:Head|Foot)|Data)|focus|write(?:ln)?|a(?:dd|ppend(?:Child|Data))|re(?:set|place(?:Child|Data)|move(?:NamedItem|Child|Attribute(?:Node)?)?)|get(?:NamedItem|Element(?:sBy(?:Name|TagName|ClassName)|ById)|Attribute(?:Node)?)|blur)\b(?=\()/},{token:"support.constant",regex:/(s(?:ystemLanguage|cr(?:ipts|ollbars|een(?:X|Y|Top|Left))|t(?:yle(?:Sheets)?|atus(?:Text|bar)?)|ibling(?:Below|Above)|ource|uffixes|e(?:curity(?:Policy)?|l(?:ection|f)))|h(?:istory|ost(?:name)?|as(?:h|Focus))|y|X(?:MLDocument|SLDocument)|n(?:ext|ame(?:space(?:s|URI)|Prop))|M(?:IN_VALUE|AX_VALUE)|c(?:haracterSet|o(?:n(?:structor|trollers)|okieEnabled|lorDepth|mp(?:onents|lete))|urrent|puClass|l(?:i(?:p(?:boardData)?|entInformation)|osed|asses)|alle(?:e|r)|rypto)|t(?:o(?:olbar|p)|ext(?:Transform|Indent|Decoration|Align)|ags)|SQRT(?:1_2|2)|i(?:n(?:ner(?:Height|Width)|put)|ds|gnoreCase)|zIndex|o(?:scpu|n(?:readystatechange|Line)|uter(?:Height|Width)|p(?:sProfile|ener)|ffscreenBuffering)|NEGATIVE_INFINITY|d(?:i(?:splay|alog(?:Height|Top|Width|Left|Arguments)|rectories)|e(?:scription|fault(?:Status|Ch(?:ecked|arset)|View)))|u(?:ser(?:Profile|Language|Agent)|n(?:iqueID|defined)|pdateInterval)|_content|p(?:ixelDepth|ort|ersonalbar|kcs11|l(?:ugins|atform)|a(?:thname|dding(?:Right|Bottom|Top|Left)|rent(?:Window|Layer)?|ge(?:X(?:Offset)?|Y(?:Offset)?))|r(?:o(?:to(?:col|type)|duct(?:Sub)?|mpter)|e(?:vious|fix)))|e(?:n(?:coding|abledPlugin)|x(?:ternal|pando)|mbeds)|v(?:isibility|endor(?:Sub)?|Linkcolor)|URLUnencoded|P(?:I|OSITIVE_INFINITY)|f(?:ilename|o(?:nt(?:Size|Family|Weight)|rmName)|rame(?:s|Element)|gColor)|E|whiteSpace|l(?:i(?:stStyleType|n(?:eHeight|kColor))|o(?:ca(?:tion(?:bar)?|lName)|wsrc)|e(?:ngth|ft(?:Context)?)|a(?:st(?:M(?:odified|atch)|Index|Paren)|yer(?:s|X)|nguage))|a(?:pp(?:MinorVersion|Name|Co(?:deName|re)|Version)|vail(?:Height|Top|Width|Left)|ll|r(?:ity|guments)|Linkcolor|bove)|r(?:ight(?:Context)?|e(?:sponse(?:XML|Text)|adyState))|global|x|m(?:imeTypes|ultiline|enubar|argin(?:Right|Bottom|Top|Left))|L(?:N(?:10|2)|OG(?:10E|2E))|b(?:o(?:ttom|rder(?:Width|RightWidth|BottomWidth|Style|Color|TopWidth|LeftWidth))|ufferDepth|elow|ackground(?:Color|Image)))\b/},{token:"identifier",regex:c},{regex:"",token:"empty",next:"no_regex"}],start:[r.getStartRule("doc-start"),u("start"),{token:"string.regexp",regex:"\\/",next:"regex"},{token:"text",regex:"\\s+|^$",next:"start"},{token:"empty",regex:"",next:"no_regex"}],regex:[{token:"regexp.keyword.operator",regex:"\\\\(?:u[\\da-fA-F]{4}|x[\\da-fA-F]{2}|.)"},{token:"string.regexp",regex:"/[sxngimy]*",next:"no_regex"},{token:"invalid",regex:/\{\d+\b,?\d*\}[+*]|[+*$^?][+*]|[$^][?]|\?{3,}/},{token:"constant.language.escape",regex:/\(\?[:=!]|\)|\{\d+\b,?\d*\}|[+*]\?|[()$^+*?.]/},{token:"constant.language.delimiter",regex:/\|/},{token:"constant.language.escape",regex:/\[\^?/,next:"regex_character_class"},{token:"empty",regex:"$",next:"no_regex"},{defaultToken:"string.regexp"}],regex_character_class:[{token:"regexp.charclass.keyword.operator",regex:"\\\\(?:u[\\da-fA-F]{4}|x[\\da-fA-F]{2}|.)"},{token:"constant.language.escape",regex:"]",next:"regex"},{token:"constant.language.escape",regex:"-"},{token:"empty",regex:"$",next:"no_regex"},{defaultToken:"string.regexp.charachterclass"}],function_arguments:[{token:"variable.parameter",regex:c},{token:"punctuation.operator",regex:"[, ]+"},{token:"punctuation.operator",regex:"$"},{token:"empty",regex:"",next:"no_regex"}],qqstring:[{token:"constant.language.escape",regex:s},{token:"string",regex:"\\\\$",consumeLineEnd:!0},{token:"string",regex:'"|$',next:"no_regex"},{defaultToken:"string"}],qstring:[{token:"constant.language.escape",regex:s},{token:"string",regex:"\\\\$",consumeLineEnd:!0},{token:"string",regex:"'|$",next:"no_regex"},{defaultToken:"string"}]},e&&e.noES6||(this.$rules.no_regex.unshift({regex:"[{}]",onMatch:function(e,t,s){if(this.next="{"==e?this.nextState:"","{"==e&&s.length)s.unshift("start",t);else if("}"==e&&s.length&&(s.shift(),this.next=s.shift(),-1!=this.next.indexOf("string")||-1!=this.next.indexOf("jsx")))return"paren.quasi.end";return"{"==e?"paren.lparen":"paren.rparen"},nextState:"start"},{token:"string.quasi.start",regex:/`/,push:[{token:"constant.language.escape",regex:s},{token:"paren.quasi.start",regex:/\${/,push:"start"},{token:"string.quasi.end",regex:/`/,next:"pop"},{defaultToken:"string.quasi"}]}),e&&0==e.jsx||d.call(this)),this.embedRules(r,"doc-",[r.getEndRule("no_regex")]),this.normalizeRules()};function d(){const e=c.replace("\\d","\\d\\-"),t={onMatch:function(e,t,s){const a="/"==e.charAt(1)?2:1;return 1==a?(t!=this.nextState?s.unshift(this.next,this.nextState,0):s.unshift(this.next),s[2]++):2==a&&t==this.nextState&&(s[1]--,(!s[1]||s[1]<0)&&(s.shift(),s.shift())),[{type:"meta.tag.punctuation."+(1==a?"":"end-")+"tag-open.xml",value:e.slice(0,a)},{type:"meta.tag.tag-name.xml",value:e.substr(a)}]},regex:"</?"+e,next:"jsxAttributes",nextState:"jsx"};this.$rules.start.unshift(t);const s={regex:"{",token:"paren.quasi.start",push:"start"};this.$rules.jsx=[s,t,{include:"reference"},{defaultToken:"string"}],this.$rules.jsxAttributes=[{token:"meta.tag.punctuation.tag-close.xml",regex:"/?>",onMatch:function(e,t,s){return t==s[0]&&s.shift(),2==e.length&&(s[0]==this.nextState&&s[1]--,(!s[1]||s[1]<0)&&s.splice(0,2)),this.next=s[0]||"start",[{type:this.token,value:e}]},nextState:"jsx"},s,u("jsxAttributes"),{token:"entity.other.attribute-name.xml",regex:e},{token:"keyword.operator.attribute-equals.xml",regex:"="},{token:"text.tag-whitespace.xml",regex:"\\s+"},{token:"string.attribute-value.xml",regex:"'",stateName:"jsx_attr_q",push:[{token:"string.attribute-value.xml",regex:"'",next:"pop"},{include:"reference"},{defaultToken:"string.attribute-value.xml"}]},{token:"string.attribute-value.xml",regex:'"',stateName:"jsx_attr_qq",push:[{token:"string.attribute-value.xml",regex:'"',next:"pop"},{include:"reference"},{defaultToken:"string.attribute-value.xml"}]},t],this.$rules.reference=[{token:"constant.language.escape.reference.xml",regex:"(?:&#[0-9]+;)|(?:&#x[0-9a-fA-F]+;)|(?:&[a-zA-Z0-9_:\\.-]+;)"}]}function u(e){return[{token:"comment",regex:/\/\*/,next:[r.getTagRule(),{token:"comment",regex:"\\*\\/",next:e||"pop"},{defaultToken:"comment",caseInsensitive:!0}]},{token:"comment",regex:"\\/\\/",next:[r.getTagRule(),{token:"comment",regex:"$|^",next:e||"pop"},{defaultToken:"comment",caseInsensitive:!0}]}]}n.inherits(l,o),s.SourceHighlightRules=l}const r=e.toString()+t+s;n.define("ace/mode/source_highlight_rules"+r,["require","exports","module","ace/lib/oop","ace/mode/doc_comment_highlight_rules","ace/mode/text_highlight_rules"],a)}var o=s(88),c=s(90),l=s(71);const d={};function u(e){return e.length<=27?e:e.substring(0,24)+"..."}function h(e){return e in o.SourceDocumentation.ext_lib?{caption:u(e),value:e,meta:o.SourceDocumentation.ext_lib[e].meta,docHTML:o.SourceDocumentation.ext_lib[e].description}:{caption:u(e),value:e,meta:"const"}}for(const[j,y]of l.b)d[j]=y.map(h);for(const j of c.h)d[j.deviceLibraryName]=j.internalFunctions.map(h);const p={};Object.entries(o.SourceDocumentation.builtins).forEach((e=>{const[t,s]=e;p[t]=Object.entries(s).map((e=>{const[t,s]=e;return{caption:u(t),value:t,meta:s.meta,docHTML:s.description}}))}));const g={builtins:p,externalLibraries:d},m=(e,t,s)=>{var n;"function"!==typeof(null===(n=ace.define.modules[`ace/mode/${b(e,t,s)}`])||void 0===n?void 0:n.Mode)&&(r(e,t,s,g.externalLibraries[s]),Object(a.ModeSelector)(e,t,s))},b=(e,t,s)=>`source${e}${t}${s}`},24:function(e,t,s){"use strict";s.d(t,"a",(function(){return a})),s.d(t,"b",(function(){return n}));const a="NOTIFY_PROGRAM_EVALUATED";let n;!function(e){e.autograder="autograder",e.briefing="briefing",e.contestVoting="contest_voting",e.contestLeaderboard="contest_leaderboard",e.dataVisualizer="data_visualizer",e.editorGrading="editor_grading",e.editorAutograder="editor_autograder",e.editorBriefing="editor_briefing",e.editorGlobalDeployment="editor_global_deployment",e.editorGlobalGraderDeployment="editor_global_grader_deployment",e.editorLocalDeployment="editor_local_deployment",e.editorLocalGraderDeployment="editor_local_grader_deployment",e.editorManageQuestion="editor_manage_question",e.editorQuestionOverview="editor_question_overview",e.editorQuestionTemplate="editor_question_template",e.envVisualizer="env_visualizer",e.files="files",e.grading="grading",e.introduction="introduction",e.module="module",e.questionOverview="question_overview",e.remoteExecution="remote_execution",e.missionMetadata="mission_metadata",e.mobileEditor="mobile_editor",e.mobileEditorRun="mobile_editor_run",e.sourcereel="sourcereel",e.substVisualizer="subst_visualiser",e.testcases="testcases",e.toneMatrix="tone_matrix",e.htmlDisplay="html_display"}(n||(n={}))},248:function(e,t,s){"use strict";s.r(t),s.d(t,"setEditorSessionId",(function(){return i})),s.d(t,"setSharedbConnected",(function(){return r}));var a=s(7),n=s(226);const i=(e,t)=>Object(a.action)(n.a,{workspaceLocation:e,editorSessionId:t}),r=(e,t)=>Object(a.action)(n.b,{workspaceLocation:e,connected:t})},26:function(e,t,s){"use strict";s.d(t,"a",(function(){return a})),s.d(t,"c",(function(){return n})),s.d(t,"d",(function(){return i})),s.d(t,"m",(function(){return r})),s.d(t,"g",(function(){return o})),s.d(t,"h",(function(){return c})),s.d(t,"i",(function(){return l})),s.d(t,"k",(function(){return d})),s.d(t,"j",(function(){return u})),s.d(t,"n",(function(){return h})),s.d(t,"o",(function(){return p})),s.d(t,"p",(function(){return g})),s.d(t,"q",(function(){return m})),s.d(t,"s",(function(){return b})),s.d(t,"r",(function(){return j})),s.d(t,"t",(function(){return y})),s.d(t,"u",(function(){return O})),s.d(t,"b",(function(){return f})),s.d(t,"f",(function(){return v})),s.d(t,"v",(function(){return x})),s.d(t,"l",(function(){return C})),s.d(t,"e",(function(){return S}));const a="ADD_EVENT",n="BULK_UPDATE_ACHIEVEMENTS",i="BULK_UPDATE_GOALS",r="HANDLE_EVENT",o="GET_ACHIEVEMENTS",c="GET_GOALS",l="GET_OWN_GOALS",d="GET_USER_ASSESSMENT_OVERVIEWS",u="GET_USERS",h="REMOVE_ACHIEVEMENT",p="REMOVE_GOAL",g="SAVE_ACHIEVEMENTS",m="SAVE_GOALS",b="SAVE_USER_ASSESSMENT_OVERVIEWS",j="SAVE_USERS",y="UPDATE_GOAL_PROGRESS",O="UPDATE_OWN_GOAL_PROGRESS";let f,v;!function(e){e.ACTIVE="ACTIVE",e.COMPLETED="COMPLETED",e.EXPIRED="EXPIRED",e.UNRELEASED="UNRELEASED"}(f||(f={})),function(e){e.ALL="ALL",e.ACTIVE="ACTIVE",e.COMPLETED="COMPLETED"}(v||(v={}));const x={count:0,targetCount:1,completed:!1};let C,S;!function(e){e.MANUAL="Manual",e.EVENT="Event",e.ASSESSMENT="Assessment (unsupported)",e.BINARY="Binary (unsupported)"}(C||(C={})),function(e){e.NONE="None",e.RUN_CODE="Run Code",e.ERROR="Error",e.RUN_TESTCASE="Run Testcase"}(S||(S={}))},281:function(e,t,s){"use strict";s.r(t),s.d(t,"logOut",(function(){return i}));var a=s(7),n=s(146);const i=()=>Object(a.action)(n.a)},282:function(e,t,s){"use strict";s.d(t,"a",(function(){return n}));var a=s(526);function n(e){return new a.a({auth:e,userAgent:"Source Academy Playground",baseUrl:"https://api.github.com",log:{debug:()=>{},info:()=>{},warn:console.warn,error:console.error},request:{agent:void 0,fetch:void 0,timeout:0}})}},288:function(e,t,s){"use strict";var a=s(3),n=s(20),i=s.n(n),r=(s(1),s(0));t.a=e=>{const t=Object(r.jsx)("div",{className:i()("ControlBar_editor",a.a.BUTTON_GROUP),children:e.editorButtons}),s=e.flowButtons&&Object(r.jsx)("div",{className:i()("ControlBar_flow",a.a.BUTTON_GROUP),children:e.flowButtons}),n=Object(r.jsx)("div",{className:i()("ControlBar_editingWorkspace",a.a.BUTTON_GROUP),children:e.editingWorkspaceButtons});return Object(r.jsxs)("div",{className:"ControlBar",children:[t,s,n]})}},289:function(e,t,s){"use strict";var a=s(103),n=s(42),i=s(1),r=s(45),o=s(10),c=s(0);class l extends i.PureComponent{constructor(){super(...arguments),this.onButtonClickFactory=e=>t=>{e!==this.props.mcq.answer&&this.props.handleMCQSubmit(e);if(null!==this.props.mcq.solution&&this.props.mcq.choices[e].hint){const t=Object(c.jsx)(r.a,{className:"markdown-notification",content:this.props.mcq.choices[e].hint});e===this.props.mcq.solution?Object(o.d)(t,4e3):Object(o.e)(t,4e3)}},this.getButtonIntent=(e,t,s)=>{const n=e===t,i=n&&void 0!==s&&e===s;return void 0===s?a.a.NONE:n&&i?a.a.SUCCESS:n&&!i?a.a.DANGER:a.a.NONE}}render(){const e=this.props.mcq.choices.map(((e,t)=>Object(c.jsx)(n.b,{className:"mcq-option col-xs-12",active:t===this.props.mcq.answer,intent:this.getButtonIntent(t,this.props.mcq.answer,this.props.mcq.solution),onClick:this.onButtonClickFactory(t),minimal:!0,children:Object(c.jsx)(r.a,{content:e.content})},t)));return Object(c.jsx)("div",{className:"MCQChooser row",children:Object(c.jsx)(n.e,{className:"mcq-content-parent col-xs-12 middle-xs",children:Object(c.jsx)("div",{className:"row mcq-options-parent between-xs",children:e})})})}}t.a=l},291:function(e,t,s){"use strict";s.d(t,"a",(function(){return n}));var a=s(33);const n=(e,t)=>a.isEqual(e,t)},292:function(e,t,s){"use strict";var a=s(42),n=s(3),i=s(139),r=s(20),o=s.n(r),c=s(88),l=s(100),d=s(1),u=s(18),h=s(0);t.a=e=>{const{index:t,testcase:s,handleTestcaseEval:r}=e,p=d.useMemo((()=>{const e=void 0!==s.result||s.errors,t=Object(l.stringify)(s.result)===s.answer;return{correct:e&&t,wrong:e&&!t,secret:s.type===u.f.secret||s.type===u.f.opaque}}),[s]),g=d.useCallback((()=>{r(t)}),[t,r]);return Object(h.jsx)("div",{className:o()("AutograderCard",p),children:Object(h.jsx)(a.e,{className:n.a.INTERACTIVE,elevation:i.a.ONE,onClick:g,children:s.type===u.f.opaque&&"assessment"===e.workspaceLocation?Object(h.jsx)(a.M,{className:"testcase-placeholder",children:"Hidden testcase"}):Object(h.jsxs)(h.Fragment,{children:[Object(h.jsx)(a.M,{className:"testcase-program",children:s.program}),Object(h.jsx)(a.M,{className:"testcase-expected",children:s.answer}),Object(h.jsx)(a.M,{className:"testcase-actual",children:s.errors?Object(c.parseError)(s.errors):void 0!==s.result?Object(l.stringify)(s.result):"No Answer"})]})})})}},293:function(e,t,s){"use strict";s.d(t,"b",(function(){return m}));var a=s(42),n=s(379),i=s(1),r=s(40),o=s(10),c=s(0);const l=n.a.ofType(),d=(e,t)=>{let{handleClick:s}=t;return Object(c.jsx)(a.B,{onClick:s,text:e.text},e.uuid)},u=(e,t)=>t.text.toLowerCase().includes(e.toLowerCase()),h=n.a.ofType(),p=(e,t)=>{let{handleClick:s}=t;return Object(c.jsx)(a.B,{onClick:s,text:e.name||e.username},e.courseRegId)},g=(e,t)=>[t.name,t.username,t.group].reduce(((t,s)=>s?t||s.toLowerCase().includes(e.toLowerCase()):t),!1);function m(){Object(o.d)("Goal updated")}t.a=function(e){const{userState:t,hiddenState:s,studio:n,getUsers:m,updateGoalProgress:b}=e,j="Staff"===n?[...e.users].sort(((e,t)=>null!=e.name&&null!=t.name?e.name.localeCompare(t.name):null==e.name?1:-1)):e.users.filter((e=>e.group===n)).sort(((e,t)=>null!=e.name&&null!=t.name?e.name.localeCompare(t.name):null==e.name?1:-1));Object(i.useEffect)(m,[m]);const y=Object(i.useContext)(r.a).getAllGoals().filter((e=>"Manual"===e.meta.type)),[O,f]=Object(i.useState)(void 0),[v,x]=t,[C,S]=Object(i.useState)(0),[w,E]=s;return Object(c.jsxs)("div",{className:"achievement-manual-editor",children:[Object(c.jsx)("h3",{children:"User: "}),Object(c.jsx)(h,{filterable:!0,items:j,itemRenderer:p,itemPredicate:g,onItemSelect:x,noResults:Object(c.jsx)(a.B,{disabled:!0,text:"No matching user"}),children:Object(c.jsx)(a.b,{outlined:!0,text:v?v.name||v.username:"No User Selected",color:"White"})}),Object(c.jsx)("h3",{children:"Goal: "}),Object(c.jsx)(l,{filterable:!0,items:y,itemRenderer:d,itemPredicate:u,onItemSelect:f,noResults:Object(c.jsx)(a.B,{disabled:!0,text:"No matching goal"}),children:Object(c.jsx)(a.b,{outlined:!0,text:O?O.text:"No Goal Selected",color:"White"})}),Object(c.jsx)("h3",{children:"Count: "}),Object(c.jsx)(a.H,{value:C,min:0,allowNumericCharactersOnly:!0,minorStepSize:null,placeholder:"Count",onValueChange:S}),Object(c.jsx)("h3",{children:" "}),Object(c.jsx)(a.b,{outlined:!0,text:"Update Goal",onClick:()=>{if(O&&v){const e={uuid:O.uuid,count:C<0?0:Math.floor(C),targetCount:O.targetCount,completed:C>=O.targetCount};b(v.courseRegId,e)}else!O&&Object(o.e)("Goal not selected"),!v&&Object(o.e)("User not selected")},intent:"primary"}),Object(c.jsx)("h3",{children:" "}),Object(c.jsx)(a.f,{checked:w,label:"View Hidden Achievements",onChange:()=>E(!w)})]})}},294:function(e,t,s){"use strict";s.r(t),s.d(t,"fetchGroupGradingSummary",(function(){return i})),s.d(t,"updateGroupGradingSummary",(function(){return r}));var a=s(7),n=s(157);const i=()=>Object(a.action)(n.a),r=e=>Object(a.action)(n.b,e)},299:function(e,t,s){"use strict";var a=s(100);const n={log:e=>function(){for(var t=arguments.length,s=new Array(t),n=0;n<t;n++)s[n]=arguments[n];e(s.map((e=>"string"===typeof e?e:Object(a.stringify)(e))).join(" "))}};const i=new class{constructor(){this.buffer=void 0,this.workspaceLocation=void 0,this.buffer=[]}dump(){const e=[...this.buffer];return this.resetBuffer(),e}push(e,t){this.handleWorkspaceChange(t),this.buffer.push(e)}attachConsole(e){const t=t=>this.push(t,e),s={};return Object.entries(n).forEach((e=>{let[a,n]=e;s[a]=console[a],console[a]=n(t)})),()=>{Object.entries(n).forEach((e=>{let[t]=e;console[t]=s[t]}))}}handleWorkspaceChange(e){this.hasWorkspace()&&e===this.workspaceLocation||(this.workspaceLocation=e,this.resetBuffer())}hasWorkspace(){return Boolean(this.workspaceLocation)}resetBuffer(){this.buffer=[]}};t.a=i},30:function(e,t,s){"use strict";s.d(t,"D",(function(){return u})),s.d(t,"w",(function(){return h})),s.d(t,"r",(function(){return p})),s.d(t,"N",(function(){return g})),s.d(t,"M",(function(){return m})),s.d(t,"E",(function(){return b})),s.d(t,"l",(function(){return j})),s.d(t,"f",(function(){return y})),s.d(t,"n",(function(){return O})),s.d(t,"t",(function(){return f})),s.d(t,"h",(function(){return v})),s.d(t,"a",(function(){return x})),s.d(t,"b",(function(){return C})),s.d(t,"X",(function(){return S})),s.d(t,"W",(function(){return w})),s.d(t,"Q",(function(){return E})),s.d(t,"S",(function(){return T})),s.d(t,"k",(function(){return k})),s.d(t,"v",(function(){return A})),s.d(t,"g",(function(){return I})),s.d(t,"x",(function(){return N})),s.d(t,"i",(function(){return M})),s.d(t,"B",(function(){return P})),s.d(t,"C",(function(){return R})),s.d(t,"p",(function(){return _})),s.d(t,"o",(function(){return L})),s.d(t,"F",(function(){return D})),s.d(t,"H",(function(){return B})),s.d(t,"G",(function(){return U})),s.d(t,"J",(function(){return G})),s.d(t,"s",(function(){return F})),s.d(t,"A",(function(){return H})),s.d(t,"u",(function(){return V})),s.d(t,"I",(function(){return W})),s.d(t,"d",(function(){return X})),s.d(t,"V",(function(){return $})),s.d(t,"c",(function(){return q})),s.d(t,"Y",(function(){return z})),s.d(t,"q",(function(){return Y})),s.d(t,"L",(function(){return K})),s.d(t,"j",(function(){return Q})),s.d(t,"K",(function(){return J})),s.d(t,"R",(function(){return Z})),s.d(t,"y",(function(){return ee})),s.d(t,"O",(function(){return te})),s.d(t,"P",(function(){return se})),s.d(t,"T",(function(){return ae})),s.d(t,"e",(function(){return ne})),s.d(t,"m",(function(){return ie})),s.d(t,"U",(function(){return re})),s.d(t,"z",(function(){return oe}));var a=s(2),n=s(89),i=s(26);const r=e=>({uuid:e.uuid||"",text:e.text||"",achievementUuids:e.achievementUuids,meta:"Event"===e.meta.type?{...e.meta,release:e.meta.release?new Date(e.meta.release):void 0,deadline:e.meta.deadline?new Date(e.meta.deadline):void 0,observeFrom:e.meta.observeFrom?new Date(e.meta.observeFrom):void 0,observeTo:e.meta.observeTo?new Date(e.meta.observeTo):void 0}:e.meta,count:e.count,targetCount:e.targetCount,completed:e.count>=e.targetCount});var o=s(18),c=s(8);var l=s(16),d=s(10);const u=async(e,t,s,a)=>{const n=await re("auth/login","POST",{body:{code:e,provider:t,...s?{client_id:s}:{},...a?{redirect_uri:a}:{}},errorMessage:"Could not login. Please contact the module administrator."});if(!n)return null;const i=await n.json();return{accessToken:i.access_token,refreshToken:i.refresh_token}},h=async e=>{const t=await re("user","GET",{...e,shouldRefresh:!0});return t&&t.ok?await t.json():{user:null,courseRegistration:null,courseConfiguration:null,assessmentConfigurations:null}},p=async e=>{const t=await re("user/latest_viewed_course","GET",{...e,shouldRefresh:!0});return t&&t.ok?await t.json():{courseRegistration:null,courseConfiguration:null,assessmentConfigurations:null}},g=async(e,t)=>await re("user/latest_viewed_course","PUT",{...e,body:{courseId:t},noHeaderAccept:!0,shouldAutoLogout:!1,shouldRefresh:!0}),m=async(e,t)=>await re(`${le()}/user/research_agreement`,"PUT",{...e,body:{agreedToResearch:t},noHeaderAccept:!0,shouldAutoLogout:!1,shouldRefresh:!0}),b=async(e,t)=>await re("config/create","POST",{...e,body:{...t},noHeaderAccept:!0,shouldAutoLogout:!1,shouldRefresh:!0}),j=async e=>{const t=await re(`${le()}/config`,"GET",{...e,shouldRefresh:!0});return t&&t.ok?t.json():null},y=async e=>{const t=await re(`${le()}/achievements`,"GET",{...e,shouldRefresh:!0});if(!t||!t.ok)return null;return(await t.json()).map((e=>(e=>({uuid:e.uuid||"",title:e.title||"",xp:e.xp,isVariableXp:e.isVariableXp,deadline:null===e.deadline?void 0:new Date(e.deadline),release:null===e.release?void 0:new Date(e.release),isTask:e.isTask,position:e.position,prerequisiteUuids:e.prerequisiteUuids,goalUuids:e.goalUuids,cardBackground:e.cardBackground||"",view:{coverImage:e.view.coverImage||"",completionText:e.view.completionText||"",description:e.view.description||""}}))(e)))},O=async(e,t)=>{const s=await re(`${le()}/admin/users/${t}/goals`,"GET",{...e,shouldRefresh:!0});if(!s||!s.ok)return null;return(await s.json()).map((e=>r(e)))},f=async e=>{const t=await re(`${le()}/self/goals`,"GET",{...e,shouldRefresh:!0});if(!t||!t.ok)return null;return(await t.json()).map((e=>r(e)))},v=async e=>{const t=await re(`${le()}/admin/users`,"GET",{...e,shouldRefresh:!0});if(!t||!t.ok)return null;return(await t.json()).map((e=>({name:e.name,courseRegId:e.courseRegId,group:e.group,username:e.username})))};async function x(e,t){return await re(`${le()}/admin/achievements`,"PUT",{accessToken:t.accessToken,body:{achievements:e.map((e=>(e=>({...e,deadline:e.deadline?e.deadline:null,release:e.release?e.release:null}))(e)))},noHeaderAccept:!0,refreshToken:t.refreshToken,shouldAutoLogout:!1,shouldRefresh:!0})}async function C(e,t){return await re(`${le()}/admin/goals`,"PUT",{accessToken:t.accessToken,body:{goals:e.map((e=>(e=>({targetCount:e.meta.type===i.l.ASSESSMENT?1:e.meta.targetCount,meta:e.meta,text:e.text,type:e.meta.type,uuid:e.uuid}))(e)))},noHeaderAccept:!0,refreshToken:t.refreshToken,shouldAutoLogout:!1,shouldRefresh:!0})}const S=async(e,t)=>await re(`${le()}/self/goals/${e.uuid}/progress`,"POST",{...t,body:{progress:e},noHeaderAccept:!0,shouldAutoLogout:!1,shouldRefresh:!0}),w=async(e,t,s)=>await re(`${le()}/admin/users/${e}/goals/${t.uuid}/progress`,"POST",{...s,body:{progress:t},noHeaderAccept:!0,shouldAutoLogout:!1,shouldRefresh:!0}),E=async(e,t)=>await re(`${le()}/admin/achievements/${e}`,"DELETE",{...t,body:{uuid:e},noHeaderAccept:!0,shouldAutoLogout:!1,shouldRefresh:!0}),T=async(e,t)=>await re(`${le()}/admin/goals/${e}`,"DELETE",{...t,body:{uuid:e},noHeaderAccept:!0,shouldAutoLogout:!1,shouldRefresh:!0}),k=async e=>{const t=await re(`${le()}/assessments`,"GET",{...e,shouldRefresh:!0});if(!t||!t.ok)return null;return(await t.json()).map((e=>(e.gradingStatus=ce(e.isManuallyGraded,e.status,e.gradedCount,e.questionCount),delete e.gradedCount,delete e.questionCount,e)))},A=async(e,t)=>{let s;if(s=void 0!==t?await re(`${le()}/admin/users/${t}/total_xp`,"GET",{...e,shouldRefresh:!0}):await re(`${le()}/user/total_xp`,"GET",{...e,shouldRefresh:!0}),!s||!s.ok)return null;return await s.json()},I=async e=>{const t=await re(`${le()}/admin/users/total_xp`,"GET",{...e,shouldRefresh:!0});if(!t||!t.ok)return null;return await t.json()},N=async(e,t)=>{const s=await re(`${le()}/admin/users/${e}/assessments`,"GET",{...t,shouldRefresh:!0});if(!s||!s.ok)return null;return(await s.json()).map((e=>(e.gradingStatus=ce(e.isManuallyGraded,e.status,e.gradedCount,e.questionCount),delete e.gradedCount,delete e.questionCount,e)))},M=async(e,t,s)=>{let a;for(a=void 0!==s?await re(`${le()}/admin/users/${s}/assessments/${e}`,"GET",{...t,shouldRefresh:!0}):await re(`${le()}/assessments/${e}`,"GET",{...t,shouldAutoLogout:!1,shouldRefresh:!0});a&&403===a.status;){const s=window.prompt("Please enter password.","");if(!s)return a=null,window.history.back(),null;a=await re(`${le()}/assessments/${e}/unlock`,"POST",{...t,body:{password:s},shouldAutoLogout:!1,shouldRefresh:!0})}if(!a||!a.ok)return null;const n=await a.json();return n.questions=n.questions.map((e=>{if(e.type===o.d.programming){const t=e;t.autogradingResults=t.autogradingResults||[],t.prepend=t.prepend||"",t.postpend=t.postpend||"",t.testcases=t.testcases||[],e=t}if(e.type===o.d.voting){const t=e;t.prepend=t.prepend||"",t.postpend=t.postpend||""}return null===e.grader&&(delete e.grader,delete e.gradedAt),e.library.external.name=e.library.external.name.toUpperCase(),e.library.globals=Object.entries(e.library.globals).map((e=>{try{e[1]=window.eval(e[1])}catch(t){}return e})),e})),n},P=async(e,t,s)=>await re(`${le()}/assessments/question/${e}/answer`,"POST",{...s,body:"object"==typeof t?{answer:t}:{answer:`${t}`},noHeaderAccept:!0,shouldAutoLogout:!1,shouldRefresh:!0}),R=async(e,t)=>await re(`${le()}/assessments/${e}/submit`,"POST",{...t,noHeaderAccept:!0,shouldAutoLogout:!1,shouldRefresh:!0}),_=async(e,t)=>{const s=await re(`${le()}/admin/grading?group=${t}`,"GET",{...e,shouldRefresh:!0});if(!s)return null;return(await s.json()).map((e=>{const t={assessmentId:e.assessment.id,assessmentName:e.assessment.title,assessmentType:e.assessment.type,studentId:e.student.id,studentName:e.student.name,submissionId:e.id,submissionStatus:e.status,groupName:e.student.groupName,groupLeaderId:e.student.groupLeaderId,gradingStatus:"none",questionCount:e.assessment.questionCount,gradedCount:e.gradedCount,initialXp:e.xp,xpAdjustment:e.xpAdjustment,currentXp:e.xp+e.xpAdjustment,maxXp:e.assessment.maxXp,xpBonus:e.xpBonus};return t.gradingStatus=ce(e.assessment.isManuallyGraded,t.submissionStatus,t.gradedCount,t.questionCount),t})).sort(((e,t)=>e.assessmentId!==t.assessmentId?t.assessmentId-e.assessmentId:t.submissionId-e.submissionId))},L=async(e,t)=>{const s=await re(`${le()}/admin/grading/${e}`,"GET",{...t,shouldRefresh:!0});if(!s)return null;return(await s.json()).map((e=>{const{student:t,question:s,grade:a}=e,n={question:{answer:s.answer,autogradingResults:s.autogradingResults||[],choices:s.choices,content:s.content,id:s.id,library:(i=s.library,{external:{name:i.external.name.toUpperCase(),symbols:i.external.symbols},execTimeMs:null==i.execTimeMs?void 0:i.execTimeMs,variant:null==i.variant?void 0:i.variant,globals:Object.entries(i.globals).map((e=>{try{e[1]=window.eval(e[1])}catch(t){}return e}))}),solution:e.solution||s.solution||null,solutionTemplate:s.solutionTemplate,prepend:s.prepend||"",postpend:s.postpend||"",testcases:s.testcases||[],type:s.type,maxXp:s.maxXp},student:t,grade:{xp:a.xp,xpAdjustment:a.xpAdjustment,comments:a.comments}};var i;return null!==e.grade.grader&&(n.grade.grader=e.grade.grader,n.grade.gradedAt=e.grade.gradedAt),n}))},D=async(e,t,s,a,n)=>await re(`${le()}/admin/grading/${e}/${t}`,"POST",{...a,body:{grading:{xpAdjustment:s,comments:n}},noHeaderAccept:!0,shouldAutoLogout:!1,shouldRefresh:!0}),B=async(e,t)=>await re(`${le()}/admin/grading/${e}/autograde`,"POST",{...t,noHeaderAccept:!0,shouldAutoLogout:!1,shouldRefresh:!0}),U=async(e,t,s)=>await re(`${le()}/admin/grading/${e}/${t}/autograde`,"POST",{...s,noHeaderAccept:!0,shouldAutoLogout:!1,shouldRefresh:!0}),G=async(e,t)=>await re(`${le()}/admin/grading/${e}/unsubmit`,"POST",{...t,noHeaderAccept:!0,shouldAutoLogout:!1,shouldRefresh:!0}),F=async e=>{const t=await re(`${le()}/notifications`,"GET",{...e,shouldAutoLogout:!1});let s=[];if(!t||!t.ok)return s;return s=(await t.json()).map((e=>({id:e.id,type:e.type,assessment_id:e.assessment_id||void 0,assessment_type:e.assessment?e.assessment.type:void 0,assessment_title:e.assessment?e.assessment.title:void 0,submission_id:e.submission_id||void 0}))),s},H=async(e,t)=>await re(`${le()}/notifications/acknowledge`,"POST",{...e,body:{notificationIds:t},shouldAutoLogout:!1}),V=async e=>{const t=await re(`${le()}/sourcecast`,"GET",{...e,shouldAutoLogout:!1,shouldRefresh:!0});return t&&t.ok?await t.json():null},W=async(e,t,s,a,n,i)=>{const r=new FormData,o=Date.now().toString()+".wav";r.append("sourcecast[title]",e),r.append("sourcecast[description]",t),r.append("sourcecast[uid]",s),r.append("sourcecast[audio]",a,o),r.append("sourcecast[playbackData]",JSON.stringify(n));return await re(`${le()}/admin/sourcecast`,"POST",{...i,body:r,noContentType:!0,noHeaderAccept:!0,shouldAutoLogout:!1,shouldRefresh:!0})},X=async(e,t)=>await re(`${le()}/admin/sourcecast/${e}`,"DELETE",{...t,noHeaderAccept:!0,shouldAutoLogout:!1,shouldRefresh:!0}),$=async(e,t,s)=>await re(`${le()}/admin/assessments/${e}`,"POST",{...s,body:t,noHeaderAccept:!0,shouldAutoLogout:!1,shouldRefresh:!0}),q=async(e,t)=>await re(`${le()}/admin/assessments/${e}`,"DELETE",{...t,noHeaderAccept:!0,shouldAutoLogout:!1,shouldRefresh:!0}),z=async(e,t,s,a)=>{const n=new FormData;n.append("assessment[file]",e),n.append("forceUpdate",String(s)),n.append("assessmentConfigId",String(a));return await re(`${le()}/admin/assessments`,"POST",{...t,body:n,noContentType:!0,noHeaderAccept:!0,shouldAutoLogout:!1,shouldRefresh:!0})},Y=async e=>{const t=await re(`${le()}/admin/grading/summary`,"GET",{...e,shouldRefresh:!0});return t&&t.ok?await t.json():null},K=async(e,t)=>await re(`${le()}/admin/config`,"PUT",{...e,body:t,noHeaderAccept:!0,shouldAutoLogout:!1,shouldRefresh:!0}),Q=async e=>{const t=await re(`${le()}/admin/config/assessment_configs`,"GET",{...e,shouldRefresh:!0});return t&&t.ok?await t.json():null},J=async(e,t,s)=>await re(`${null!=s?`courses/${s}`:le()}/admin/config/assessment_configs`,"PUT",{...e,body:{assessmentConfigs:t},noHeaderAccept:!0,shouldAutoLogout:!1,shouldRefresh:!0}),Z=async(e,t)=>await re(`${le()}/admin/config/assessment_config/${t.assessmentConfigId}`,"DELETE",{...e,noHeaderAccept:!0,shouldAutoLogout:!1,shouldRefresh:!0}),ee=async e=>{const t=await re(`${le()}/admin/users`,"GET",{...e,shouldRefresh:!0});return t&&t.ok?await t.json():null},te=async(e,t,s)=>await re(`${le()}/admin/users`,"PUT",{...e,body:{users:t,provider:s},noHeaderAccept:!0,shouldAutoLogout:!1,shouldRefresh:!0}),se=async(e,t,s)=>await re(`${le()}/admin/users/${t}/role`,"PUT",{...e,body:{role:s},noHeaderAccept:!0,shouldAutoLogout:!1,shouldRefresh:!0}),ae=async(e,t)=>await re(`${le()}/admin/users/${t}`,"DELETE",{...e,noHeaderAccept:!0,shouldAutoLogout:!1,shouldRefresh:!0});async function ne(e){const t=await re("devices","GET",{accessToken:e.accessToken,refreshToken:e.refreshToken,shouldRefresh:!0});return t&&t.ok?t.json():null}async function ie(e,t){const s=await re(`devices/${e.id}/ws_endpoint`,"GET",{accessToken:t.accessToken,refreshToken:t.refreshToken,shouldRefresh:!0,shouldAutoLogout:!1});return s&&s.ok?s.json():null}const re=async(e,t,s)=>{const a=new Headers;s.noHeaderAccept||a.append("Accept","application/json"),s.accessToken&&a.append("Authorization",`Bearer ${s.accessToken}`);const i={method:t,headers:a};s.body&&(s.noContentType?i.body=s.body:(a.append("Content-Type","application/json"),i.body=JSON.stringify(s.body)));try{const a=await fetch(`${l.b.backendUrl}/v2/${e}`,i);if(s.shouldRefresh&&a&&401===a.status){const a=await(async e=>{const t=await re("auth/refresh","POST",{body:{refresh_token:e}});if(!t)return null;const s=await t.json();return{accessToken:s.access_token,refreshToken:s.refresh_token}})(s.refreshToken);n.a.dispatch(c.a.setTokens(a));const i={...s,accessToken:a.accessToken,shouldRefresh:!1};return re(e,t,i)}return a&&!a.ok&&!1===s.shouldAutoLogout||a.ok?a:(Object(d.e)(s.errorMessage?s.errorMessage:`Error while communicating with backend: ${a.status} ${a.statusText}${401===a.status||403===a.status?"; try logging in again, after manually saving any work.":""}`),null)}catch(r){return Object(d.e)(s.errorMessage?s.errorMessage:"Error while communicating with backend; check your network?"),null}};function*oe(e){if(!e)return void(yield Object(a.a)(d.e,"Couldn't reach our servers. Are you online?"));let t=yield e.text();t.length>100&&e.status&&(t=`Something went wrong (got ${e.status} response)`),yield Object(a.a)(d.e,t)}const ce=(e,t,s,a)=>e&&"submitted"===t?0===s?"none":s===a?"graded":"grading":"excluded",le=()=>{const e=n.a.getState().session.courseId;if(e)return`courses/${e}`;throw Object(d.e)("No course selected!",1e3),new Error("No course selected")}},300:function(e,t,s){"use strict";var a=s(3),n=s(42),i=s(20),r=s.n(i),o=s(88),c=s(1),l=s(136),d=s(148),u=s.n(d),h=s(208),p=s.n(h),g=s(227),m=s(0);const b=e=>{const{onFocus:t,onBlur:s}=e,n=c.useRef(null),i=c.useRef(null),o=e.handleBrowseHistoryDown,l=e.handleBrowseHistoryUp;c.useEffect((()=>{if(!n.current)return;const e=n.current.editor;t&&e.on("focus",(()=>t(e))),s&&e.on("blur",s)})),c.useEffect((()=>{i.current&&!e.disableScrolling&&(i.current.clientWidth>=window.innerWidth-50||i.current.scrollIntoView())})),Object(g.b)(e.sourceChapter,e.sourceVariant,e.externalLibrary);return Object(m.jsxs)(m.Fragment,{children:[Object(m.jsx)(u.a,{className:"repl-react-ace react-ace",mode:Object(g.a)(e.sourceChapter,e.sourceVariant,e.externalLibrary),theme:"source",height:"1px",width:"100%",value:e.replValue,onChange:e.handleReplValueChange,commands:[{name:"browseHistoryDown",bindKey:{win:"Down",mac:"Down"},exec:o},{name:"browseHistoryUp",bindKey:{win:"Up",mac:"Up"},exec:l},{name:"evaluate",bindKey:{win:"Shift-Enter",mac:"Shift-Enter"},exec:()=>{e.handleReplEval(),i.current&&!e.disableScrolling&&i.current.scrollIntoView()}}],minLines:1,maxLines:20,fontSize:17,highlightActiveLine:!1,showGutter:!1,showPrintMargin:!1,setOptions:{fontFamily:"'Inconsolata', 'Consolas', monospace"},ref:n}),Object(m.jsx)("div",{className:r()(a.a.BUTTON_GROUP,a.a.DARK),children:e.replButtons}),Object(m.jsx)(p.a,{minWidth:769,children:Object(m.jsx)("div",{ref:i})})]})},j=e=>{switch(e.output.type){case"code":return Object(m.jsx)(n.e,{children:Object(m.jsx)(n.M,{className:"code-output",children:e.output.value})});case"running":return Object(m.jsx)(n.e,{children:Object(m.jsx)(n.M,{className:"log-output",children:e.output.consoleLogs.join("\n")})});case"result":return e.usingSubst&&e.output.value instanceof Array?Object(m.jsx)(n.e,{children:Object(m.jsx)(n.M,{className:"log-output",children:"Check out the Stepper tab!"})}):0===e.output.consoleLogs.length?Object(m.jsx)(n.e,{children:Object(m.jsx)(n.M,{className:"result-output",children:e.output.value})}):Object(m.jsxs)(n.e,{children:[Object(m.jsx)(n.M,{className:"log-output",children:e.output.consoleLogs.join("\n")}),Object(m.jsx)(n.M,{className:"result-output",children:e.output.value})]});case"errors":return 0===e.output.consoleLogs.length?Object(m.jsx)(n.e,{children:Object(m.jsx)(n.M,{className:"error-output",children:Object(o.parseError)(e.output.errors)})}):Object(m.jsxs)(n.e,{children:[Object(m.jsx)(n.M,{className:"log-output",children:e.output.consoleLogs.join("\n")}),Object(m.jsx)("br",{}),Object(m.jsx)(n.M,{className:"error-output",children:Object(o.parseError)(e.output.errors)})]});default:return Object(m.jsx)(n.e,{children:"''"})}},y={goGreen:()=>{}};t.a=e=>{const t=e.output.map(((t,s)=>{var a;return Object(m.jsx)(j,{output:t,usingSubst:null!==(a=e.usingSubst)&&void 0!==a&&a},s)}));return Object(m.jsx)("div",{className:"Repl",style:{display:e.hidden?"none":void 0},children:Object(m.jsxs)("div",{className:"repl-output-parent",children:[t,!e.inputHidden&&Object(m.jsx)(l.HotKeys,{className:r()("repl-input-parent","row",a.a.CARD,a.a.ELEVATION_0),handlers:y,children:Object(m.jsx)(b,{...e})})]})})}},31:function(e,t,s){"use strict";s.d(t,"a",(function(){return a})),s.d(t,"b",(function(){return n})),s.d(t,"c",(function(){return i})),s.d(t,"d",(function(){return r})),s.d(t,"e",(function(){return o})),s.d(t,"f",(function(){return c})),s.d(t,"g",(function(){return l})),s.d(t,"h",(function(){return d})),s.d(t,"j",(function(){return u})),s.d(t,"k",(function(){return h})),s.d(t,"l",(function(){return p})),s.d(t,"m",(function(){return g})),s.d(t,"n",(function(){return m})),s.d(t,"o",(function(){return b})),s.d(t,"q",(function(){return j})),s.d(t,"w",(function(){return y})),s.d(t,"r",(function(){return O})),s.d(t,"s",(function(){return f})),s.d(t,"p",(function(){return v})),s.d(t,"t",(function(){return x})),s.d(t,"u",(function(){return C})),s.d(t,"v",(function(){return S})),s.d(t,"x",(function(){return w})),s.d(t,"y",(function(){return E})),s.d(t,"z",(function(){return T})),s.d(t,"A",(function(){return k})),s.d(t,"B",(function(){return A})),s.d(t,"D",(function(){return I})),s.d(t,"E",(function(){return N})),s.d(t,"C",(function(){return M})),s.d(t,"G",(function(){return P})),s.d(t,"F",(function(){return R})),s.d(t,"H",(function(){return _})),s.d(t,"I",(function(){return L})),s.d(t,"K",(function(){return D})),s.d(t,"J",(function(){return B})),s.d(t,"i",(function(){return U}));const a="ADD_HTML_CONSOLE_ERROR",n="BEGIN_CLEAR_CONTEXT",i="BROWSE_REPL_HISTORY_DOWN",r="BROWSE_REPL_HISTORY_UP",o="CHANGE_EXEC_TIME",c="CHANGE_EXTERNAL_LIBRARY",l="CHANGE_SIDE_CONTENT_HEIGHT",d="CHANGE_STEP_LIMIT",u="CHAPTER_SELECT",h="CLEAR_REPL_INPUT",p="CLEAR_REPL_OUTPUT",g="CLEAR_REPL_OUTPUT_LAST",m="END_CLEAR_CONTEXT",b="EVAL_EDITOR",j="EVAL_REPL",y="PROMPT_AUTOCOMPLETE",O="EVAL_SILENT",f="EVAL_TESTCASE",v="EVAL_EDITOR_AND_TESTCASES",x="MOVE_CURSOR",C="NAV_DECLARATION",S="PLAYGROUND_EXTERNAL_SELECT ",w="RESET_TESTCASE",E="RESET_WORKSPACE",T="SEND_REPL_INPUT_TO_OUTPUT",k="TOGGLE_EDITOR_AUTORUN",A="TOGGLE_USING_SUBST",I="UPDATE_CURRENT_ASSESSMENT_ID",N="UPDATE_CURRENT_SUBMISSION_ID",M="UPDATE_ACTIVE_EDITOR_TAB",P="UPDATE_EDITOR_VALUE",R="UPDATE_EDITOR_BREAKPOINTS",_="UPDATE_HAS_UNSAVED_CHANGES",L="UPDATE_REPL_VALUE",D="UPDATE_WORKSPACE",B="UPDATE_SUBLANGUAGE",U="CHANGE_SUBLANGUAGE"},35:function(e,t,s){"use strict";s.d(t,"d",(function(){return c})),s.d(t,"b",(function(){return l})),s.d(t,"c",(function(){return d})),s.d(t,"f",(function(){return u})),s.d(t,"a",(function(){return h})),s.d(t,"e",(function(){return p}));var a=s(1),n=s.n(a),i=s(34),r=s(208),o=s(16);function c(e,t){const[s,a]=n.a.useState(t);return n.a.useEffect((()=>{(async()=>{const t=await e();a(t)})()}),[e]),{value:s,setValue:a}}function l(e){const[t,s]=n.a.useState(e);return{value:t,setValue:s,inputProps:{value:t,onChange:e=>{s(e.target.value)}}}}function d(e,t){const[s,a]=n.a.useState(((e,t)=>{const s=window.localStorage.getItem(e);return s?JSON.parse(s):t})(e,t));return n.a.useEffect((()=>{((e,t)=>{window.localStorage.setItem(e,JSON.stringify(t))})(e,s)}),[e,s]),[s,a]}const u=i.d,h=e=>{const[t,s]=n.a.useState(0),[a,i]=n.a.useState(0),r=n.a.useMemo((()=>new ResizeObserver(((e,t)=>{if(1!==e.length)throw new Error("Expected only a single HTML element to be observed by the ResizeObserver.");const a=e[0].contentRect;s(a.width),i(a.height)}))),[]);return n.a.useEffect((()=>{const t=e.current;if(null!==t)return r.observe(t),()=>r.disconnect()}),[e,r]),[t,a]},p=()=>({isMobileBreakpoint:Object(r.useMediaQuery)({maxWidth:o.b.mobileBreakpoint})})},37:function(e,t,s){"use strict";s.d(t,"d",(function(){return a})),s.d(t,"f",(function(){return n})),s.d(t,"e",(function(){return i})),s.d(t,"g",(function(){return r})),s.d(t,"h",(function(){return o})),s.d(t,"i",(function(){return c})),s.d(t,"j",(function(){return l})),s.d(t,"a",(function(){return d})),s.d(t,"b",(function(){return u})),s.d(t,"c",(function(){return h}));const a="SAVE_SOURCECAST_DATA",n="SET_CURRENT_PLAYER_TIME",i="SET_CODE_DELTAS_TO_APPLY",r="SET_INPUT_TO_APPLY",o="SET_SOURCECAST_DATA",c="SET_SOURCECAST_PLAYBACK_DURATION",l="SET_SOURCECAST_PLAYBACK_STATUS";let d,u,h;!function(e){e.run="run"}(d||(d={})),function(e){e.forcedPaused="forcedPaused",e.playing="playing",e.paused="paused"}(u||(u={})),function(e){e.notStarted="notStarted",e.recording="recording",e.paused="paused",e.finished="finished"}(h||(h={}))},38:function(e,t,s){"use strict";s.r(t),s.d(t,"fetchAuth",(function(){return r})),s.d(t,"fetchUserAndCourse",(function(){return o})),s.d(t,"fetchCourseConfig",(function(){return c})),s.d(t,"fetchAssessment",(function(){return l})),s.d(t,"fetchAssessmentAdmin",(function(){return d})),s.d(t,"fetchAssessmentOverviews",(function(){return u})),s.d(t,"fetchTotalXp",(function(){return h})),s.d(t,"fetchTotalXpAdmin",(function(){return p})),s.d(t,"fetchAllUserXp",(function(){return g})),s.d(t,"fetchGrading",(function(){return m})),s.d(t,"fetchGradingOverviews",(function(){return b})),s.d(t,"login",(function(){return j})),s.d(t,"logoutGoogle",(function(){return y})),s.d(t,"loginGitHub",(function(){return O})),s.d(t,"logoutGitHub",(function(){return f})),s.d(t,"setTokens",(function(){return v})),s.d(t,"setUser",(function(){return x})),s.d(t,"setCourseConfiguration",(function(){return C})),s.d(t,"setCourseRegistration",(function(){return S})),s.d(t,"setAssessmentConfigurations",(function(){return w})),s.d(t,"setAdminPanelCourseRegistrations",(function(){return E})),s.d(t,"setGoogleUser",(function(){return T})),s.d(t,"setGitHubAssessment",(function(){return k})),s.d(t,"setGitHubOctokitObject",(function(){return A})),s.d(t,"setGitHubAccessToken",(function(){return I})),s.d(t,"removeGitHubOctokitObjectAndAccessToken",(function(){return N})),s.d(t,"submitAnswer",(function(){return M})),s.d(t,"submitAssessment",(function(){return P})),s.d(t,"submitGrading",(function(){return R})),s.d(t,"submitGradingAndContinue",(function(){return _})),s.d(t,"reautogradeSubmission",(function(){return L})),s.d(t,"reautogradeAnswer",(function(){return D})),s.d(t,"updateAssessmentOverviews",(function(){return B})),s.d(t,"updateTotalXp",(function(){return U})),s.d(t,"updateAllUserXp",(function(){return G})),s.d(t,"updateAssessment",(function(){return F})),s.d(t,"updateGradingOverviews",(function(){return H})),s.d(t,"updateGrading",(function(){return V})),s.d(t,"unsubmitSubmission",(function(){return W})),s.d(t,"fetchNotifications",(function(){return X})),s.d(t,"acknowledgeNotifications",(function(){return $})),s.d(t,"updateNotifications",(function(){return q})),s.d(t,"updateLatestViewedCourse",(function(){return z})),s.d(t,"updateCourseConfig",(function(){return Y})),s.d(t,"fetchAssessmentConfigs",(function(){return K})),s.d(t,"updateAssessmentConfigs",(function(){return Q})),s.d(t,"deleteAssessmentConfig",(function(){return J})),s.d(t,"fetchAdminPanelCourseRegistrations",(function(){return Z})),s.d(t,"updateUserRole",(function(){return ee})),s.d(t,"deleteUserCourseRegistration",(function(){return te})),s.d(t,"updateCourseResearchAgreement",(function(){return se}));var a=s(7),n=s(282),i=s(15);const r=(e,t)=>Object(a.action)(i.j,{code:e,providerId:t}),o=()=>Object(a.action)(i.q),c=()=>Object(a.action)(i.k),l=e=>Object(a.action)(i.f,e),d=(e,t)=>Object(a.action)(i.g,{assessmentId:e,courseRegId:t}),u=()=>Object(a.action)(i.i),h=()=>Object(a.action)(i.o),p=e=>Object(a.action)(i.p,e),g=()=>Object(a.action)(i.e),m=e=>Object(a.action)(i.l,e),b=function(){let e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];return Object(a.action)(i.m,e)},j=e=>Object(a.action)(i.r,e),y=()=>Object(a.action)(i.u),O=()=>Object(a.action)(i.s),f=()=>Object(a.action)(i.t),v=e=>{let{accessToken:t,refreshToken:s}=e;return Object(a.action)(i.G,{accessToken:t,refreshToken:s})},x=e=>Object(a.action)(i.H,e),C=e=>Object(a.action)(i.A,e),S=e=>Object(a.action)(i.B,e),w=e=>Object(a.action)(i.z,e),E=e=>Object(a.action)(i.y,e),T=e=>Object(a.action)(i.F,e),k=e=>Object(a.action)(i.D,e),A=e=>Object(a.action)(i.E,Object(n.a)(e||"")),I=e=>Object(a.action)(i.C,e),N=()=>Object(a.action)(i.x),M=(e,t)=>Object(a.action)(i.I,{id:e,answer:t}),P=e=>Object(a.action)(i.J,e),R=function(e,t){let s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,n=arguments.length>3?arguments[3]:void 0;return Object(a.action)(i.K,{submissionId:e,questionId:t,xpAdjustment:s,comments:n})},_=function(e,t){let s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,n=arguments.length>3?arguments[3]:void 0;return Object(a.action)(i.L,{submissionId:e,questionId:t,xpAdjustment:s,comments:n})},L=e=>Object(a.action)(i.w,e),D=(e,t)=>Object(a.action)(i.v,{submissionId:e,questionId:t}),B=e=>Object(a.action)(i.Q,e),U=e=>Object(a.action)(i.X,e),G=e=>Object(a.action)(i.N,e),F=e=>Object(a.action)(i.O,e),H=e=>Object(a.action)(i.U,e),V=(e,t)=>Object(a.action)(i.T,{submissionId:e,grading:t}),W=e=>Object(a.action)(i.M,{submissionId:e}),X=()=>Object(a.action)(i.n),$=e=>Object(a.action)(i.a,{withFilter:e}),q=e=>Object(a.action)(i.W,e),z=e=>Object(a.action)(i.V,{courseId:e}),Y=e=>Object(a.action)(i.R,e),K=()=>Object(a.action)(i.h),Q=e=>Object(a.action)(i.P,e),J=e=>Object(a.action)(i.b,e),Z=()=>Object(a.action)(i.d),ee=(e,t)=>Object(a.action)(i.Y,{courseRegId:e,role:t}),te=e=>Object(a.action)(i.c,{courseRegId:e}),se=e=>Object(a.action)(i.S,{agreedToResearch:e})},40:function(e,t,s){"use strict";s.d(t,"a",(function(){return o})),s.d(t,"b",(function(){return c})),s.d(t,"c",(function(){return h})),s.d(t,"d",(function(){return p})),s.d(t,"e",(function(){return g})),s.d(t,"f",(function(){return m})),s.d(t,"g",(function(){return b})),s.d(t,"h",(function(){return j})),s.d(t,"i",(function(){return y})),s.d(t,"j",(function(){return O}));var a=s(1),n=s.n(a),i=s(171),r=s(16);const o=n.a.createContext(new i.a([],[]));let c,l;!function(e){e.RED="#f00",e.BLACK="#000"}(c||(c={})),function(e){e.BLUE="#4df",e.WHITE="#fff"}(l||(l={}));const d=`${r.a.sourceAcademyAssets}achievement`,u=`${d}/view-background`,h=`${d}/card-background`,p=`${d}/cover-image`,g=()=>({background:`url(${u}/exploration.png) no-repeat center/cover`}),m=()=>"#9ce",b=()=>({border:`1px solid ${m()}`,boxShadow:`0 0 10px ${m()}`}),j=(e,t)=>e===t?l.BLUE:l.WHITE,y=(e,t)=>e===t?b():void 0,O=1e3},45:function(e,t,s){"use strict";var a=s(3),n=s(20),i=s.n(n),r=s(1),o=s(514),c=s(0);const l=e=>{const t=new o.Converter({tables:!0,simplifiedAutoLink:e.simplifiedAutoLink,strikethrough:e.strikethrough,tasklists:e.tasklists,openLinksInNewWindow:e.openLinksInNewWindow});return Object(c.jsx)("div",{className:i()(e.className?e.className:"md",a.a.RUNNING_TEXT),dangerouslySetInnerHTML:{__html:t.makeHtml(e.content)}})};t.a=r.memo(l)},480:function(e,t){},52:function(e,t,s){"use strict";s.d(t,"a",(function(){return n}));var a=s(107);const n=Object(a.a)()},522:function(e,t,s){"use strict";(function(e){var a=s(42),n=s(122),i=s(1),r=s(25),o=s(35),c=s(93),l=s(531),d=s(10),u=s(55),h=s(523),p=s(527),g=s(524),m=s(0);async function b(t,s,a){const n=(await t.users.getAuthenticated()).data.login,i="source-academy-course-".concat(s),r=(await t.repos.listForAuthenticatedUser({per_page:100})).data,o=r.filter((e=>e.owner.login===i)).find((e=>e.name.includes("course-info")));if(void 0===o)return void Object(d.e)("The course-info repository cannot be located.",2e3);const c=(await t.repos.getContent({owner:o.owner.login,repo:o.name,path:""})).data;if(Array.isArray(c)){if(!c.find((e=>"course-info.json"===e.name)))return void Object(d.e)("The course-info.json file cannot be located.",2e3);{const s=await t.repos.getContent({owner:o.owner.login,repo:o.name,path:"course-info.json"}),i=JSON.parse(e.from(s.data.content,"base64").toString());i.types.forEach((e=>{const t=[];e.assessments.forEach((e=>{if(!e.published)return;const s=e.repoPrefix+"-"+n,a=r.find((e=>e.name===s));let i,c=new Date;void 0===a?i=e.acceptLink:null!==a.created_at&&(c=new Date(a.created_at)),t.push({title:e.title,coverImage:e.coverImage,webSummary:e.shortSummary,missionRepoData:{repoOwner:o.owner.login,repoName:s,dateOfCreation:c},dueDate:new Date(e.closeAt),link:i}),t.sort(((e,t)=>e.dueDate<=t.dueDate?-1:1))})),e.assessments=t})),a(i.types)}}}t.a=e=>{var t,s,d;const j=Object(r.i)(),y=Object(o.f)((e=>e.session.githubOctokitObject)).octokit,[O,f]=Object(i.useState)(null===(t=j.state)||void 0===t?void 0:t.courses),[v,x]=Object(i.useState)((null===(s=j.state)||void 0===s?void 0:s.selectedCourse)||""),[C,S]=Object(i.useState)(null===(d=j.state)||void 0===d?void 0:d.assessmentTypeOverviews),w=null===C||void 0===C?void 0:C.map((e=>e.typeName));Object(i.useEffect)((()=>{void 0!==y&&(O||async function(e,t,s,a){const n=[],i=(await e.orgs.listForAuthenticatedUser({per_page:100})).data;i.filter((e=>e.login.includes("source-academy-course"))).forEach((e=>{n.push(e.login.replace("source-academy-course-",""))})),t(n),n.length>0&&(s(n[0]),b(e,n[0],a))}(y,f,x,S))}),[O,y]);const E=i.useCallback((e=>{void 0!==y&&(b(y,e.target.innerText,S),x(e.target.innerText))}),[y,x,S]),T=()=>{void 0!==y&&b(y,v,S)},k=()=>Object(m.jsx)(r.b,{to:"/githubassessments/login"}),A=()=>Object(m.jsx)(r.b,{to:{pathname:`/githubassessments/${Object(u.a)(w?w[0]:"welcome")}`,state:{courses:O,assessmentTypeOverviews:C,selectedCourse:v}}});return Object(m.jsxs)("div",{className:"Academy",style:{overflow:"hidden"},children:[Object(m.jsx)(l.a,{changeCourseHandler:E,handleGitHubLogIn:e.handleGitHubLogIn,handleGitHubLogOut:()=>{e.handleGitHubLogOut(),f(void 0),S(void 0),x("")},octokit:y,courses:O,selectedCourse:v,types:w,assessmentTypeOverviews:C}),Object(m.jsxs)(r.e,{children:[Object(m.jsx)(r.c,{path:"/githubassessments/login",render:()=>y&&(!O||O.length>0&&!C)?Object(m.jsx)(c.a,{display:Object(m.jsx)(a.G,{description:"Loading...",icon:Object(m.jsx)(a.R,{})}),loadContentDispatch:()=>{}}):y&&O&&0===O.length?Object(m.jsx)(r.b,{to:"/githubassessments/welcome"}):y?A():Object(m.jsx)(c.a,{display:Object(m.jsx)(a.G,{description:"Please sign in to GitHub.",icon:n.a.WARNING_SIGN}),loadContentDispatch:()=>{}})}),Object(m.jsx)(r.c,{path:"/githubassessments/welcome",component:()=>y?Object(m.jsx)(g.a,{}):k()}),Object(m.jsx)(r.c,{path:"/githubassessments/editor",component:p.a}),y?null===w||void 0===w?void 0:w.map(((e,t)=>{const s=C?C[t].assessments:void 0;return Object(m.jsx)(r.c,{path:`/githubassessments/${Object(u.a)(e)}`,render:()=>Object(m.jsx)(h.a,{assessmentOverviews:s,refreshAssessmentOverviews:T})},t)})):null,Object(m.jsx)(r.c,{render:y&&O&&O.length>0?A:k})]})]})}}).call(this,s(74).Buffer)},523:function(e,t,s){"use strict";var a=s(42),n=s(139),i=s(122),r=s(1),o=s(35),c=s(211),l=s(93),d=s(45),u=s(52),h=s(0);t.a=e=>{const{isMobileBreakpoint:t}=Object(o.e)();let s;const p=Object(r.useMemo)((()=>Object(h.jsx)(a.b,{icon:i.a.ADD,onClick:()=>u.a.push("/githubassessments/editor"),children:"Create a New Assessment!"})),[]),g=Object(r.useMemo)((()=>Object(h.jsx)(a.b,{icon:i.a.REFRESH,onClick:e.refreshAssessmentOverviews,children:"Refresh Assessments"})),[e.refreshAssessmentOverviews]);if(e.assessmentOverviews)if(0===e.assessmentOverviews.length)s=Object(h.jsxs)(h.Fragment,{children:[p,g,Object(h.jsx)(a.G,{title:"There are no assessments.",icon:i.a.FLAME})]});else{const r=e.assessmentOverviews.map((e=>function(e,t){const s=t?5:3,r=e.missionRepoData.repoOwner+"/"+e.missionRepoData.repoName,o=e.dueDate.toDateString(),l=new Date(864e13)>e.dueDate,p=new Date>e.dueDate,g=void 0!==e.link;let m="Open",b=()=>u.a.push("/githubassessments/editor",e);g?(m="Accept",b=()=>window.open(e.link)):p&&(m="Review Answers");return Object(h.jsx)("div",{children:Object(h.jsxs)(a.e,{className:"row listing",elevation:n.a.ONE,children:[Object(h.jsx)("div",{className:`col-xs-${String(s)} listing-picture`,children:Object(h.jsx)("img",{alt:"Assessment",className:`cover-image-${e.title}`,src:e.coverImage?e.coverImage:c.a})}),Object(h.jsxs)("div",{className:`col-xs-${String(12-s)} listing-text`,children:[Object(h.jsx)("div",{className:"listing-header",children:Object(h.jsxs)(a.Y,{ellipsize:!0,children:[Object(h.jsx)(a.r,{className:"listing-title",children:e.title}),Object(h.jsx)(a.t,{children:r})]})}),Object(h.jsx)("div",{className:"listing-description",children:Object(h.jsx)(d.a,{content:e.webSummary})}),Object(h.jsxs)("div",{className:"listing-footer",children:[Object(h.jsxs)(a.Y,{className:"listing-due-date",children:[Object(h.jsx)(a.w,{className:"listing-due-icon",iconSize:12,icon:i.a.TIME}),l?"Due: "+o:"No due date"]}),Object(h.jsx)("div",{className:"listing-button",children:Object(h.jsx)(a.b,{icon:i.a.PLAY,minimal:!0,onClick:b,children:Object(h.jsx)("span",{className:"custom-hidden-xxxs",children:m})})})]})]})]})},r)}(e,t)));s=Object(h.jsxs)(h.Fragment,{children:[p,g,r]})}else s=Object(h.jsxs)(h.Fragment,{children:[p,Object(h.jsx)(a.G,{description:"Fetching assessment...",icon:Object(h.jsx)(a.R,{})})]});return Object(h.jsx)("div",{className:"Assessment",style:{overflow:"auto"},children:Object(h.jsx)(l.a,{display:s,loadContentDispatch:()=>{}})})}},524:function(e,t,s){"use strict";var a=s(42),n=s(0);t.a=()=>Object(n.jsx)("div",{className:"github-welcome",children:Object(n.jsx)(a.e,{className:"github-welcome-content",children:Object(n.jsx)("div",{style:{marginTop:"20px",display:"flex",justifyContent:"center"},children:Object(n.jsxs)("div",{children:[Object(n.jsx)(a.p,{children:"Welcome to Source Academy with GitHub Classroom!"}),Object(n.jsx)("br",{}),Object(n.jsx)(a.r,{children:"Source Academy does not find any course information for this account."}),Object(n.jsx)("div",{style:{display:"flex",justifyContent:"center"},children:Object(n.jsxs)(a.cb,{style:{textAlign:"justify"},children:[Object(n.jsx)("li",{children:"If you are enrolled in a Source Academy course that uses GitHub Classroom, check with the course staff to make sure your account is added to the course."}),Object(n.jsxs)("li",{children:["If you are looking for a course to join, check"," ",Object(n.jsx)("a",{href:"https://about.sourceacademy.org/learner/README.html",children:"here"})," to find a course that suits your needs."]})]})})]})})})})},527:function(e,t,s){"use strict";var a=s(27),n=s(34),i=s(25),r=s(44),o=s(13),c=s(42),l=s(3),d=s(122),u=s(20),h=s.n(u),p=s(33),g=s(1),m=s.n(g),b=s(35),j=s(71),y=s(125),O=s(110),f=s(111),v=s(173),x=s(169),C=s(170),S=s(212),w=s(147),E=s(213),T=s(12),k=s(0);const A=e=>{const t=e.mcqDisplayed?"Show MCQ Text":"Hide MCQ Text",s=e.mcqDisplayed?e.displayTextInEditor:e.displayMCQInEditor;return Object(k.jsx)(T.a,{label:t,icon:d.a.REFRESH,onClick:s})};var I=s(153),N=s(10);const M=e=>Object(k.jsx)(T.a,{label:"Add Task",icon:d.a.ADD,onClick:function(){e.numberOfTasks!==I.f?e.addNewQuestion():Object(N.e)("Cannot have more than "+I.f+" Tasks in a Mission!")}});var P=s(69);const R=e=>Object(k.jsx)(T.a,{label:"Delete Current Task",icon:d.a.DELETE,onClick:async function(){if(e.numberOfTasks<=1)return void Object(N.e)("Cannot delete the only remaining task!");await Object(P.b)({contents:Object(k.jsxs)("div",{children:[Object(k.jsx)("p",{children:"Warning: you are about to delete a task."}),Object(k.jsx)("p",{children:"This action cannot be undone."}),Object(k.jsx)("p",{children:"Please click 'Confirm' to continue, or 'Cancel' to go back."})]}),negativeLabel:"Cancel",positiveIntent:"primary",positiveLabel:"Confirm"})&&e.deleteCurrentQuestion()}});var _=s(97),L=s(103);const D=e=>{const[t,s]=Object(g.useState)("sa-new-mission-repository");return Object(k.jsxs)(c.h,{className:"missionBrowser",isOpen:!0,children:[Object(k.jsx)("div",{className:h()("githubDialogHeader",l.a.DIALOG_HEADER),children:Object(k.jsx)("h3",{children:"Please confirm your save"})}),Object(k.jsxs)("div",{className:h()("githubDialogBody",l.a.DIALOG_BODY),children:[Object(k.jsxs)("div",{children:[Object(k.jsxs)("h4",{children:["This will create a repository owned by ",e.userLogin," with the title:"]}),Object(k.jsx)(c.y,{onChange:function(e){s(e.target.value)},placeholder:"Enter Repository Title",value:t})]}),Object(k.jsxs)("div",{children:[Object(k.jsx)("h4",{children:"This repository will be created with following files:"}),e.filesToCreate.map((e=>Object(k.jsx)("li",{children:e},e)))]})]}),Object(k.jsx)("div",{className:h()(l.a.DIALOG_FOOTER),children:Object(k.jsxs)("div",{className:h()(l.a.DIALOG_FOOTER_ACTIONS),children:[Object(k.jsx)(c.b,{onClick:function(){e.resolveDialog({confirmSave:!1,repoName:""})},children:"Close"}),Object(k.jsx)(c.a,{onClick:function(){if(""===t)return void Object(N.e)("Cannot create repository without title!",2e3);e.resolveDialog({confirmSave:!0,repoName:t})},intent:L.a.PRIMARY,children:"Confirm"})]})})]})};var B=s(45),U=s(172);var G=e=>{const[t,s]=m.a.useState(!1),a=e.allowEdits,n=m.a.useRef();return Object(g.useEffect)((()=>{function e(e){a&&(n.current&&!n.current.contains(e.target)&&s(!1),n.current&&n.current.contains(e.target)&&s(!0))}return document.addEventListener("mousedown",e),()=>{document.removeEventListener("mousedown",e)}}),[a]),Object(k.jsx)("div",{ref:n,children:t?Object(k.jsx)(c.Z,{onChange:function(t){e.setContent(t.target.value)},fill:!0,growVertically:!0,defaultValue:e.content}):Object(k.jsx)(B.a,{content:e.content,openLinksInNewWindow:!0})})},F=s(16);var H=e=>Object(k.jsx)("div",{className:"SideContentMissionEditor",children:Object(k.jsxs)("div",{className:"SideContentMissionEditorRow",children:[Object(k.jsx)("div",{className:"SideContentMissionEditorLabelColumn",children:Object(k.jsx)(c.z,{children:"Source Version"})}),Object(k.jsx)("div",{className:"SideContentMissionEditorOptionColumn",children:Object(k.jsx)(y.a,{sourceChapter:e.missionMetadata.sourceVersion,sourceVariant:F.b.defaultSourceVariant,disabled:!1,handleChapterSelect:function(t,s){!function(t,s){const a=Object.assign({},e.missionMetadata);a[t]=s,e.setMissionMetadata(a)}("sourceVersion",t.chapter)}},"chapter")})]})});var V=e=>{const t=e.currentTaskNumber-1,s=e.taskDescriptions,a=e.setTaskDescriptions,n=t<0||t>=s.length||0===s.length,i=n?"Welcome to Mission Mode! This is where the Task Briefing for each question will appear!":s[t],r=m.a.useCallback((e=>{if(n)return;const i=s.map((e=>e));i[t]=e,a(i)}),[a,s,t,n]);return Object(k.jsx)("div",{children:Object(k.jsx)(G,{allowEdits:e.allowEdits,content:i,setContent:r})})},W=s(303),X=s(148),$=s.n(X),q=s(292),z=s(139),Y=s(88),K=s(100),Q=s(18);var J=e=>{const{index:t,testcase:s,setTestcaseProgram:a,setTestcaseExpectedResult:n,handleTestcaseEval:i,deleteTestcase:r}=e,o=g.useMemo((()=>{const e=void 0!==s.result||s.errors,t=Object(K.stringify)(s.result)===s.answer;return{correct:e&&t,wrong:e&&!t,secret:s.type===Q.f.secret||s.type===Q.f.opaque}}),[s]),u=g.useCallback((()=>{i(t)}),[t,i]),p=s.program,m=s.answer,b=Object(k.jsx)(c.b,{className:"testcase-button",icon:d.a.PLAY,onClick:u}),j=Object(k.jsx)(c.b,{className:"testcase-button",icon:d.a.DELETE,onClick:()=>r(t)}),y=g.useMemo((()=>{let e="No Answer";return s.errors?e=Object(Y.parseError)(s.errors):void 0!==s.result&&(e=Object(K.stringify)(s.result)),e}),[s]);return Object(k.jsx)("div",{className:h()("EditableAutograderCard",o),children:Object(k.jsxs)(c.e,{className:l.a.INTERACTIVE,elevation:z.a.ONE,children:[Object(k.jsxs)(k.Fragment,{children:[Object(k.jsx)(c.y,{className:"testcase-program",value:p,onChange:e=>a(e.target.value)}),Object(k.jsx)(c.y,{className:"testcase-expected",value:m,onChange:e=>n(e.target.value)}),Object(k.jsx)(c.y,{className:"testcase-actual",value:y,readOnly:!0})]}),b,j]})})};function Z(e,t){return Object(k.jsx)($.a,{className:"react-ace",fontSize:14,highlightActiveLine:!1,mode:"javascript",onChange:t,theme:"source",value:e,width:"100%",height:"16rem"})}const ee=Object(k.jsxs)("div",{className:"autograder-help-tooltip",children:[Object(k.jsx)("p",{children:"Click on each testcase below to execute it with the program in the editor."}),Object(k.jsx)("p",{children:"To execute all testcases at once, evaluate the program in the editor with this tab active."}),Object(k.jsx)("p",{children:"A green or red background indicates a passed or failed testcase respectively."}),Object(k.jsx)("p",{children:"Private testcases (only visible to staff when grading) have a grey background."})]}),te=(e,t)=>Object(k.jsxs)("div",{className:e,children:[t,Object(k.jsx)(c.w,{icon:d.a.CARET_DOWN})]}),se=Object(k.jsxs)("div",{className:"testcases-header",children:[te("header-fn","Testcase"),te("header-expected","Expected result"),te("header-actual","Actual result")]}),ae=(e,t,s)=>Object(k.jsx)(T.a,{label:e,icon:t?d.a.CARET_DOWN:d.a.CARET_RIGHT,onClick:s,options:{className:"collapse-button",minimal:!0}});var ne=e=>{const[t,s]=g.useState(!0),[a,n]=g.useState(!0),[i,r]=g.useState(!0),{testcases:o,testPrepend:l,testPostpend:u,allowEdits:h,handleTestcaseEval:p,setTaskTestcases:m,setTestPrepend:b,setTestPostpend:j}=e,y=g.useCallback((e=>t=>{const s=o.map((e=>Object.assign({},e)));s[e].program=t,delete s[e].result,m(s)}),[m,o]),O=g.useCallback((e=>t=>{const s=o.map((e=>Object.assign({},e)));s[e].answer=t,delete s[e].result,m(s)}),[m,o]),f=g.useCallback((()=>{const e=[...o];e.push({answer:"",program:"",score:0,type:"public"}),m(e)}),[o,m]),v=g.useCallback((async e=>{if(!await Object(P.b)({title:"confirm testcase deletion",contents:"Are you sure you want to delete this testcase? This cannot be undone.",positiveLabel:"Confirm",negativeLabel:"Cancel"}))return;const t=o.slice(0,e).concat(o.slice(e+1));m(t)}),[o,m]),x=g.useCallback(((e,t)=>h?Object(k.jsx)(J,{index:t,testcase:e,setTestcaseProgram:y(t),setTestcaseExpectedResult:O(t),deleteTestcase:v,handleTestcaseEval:p},t):Object(k.jsx)(q.a,{index:t,testcase:e,handleTestcaseEval:p,workspaceLocation:"githubAssessment"},t)),[h,v,p,y,O]),C=g.useMemo((()=>o.length>0?Object(k.jsxs)("div",{className:"testcaseCards",children:[se,o.map(((e,t)=>x(e,t)))]}):Object(k.jsx)("div",{className:"noResults",children:"There are no testcases provided for this question."})),[o,x]),S=g.useMemo((()=>Object(k.jsx)(c.b,{className:"collapse-button",icon:d.a.ADD,minimal:!0,text:"Add a new testcase",onClick:f})),[f]),w=g.useCallback((()=>{s(!t)}),[t]),E=g.useCallback((()=>{n(!a)}),[a]),T=g.useCallback((()=>{r(!i)}),[i]);return Object(k.jsxs)("div",{className:"Autograder",children:[Object(k.jsxs)(c.b,{className:"collapse-button",icon:i?d.a.CARET_DOWN:d.a.CARET_RIGHT,minimal:!0,onClick:T,children:[Object(k.jsx)("span",{children:"Testcases"}),Object(k.jsx)(W.a,{content:ee,placement:c.L.LEFT,children:Object(k.jsx)(c.w,{icon:d.a.HELP})})]}),Object(k.jsx)(c.g,{isOpen:i,keepChildrenMounted:!0,children:Object(k.jsxs)("div",{className:"testcaseeditor-subcomponent",children:[C,h&&S]})}),h&&ae("Testcase Prepend",t,w),h&&Object(k.jsx)(c.g,{isOpen:t,keepChildrenMounted:!0,children:Object(k.jsx)("div",{className:"testcaseeditor-subcomponent",children:Z(l,(e=>b(e)))})}),h&&ae("Testcase Postpend",a,E),h&&Object(k.jsx)(c.g,{isOpen:a,keepChildrenMounted:!0,children:Object(k.jsx)("div",{className:"testcaseeditor-subcomponent",children:Z(u,(e=>j(e)))})})]})},ie=s(24),re=s(52),oe=s(112),ce=s(72);const le="### Assignment Briefing (Click to Edit!)\nWelcome to Assignment Creator! This is where the Briefing for each assignment will appear.\n\nIf you are on the SourceAcademy website, you may edit **this section** by clicking on it. You can also add or delete questions through the control bar.\n\nThe text written here will show up as the `README.md` file on the GitHub repository.\n\nPlease also refer to our instructor's guide [here](https://github.com/source-academy/general/tree/master/instructor/github) to learn more about how to use this website.\n\n### Brief Markdown Cheatsheet\nEverything here is written in Markdown.\n\nThis means that you can **bolden** or *italicize* text by adding asterisks.\n\nPrograms can be formatted through the use of triple backticks:\n```\n// This is a program example\n```\nIf you want to in-line program snippets, rather than display it as a block, you can also use single backticks like `this`.\n\nLists can be created by adding dashes to the start of a line:\n- First element\n- Second element\n- Third element\n\n\nIt is also possible to embed images, like this:\n\n![an embedded image](https://avatars.githubusercontent.com/u/35620705?s=400&u=32f72fd1d65a0d6877ad1d5870ffa327dda754f1&v=4)\n\nIf you need a more detailed cheatsheet, please click [here](https://www.markdownguide.org/cheat-sheet/)!\n",de="// Your program here!\n",ue={sourceVersion:a.Chapter.CALC},he={questionNumber:0,taskDescription:"### Problem Description (Click to Edit!)\nWelcome to the Assignment Creator! This is where the problem description specific to each problem should be written.\n\nIf you are on the SourceAcademy website, you may edit **this section** by clicking on it. You can also add or delete questions through the control bar.\n\nIf you would like to add new questions outside of the website, simply duplicate this folder, and edit the `Problem.md` and `StarterCode.js` files accordingly. Make sure that the folders are named 'Q1', 'Q2', 'Q3' and so on.\n\nPlease also refer to our instructor's guide [here](https://github.com/source-academy/general/tree/master/instructor/github).\n\n### Brief Markdown Cheatsheet\nEverything here is written in Markdown.\n\nThis means that you can **bolden** or *italicize* text by adding asterisks.\n\nPrograms can be formatted through the use of triple backticks:\n```\n// This is a program example\n```\nIf you want to in-line program snippets, rather than display it as a block, you can also use single backticks like `this`.\n\nLists can be created by adding dashes to the start of a line:\n- First element\n- Second element\n- Third element\n\n\nIt is also possible to embed images, like this:\n\n![an embedded image](https://avatars.githubusercontent.com/u/35620705?s=400&u=32f72fd1d65a0d6877ad1d5870ffa327dda754f1&v=4)\n\nIf you need a more detailed cheatsheet, please click [here](https://www.markdownguide.org/cheat-sheet/)!\n",starterCode:de,savedCode:de,testPrepend:"",testPostpend:"",testCases:[]},pe={answer:-1,choices:[],solution:-1,type:"mcq",content:"",grade:0,id:0,library:{chapter:a.Chapter.CALC,external:{name:"NONE",symbols:[]},globals:[]},maxGrade:0,xp:0,maxXp:0},ge="githubAssessment";var me=e=>{const t=Object(n.c)(),s=Object(ce.f)();void 0===s&&re.a.push("/githubassessments/login");const[i,r]=m.a.useState(ue),[u,T]=m.a.useState(ue),[L,W]=m.a.useState(!1),[X,$]=m.a.useState(le),[q,z]=m.a.useState(le),[Y,K]=m.a.useState(!1),[Q,J]=m.a.useState([]),[Z,ee]=m.a.useState([]),[te,se]=m.a.useState(!1),[ae,de]=m.a.useState(""),[me,be]=m.a.useState(0),[je,ye]=m.a.useState(!1),[Oe,fe]=m.a.useState(!0),[ve,xe]=m.a.useState(!1),[Ce,Se]=m.a.useState(!0),[we,Ee]=m.a.useState(pe),[Te,ke]=m.a.useState(void 0),Ae=e.location.state,[Ie,Ne]=m.a.useState(!1),[Me,Pe]=m.a.useState(ie.b.questionOverview),{isMobileBreakpoint:Re}=Object(b.e)(),_e=e.hasUnsavedChanges,Le=e.editorTestcases,De=e.handleEditorValueChange,Be=e.handleUpdateWorkspace,Ue=e.handleUpdateHasUnsavedChanges,Ge=e.handleReplOutputClear,Fe=Object(g.useCallback)(((e,t)=>{be(e);const s=e-1;Be({editorTabs:[{value:t[s].savedCode,prependValue:t[s].testPrepend,postpendValue:t[s].testPostpend,highlightedLines:[],breakpoints:[]}],editorTestcases:t[s].testCases}),Ge();const[a,n]=Object(I.b)(t[s].savedCode);xe(a),Ee(n)}),[Be,Ge]),He=Object(g.useCallback)((e=>{$(e),K(e!==q)}),[q]),Ve=Object(g.useCallback)((e=>{r(e),W(!Object(p.isEqual)(e,u))}),[u]),We=Object(g.useCallback)((e=>{ee(e),se(!Object(p.isEqual)(e,Q))}),[Q]),Xe=Object(g.useCallback)((e=>{if(e){const[e,t]=Object(I.b)(Z[me-1].savedCode);xe(e),Ee(t)}Se(e)}),[Z,me]),$e=Object(g.useMemo)((()=>L||Y||te),[L,Y,te]);Object(g.useEffect)((()=>{$e!==_e&&Ue($e)}),[$e,_e,Ue]);const qe=Object(g.useCallback)((async()=>{if(void 0===s)return;const e=Ae.missionRepoData,t=[Object(I.e)(e,s),s.users.getAuthenticated().then((t=>t.data.login===e.repoOwner))];Promise.all(t).then((t=>{ke(e),se(!1),K(!1),W(!1),Ue(!1);const s=t[0];de(s.missionBriefing),r(s.missionMetadata),T(s.missionMetadata),$(s.missionBriefing),z(s.missionBriefing),ee(s.tasksData),J(s.tasksData.map((e=>Object.assign({},e)))),Fe(1,s.tasksData);const a=t[1];ye(a),fe(!1)}))}),[Ae,s,Fe,Ue]),ze=Object(g.useCallback)((()=>{de(le),r(ue),T(ue),$(le),z(le),ee([he]),J([he]),Se(!1),Fe(1,[he]),se(!1),K(!1),W(!1),Ue(!1),ye(!0),fe(!1)}),[Fe,Ue]);Object(g.useEffect)((()=>{void 0===Ae?ze():qe()}),[Ae,qe,ze]);const Ye=Object(k.jsx)(c.h,{className:"assessment-briefing",isOpen:Ie,children:Object(k.jsxs)(c.e,{children:[Object(k.jsx)(B.a,{content:ae}),Object(k.jsx)(c.b,{className:"assessment-briefing-button",onClick:()=>Ne(!1),text:"Continue"})]})}),Ke=Object(g.useCallback)(((e,t)=>{if(e>Z.length)return;const s=Z.map((e=>Object.assign({},e)));s[e-1]={...s[e-1],savedCode:t},We(s)}),[Z,We]),Qe=Object(g.useCallback)((()=>{const e=Z[me-1].starterCode;De(e),Ke(me,e)}),[me,Ke,De,Z]),Je=Object(g.useCallback)((async(e,t,a,n,i)=>{const r=Te,{saveType:o}=await Object(ce.b)(s,r.repoOwner,r.repoName,e);"Overwrite"===o&&await Object(ce.j)(s,r.repoOwner,r.repoName,e,a,n,i,t),"Create"===o&&await Object(ce.h)(s,r.repoOwner,r.repoName,e,a,n,i,t)}),[Te,s]),Ze=Object(g.useCallback)((async(e,t,a,n)=>{const i=Te;await Object(ce.i)(s,i.repoOwner,i.repoName,e,t,a,n)}),[Te,s]),et=Object(g.useCallback)((async()=>{if(void 0===s)return void Object(N.e)("Please sign in with GitHub!",2e3);const[e,t]=Object(I.c)(i,u,X,q,Z,Q,je),a=Object.keys(e),n=await s.users.getAuthenticated(),r=n.data.name,o=n.data.email;for(let s=0;s<t.length;s++)await Ze(t[s],r,o,"");for(let s=0;s<a.length;s++){const t=a[s],n=e[t];await Je(t,n,r,o,"")}J(Z),z(X),T(i),se(!1),K(!1),W(!1)}),[s,je,X,i,Z,Q,q,u,Je,Ze]),tt=Object(g.useCallback)((async()=>{if(void 0===s)return void Object(N.e)("Please sign in with GitHub!",2e3);const e=Object(I.d)(i,X,Z),t=Object.keys(e).sort(),a=await s.users.getAuthenticated(),n=await Object(P.a)(D,(e=>({filesToCreate:t,userLogin:a.data.login,resolveDialog:t=>e(t)})));if(!n.confirmSave)return;const r=a.data.name,o=a.data.email,c=n.repoName,l=a.data.login;try{await s.repos.createForAuthenticatedUser({name:c});for(let a=0;a<t.length;a++){const n=t[a],i=e[n];await Object(ce.h)(s,l,c,n,r,o,"Repository created from Source Academy",i)}J(Z),z(X),T(i),se(!1),K(!1),W(!1),ke({repoOwner:l,repoName:c,dateOfCreation:new Date})}catch(d){console.error(d),Object(N.e)("Something went wrong while creating the repository!",2e3)}}),[X,i,s,Z]),st=Object(g.useCallback)((()=>{void 0!==Ae&&new Date>Ae.dueDate?Object(N.e)("It is past the due date for this assessment!"):void 0!==Te?et():tt()}),[Ae,Te,et,tt]),at=Object(g.useCallback)((async()=>{await Object(P.b)({contents:Object(k.jsxs)("div",{className:l.a.DIALOG_BODY,children:[Object(k.jsx)(B.a,{content:"Are you sure you want to reset the template?"}),Object(k.jsx)(B.a,{content:"*Note this will not affect the saved copy of your program, unless you save over it.*"})]}),negativeLabel:"Cancel",positiveIntent:"primary",positiveLabel:"Confirm"})&&Qe()}),[Qe]),nt=Object(g.useCallback)(((e,t,s,a)=>{if(void 0===a)return!0;const n=e-1;return!!Object(p.isEqual)(t[n],s[n])||window.confirm("You have unsaved changes to the current question. Are you sure you want to continue?")}),[]),it=Object(g.useCallback)((()=>{if(nt(me,Z,Q,Te)){let e=Z;void 0!==Te&&(e=Q.map((e=>Object.assign({},e))),We(e));Fe(me-1,e)}}),[me,Z,Q,Te,We,nt,Fe]),rt=Object(g.useCallback)((()=>{if(nt(me,Z,Q,Te)){let e=Z;void 0!==Te&&(e=Q.map((e=>Object.assign({},e))),We(e));Fe(me+1,e)}}),[me,Z,Q,Te,We,nt,Fe]),ot=Object(g.useCallback)((()=>{re.a.push("/githubassessments/missions")}),[]);m.a.useEffect((()=>{Re||Me!==ie.b.mobileEditor&&Me!==ie.b.mobileEditorRun||Pe(ie.b.questionOverview)}),[Re,e,Me]);const ct=m.a.useCallback((e=>{De(e),Ke(me,e)}),[me,Ke,De]),lt=(e,t,s)=>{e!==t&&Pe(e)},dt=m.a.useRef(Me);dt.current=Me;const ut=()=>{e.handleEditorEval(),dt.current===ie.b.testcases&&t(Object(o.runAllTestcases)(ge))},ht=Object(g.useCallback)((e=>{const t=[];for(let s=0;s<Z.length;s++){const a=Object.assign({},Z[s]);a.taskDescription=e[s],t.push(a)}We(t)}),[Z,We]),pt=Object(g.useCallback)((e=>{const t=Z.map((e=>Object.assign({},e)));t[me-1]={...t[me-1],testCases:e},Be({editorTestcases:t[me-1].testCases}),We(t)}),[me,Z,Be,We]),gt=Object(g.useCallback)((e=>{const t=Z.map((e=>Object.assign({},e)));t[me-1]={...t[me-1],testPrepend:e},We(t)}),[me,Z,We]),mt=Object(g.useCallback)((e=>{const t=Z.map((e=>Object.assign({},e)));t[me-1]={...t[me-1],testPostpend:e},We(t)}),[me,Z,We]),bt=e=>{const s=[{label:"Task",iconName:d.a.NINJA,body:Object(k.jsx)(V,{allowEdits:je,currentTaskNumber:me,taskDescriptions:Z.map((e=>e.taskDescription)),setTaskDescriptions:ht}),id:ie.b.questionOverview},{label:"Briefing",iconName:d.a.BRIEFCASE,body:Object(k.jsx)(G,{allowEdits:je,content:X,setContent:He}),id:ie.b.briefing}],a=me-1,n=Z[a]?Z[a].testPrepend:"",r=Z[a]?Z[a].testPostpend:"";return s.push({label:"Testcases",iconName:d.a.AIRPLANE,body:Object(k.jsx)(ne,{allowEdits:je,testcases:Le,testPrepend:n,testPostpend:r,setTaskTestcases:pt,setTestPrepend:gt,setTestPostpend:mt,handleTestcaseEval:e=>t(Object(o.evalTestcase)(ge,e))}),id:ie.b.testcases}),je&&s.push({label:"Mission Metadata",iconName:d.a.BUILD,body:Object(k.jsx)(H,{missionMetadata:i,setMissionMetadata:Ve}),id:ie.b.missionMetadata}),{selectedTabId:Me,tabs:{beforeDynamicTabs:s,afterDynamicTabs:[]},onChange:lt,workspaceLocation:"githubAssessment"}},jt=()=>{const e=Z.slice(0,me).concat([he]).concat(Z.slice(me,Z.length));We(e);Fe(me+1,e)},yt=()=>{const e=me-1,t=Z.slice(0,e).concat(Z.slice(me,Z.length));We(t);Fe(1===me?me:me-1,t)},Ot=()=>{const e=Object(k.jsx)(w.a,{handleEditorEval:ut},"run"),t=Object(k.jsx)(E.a,{hasUnsavedChanges:_e,onClickSave:st},"save"),s=Object(k.jsx)(S.a,{onClick:at},"reset"),a=Object(k.jsx)(y.a,{handleChapterSelect:()=>{},sourceChapter:i.sourceVersion,sourceVariant:F.b.defaultSourceVariant,disabled:!0},"chapter"),n=Object(k.jsx)(v.a,{onClickNext:rt,onClickReturn:ot,questionProgress:[me,Z.length]},"next_question"),r=Object(k.jsx)(x.a,{onClick:it,questionProgress:[me,Z.length]},"previous_question"),o=Object(k.jsx)(C.a,{questionProgress:[me,Z.length]},"task_view"),c=Re?[t,s]:[e,t,s,a];if(je){const e=Object(k.jsx)(M,{addNewQuestion:jt,numberOfTasks:Z.length},"add_task"),t=Object(k.jsx)(R,{deleteCurrentQuestion:yt,numberOfTasks:Z.length},"delete_task"),s=Object(k.jsx)(A,{displayMCQInEditor:()=>Xe(!0),displayTextInEditor:()=>Xe(!1),mcqDisplayed:Ce},"display MCQ");c.push(e,t,s)}return{editorButtons:c,flowButtons:[r,o,n]}},ft=Object(g.useCallback)((e=>{if(!ve)return;const t=Object.assign({},we);t.answer=e,Ee(t),Ke(me,Object(I.a)(t))}),[ve,me,Ke,we]),vt=Object(g.useMemo)((()=>ve&&Ce?{mcq:we,handleMCQSubmit:ft}:void 0),[ve,Ce,we,ft]),xt={editorVariant:"normal",editorTabs:e.editorTabs.map(_.a),editorSessionId:"",handleDeclarationNavigate:e=>t(Object(o.navigateToDeclaration)(ge,e)),handleEditorEval:ut,handleEditorValueChange:ct,handleUpdateHasUnsavedChanges:Ue,handleEditorUpdateBreakpoints:e=>t(Object(o.setEditorBreakpoint)(e,ge)),handlePromptAutocomplete:(e,s,a)=>t(Object(o.promptAutocomplete)(ge,e,s,a)),isEditorAutorun:!1},Ct={handleBrowseHistoryDown:()=>t(Object(o.browseReplHistoryDown)(ge)),handleBrowseHistoryUp:()=>t(Object(o.browseReplHistoryUp)(ge)),handleReplEval:e.handleReplEval,handleReplValueChange:e=>t(Object(o.updateReplValue)(e,ge)),output:e.output,replValue:e.replValue,sourceChapter:i.sourceVersion||a.Chapter.CALC,sourceVariant:a.Variant.DEFAULT,externalLibrary:j.a.NONE,replButtons:(()=>{const t=Object(k.jsx)(O.a,{handleReplOutputClear:Ge},"clear_repl");return[Object(k.jsx)(f.a,{handleReplEval:e.handleReplEval,isRunning:e.isRunning},"eval_repl"),t]})()},St={tabs:[]},wt={controlBarProps:Ot(),editorContainerProps:ve&&Ce?void 0:xt,handleSideContentHeightChange:e=>t(Object(o.changeSideContentHeight)(e,ge)),hasUnsavedChanges:_e,mcqProps:vt,sideBarProps:St,sideContentHeight:e.sideContentHeight,sideContentProps:bt(),replProps:Ct},Et={editorContainerProps:ve&&Ce?void 0:xt,replProps:Ct,sideBarProps:St,hasUnsavedChanges:_e,mcqProps:vt,mobileSideContentProps:(()=>{const e=bt();return{mobileControlBarProps:{...Ot()},...e,onChange:(e,t,s)=>{e!==t&&(t===ie.b.testcases&&e===ie.b.mobileEditorRun||Pe(e))},selectedTabId:Me,handleEditorEval:ut}})()};return Oe?Object(k.jsx)("div",{className:h()("missionLoading",l.a.DARK),children:Object(k.jsx)(c.G,{description:"Loading",icon:Object(k.jsx)(c.R,{size:c.S.LARGE})})}):Object(k.jsxs)("div",{className:h()("WorkspaceParent",l.a.DARK),children:[Ye,Re?Object(k.jsx)(U.a,{...Et}):Object(k.jsx)(oe.a,{...wt})]})};const be="githubAssessment",je=Object(i.l)(Object(n.b)((e=>({activeEditorTabIndex:e.workspaces.githubAssessment.activeEditorTabIndex,editorTabs:e.workspaces.githubAssessment.editorTabs,editorTestcases:e.workspaces.githubAssessment.editorTestcases,hasUnsavedChanges:e.workspaces.githubAssessment.hasUnsavedChanges,isRunning:e.workspaces.githubAssessment.isRunning,isDebugging:e.workspaces.githubAssessment.isDebugging,enableDebugging:e.workspaces.githubAssessment.enableDebugging,output:e.workspaces.githubAssessment.output,replValue:e.workspaces.githubAssessment.replValue,sideContentHeight:e.workspaces.githubAssessment.sideContentHeight,sourceChapter:a.Chapter.CALC})),(e=>Object(r.b)({handleChapterSelect:e=>Object(o.chapterSelect)(e,a.Variant.DEFAULT,be),handleEditorEval:()=>Object(o.evalEditor)(be),handleEditorValueChange:e=>Object(o.updateEditorValue)(e,be),handleReplEval:()=>Object(o.evalRepl)(be),handleReplOutputClear:()=>Object(o.clearReplOutput)(be),handleUpdateHasUnsavedChanges:e=>Object(o.updateHasUnsavedChanges)(be,e),handleUpdateWorkspace:e=>Object(o.updateWorkspace)(be,e)},e)))(me));t.a=je},531:function(e,t,s){"use strict";var a=s(42),n=s(242),i=s(3),r=s(122),o=s(377),c=s(20),l=s.n(c),d=(s(1),s(47)),u=s(35),h=s(12),p=s(0);const g=e=>{const{isMobileBreakpoint:t}=Object(u.e)(),s=void 0!==Object(u.f)((e=>e.session.githubOctokitObject)).octokit?Object(p.jsx)(h.a,{label:"Log Out",icon:r.a.GIT_BRANCH,onClick:e.onClickLogOut}):Object(p.jsx)(h.a,{label:"Log In",icon:r.a.GIT_BRANCH,onClick:e.onClickLogIn});return Object(p.jsx)(a.c,{large:!t,children:s})};var m=s(55);const b=[r.a.FLAME,r.a.LIGHTBULB,r.a.PREDICTIVE_ANALYSIS,r.a.COMPARISON,r.a.MANUAL];t.a=e=>{var t,s;const r=t=>{e.changeCourseHandler(t)};return Object(p.jsxs)(a.C,{className:"NavigationBar secondary-navbar",children:[Object(p.jsx)(a.E,{align:n.a.LEFT,children:null===(t=e.types)||void 0===t?void 0:t.map(((t,s)=>Object(p.jsxs)(d.b,{to:{pathname:`/githubassessments/${Object(m.a)(t)}`,state:{courses:e.courses,assessmentTypeOverviews:e.assessmentTypeOverviews,selectedCourse:e.selectedCourse}},activeClassName:i.a.ACTIVE,className:l()("NavigationBar__link",i.a.BUTTON,i.a.MINIMAL),children:[Object(p.jsx)(a.w,{icon:s<5?b[s]:b[0]}),Object(p.jsx)("div",{className:"navbar-button-text hidden-xs hidden-sm",children:t})]},t)))}),Object(p.jsxs)(a.E,{align:n.a.RIGHT,children:[void 0!==e.octokit&&e.types&&e.types.length>0&&Object(p.jsx)(a.y,{disabled:!0,leftElement:Object(p.jsx)(o.a,{content:Object(p.jsx)(a.A,{children:null===(s=e.courses)||void 0===s?void 0:s.map((e=>Object(p.jsx)(a.B,{onClick:r,text:e},e)))}),placement:"bottom-end",children:Object(p.jsx)(a.b,{minimal:!0,rightIcon:"caret-down","aria-label":"choose"})}),placeholder:"Select Course",onChange:e.changeCourseHandler,value:e.selectedCourse},"courseselect"),Object(p.jsx)(g,{onClickLogIn:e.handleGitHubLogIn,onClickLogOut:e.handleGitHubLogOut},"loginlogout")]})]})}},55:function(e,t,s){"use strict";s.d(t,"a",(function(){return a})),s.d(t,"b",(function(){return n}));const a=e=>e.toLowerCase().replace(/\W+/g,"_"),n=e=>{if(void 0===e)return null;const t=parseInt(e,10);return Number.isInteger(t)?t:null}},559:function(e,t,s){},59:function(e,t,s){"use strict";s.d(t,"b",(function(){return a})),s.d(t,"f",(function(){return n})),s.d(t,"g",(function(){return i})),s.d(t,"h",(function(){return r})),s.d(t,"i",(function(){return o})),s.d(t,"j",(function(){return c})),s.d(t,"k",(function(){return l})),s.d(t,"a",(function(){return d})),s.d(t,"e",(function(){return u})),s.d(t,"d",(function(){return h})),s.d(t,"c",(function(){return p})),s.d(t,"l",(function(){return g}));const a="BEGIN_INTERRUPT_EXECUTION",n="END_INTERRUPT_EXECUTION",i="EVAL_INTERPRETER_ERROR",r="EVAL_INTERPRETER_SUCCESS",o="EVAL_TESTCASE_FAILURE",c="EVAL_TESTCASE_SUCCESS",l="HANDLE_CONSOLE_LOG",d="BEGIN_DEBUG_PAUSE",u="END_DEBUG_PAUSE",h="DEBUG_RESUME",p="DEBUG_RESET",g="HIGHLIGHT_LINE"},68:function(e,t,s){"use strict";s.r(t),s.d(t,"handleConsoleLog",(function(){return i})),s.d(t,"evalInterpreterSuccess",(function(){return r})),s.d(t,"evalTestcaseSuccess",(function(){return o})),s.d(t,"evalTestcaseFailure",(function(){return c})),s.d(t,"evalInterpreterError",(function(){return l})),s.d(t,"beginInterruptExecution",(function(){return d})),s.d(t,"endInterruptExecution",(function(){return u})),s.d(t,"beginDebuggerPause",(function(){return h})),s.d(t,"endDebuggerPause",(function(){return p})),s.d(t,"debuggerResume",(function(){return g})),s.d(t,"debuggerReset",(function(){return m}));var a=s(7),n=s(59);const i=function(e){for(var t=arguments.length,s=new Array(t>1?t-1:0),i=1;i<t;i++)s[i-1]=arguments[i];return Object(a.action)(n.k,{logString:s,workspaceLocation:e})},r=(e,t)=>Object(a.action)(n.h,{type:"result",value:e,workspaceLocation:t}),o=(e,t,s)=>Object(a.action)(n.j,{type:"result",value:e,workspaceLocation:t,index:s}),c=(e,t,s)=>Object(a.action)(n.i,{type:"errors",value:e,workspaceLocation:t,index:s}),l=(e,t)=>Object(a.action)(n.g,{type:"errors",errors:e,workspaceLocation:t}),d=e=>Object(a.action)(n.b,{workspaceLocation:e}),u=e=>Object(a.action)(n.f,{workspaceLocation:e}),h=e=>Object(a.action)(n.a,{workspaceLocation:e}),p=e=>Object(a.action)(n.e,{workspaceLocation:e}),g=e=>Object(a.action)(n.d,{workspaceLocation:e}),m=e=>Object(a.action)(n.c,{workspaceLocation:e})},69:function(e,t,s){"use strict";s.d(t,"a",(function(){return b})),s.d(t,"b",(function(){return y})),s.d(t,"c",(function(){return O}));var a=s(103),n=s(1),i=s(53),r=s(42),o=s(3),c=s(20),l=s.n(c),d=s(0);function u(e){const t=e.choices.map(((t,s)=>Object(d.jsx)(r.b,{onClick:()=>e.onResponse&&e.onResponse(t.key),intent:t.intent,fill:e.largeButtons,className:l()(e.largeButtons&&"large-button"),...t.props,children:t.label},s))),{escapeResponse:s}=e,a="undefined"===typeof s?void 0:()=>e.onResponse&&e.onResponse(s);return Object(d.jsxs)(r.h,{className:l()(o.a.DARK,"ConfirmDialog"),title:e.title,isCloseButtonShown:"undefined"===typeof e.title&&void 0,canEscapeKeyClose:!!a,onClose:a,isOpen:e.isOpen,icon:e.icon,...e.props,children:[Object(d.jsx)("div",{className:o.a.DIALOG_BODY,children:e.contents}),Object(d.jsxs)("div",{className:o.a.DIALOG_FOOTER,children:[e.largeButtons&&t,!e.largeButtons&&Object(d.jsx)("div",{className:o.a.DIALOG_FOOTER_ACTIONS,children:t})]})]})}function h(e){const{enterResponse:t,validationFunction:s}=e,i=n.useRef(null),[o,c]=n.useState(!s||s(e.defaultValue||""));n.useEffect((()=>{i.current&&c(!s||s(i.current.value))}),[s]);const l=t=>{var a;t!==e.escapeResponse&&s&&!s(i.current.value)||e.onResponse(t,(null===(a=i.current)||void 0===a?void 0:a.value)||"")},h=e.choices.map((e=>({...e,props:{...e.props,disabled:e.disableOnInvalid&&!o}}))),p=t?e=>{13===e.keyCode&&l(t)}:void 0,g=s?e=>{s(e.target.value)!==o&&c(!o)}:void 0;return Object(d.jsx)(u,{...e,onResponse:l,choices:h,contents:Object(d.jsxs)(d.Fragment,{children:[e.contents,Object(d.jsx)(r.y,{autoFocus:!0,defaultValue:e.defaultValue,inputRef:i,onKeyDown:p,onChange:g,intent:o?a.a.NONE:a.a.DANGER})]})})}class p extends n.PureComponent{constructor(){super(...arguments),this.state={dialog:null,dialogOnClose:null}}static create(){const e=document.createElement("div");document.body.appendChild(e);const t=i.render(Object(d.jsx)(p,{}),e);if(null==t)throw new Error("Could not create DialogHelper - are you in a React lifecycle method?");return t}show(e,t){this.setState((()=>({dialog:e,dialogOnClose:t||null})))}close(){this.state.dialogOnClose&&this.state.dialogOnClose(),this.setState((()=>({dialog:null,dialogOnClose:null})))}render(){return this.state.dialog}}const g=p.create();function m(){g.close()}function b(e,t){return new Promise(((s,a)=>{var n,i;n=Object(d.jsx)(e,{...t(s)}),i=a,g.show(n,i)})).finally(m)}function j(e){return b(u,(t=>({...e,onResponse:t,isOpen:!0})))}function y(e){return j({title:e.title,contents:e.contents,choices:[{key:!1,label:e.negativeLabel||"No"},{key:!0,label:e.positiveLabel||"Yes",intent:e.positiveIntent||a.a.SUCCESS,props:{type:"submit"}}],escapeResponse:!1,icon:e.icon,...e.props})}function O(e){return b(h,(t=>({title:e.title,contents:e.contents,choices:[{key:!1,label:e.negativeLabel||"Cancel"},{key:!0,label:e.positiveLabel||"Accept",intent:a.a.SUCCESS,disableOnInvalid:!0}],escapeResponse:!1,enterResponse:!0,onResponse:(e,s)=>t({buttonResponse:e,value:s}),isOpen:!0,...e.props})))}},71:function(e,t,s){"use strict";let a;s.d(t,"a",(function(){return a})),s.d(t,"b",(function(){return i})),function(e){e.NONE="NONE",e.SOUNDS="SOUNDS",e.EV3="EV3"}(a||(a={}));const n=[[a.NONE,[]],[a.SOUNDS,[]]],i=new Map(n)},72:function(e,t,s){"use strict";(function(e){s.d(t,"e",(function(){return c})),s.d(t,"f",(function(){return l})),s.d(t,"a",(function(){return d})),s.d(t,"b",(function(){return u})),s.d(t,"c",(function(){return h})),s.d(t,"d",(function(){return p})),s.d(t,"g",(function(){return g})),s.d(t,"j",(function(){return m})),s.d(t,"h",(function(){return b})),s.d(t,"i",(function(){return j}));var a=s(8),n=s(69),i=s(10),r=s(89),o=s(0);async function c(e,t){return await fetch(e,{method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded; charset=UTF-8"},body:t})}function l(){const e=r.a.getState().session.githubOctokitObject;return void 0===e?void 0:e.octokit}async function d(e,t,s,a){if(void 0===e)return Object(i.e)("Please log in and try again",2e3),!1;if(""===a)return Object(i.e)("Please select a file!",2e3),!1;let n;try{n=(await e.repos.getContent({owner:t,repo:s,path:a})).data}catch(r){return Object(i.e)("Connection denied or file does not exist.",2e3),console.error(r),!1}return!Array.isArray(n)||(Object(i.e)("Can't open folder as a file!",2e3),!1)}async function u(e,t,s,a){let n,r="";if(""===a)return Object(i.e)("No file name given.",2e3),{canBeSaved:!1,saveType:r};if(void 0===e)return Object(i.e)("Please log in and try again",2e3),{canBeSaved:!1,saveType:r};try{n=(await e.repos.getContent({owner:t,repo:s,path:a})).data,r="Overwrite"}catch(o){if(404!==o.status)return Object(i.e)("Connection denied or file does not exist.",2e3),console.error(o),{canBeSaved:!1,saveType:r};r="Create"}return Array.isArray(n)?(Object(i.e)("Can't save over a folder!",2e3),{canBeSaved:!1,saveType:r}):{canBeSaved:!0,saveType:r}}async function h(){return await Object(n.b)({contents:Object(o.jsxs)("div",{children:[Object(o.jsx)("p",{children:"Warning: opening this file will overwrite the text data in the editor."}),Object(o.jsx)("p",{children:"Please click 'Confirm' to continue, or 'Cancel' to go back."})]}),negativeLabel:"Cancel",positiveIntent:"primary",positiveLabel:"Confirm"})}async function p(){return await Object(n.b)({contents:Object(o.jsxs)("div",{children:[Object(o.jsx)("p",{children:"Warning: You are saving over an existing file in the repository."}),Object(o.jsx)("p",{children:"Please click 'Confirm' to continue, or 'Cancel' to go back."})]}),negativeLabel:"Cancel",positiveIntent:"primary",positiveLabel:"Confirm"})}async function g(t,s,n,o){if(void 0===t)return;const c=(await t.repos.getContent({owner:s,repo:n,path:o})).data.content;if(c){const t=e.from(c,"base64").toString();r.a.dispatch(a.a.updateEditorValue(t,"playground")),r.a.dispatch(a.a.playgroundUpdateGitHubSaveInfo(n,o,new Date)),Object(i.d)("Successfully loaded file!",1e3)}}async function m(t,s,n,o,c,l,d,u){if(void 0===t)return;l=l||"No public email provided",c=c||"Source Academy User",d=d||"Changes made from Source Academy",u=u||"";const h=e.from(u,"utf8").toString("base64");try{const e=(await t.repos.getContent({owner:s,repo:n,path:o})).data;if(Array.isArray(e))return;const u=e.sha;await t.repos.createOrUpdateFileContents({owner:s,repo:n,path:o,message:d,content:h,sha:u,committer:{name:c,email:l},author:{name:c,email:l}}),r.a.dispatch(a.a.playgroundUpdateGitHubSaveInfo(n,o,new Date)),Object(i.d)("Successfully saved file!",1e3)}catch(p){console.error(p),Object(i.e)("Something went wrong when trying to save the file.",1e3)}}async function b(t,s,n,o,c,l,d,u){if(void 0===t)return;l=l||"No public email provided",c=c||"Source Academy User",d=d||"Changes made from Source Academy",u=u||"";const h=e.from(u,"utf8").toString("base64");try{await t.repos.createOrUpdateFileContents({owner:s,repo:n,path:o,message:d,content:h,committer:{name:c,email:l},author:{name:c,email:l}}),r.a.dispatch(a.a.playgroundUpdateGitHubSaveInfo(n,o,new Date)),Object(i.d)("Successfully created file!",1e3)}catch(p){console.error(p),Object(i.e)("Something went wrong when trying to save the file.",1e3)}}async function j(e,t,s,a,n,r,o){if(void 0!==e){r=r||"No public email provided",n=n||"Source Academy User",o=o||"Changes made from Source Academy";try{const n=(await e.repos.getContent({owner:t,repo:s,path:a})).data;if(!Array.isArray(n))return void Object(i.e)("Something went wrong when trying to delete the folder.",1e3);for(let a=0;a<n.length;a++){const i=n[a];await e.repos.deleteFile({owner:t,repo:s,path:i.path,message:o,sha:i.sha})}Object(i.d)("Successfully deleted folder!",1e3)}catch(c){console.error(c),Object(i.e)("Something went wrong when trying to delete the folder.",1e3)}}}}).call(this,s(74).Buffer)},75:function(e,t,s){"use strict";s.d(t,"a",(function(){return r})),s.d(t,"b",(function(){return o})),s.d(t,"c",(function(){return c})),s.d(t,"g",(function(){return l})),s.d(t,"d",(function(){return d})),s.d(t,"f",(function(){return u})),s.d(t,"e",(function(){return h}));var a=s(65),n=s.n(a);const i=new Date,r=e=>void 0!==e&&e<=i,o=e=>void 0===e||e<=i,c=(e,t)=>{if(void 0===e&&void 0===t)return!0;const s=new Date,a=100*s.getHours()+s.getMinutes(),n=void 0===e?void 0:100*e.getHours()+e.getMinutes(),i=void 0===t?void 0:100*t.getHours()+t.getMinutes();return void 0===n?a<=i:void 0===i?a>=n:n>=i?a<=i||a>=n:a<=i&&a>=n},l=e=>void 0===e?0:e.getTime()-i.getTime(),d=e=>void 0===e?"":n()(e).format("D MMMM YYYY HH:mm"),u=e=>void 0===e?"":n()(e).format("HH:mm"),h=e=>{if(void 0===e)return"Unlimited";if(r(e))return"Expired";const t=n()(),s=Math.ceil(n()(e).diff(t,"weeks",!0)),a=Math.ceil(n()(e).diff(t,"days",!0)),i=Math.ceil(n()(e).diff(t,"hours",!0));let o="";return o=s>1?s+" Weeks":a>1?a+" Days":i>1?i+" Hours":"1 Hour",o}},766:function(e,t){},768:function(e,t){},793:function(e,t){},795:function(e,t){},8:function(e,t,s){"use strict";s.d(t,"a",(function(){return A}));var a={};s.r(a),s.d(a,"persistenceOpenPicker",(function(){return b})),s.d(a,"persistenceSaveFile",(function(){return j})),s.d(a,"persistenceSaveFileAs",(function(){return y})),s.d(a,"persistenceInitialise",(function(){return O}));var n={};s.r(n),s.d(n,"remoteExecFetchDevices",(function(){return x})),s.d(n,"remoteExecUpdateDevices",(function(){return C})),s.d(n,"remoteExecUpdateSession",(function(){return S})),s.d(n,"remoteExecConnect",(function(){return w})),s.d(n,"remoteExecDisconnect",(function(){return E})),s.d(n,"remoteExecRun",(function(){return T})),s.d(n,"remoteExecReplInput",(function(){return k}));var i=s(281),r=s(68),o=s(38),c=s(248),l=s(13),d=s(207),u=s(96),h=s(294),p=s(188),g=s(7),m=s(152);const b=()=>Object(g.action)(m.b),j=e=>Object(g.action)(m.c,e),y=()=>Object(g.action)(m.d),O=()=>Object(g.action)(m.a);var f=s(127),v=s(90);const x=()=>Object(g.action)(v.c),C=e=>Object(g.action)(v.f,e),S=e=>Object(g.action)(v.g,e),w=(e,t)=>Object(g.action)(v.a,{workspace:e,device:t}),E=()=>Object(g.action)(v.b),T=e=>Object(g.action)(v.e,e),k=e=>Object(g.action)(v.d,e);const A={...u,...i,...c,...h,...r,...f,...o,...s(214),...s(95),...s(120),...l,...p,...d,...a,...n}},815:function(e,t){},86:function(e,t,s){"use strict";s.d(t,"a",(function(){return a})),s.d(t,"b",(function(){return n})),s.d(t,"c",(function(){return i})),s.d(t,"d",(function(){return r})),s.d(t,"e",(function(){return o})),s.d(t,"f",(function(){return c})),s.d(t,"g",(function(){return l})),s.d(t,"h",(function(){return d})),s.d(t,"i",(function(){return u}));const a="DELETE_SOURCECAST_ENTRY",n="RECORD_INIT",i="RECORD_INPUT",r="RESET_INPUTS",o="TIMER_PAUSE",c="TIMER_RESET",l="TIMER_RESUME",d="TIMER_START",u="TIMER_STOP"},89:function(e,t,s){"use strict";s.d(t,"a",(function(){return _t}));var a=s(33),n=s.n(a),i=s(27),r=s(44),o=s(530),c=s(22),l=s(146),d=s(126);const u=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:c.c,t=arguments.length>1?arguments[1]:void 0;switch(t.type){case l.a:return c.c;case d.c:return{...e,gameCanvas:t.payload};default:return e}};var h=s(26);const p=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:c.d,t=arguments.length>1?arguments[1]:void 0;switch(t.type){case h.p:return{...e,achievements:t.payload};case h.q:return{...e,goals:t.payload};case h.r:return{...e,users:t.payload};case h.s:return{...e,assessmentOverviews:t.payload};default:return e}};var g=s(157);const m=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:c.f,t=arguments.length>1?arguments[1]:void 0;return t.type===g.b?{...e,gradingSummary:t.payload}:e};var b=s(108);const j=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:c.i,t=arguments.length>1?arguments[1]:void 0;switch(t.type){case b.a:return{...e,queryString:t.payload};case b.f:return{...e,shortURL:t.payload};case b.c:return{...e,githubSaveInfo:t.payload};case b.d:return{...e,persistenceFile:t.payload};default:return e}};var y=s(100),O=s(37),f=s(135);const v=(e,t)=>{switch(t.type){case O.d:return{...e,title:t.payload.title,description:t.payload.description,uid:t.payload.uid,audioUrl:t.payload.audioUrl,playbackData:t.payload.playbackData};case O.f:return{...e,currentPlayerTime:t.payload.playerTime};case O.e:return{...e,codeDeltasToApply:t.payload.deltas};case O.g:return{...e,inputToApply:t.payload.inputToApply};case O.h:return{...e,title:t.payload.title,description:t.payload.description,uid:t.payload.uid,audioUrl:t.payload.audioUrl,playbackData:t.payload.playbackData};case O.i:return{...e,playbackDuration:t.payload.duration};case O.j:return{...e,playbackStatus:t.payload.playbackStatus};case f.c:return{...e,sourcecastIndex:t.payload.index};default:return e}};var x=s(86);const C=(e,t)=>{switch(t.type){case x.b:return{...e,playbackData:{init:t.payload.initData,inputs:[]}};case x.c:return{...e,playbackData:{...e.playbackData,inputs:[...e.playbackData.inputs,t.payload.input]}};case x.d:return{...e,playbackData:{...e.playbackData,inputs:t.payload.inputs}};case x.e:return{...e,recordingStatus:O.c.paused,timeElapsedBeforePause:e.timeElapsedBeforePause+t.payload.timeNow-e.timeResumed};case x.f:return{...e,recordingStatus:O.c.notStarted,timeElapsedBeforePause:0,timeResumed:0};case x.g:return{...e,recordingStatus:O.c.recording,timeElapsedBeforePause:t.payload.timeBefore>=0?t.payload.timeBefore:e.timeElapsedBeforePause,timeResumed:t.payload.timeNow};case x.h:return{...e,recordingStatus:O.c.recording,timeElapsedBeforePause:0,timeResumed:t.payload.timeNow};case x.i:return{...e,recordingStatus:O.c.finished,timeElapsedBeforePause:0,timeResumed:0};default:return e}};var S=s(59),w=s(226),E=s(24),T=s(16),k=s(101),A=s(31);const I=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:c.l,t=arguments.length>1?arguments[1]:void 0;const s=t.payload?t.payload.workspaceLocation:"assessment";let a,n;switch(s){case"sourcecast":const s=v(e.sourcecast,t);if(s===e.sourcecast)break;return{...e,sourcecast:s};case"sourcereel":const a=C(e.sourcereel,t);if(a===e.sourcereel)break;return{...e,sourcereel:a}}switch(t.type){case A.c:if(null===e[s].replHistory.browseIndex)return e;if(0!==e[s].replHistory.browseIndex){const t=e[s].replHistory.browseIndex-1,a=e[s].replHistory.records[t];return{...e,[s]:{...e[s],replValue:a,replHistory:{...e[s].replHistory,browseIndex:t}}}}{const t=null,a=e[s].replHistory.originalValue,n=e[s].replHistory.records.slice();return{...e,[s]:{...e[s],replValue:a,replHistory:{browseIndex:t,records:n,originalValue:""}}}}case A.d:const i=e[s].replHistory.records,r=e[s].replHistory.browseIndex;if(0===i.length||null!==r&&void 0===i[r+1])return e;if(null===r){const t=0,a=i.slice(),n=e[s].replValue,r=a[t];return{...e,[s]:{...e[s],replValue:r,replHistory:{...e[s].replHistory,browseIndex:t,records:a,originalValue:n}}}}{const t=r+1,a=i[t];return{...e,[s]:{...e[s],replValue:a,replHistory:{...e[s].replHistory,browseIndex:t}}}}case A.e:return{...e,[s]:{...e[s],execTime:t.payload.execTime}};case A.g:return{...e,[s]:{...e[s],sideContentHeight:t.payload.height}};case A.h:return{...e,[s]:{...e[s],stepLimit:t.payload.stepLimit}};case A.k:return{...e,[s]:{...e[s],replValue:""}};case A.m:return{...e,[s]:{...e[s],output:e[s].output.slice(0,-1)}};case A.l:return{...e,[s]:{...e[s],output:[]}};case A.n:return{...e,[s]:{...e[s],context:Object(k.a)(t.payload.library.external.symbols,s,t.payload.library.variant),globals:t.payload.library.globals,externalLibrary:t.payload.library.external.name}};case A.z:let o;return a=e[s].output.concat(t.payload),o=""!==t.payload.value?[t.payload.value].concat(e[s].replHistory.records):e[s].replHistory.records,o.length>T.b.maxBrowseIndex&&o.pop(),{...e,[s]:{...e[s],output:a,replHistory:{...e[s].replHistory,records:o}}};case A.f:return{...e,[s]:{...e[s],externalLibrary:t.payload.newExternal}};case S.k:if(n=e[s].output[e[s].output.length-1],void 0===n||"running"!==n.type)a=e[s].output.concat({type:"running",consoleLogs:[...t.payload.logString]});else{const i={type:n.type,consoleLogs:n.consoleLogs.concat(t.payload.logString)};a=e[s].output.slice(0,-1),a.push(i)}return{...e,[s]:{...e[s],output:a}};case l.a:const d=e.playground;return{...c.l,playground:d};case A.o:return{...e,[s]:{...e[s],isRunning:!0,isDebugging:!1}};case A.q:return{...e,[s]:{...e[s],isRunning:!0}};case S.h:const u=e[s].context.executionMethod,h={type:t.payload.type,value:"interpreter"===u?t.payload.value:Object(y.stringify)(t.payload.value)};return n=e[s].output.slice(-1)[0],a=void 0!==n&&"running"===n.type?e[s].output.slice(0,-1).concat({consoleLogs:n.consoleLogs,...h}):e[s].output.concat({consoleLogs:[],...h}),{...e,[s]:{...e[s],output:a,isRunning:!1}};case S.j:return{...e,[s]:{...e[s],editorTestcases:e[s].editorTestcases.map(((e,s)=>s===t.payload.index?{...e,result:t.payload.value,errors:void 0}:e)),isRunning:!1}};case S.i:return{...e,[s]:{...e[s],editorTestcases:e[s].editorTestcases.map(((e,s)=>s===t.payload.index?{...e,result:void 0,errors:t.payload.value}:e))}};case S.g:return n=e[s].output.slice(-1)[0],a=void 0!==n&&"running"===n.type?e[s].output.slice(0,-1).concat({type:t.payload.type,errors:t.payload.errors,consoleLogs:n.consoleLogs}):e[s].output.concat({type:t.payload.type,errors:t.payload.errors,consoleLogs:[]}),{...e,[s]:{...e[s],output:a,isRunning:!1,isDebugging:!1}};case S.f:return{...e,[s]:{...e[s],isRunning:!1,isDebugging:!1}};case S.e:return{...e,[s]:{...e[s],isRunning:!1,isDebugging:!0}};case S.d:return{...e,[s]:{...e[s],isRunning:!0,isDebugging:!1}};case S.c:return{...e,[s]:{...e[s],isRunning:!1,isDebugging:!1}};case A.x:return{...e,[s]:{...e[s],editorTestcases:e[s].editorTestcases.map(((e,s)=>s===t.payload.index?{...e,result:void 0,errors:void 0}:e))}};case A.y:return{...e,[s]:{...e[s],...Object(c.b)(s),...t.payload.workspaceOptions}};case A.K:return{...e,[s]:{...e[s],...t.payload.workspaceOptions}};case w.a:return{...e,[s]:{...e[s],editorSessionId:t.payload.editorSessionId}};case f.b:return{...e,[s]:{...e[s],isEditorReadonly:t.payload.isEditorReadonly}};case w.b:return{...e,[s]:{...e[s],sharedbConnected:t.payload.connected}};case A.A:return{...e,[s]:{...e[s],isEditorAutorun:!e[s].isEditorAutorun}};case A.B:return"playground"===s||"sicp"===s?{...e,[s]:{...e[s],usingSubst:t.payload.usingSubst}}:e;case A.D:return{...e,assessment:{...e.assessment,currentAssessment:t.payload.assessmentId,currentQuestion:t.payload.questionId}};case A.E:return{...e,grading:{...e.grading,currentSubmission:t.payload.submissionId,currentQuestion:t.payload.questionId}};case A.C:const p=e[s].activeEditorTabIndex;if(null===p)return e;const g=[...e[s].editorTabs];return g[p]={...g[p],...t.payload.activeEditorTabOptions},{...e,[s]:{...e[s],editorTabs:g}};case A.F:return{...e,[s]:{...e[s],editorTabs:[{...e[s].editorTabs[0],breakpoints:t.payload.breakpoints}]}};case A.G:return{...e,[s]:{...e[s],editorTabs:[{...e[s].editorTabs[0],value:t.payload.newEditorValue}]}};case S.l:return{...e,[s]:{...e[s],editorTabs:[{...e[s].editorTabs[0],highlightedLines:t.payload.highlightedLines}]}};case A.t:return{...e,[s]:{...e[s],editorTabs:[{...e[s].editorTabs[0],newCursorPosition:t.payload.cursorPosition}]}};case A.I:return{...e,[s]:{...e[s],replValue:t.payload.newReplValue}};case A.H:return{...e,[s]:{...e[s],hasUnsavedChanges:t.payload.hasUnsavedChanges}};case A.J:return{...e,playground:{...e.playground,context:{...e.playground.context,chapter:t.payload.sublang.chapter,variant:t.payload.sublang.variant}}};case E.a:return{...e,[s]:{...e[s],debuggerContext:{...e[s].debuggerContext,result:t.payload.result,lastDebuggerResult:t.payload.lastDebuggerResult,code:t.payload.code,context:t.payload.context,workspaceLocation:t.payload.workspaceLocation}}};default:return e}},N=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:c.e;return e};var M=s(90),P=s(15);const R=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:c.j,t=arguments.length>1?arguments[1]:void 0;switch(t.type){case l.a:return c.j;case P.D:return{...e,githubAssessment:t.payload};case P.E:return{...e,githubOctokitObject:{octokit:t.payload}};case P.C:return{...e,githubAccessToken:t.payload};case P.F:return{...e,googleUser:t.payload};case P.G:case P.H:case P.A:case P.B:return{...e,...t.payload};case P.z:return{...e,assessmentConfigurations:t.payload};case P.y:return{...e,userCourseRegistrations:t.payload};case P.O:const s=new Map(e.assessments);return s.set(t.payload.id,t.payload),{...e,assessments:s};case P.Q:return{...e,assessmentOverviews:t.payload};case P.X:return{...e,xp:t.payload};case P.N:return{...e,allUserXp:t.payload};case P.T:const a=new Map(e.gradings);return a.set(t.payload.submissionId,t.payload.grading),{...e,gradings:a};case P.U:return{...e,gradingOverviews:t.payload};case P.W:return{...e,notifications:t.payload};case M.f:return{...e,remoteExecutionDevices:t.payload};case M.g:return{...e,remoteExecutionSession:t.payload};case P.x:return{...e,githubOctokitObject:{octokit:void 0},githubAccessToken:void 0};default:return e}};var _=()=>Object(r.c)({academy:u,achievement:p,application:N,dashboard:m,playground:j,session:R,workspaces:I}),L=s(2),D=s(18),B=s(8),U=s(52),G=s(10),F=s(71);const H=[[{assessmentConfigId:1,type:"Missions",isManuallyGraded:!0,displayInDashboard:!0,hoursBeforeEarlyXpDecay:48,earlySubmissionXp:200},{assessmentConfigId:2,type:"Quests",isManuallyGraded:!0,displayInDashboard:!0,hoursBeforeEarlyXpDecay:48,earlySubmissionXp:200},{assessmentConfigId:3,type:"Paths",isManuallyGraded:!0,displayInDashboard:!0,hoursBeforeEarlyXpDecay:48,earlySubmissionXp:200},{assessmentConfigId:4,type:"Contests",isManuallyGraded:!0,displayInDashboard:!0,hoursBeforeEarlyXpDecay:48,earlySubmissionXp:200},{assessmentConfigId:5,type:"Others",isManuallyGraded:!0,displayInDashboard:!0,hoursBeforeEarlyXpDecay:48,earlySubmissionXp:200}],[{assessmentConfigId:1,type:"Mission Impossible",isManuallyGraded:!0,displayInDashboard:!0,hoursBeforeEarlyXpDecay:48,earlySubmissionXp:200},{assessmentConfigId:2,type:"Data Structures",isManuallyGraded:!0,displayInDashboard:!0,hoursBeforeEarlyXpDecay:48,earlySubmissionXp:200},{assessmentConfigId:3,type:"Algorithm Frenzy",isManuallyGraded:!0,displayInDashboard:!0,hoursBeforeEarlyXpDecay:48,earlySubmissionXp:200}]],V=[...[{type:"Missions",isManuallyGraded:!0,closeAt:"2048-06-18T05:24:26.026Z",coverImage:"https://fakeimg.pl/300/",id:1,maxXp:1e3,openAt:"2038-06-18T05:24:26.026Z",title:"An Odessey to Runes (Duplicate)",shortSummary:"This is a test for the UI of the unopened assessment overview. It links to the mock Mission 0",status:D.a.not_attempted,story:"mission-1",xp:0,gradingStatus:D.c.none}],...[{type:"Missions",isManuallyGraded:!0,closeAt:"2048-06-18T05:24:26.026Z",coverImage:"https://fakeimg.pl/300/",id:1,maxXp:1e3,openAt:"2018-06-18T05:24:26.026Z",title:"An Odessey to Runes",shortSummary:"\n  *Lorem ipsum* dolor sit amet, consectetur adipiscing elit, sed do eiusmod tempor\n  incididunt ut labore et dolore magna aliqua.\n  \n  ```\n  const a = 5;\n  ```\n  \n  Sed ut perspiciatis unde omnis iste natus error sit voluptatem accusantium\n  _doloremque laudantium_, totam rem aperiam, eaque ipsa quae ab illo inventore\n  [veritatis et quasi architecto](google.com) beatae vitae dicta sunt\n  `explicabo`.\n  \n  ",status:D.a.attempted,story:"mission-1",xp:1,gradingStatus:D.c.none},{type:"Missions",isManuallyGraded:!0,closeAt:"2048-06-18T05:24:26.026Z",coverImage:"https://fakeimg.pl/350x200/?text=World&font=lobster",id:2,maxXp:1e3,openAt:"2018-07-18T05:24:26.026Z",title:"The Secret to Streams",shortSummary:"Once upon a time, Lorem ipsum dolor sit amet, consectetur adipiscing elit. Proin nec vulputate sapien. Fusce vel lacus fermentum, efficitur ipsum.",status:D.a.attempting,story:"mission-2",xp:2,gradingStatus:D.c.none},{type:"Quests",isManuallyGraded:!0,closeAt:"2048-06-18T05:24:26.026Z",coverImage:"https://fakeimg.pl/350x200/?text=Hello",id:3,maxXp:1e3,openAt:"2018-07-18T05:24:26.026Z",title:"A sample Sidequest",shortSummary:"Once upon a time, Lorem ipsum dolor sit amet, consectetur adipiscing elit. Proin nec vulputate sapien. Fusce vel lacus fermentum, efficitur ipsum.",status:D.a.not_attempted,story:"sidequest-2.1",xp:3,gradingStatus:D.c.none},{type:"Paths",isManuallyGraded:!0,closeAt:"2069-04-20T01:23:45.111Z",coverImage:"https://fakeimg.pl/700x400/417678,64/?text=%E3%83%91%E3%82%B9&font=noto",id:6,maxXp:200,openAt:"2018-01-01T00:00:00.000Z",title:"Basic logic gates",shortSummary:"This mock path serves as a demonstration of the support provided for mock programming path functionality.",status:D.a.not_attempted,story:null,xp:0,gradingStatus:D.c.excluded},{type:"Others",isManuallyGraded:!1,closeAt:"2048-06-18T05:24:26.026Z",coverImage:"https://fakeimg.pl/350x200/?text=Hello",id:5,maxXp:1e3,openAt:"2018-07-18T05:24:26.026Z",title:"A sample Practical",shortSummary:"Once upon a time, Lorem ipsum dolor sit amet, consectetur adipiscing elit. Proin nec vulputate sapien. Fusce vel lacus fermentum, efficitur ipsum.",status:D.a.not_attempted,story:"sidequest-2.1",xp:3,gradingStatus:D.c.none,private:!0}],...[{type:"Missions",isManuallyGraded:!0,closeAt:"2008-06-18T05:24:26.026Z",coverImage:"https://fakeimg.pl/350x200/ff0000/000",id:4,maxXp:1e3,openAt:"2007-07-18T05:24:26.026Z",title:"A closed Mission",shortSummary:"This is a test for the grading status tooltip when the assessment is partially graded (undergoing manual grading). It should render as an orange clock.",status:D.a.submitted,story:"mission-3",xp:800,gradingStatus:D.c.grading},{type:"Quests",isManuallyGraded:!0,closeAt:"2008-06-18T05:24:26.026Z",coverImage:"https://fakeimg.pl/350x200/ff0000,128/000,255",id:5,maxXp:1e3,openAt:"2007-07-18T05:24:26.026Z",title:"Closed (not graded) Sidequest",shortSummary:"This is a test for the grading status tooltip when the assessment is not graded. It should render as a red cross.",status:D.a.submitted,story:null,xp:500,gradingStatus:D.c.none},{type:"Quests",isManuallyGraded:!0,closeAt:"2008-06-18T05:24:26.026Z",coverImage:"https://fakeimg.pl/350x200/ff0000,128/000,255",id:5,maxXp:500,openAt:"2007-07-18T05:24:26.026Z",title:"Closed (fully graded) Sidequest",shortSummary:"This is a test for the grading status tooltip when the assessment is fully graded. It should render as a green tick. This sidequest links to the mock Sidequest 4.",status:D.a.submitted,story:null,xp:150,gradingStatus:D.c.graded},{type:"Quests",isManuallyGraded:!0,closeAt:"2008-06-18T05:24:26.026Z",coverImage:"https://fakeimg.pl/350x200/ff0000/000",id:5,maxXp:0,openAt:"2007-07-18T05:24:26.026Z",title:"Ungraded assessment",shortSummary:"This is a test for the grading status tooltip when the assessment does not require manual grading (e.g. paths and contests). It should render as a blue disable sign. This sidequest links to the mock Sidequest 4.",status:D.a.submitted,story:null,xp:100,gradingStatus:D.c.excluded}]],W={external:{name:F.a.NONE,symbols:[]},globals:[]},X=[{autogradingResults:[],answer:null,content:"\n  This question has an id of `0`.\n  \n  ```\n  What's your favourite dinner food?\n  ```\n  ",id:0,library:W,prepend:'const pizza = "pizza";\n  const sushi = "sushi";\n  const chickenrice = "chicken rice";',postpend:"// This is a mock Postpend! You shouldn't be able to see me!",testcases:[{type:D.f.public,program:"answer();",score:1,answer:'"pizza"'},{type:D.f.public,program:"answer();",score:1,answer:'"sushi"'},{type:D.f.public,program:"answer();",score:1,answer:'"chicken rice"'}],solutionTemplate:"function answer() {\n      // Write something here!\n  }\n  ",type:"programming",xp:0,maxXp:2,blocking:!1},{autogradingResults:[],answer:"function areaOfCircle(x) {\n      return square(x) * pi;\n  }\n  \n  function volumeOfSphere(x) {\n      return 4 / 3 * cube(x) * pi;\n  }",content:"Hello and welcome to this assessment! This is the 1st question.",id:1,library:W,prepend:"const square = x => x * x;\n  const cube = x => x * x * x;\n  const pi = 3.1415928;",postpend:"",testcases:[{type:D.f.public,program:"areaOfCircle(5);",score:1,answer:"78.53982"},{type:D.f.public,program:"volumeOfSphere(5);",score:1,answer:"523.5988"}],solutionTemplate:"function areaOfCircle(x) {\n      // return area of circle\n  }\n  \n  function volumeOfSphere(x) {\n      // return volume of sphere\n  }",type:"programming",xp:0,maxXp:2,blocking:!1},{answer:3,content:"This is the 3rd question. Oddly enough, it is an ungraded MCQ question that uses the binary tree library! Option C has a null hint!",choices:[{content:"**Option** `A`",hint:"_hint_ A is `here`"},{content:"### B",hint:"hint B"},{content:"C",hint:null},{content:"D",hint:"hint D"}],id:2,library:W,type:"mcq",solution:0,xp:0,maxXp:2,blocking:!1},{answer:3,content:"This is the 4th question. Oddly enough, it is a graded MCQ question that uses the binary tree library!",choices:[{content:"A",hint:null},{content:"B",hint:null},{content:"C",hint:null},{content:"D",hint:null}],id:3,library:W,type:"mcq",solution:void 0,xp:0,maxXp:2,blocking:!1},{autogradingResults:[],answer:null,content:"You have reached the last question! Have some fun with the tone matrix...",id:4,library:W,prepend:"",postpend:"",testcases:[],solutionTemplate:"5th question mock solution template",type:"programming",xp:0,maxXp:2,blocking:!1}],$=[{answer:"function fibonacci(n) {\n      if (n <= 2) {\n          return 1;\n      } else {\n          return fibonacci(n-1) + fibonacci(n-2);\n      }\n  }",content:"You can see autograding results!!!",id:0,library:W,prepend:"",postpend:"// This is a mock Postpend! You shouldn't be able to see me!",testcases:[{type:D.f.public,program:"fibonacci(3);",score:1,answer:"2"},{type:D.f.public,program:"fibonacci(4);",score:1,answer:"3"},{type:D.f.public,program:"fibonacci(5);",score:1,answer:"5"}],solutionTemplate:"function fibonacci(n) {\n      // Your answer here\n  }",type:"programming",grader:{name:"avenger",id:1},gradedAt:"2038-06-18T05:24:26.026Z",xp:0,maxXp:2,blocking:!1,comments:"Good job. You are awarded the full marks!\n  \n  ----\n  ## markdown test\n  \n  # header\n  \n  **bold**\n  \n  _italics_\n  \n  * list\n  \n  1. numbered list\n  \n  - [] checkboxes\n  \n  > quote\n  \n      code\n  \n  [link to Source Academy](https://sourceacademy.nus.edu.sg)  \n  \n  ![](image-url-goes-here)",autogradingResults:[{resultType:"pass"},{resultType:"fail",expected:"8",actual:"5"},{resultType:"error",errors:[{errorType:"timeout"},{errorType:"syntax",line:1,location:"student",errorLine:"function fibonacci(n) {",errorExplanation:"Just kidding!"}]}]},{answer:"function recurse(rune, n) {\n      return n <= 1 ? rune : make_cross(recurse(rune, n - 1));\n  }",content:"This is a runes question - there are no testcases nor autograding results.",id:1,library:W,prepend:"",postpend:"",testcases:[],solutionTemplate:"function recurse(rune, n) {\n      // Your answer here\n  }",type:"programming",grader:{name:"some avenger",id:1},gradedAt:"2038-06-18T05:24:26.026Z",xp:0,maxXp:2,blocking:!1,comments:"You open the Report Card, not knowing what to expect...\n  \n      ## WOW!\n      Amazing grasp of runes. We can now move on to the next assignment.\n      \n      <br/>\n      \n      Robot Dog: `woof`\n      \n      You look at the display of the robot dog.\n      \n          FEED ME\n      1. Bread\n      2. Water\n      \n      <br/>\n      \n      * I am hungry.\n      * I am thirsty.\n      \n      <br/>\n      <br/>\n          \n      New message from **Avenger**!\n      \n      > _Cadet, please meet me at Level X-05, outside the pod bay doors. There is an important mission awaiting us._\n      \n      > _May the [Source](https://sourceacademy.nus.edu.sg) be with you._\n      \n      > Best regards, Avocado A. Avenger\n      \n      #### Upcoming Tasks\n      - [] Meet Avenger Avenger at Level X-05\n      - [] Open the Pod Bay Doors",autogradingResults:[]}],q=[{type:"Missions",id:1,longSummary:"This is the mission briefing. Lorem ipsum dolor sit amet, consectetur adipiscing elit. Maecenas viverra, sem scelerisque ultricies ullamcorper, sem nibh sollicitudin enim, at ultricies sem orci eget odio. Pellentesque varius et mauris quis vestibulum. Etiam in egestas dolor. Nunc consectetur, sapien sodales accumsan convallis, lectus mi tempus ipsum, vel ornare metus turpis sed justo. Vivamus at tellus sed ex convallis commodo at in lectus. Pellentesque pharetra pulvinar sapien pellentesque facilisis. Curabitur efficitur malesuada urna sed aliquam. Quisque massa metus, aliquam in sagittis non, cursus in sem. Morbi vel nunc at nunc pharetra lobortis. Aliquam feugiat ultricies ipsum vel sollicitudin. Vivamus nulla massa, hendrerit sit amet nibh quis, porttitor convallis nisi. ",missionPDF:"www.google.com",questions:X,title:"An Odessey to Runes"},{type:"Missions",id:2,longSummary:"This is the mission briefing. Lorem ipsum dolor sit amet, consectetur adipiscing elit. Maecenas viverra, sem scelerisque ultricies ullamcorper, sem nibh sollicitudin enim, at ultricies sem orci eget odio. Pellentesque varius et mauris quis vestibulum. Etiam in egestas dolor. Nunc consectetur, sapien sodales accumsan convallis, lectus mi tempus ipsum, vel ornare metus turpis sed justo. Vivamus at tellus sed ex convallis commodo at in lectus. Pellentesque pharetra pulvinar sapien pellentesque facilisis. Curabitur efficitur malesuada urna sed aliquam. Quisque massa metus, aliquam in sagittis non, cursus in sem. Morbi vel nunc at nunc pharetra lobortis. Aliquam feugiat ultricies ipsum vel sollicitudin. Vivamus nulla massa, hendrerit sit amet nibh quis, porttitor convallis nisi. ",missionPDF:"www.google.com",questions:X,title:"The Secret to Streams"},{type:"Quests",id:3,longSummary:"###This is the sidequest briefing.\n  \n  *Lorem ipsum* dolor sit amet, consectetur adipiscing elit.\n  \n  > Maecenas viverra, sem scelerisque ultricies ullamcorper, sem nibh sollicitudin\n  enim, at ultricies sem orci eget odio. Pellentesque varius et mauris quis\n  vestibulum.\n  \n  - Etiam in egestas dolor.\n  - Nunc consectetur, sapien sodales accumsan convallis, lectus mi tempus ipsum,\n    vel ornare metus turpis sed justo.\n  - Vivamus at tellus sed ex convallis commodo at in lectus.\n  \n  ```\n  Pellentesque\n  pharetra\n  pulvinar\n  sapien\n  ```",missionPDF:"www.google.com",questions:X,title:"A sample Sidequest"},{type:"Missions",id:4,longSummary:"This is the closed mission briefing. The save button should not be there. Lorem ipsum dolor sit amet, consectetur adipiscing elit. Maecenas viverra, sem scelerisque ultricies ullamcorper, sem nibh sollicitudin enim, at ultricies sem orci eget odio. Pellentesque varius et mauris quis vestibulum. Etiam in egestas dolor. Nunc consectetur, sapien sodales accumsan convallis, lectus mi tempus ipsum, vel ornare metus turpis sed justo. Vivamus at tellus sed ex convallis commodo at in lectus. Pellentesque pharetra pulvinar sapien pellentesque facilisis. Curabitur efficitur malesuada urna sed aliquam. Quisque massa metus, aliquam in sagittis non, cursus in sem. Morbi vel nunc at nunc pharetra lobortis. Aliquam feugiat ultricies ipsum vel sollicitudin. Vivamus nulla massa, hendrerit sit amet nibh quis, porttitor convallis nisi. ",missionPDF:"www.google.com",questions:$,title:"A Closed Mission"},{type:"Quests",id:5,longSummary:"This is the closed sidequest briefing. The save button should not exist. This is a placeholder sidequest for testing rendering of grading statuses.",missionPDF:"www.google.com",questions:$,title:"A Closed Sidequest"},{type:"Paths",id:6,longSummary:"### Basic logic gates\n  \n  This path is intended to demonstrate concepts from the lecture **Logic Circuits**. You are strongly encouraged to attempt this path to check your understanding, prior to the next Studio session. For this, you will be granted a small amount of XP!\n  \n  The path comprises 4 questions and is fully autograded and guided, and there are **no private test cases** - there will be no manual review by default. Please consult your Avenger if you require assistance!</TEXT>",missionPDF:"www.google.com",questions:[{answer:null,content:"As a recap: which of the following is not a valid logic gate?",choices:[{content:"XOR gate",hint:"This is the exclusive-OR gate!"},{content:"IF gate",hint:"Correct!"},{content:"AND gate",hint:"This logic gate exists!"},{content:"OR gate",hint:"This logic gate exists!"}],id:0,library:W,type:"mcq",solution:1,xp:0,maxXp:0,blocking:!1},{autogradingResults:[],answer:null,content:"An AND gate is a digital logic gate that implements logical conjunction on its inputs. It returns a single output that is HIGH (active) iff all the inputs to the AND gate are HIGH (active).\n  \n  In this question, let us model an AND gate as a function, and treat HIGH (active) inputs as the boolean value `true` and LOW (inactive) inputs as the boolean value `false`.\n  \n  As an AND gate is not restricted to exactly two inputs, our function shall be the same. Implement the function `AND(inputs)` which takes in the list `inputs` (a list of boolean values), and returns the output of the AND gate as a boolean. You may assume the list `inputs` is of minimum length 2.\n  \n  This question makes use of the sentinel function method to throw custom errors for each testcase.",id:1,library:W,prepend:"const OR = (x, y) => x || y;",postpend:"\n  const __AND = (xs) => {\n    if (AND(list(true, true)) === undefined) {\n      error('Your function is empty!');\n    } else {}\n    \n    const result = AND(xs);\n  \n    if (!is_boolean(result)) {\n      error('Your function does not return a boolean!');\n    } else {}\n    \n    if (equal(xs, list(true, false)) && result) {\n      error('Check the truth table for an AND gate again!');\n    } else if (equal(xs, list(true, true, false)) && result) {\n      error('Are you using all inputs in the list?');\n    } else if (equal(xs, list(true, true, true)) && !result) {\n      error('Are you sure your base case is correct?');\n    } else if (AND(list(true, true)) === AND(list(false, false))) {\n      error('Oi! Do not hardcode values!');\n    } else {\n      return result;\n    }\n  };",testcases:[{type:D.f.public,program:"__AND(list(true, false));",score:0,answer:"false"},{type:D.f.public,program:"__AND(list(true, true, false));",score:0,answer:"false"},{type:D.f.public,program:"__AND(list(true, OR(true, false), OR(true, true)));",score:0,answer:"true"},{type:D.f.opaque,program:"__AND(list(true, OR(false, true), AND(list(true, false)), false));",score:0,answer:"false"},{type:D.f.opaque,program:"__AND(list(true, OR(true, false), OR(true, AND(list(false, true))), true));",score:0,answer:"true"}],solutionTemplate:"function AND(inputs) {\n      // Your answer here!\n  }",type:"programming",xp:0,maxXp:0,blocking:!1},{autogradingResults:[],answer:null,content:"The XOR (exclusive-OR) gate is a digital logic gate that accepts two inputs and returns a single output that is HIGH (active) iff one of the inputs are HIGH (active), but not both.\n  \n  In this question, let us model the XOR gate as a function. Implement the function `XOR(x, y)` which takes two boolean inputs `x` and `y` and which returns the output of the XOR gate as a boolean.\n  \n  This question makes use of the wrapping container method to throw custom errors for each testcase.",id:2,library:W,prepend:"",postpend:"\n  const __XOR = (x, y) => {\n    if (XOR(false, false) === undefined) {\n      error('Your function is empty!');\n    } else {}\n    \n    const result = XOR(x, y);\n  \n    if (!is_boolean(result)) {\n      error('Your function does not return a boolean!');\n    } else {}\n    \n    if (((x && !y) || (y && !x)) && !result) {\n      error('Check your truth tables!');\n    } else if (XOR(false, false) === XOR(false, true)) {\n      error('Oi! Do not hardcode values!');\n    } else {\n      return result;\n    }\n  };",testcases:[{type:D.f.public,program:"__XOR(true, false);",score:0,answer:"true"},{type:D.f.public,program:"__XOR(false, true);",score:0,answer:"true"},{type:D.f.opaque,program:"__XOR(true, XOR(true, false));",score:0,answer:"false"}],solutionTemplate:"function XOR(x, y) {\n      // Your answer here!\n  }",type:"programming",xp:0,maxXp:0,blocking:!1},{autogradingResults:[],answer:null,content:"The NOR logic gate is special in that it is an _universal logic gate_, that is to say, they can be composed to form any other logic gate.\n  \n  Implement the AND logic gate **using ONLY the NOR logic gate**, as the `NOR_AND(x, y)` function that takes in two booleans as input.\n  \n  The `NOR` function modeled after a NOR gate is provided for you - it accepts two boolean values and returns `true` iff both inputs are `false`.",id:3,library:W,prepend:"\n  let counter = 0;\n  const NOR = (x, y) => {\n    counter = counter + 1;\n    return !(x || y);\n  };",postpend:"\n  const __NOR_AND = (x, y) => {\n    if (NOR_AND(false, false) === undefined) {\n      error('Your function is empty!');\n    } else {}\n    \n    counter = 0;\n    const result = NOR_AND(x, y);\n  \n    if (!is_boolean(result)) {\n      error('Your function does not return a boolean!');\n    } else {}\n    \n    if (!x && y && result) {\n      error('Check your truth tables!');\n    } else if (x && y && !result && counter > 0) {\n      error('Nope! Try again :)');\n    } else if (x && y && !result) {\n      error('...You did not use NOR and still got it wrong!');\n    } else if (x && y && result && counter !== 3) {\n      error('Did you use NOR in your solution? >:(');\n    } else if (x && !y && counter !== 6) {\n      error('Incorrect number of calls.');\n    } else {\n      return result;\n    }\n  };",testcases:[{type:D.f.public,program:"__NOR_AND(false, true);",score:0,answer:"false"},{type:D.f.public,program:"__NOR_AND(true, true);",score:0,answer:"true"},{type:D.f.opaque,program:"__NOR_AND(true, NOR_AND(false, true));",score:0,answer:"false"}],solutionTemplate:"function NOR_AND(x, y) {\n      // Your answer here!\n  }",type:"programming",xp:0,maxXp:0,blocking:!1}],title:"A sample guided path"},{type:"Others",id:7,title:"A sample contest voting assessment",longSummary:"Vote for your favourite contest entries here!",missionPDF:"www.google.com",questions:[{id:0,type:"voting",content:"Sample Contest Voting Question",xp:0,maxXp:0,answer:[],prepend:"",postpend:"",contestEntries:[{submission_id:1,answer:{code:"display('voting test')"}},{submission_id:2,answer:{code:"function voting_test() { return true; }"}}],contestLeaderboard:[{submission_id:1,student_name:"student_1",answer:{code:"display('leaderboard test')"}},{submission_id:2,student_name:"student_2",answer:{code:"function leaderboard_test() { return true; }"}}],library:W,blocking:!1}]}];var z=s(104);const Y=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:c.a.Staff;return t},K={userId:123,name:"DevAdmin",courses:[{courseId:1,courseName:"CS1101S Programming Methodology (AY20/21 Sem 1)",courseShortName:"CS1101S",role:c.a.Admin,viewable:!0},{courseId:2,courseName:"CS2040S Data Structures and Algorithms (AY20/21 Sem 2)",courseShortName:"CS2040S",role:c.a.Admin,viewable:!1},{courseId:3,courseName:"CS2030S Programming Methodology II (AY21/22 Sem 1)",courseShortName:"CS2030S",role:c.a.Staff,viewable:!1}]},Q=[{courseRegId:1,role:c.a.Admin,group:"1F",gameState:{},courseId:1,xp:0,story:{story:"mission-1",playStory:!0},agreedToResearch:!0},{courseRegId:2,role:c.a.Student,group:"1F",gameState:{},courseId:2,xp:0,story:{story:"mission-1",playStory:!0},agreedToResearch:!0}],J=[{courseRegId:1,courseId:1,name:"DevAdmin",username:"test/admin",role:c.a.Admin},{courseRegId:3,courseId:1,name:"Dummy student",username:"test/student",role:c.a.Student},{courseRegId:4,courseId:1,name:"Dummy staff",username:"test/staff",role:c.a.Staff}],Z=[{courseName:"CS1101S Programming Methodology (AY20/21 Sem 1)",courseShortName:"CS1101S",viewable:!0,enableGame:!1,enableAchievements:!0,enableSourcecast:!0,sourceChapter:i.Chapter.CALC,sourceVariant:i.Variant.DEFAULT,moduleHelpText:"",assetsPrefix:""},{courseName:"CS2040S Data Structures and Algorithms (AY20/21 Sem 2)",courseShortName:"CS2040S",viewable:!0,enableGame:!1,enableAchievements:!1,enableSourcecast:!1,sourceChapter:i.Chapter.CALC,sourceVariant:i.Variant.DEFAULT,moduleHelpText:"Help Text!",assetsPrefix:""}],ee=[{id:1,type:z.a.deadline,assessment_id:3,assessment_type:"Quests",assessment_title:"The Secret to Streams"},{id:2,type:z.a.autograded,assessment_id:4,assessment_type:"Missions",assessment_title:"A Closed Mission"},{id:3,type:z.a.graded,assessment_id:4,assessment_type:"Missions",assessment_title:"A Closed Mission"},{id:4,type:z.a.new,assessment_id:6,assessment_type:"Paths",assessment_title:"Basic Logic"},{id:5,type:z.a.new,assessment_id:7,assessment_type:"Missions",assessment_title:"Symphony of the Winds"},{id:6,type:z.a.submitted,submission_id:1,assessment_type:"Missions",assessment_title:"Mission 0"},{id:7,type:z.a.submitted,submission_id:2,assessment_type:"Missions",assessment_title:"Mission 1"},{id:8,type:z.a.submitted,submission_id:3,assessment_type:"Missions",assessment_title:"Mission 0"}],te=[{xpAdjustment:0,assessmentType:"Missions",assessmentId:0,assessmentName:"Mission 0 ",currentXp:69,xpBonus:10,initialXp:69,maxXp:100,studentId:0,studentName:"Al Gorithm",submissionId:1,submissionStatus:"submitted",groupName:"1D",gradingStatus:"graded",questionCount:6,gradedCount:6},{xpAdjustment:-2,assessmentType:"Missions",assessmentId:1,assessmentName:"Mission 1",currentXp:-2,xpBonus:12,initialXp:0,maxXp:400,studentId:0,studentName:"Dee Sign",submissionId:2,submissionStatus:"submitted",groupName:"1F",gradingStatus:"grading",questionCount:6,gradedCount:2},{xpAdjustment:4,assessmentType:"Missions",assessmentId:0,assessmentName:"Mission 0",currentXp:1e3,xpBonus:12,initialXp:996,maxXp:1e3,studentId:1,studentName:"May Trix",submissionId:3,submissionStatus:"submitted",groupName:"1F",gradingStatus:"none",questionCount:6,gradedCount:0}],se=[{question:{answer:"function remainder(n, d) {\n  return (n - d) < 0 ? n : remainder(n - d, d);\n}",content:"\nHello and welcome to this assessment! This is the *0th question*.\n\n```\n>>> import this\n```\n",prepend:"// THIS IS A PREPEND",postpend:"// THIS IS A POSTPEND",testcases:[{type:D.f.public,program:"remainder(12, 7);",score:1,answer:"5"},{type:D.f.public,program:"remainder(6, 1);",score:2,answer:"0"},{type:D.f.opaque,program:"remainder(-15, 6);",score:2,answer:"-3"},{type:D.f.opaque,program:"remainder(17, 23) === 17;",score:2,answer:"true"}],id:0,library:W,solutionTemplate:"0th question mock solution template",solution:"This is how the 0th question is solved. [7 points]\n\nfunction remainder(n, d) {\n  return n % d;\n}",type:"programming",maxXp:1e3,grader:{name:"avenger",id:1},gradedAt:"2038-06-18T05:24:26.026Z",xp:1,autogradingResults:[{resultType:"pass"},{resultType:"fail",expected:"8",actual:"5"},{resultType:"error",errors:[{errorType:"dummyErrorType"}]},{resultType:"error",errors:[{errorType:"systemError",errorMessage:"Cannot read property 'getUniformLocation' of null"}]},{resultType:"error",errors:[{errorType:"timeout"},{errorType:"syntax",line:2,location:"student",errorLine:"return (n - d) < 0 ? n : remainder(n - d, d)",errorExplanation:"Missing semicolon at the end of statement"}]}],blocking:!1},grade:{xpAdjustment:0,xp:0,comments:"Good job. You are awarded the full marks!\n\n----\n## markdown test\n\n# header\n\n**bold**\n\n_italics_\n\n* list\n\n1. numbered list\n\n- [] checkboxes\n\n> quote\n\n    code\n\n[link to Source Academy](https://sourceacademy.nus.edu.sg)\n\n![](image-url-goes-here)\n      ",grader:{name:"HARTIN MENZ",id:100},gradedAt:"2019-08-16T13:26:32+00:00"},student:{name:"Al Gorithm",id:0}},{question:{prepend:"",postpend:"",testcases:[],answer:"This student's answer to the 1st question",content:"Hello and welcome to this assessment! This is the 1st question.",id:1,library:W,solutionTemplate:"1st question mock solution template",solution:null,type:"programming",maxXp:200,grader:{name:"avenger",id:1},gradedAt:"2038-06-18T05:24:26.026Z",xp:1,autogradingResults:[{resultType:"pass"},{resultType:"fail",expected:"8",actual:"5"},{resultType:"error",errors:[{errorType:"timeout"},{errorType:"syntax",line:1,location:"student",errorLine:"function fibonacci(n) {",errorExplanation:"Just kidding!"}]}],blocking:!1},grade:{xpAdjustment:0,xp:100,comments:"You open the Report Card, not knowing what to expect...\n\n## WOW!\nAmazing grasp of runes. We can now move on to the next assignment.\n\n<br/>\n\nRobot Dog: `woof`\n\nYou look at the display of the robot dog.\n\n    FEED ME\n1. Bread\n2. Water\n\n<br/>\n\n* I am hungry.\n* I am thirsty.\n\n<br/>\n<br/>\n\nNew message from **Avenger**!\n\n> _Cadet, please meet me at Level X-05, outside the pod bay doors. There is an important mission awaiting us._\n\n> _May the [Source](https://sourceacademy.nus.edu.sg) be with you._\n\n> Best regards, Avocado A. Avenger\n\n#### Upcoming Tasks\n- [] Meet Avenger Avenger at Level X-05\n- [] Open the Pod Bay Doors\n      "},student:{name:"Al Gorithm",id:0}},{question:{prepend:"",postpend:"",testcases:[],answer:3,solution:2,content:"Hello and welcome to this assessment! This is the 2nd question. Oddly enough, it is an MCQ question!",choices:[{content:"A",hint:"hint A"},{content:"B",hint:"hint B"},{content:"C",hint:"hint C"},{content:"D",hint:"hint D"}],id:2,library:W,type:"mcq",maxXp:100,grader:{name:"avenger",id:1},gradedAt:"2038-06-18T05:24:26.026Z",xp:1,autogradingResults:[{resultType:"pass"},{resultType:"fail",expected:"8",actual:"5"},{resultType:"error",errors:[{errorType:"timeout"},{errorType:"syntax",line:1,location:"student",errorLine:"function fibonacci(n) {",errorExplanation:"Just kidding!"}]}],blocking:!1},grade:{xpAdjustment:0,xp:50},student:{name:"Al Gorithm",id:0}}],ae={cols:["group","avenger","ungradedMissions","submittedMissions","ungradedQuests","submittedQuests"],rows:[{group:"Mock Group 1",avenger:"John",ungradedMissions:123,submittedMissions:200,ungradedQuests:100,submittedQuests:117},{group:"Mock Group 2",avenger:"Molly",ungradedMissions:1232,submittedMissions:205430,ungradedQuests:345,submittedQuests:11547},{group:"Mock Group 3",avenger:"Lenny",ungradedMissions:1532,submittedMissions:22200,ungradedQuests:134500,submittedQuests:6777}]};function*ne(){yield Object(L.h)(P.j,(function*(t){yield Object(L.d)(B.a.setTokens({accessToken:"accessToken",refreshToken:"refreshToken"})),yield e();const s=yield Object(L.f)((e=>e.session.courseId));yield U.a.push(`/courses/${s}`)}));const e=function*(){const e={...K},t={...Q[0]},s={...Z[0]},a=[...H[0]],n={chapter:s.sourceChapter,variant:s.sourceVariant,displayName:Object(c.o)(s.sourceChapter,s.sourceVariant)};yield Object(L.d)(B.a.setUser(e)),yield Object(L.d)(B.a.setCourseRegistration(t)),yield Object(L.d)(B.a.setCourseConfiguration(s)),yield Object(L.d)(B.a.setAssessmentConfigurations(a)),yield Object(L.d)(B.a.updateSublanguage(n))};yield Object(L.h)(P.q,e),yield Object(L.h)(P.k,(function*(){const e={...Z[0]};yield Object(L.d)(B.a.setCourseConfiguration(e))})),yield Object(L.h)(D.b,(function*(){yield Object(L.d)(B.a.updateAssessmentOverviews([...V]))})),yield Object(L.h)(P.f,(function*(e){const t=e.payload,s=q[t-1];yield Object(L.d)(B.a.updateAssessment({...s}))})),yield Object(L.h)(P.I,(function*(e){const t=e.payload.id,s=e.payload.answer,a=yield Object(L.f)((e=>e.workspaces.assessment.currentAssessment)),n=yield Object(L.f)((e=>e.session.assessments.get(a))),i=n.questions.slice().map((e=>(e.id===t&&(e.answer=s),e))),r={...n,questions:i};return yield Object(L.d)(B.a.updateAssessment(r)),yield Object(L.a)(G.d,"Saved!",1e3),yield Object(L.d)(B.a.updateHasUnsavedChanges("assessment",!1))})),yield Object(L.h)(D.e,(function*(e){const t=e.payload,s=(yield Object(L.f)((e=>e.session.assessmentOverviews))).map((e=>e.id===t?{...e,status:D.a.submitted}:e));return yield Object(L.a)(G.d,"Submitted!",2e3),yield Object(L.d)(B.a.updateAssessmentOverviews(s))})),yield Object(L.h)(P.m,(function*(e){const t=yield Object(L.f)((e=>e.session.accessToken)),s=e.payload,a=yield Object(L.a)((()=>((e,t)=>{const s=[c.a.Admin,c.a.Staff],a=Y(e);return null!==a&&s.includes(a)?t?[te[0]]:te.sort(((e,t)=>e.assessmentId!==t.assessmentId?t.assessmentId-e.assessmentId:t.submissionId-e.submissionId)):null})(t,s)));null!==a&&(yield Object(L.d)(B.a.updateGradingOverviews([...a])))})),yield Object(L.h)(P.l,(function*(e){const t=e.payload,s=yield Object(L.f)((e=>e.session.accessToken)),a=yield Object(L.a)((()=>((e,t)=>{const s=[c.a.Admin,c.a.Staff],a=Y(e);return null!==a&&s.includes(a)?se:null})(s)));null!==a&&(yield Object(L.d)(B.a.updateGrading(t,[...a])))})),yield Object(L.h)(P.M,(function*(e){const{submissionId:t}=e.payload,s=yield Object(L.f)((e=>e.session.gradingOverviews||[]));if(-1===s.findIndex((e=>e.submissionId===t&&"submitted"===e.submissionStatus)))return void(yield Object(L.a)(G.e,"400: Bad Request"));const a=s.map((e=>e.submissionId===t?{...e,submissionStatus:"attempted"}:e));yield Object(L.a)(G.d,"Unsubmit successful!",1e3),yield Object(L.d)(B.a.updateGradingOverviews(a))}));const t=function*(e){if((yield Object(L.f)((e=>e.session.role)))===c.a.Student)return yield Object(L.a)(G.e,"Only staff can submit answers.");const{submissionId:t,questionId:s,xpAdjustment:a,comments:n}=e.payload,i=(yield Object(L.f)((e=>e.session.gradings.get(t)))).slice().map((e=>(e.question.id===s&&(e.grade={xpAdjustment:a,xp:e.grade.xp,comments:n}),e)));yield Object(L.d)(B.a.updateGrading(t,i)),yield Object(L.a)(G.d,"Submitted!",1e3)};yield Object(L.h)(P.K,t),yield Object(L.h)(P.L,(function*(e){const{submissionId:s}=e.payload;yield*t(e);const[a,n]=yield Object(L.f)((e=>[e.workspaces.grading.currentQuestion,e.session.courseId]));yield U.a.push(`/courses/${n}/grading/${s}/${(a||0)+1}`)})),yield Object(L.h)(P.n,(function*(e){yield Object(L.d)(B.a.updateNotifications([...ee]))})),yield Object(L.h)(P.a,(function*(e){const t=e.payload.withFilter,s=yield Object(L.f)((e=>e.session.notifications));let a=s;if(t&&(a=t(s)),0===a.length)return;const n=a.map((e=>e.id)),i=s.filter((e=>!n.includes(e.id)));yield Object(L.d)(B.a.updateNotifications(i))})),yield Object(L.h)(P.V,(function*(e){const{courseId:t}=e.payload,s=t-1,a={...Z[s]};yield Object(L.d)(B.a.setCourseConfiguration(a)),yield Object(L.d)(B.a.setAssessmentConfigurations([...H[s]])),yield Object(L.d)(B.a.setCourseRegistration({...Q[s]})),yield Object(L.d)(B.a.updateSublanguage({chapter:a.sourceChapter,variant:a.sourceVariant,displayName:Object(c.o)(a.sourceChapter,a.sourceVariant)})),yield Object(L.a)(G.d,`Switched to ${a.courseName}!`,5e3)})),yield Object(L.h)(P.R,(function*(e){const t=e.payload;yield Object(L.d)(B.a.setCourseConfiguration(t)),yield Object(L.a)(G.d,"Updated successfully!",1e3)})),yield Object(L.h)(P.P,(function*(e){const t=e.payload;yield Object(L.d)(B.a.setAssessmentConfigurations(t)),yield Object(L.a)(G.d,"Updated successfully!",1e3)})),yield Object(L.h)(P.d,(function*(e){const t=[...J];yield Object(L.d)(B.a.setAdminPanelCourseRegistrations(t))})),yield Object(L.h)(g.a,(function*(){yield Object(L.d)(B.a.updateGroupGradingSummary({...ae}))}))}var ie=s(293),re=s(171),oe=s(75);function ce(e,t){if(e.meta.type===h.l.EVENT&&(s=e.meta,!Object(oe.a)(s.deadline)&&Object(oe.b)(s.release)&&Object(oe.c)(s.observeFrom,s.observeTo)))for(let a=0;a<e.meta.eventNames.length;a++)for(let s=0;s<t.length;s++)if(e.meta.eventNames[a]===t[s])return!0;var s;return!1}var le=s(30),de=s(1304);function ue(e){de.a(e),console.error(e)}function he(e){return e&&"function"===typeof e.next&&"function"===typeof e.throw}function pe(e,t){function*s(){try{const e=t(...arguments);he(e)&&(yield*e)}catch(e){ue(e)}}for(var a=arguments.length,n=new Array(a>2?a-2:0),i=2;i<a;i++)n[i-2]=arguments[i];return Object(L.h)(e,s,...n)}function ge(e,t){function*s(){try{const e=t(...arguments);he(e)&&(yield*e)}catch(e){ue(e)}}for(var a=arguments.length,n=new Array(a>2?a-2:0),i=2;i<a;i++)n[i-2]=arguments[i];return Object(L.i)(e,s,...n)}function me(){return Object(L.f)((e=>({accessToken:e.session.accessToken,refreshToken:e.session.refreshToken})))}function*be(){yield pe(h.c,(function*(e){const t=yield me(),s=e.payload;yield Object(L.a)(le.a,s,t)})),yield pe(h.d,(function*(e){const t=yield me(),s=e.payload;yield Object(L.a)(le.b,s,t)})),yield pe(h.g,(function*(){const e=yield me(),t=yield Object(L.a)(le.f,e);t&&(yield Object(L.d)(B.a.saveAchievements(t)))})),yield pe(h.h,(function*(e){const t=yield me(),s=e.payload,a=yield Object(L.a)(le.n,t,s);a&&(yield Object(L.d)(B.a.saveGoals(a)))})),yield pe(h.i,(function*(e){const t=yield me(),s=yield Object(L.a)(le.t,t);s&&(yield Object(L.d)(B.a.saveGoals(s)))})),yield pe(h.j,(function*(e){const t=yield me(),s=yield Object(L.a)(le.h,t);s&&(yield Object(L.d)(B.a.saveUsers(s)))})),yield pe(h.n,(function*(e){const t=yield me(),s=e.payload;yield Object(L.a)(le.Q,s,t)})),yield pe(h.o,(function*(e){const t=yield me(),s=e.payload;yield Object(L.a)(le.S,s,t)})),yield pe(h.u,(function*(e){const t=yield me(),s=e.payload;yield Object(L.a)(le.X,s,t)})),yield pe(h.t,(function*(e){const t=yield me(),{studentCourseRegId:s,progress:a}=e.payload,n=yield Object(L.a)(le.W,s,a,t);n&&n.ok&&(yield Object(L.d)(B.a.getGoals(s)),Object(ie.b)())}));let e=[],t=!1;yield pe(h.a,(function*(s){const a=yield Object(L.f)((e=>e.session.role)),n=yield Object(L.f)((e=>e.session.enableAchievements));a&&n&&!T.b.playgroundOnly&&(e.push(s.payload),!t&&a&&(t=!0,yield Object(L.b)(3e3),t=!1,yield Object(L.d)(B.a.handleEvent(e)),e=[]))})),yield pe(h.m,(function*(e){const t=yield me(),s=yield Object(L.a)(le.f,t);s&&(yield Object(L.d)(B.a.saveAchievements(s)));const a=yield Object(L.a)(le.t,t);if(!a)return;yield Object(L.d)(B.a.saveGoals(a));const n=yield Object(L.f)((e=>e.achievement.achievements)),i=yield Object(L.f)((e=>e.achievement.goals)),r=new re.a(n,i),o=e.payload,c=new Set;o.forEach((e=>{i.filter((t=>ce(t,e))).map((e=>e.uuid)).forEach((e=>{!function(e,t){const s={...t.getGoalProgress(e)};s.count=s.count+1;const a=s.completed;s.completed=s.count>=s.targetCount;const n=[];if(!a&&s.completed){const s=t.getAchievementsByGoal(e);for(const e of s)t.isCompleted(t.getAchievement(e))||n.push(e)}t.modifyGoalProgress(s);for(const i of n){const e=t.getAchievement(i);t.isCompleted(e)&&Object(G.d)("Completed acheivement: "+e.title)}}(e,r),c.add(e)}))}));for(const l of c){if(!(yield Object(L.a)(le.X,r.getGoalProgress(l),t)))return}})),yield pe(h.k,(function*(e){const t=yield me(),s=yield Object(L.a)(le.x,e.payload,t);s&&(yield Object(L.d)(B.a.saveUserAssessmentOverviews(s)))}))}var je=s(151);function ye(e){const t=T.b.authProviders.get(e);if(!t)return;const s=""===window.location.port?"":`:${window.location.port}`;return`${window.location.protocol}//${window.location.hostname}${s}/login${t.isDefault?"":"?provider="+encodeURIComponent(e)}`}function Oe(){return Object(L.f)((e=>({accessToken:e.session.accessToken,refreshToken:e.session.refreshToken})))}function*fe(e){return e&&e.ok?yield Object(L.a)(G.d,"Autograde job queued successfully."):e&&400===e.status?yield Object(L.a)(G.e,"Cannot reautograde non-submitted submission."):yield Object(L.a)(G.e,"Failed to queue autograde job.")}var ve=function*(){yield pe(P.j,(function*(e){const{code:t,providerId:s}=e.payload,a=s||([...T.b.authProviders.entries()].find((e=>{let[t,{isDefault:s}]=e;return s}))||[null])[0];if(!a)return yield Object(L.a)(G.e,"Could not log in; invalid provider or no providers configured."),yield U.a.push("/");const n=function(e){const t=T.b.authProviders.get(e);if(t)try{return new URL(t.endpoint).searchParams.get("client_id")||void 0}catch(s){return t.endpoint||void 0}}(a),i=ye(a),r=yield Object(L.a)(le.D,t,a,n,i);if(!r)return yield U.a.push("/");yield Object(L.d)(B.a.setTokens(r));const{user:o,courseRegistration:c,courseConfiguration:l,assessmentConfigurations:d}=yield Object(L.a)(le.w,r);return o?(yield Object(L.d)(B.a.setUser(o)),null===l&&o.courses.length>0&&(yield Object(L.d)(B.a.updateLatestViewedCourse(o.courses[0].courseId))),c&&l&&d?(yield Object(L.d)(B.a.setCourseRegistration(c)),yield Object(L.d)(B.a.setCourseConfiguration(l)),yield Object(L.d)(B.a.setAssessmentConfigurations(d)),yield U.a.push(`/courses/${c.courseId}`)):yield U.a.push("/welcome")):void 0})),yield pe(P.q,(function*(e){const t=yield Oe(),{user:s,courseRegistration:a,courseConfiguration:n,assessmentConfigurations:i}=yield Object(L.a)(le.w,t);s&&(yield Object(L.d)(B.a.setUser(s)),null===n&&s.courses.length>0&&(yield Object(L.d)(B.a.updateLatestViewedCourse(s.courses[0].courseId))),a&&n&&i&&(yield Object(L.d)(B.a.setCourseRegistration(a)),yield Object(L.d)(B.a.setCourseConfiguration(n)),yield Object(L.d)(B.a.setAssessmentConfigurations(i))))})),yield pe(P.k,(function*(){const e=yield Oe(),{config:t}=yield Object(L.a)(le.l,e);t&&(yield Object(L.d)(B.a.setCourseConfiguration(t)))})),yield pe(D.b,(function*(){const e=yield Oe(),t=yield Object(L.a)(le.k,e);t&&(yield Object(L.d)(B.a.updateAssessmentOverviews(t)))})),yield pe(P.e,(function*(){const e=yield Oe(),t=yield Object(L.a)(le.g,e);t&&(yield Object(L.d)(B.a.updateAllUserXp(t.all_users_xp)))})),yield pe(P.o,(function*(){const e=yield Oe(),t=yield Object(L.a)(le.v,e);t&&(yield Object(L.d)(B.a.updateTotalXp(t.totalXp)))})),yield pe(P.p,(function*(e){const t=yield Oe(),s=e.payload,a=yield Object(L.a)(le.v,t,s);a&&(yield Object(L.d)(B.a.updateTotalXp(a.totalXp)))})),yield pe(P.f,(function*(e){const t=yield Oe(),s=e.payload,a=yield Object(L.a)(le.i,s,t);a&&(yield Object(L.d)(B.a.updateAssessment(a)))})),yield pe(P.g,(function*(e){const t=yield Oe(),{assessmentId:s,courseRegId:a}=e.payload,n=yield Object(L.a)(le.i,s,t,a);n&&(yield Object(L.d)(B.a.updateAssessment(n)))})),yield pe(P.I,(function*(e){const t=yield Oe(),s=e.payload.id,a=e.payload.answer,n=yield Object(L.a)(le.B,s,a,t);if(!n||!n.ok)return yield Object(le.z)(n);yield Object(L.a)(G.d,"Saved!",1e3);const i=yield Object(L.f)((e=>e.workspaces.assessment.currentAssessment)),r=yield Object(L.f)((e=>e.session.assessments.get(i))),o=r.questions.slice().map((e=>e.id===s?{...e,answer:a}:e)),c={...r,questions:o};return yield Object(L.d)(B.a.updateAssessment(c)),yield Object(L.d)(B.a.updateHasUnsavedChanges("assessment",!1))})),yield pe(D.e,(function*(e){const t=yield Oe(),s=e.payload,a=yield Object(L.a)(le.C,s,t);if(!a||!a.ok)return yield Object(le.z)(a);yield Object(L.a)(G.d,"Submitted!",2e3);const n=(yield Object(L.f)((e=>e.session.assessmentOverviews))).map((e=>e.id===s?{...e,status:D.a.submitted}:e));return yield Object(L.d)(B.a.updateAssessmentOverviews(n))})),yield pe(P.m,(function*(e){const t=yield Oe(),s=e.payload,a=yield Object(L.a)(le.p,t,s);a&&(yield Object(L.d)(B.a.updateGradingOverviews(a)))})),yield pe(P.l,(function*(e){const t=yield Oe(),s=e.payload,a=yield Object(L.a)(le.o,s,t);a&&(yield Object(L.d)(B.a.updateGrading(s,a)))})),yield pe(P.M,(function*(e){const t=yield Oe(),{submissionId:s}=e.payload,a=yield Object(le.J)(s,t);if(!a||!a.ok)return yield Object(le.z)(a);const n=(yield Object(L.f)((e=>e.session.gradingOverviews||[]))).map((e=>e.submissionId===s?{...e,submissionStatus:"attempted"}:e));yield Object(L.a)(G.d,"Unsubmit successful",1e3),yield Object(L.d)(B.a.updateGradingOverviews(n))}));const e=function*(e){if((yield Object(L.f)((e=>e.session.role)))===c.a.Student)return yield Object(L.a)(G.e,"Only staff can submit answers.");const{submissionId:t,questionId:s,xpAdjustment:a,comments:n}=e.payload,i=yield Oe(),r=yield Object(le.F)(t,s,a,i,n);if(!r||!r.ok)return yield Object(le.z)(r);yield Object(L.a)(G.d,"Submitted!",1e3);const o=(yield Object(L.f)((e=>e.session.gradings.get(t)))).slice().map((e=>(e.question.id===s&&(e.grade={xpAdjustment:a,xp:e.grade.xp,comments:n}),e)));yield Object(L.d)(B.a.updateGrading(t,o))};yield pe(P.K,e),yield pe(P.L,(function*(t){yield*e(t);const{submissionId:s}=t.payload,[a,n]=yield Object(L.f)((e=>[e.workspaces.grading.currentQuestion,e.session.courseId]));yield U.a.push(`/courses/${n}/grading/${s}/${(a||0)+1}`)})),yield pe(P.w,(function*(e){const t=e.payload,s=yield Oe(),a=yield Object(L.a)(le.H,t,s);yield Object(L.a)(fe,a)})),yield pe(P.v,(function*(e){const{submissionId:t,questionId:s}=e.payload,a=yield Oe(),n=yield Object(L.a)(le.G,t,s,a);yield Object(L.a)(fe,n)})),yield pe(P.n,(function*(e){const t=yield Oe(),s=yield Object(L.a)(le.s,t);yield Object(L.d)(B.a.updateNotifications(s))})),yield pe(P.a,(function*(e){const t=yield Oe(),s=e.payload.withFilter,a=yield Object(L.f)((e=>e.session.notifications));let n=a;if(s&&(n=s(a)),0===n.length)return;const i=n.map((e=>e.id)),r=a.filter((e=>!i.includes(e.id)));yield Object(L.d)(B.a.updateNotifications(r));const o=yield Object(L.a)(le.A,t,i);return o&&o.ok?void 0:yield Object(le.z)(o)})),yield pe(x.a,(function*(e){if((yield Object(L.f)((e=>e.session.role)))===c.a.Student)return yield Object(L.a)(G.e,"Only staff can delete sourcecasts.");const t=yield Oe(),{id:s}=e.payload,a=yield Object(le.d)(s,t);if(!a||!a.ok)return yield Object(le.z)(a);const n=yield Object(L.a)(le.u,t);n&&(yield Object(L.d)(B.a.updateSourcecastIndex(n,e.payload.workspaceLocation))),yield Object(L.a)(G.d,"Deleted successfully!",1e3)})),yield pe(f.a,(function*(e){const t=yield Oe(),s=yield Object(L.a)(le.u,t);s&&(yield Object(L.d)(B.a.updateSourcecastIndex(s,e.payload.workspaceLocation)))})),yield pe(O.d,(function*(e){const[t,s]=yield Object(L.f)((e=>[e.session.role,e.session.courseId]));if(t===c.a.Student)return yield Object(L.a)(G.e,"Only staff can save sourcecasts.");const{title:a,description:n,uid:i,audio:r,playbackData:o}=e.payload,l=yield Oe(),d=yield Object(le.I)(a,n,i,r,o,l);if(!d||!d.ok)return yield Object(le.z)(d);yield Object(L.a)(G.d,"Saved successfully!",1e3),yield U.a.push(`/courses/${s}/sourcecast`)})),yield pe(A.i,(function*(e){const t=yield Oe(),{sublang:s}=e.payload,a=yield Object(L.a)(le.L,t,{sourceChapter:s.chapter,sourceVariant:s.variant});if(!a||!a.ok)return yield Object(le.z)(a);yield Object(L.d)(B.a.setCourseConfiguration({sourceChapter:s.chapter,sourceVariant:s.variant})),yield Object(L.a)(G.d,"Updated successfully!",1e3)})),yield pe(P.V,(function*(e){const t=yield Oe(),{courseId:s}=e.payload,a=yield Object(L.a)(le.N,t,s);if(!a||!a.ok)return yield Object(le.z)(a);const{courseRegistration:n,courseConfiguration:i,assessmentConfigurations:r}=yield Object(L.a)(le.r,t);if(!n||!i||!r)return yield Object(L.a)(G.e,"Failed to load course!"),yield U.a.push("/welcome");yield Object(L.d)(B.a.setCourseConfiguration(i)),yield Object(L.d)(B.a.setAssessmentConfigurations(r)),yield Object(L.d)(B.a.setCourseRegistration(n)),yield Object(L.a)(G.d,`Switched to ${i.courseName}!`,5e3)})),yield pe(P.R,(function*(e){const t=yield Oe(),s=e.payload,a=yield Object(L.a)(le.L,t,s);if(!a||!a.ok)return yield Object(le.z)(a);yield Object(L.d)(B.a.setCourseConfiguration(s)),yield Object(L.a)(G.d,"Updated successfully!",1e3)})),yield pe(P.h,(function*(){const e=yield Oe(),t=yield Object(L.a)(le.j,e);t&&(yield Object(L.d)(B.a.setAssessmentConfigurations(t)))})),yield pe(P.P,(function*(e){const t=yield Oe(),s=e.payload,a=yield Object(L.a)(le.K,t,s);if(!a||!a.ok)return yield Object(le.z)(a);const n=yield Object(L.a)(le.j,t);n&&(yield Object(L.d)(B.a.setAssessmentConfigurations(n))),yield Object(L.a)(G.d,"Updated successfully!",1e3)})),yield pe(P.b,(function*(e){const t=yield Oe(),s=e.payload,a=yield Object(L.a)(le.R,t,s);if(!a||!a.ok)return yield Object(le.z)(a)})),yield pe(P.d,(function*(e){const t=yield Oe(),s=yield Object(L.a)(le.y,t);s&&(yield Object(L.d)(B.a.setAdminPanelCourseRegistrations(s)))})),yield pe(d.b,(function*(e){const t=yield Oe(),s=e.payload,a=yield Object(L.a)(le.E,t,s);if(!a||!a.ok)return yield Object(le.z)(a);const{user:n,courseRegistration:i,courseConfiguration:r}=yield Object(L.a)(le.w,t);if(!n||!i||!r)return yield Object(G.e)("An error occurred. Please try again.");yield Object(L.d)(B.a.setUser(n)),yield Object(L.d)(B.a.setCourseRegistration({role:c.a.Student}));const o=yield Object(L.a)(le.K,t,[{type:"Missions",assessmentConfigId:-1,isManuallyGraded:!0,displayInDashboard:!0,hoursBeforeEarlyXpDecay:0,earlySubmissionXp:0}],i.courseId);if(!o||!o.ok)return yield Object(le.z)(a);yield Object(L.a)(G.d,"Successfully created your new course!"),yield Object(L.a)([U.a,"push"],`/courses/${i.courseId}`)})),yield pe(d.a,(function*(e){const t=yield Oe(),{users:s,provider:a}=e.payload,n=yield Object(L.a)(le.O,t,s,a);if(!n||!n.ok)return yield Object(le.z)(n);yield Object(L.d)(B.a.fetchAdminPanelCourseRegistrations()),yield Object(L.a)(G.d,"Users added!")})),yield pe(P.Y,(function*(e){const t=yield Oe(),{courseRegId:s,role:a}=e.payload,n=yield Object(L.a)(le.P,t,s,a);if(!n||!n.ok)return yield Object(le.z)(n);yield Object(L.d)(B.a.fetchAdminPanelCourseRegistrations()),yield Object(L.a)(G.d,"Role updated!")})),yield pe(P.S,(function*(e){const t=yield Oe(),{agreedToResearch:s}=e.payload,a=yield Object(L.a)(le.M,t,s);if(!a||!a.ok)return yield Object(le.z)(a);yield Object(L.d)(B.a.setCourseRegistration({agreedToResearch:s})),yield Object(L.a)(G.d,"Research preference saved!")})),yield pe(P.c,(function*(e){const t=yield Oe(),{courseRegId:s}=e.payload,a=yield Object(L.a)(le.T,t,s);if(!a||!a.ok)return yield Object(le.z)(a);yield Object(L.d)(B.a.fetchAdminPanelCourseRegistrations()),yield Object(L.a)(G.d,"User deleted!")})),yield pe(g.a,(function*(e){const t=yield Oe(),s=yield Object(L.a)(le.q,t);s&&(yield Object(L.d)(B.a.updateGroupGradingSummary(s)))})),yield pe(je.a,(function*(e){const t=yield Oe(),s=e.payload.id,a=e.payload.closeAt,n=e.payload.openAt,i=yield Object(le.V)(s,{openAt:n,closeAt:a},t);if(!i||!i.ok)return yield Object(le.z)(i);yield Object(L.d)(B.a.fetchAssessmentOverviews()),yield Object(L.a)(G.d,"Updated successfully!",1e3)})),yield pe(je.b,(function*(e){const t=yield Oe(),s=e.payload,a=yield Object(le.c)(s,t);if(!a||!a.ok)return yield Object(le.z)(a);yield Object(L.d)(B.a.fetchAssessmentOverviews()),yield Object(L.a)(G.d,"Deleted successfully!",1e3)})),yield pe(je.c,(function*(e){const t=yield Oe(),s=e.payload.id,a=e.payload.togglePublishTo,n=yield Object(le.V)(s,{isPublished:a},t);if(!n||!n.ok)return yield Object(le.z)(n);yield Object(L.d)(B.a.fetchAssessmentOverviews()),a?yield Object(L.a)(G.d,"Published successfully!",1e3):yield Object(L.a)(G.d,"Unpublished successfully!",1e3)})),yield pe(je.d,(function*(e){const t=yield Oe(),{file:s,forceUpdate:a,assessmentConfigId:n}=e.payload,i=yield Object(le.Y)(s,t,a,n);if(!i||!i.ok)return yield Object(le.z)(i);const r=yield i.text();"OK"===r?yield Object(L.a)(G.d,"Uploaded successfully!",2e3):"Force Update OK"===r&&(yield Object(L.a)(G.d,"Assessment force updated successfully!",2e3)),yield Object(L.d)(B.a.fetchAssessmentOverviews())}))};var xe=s(72),Ce=s(42),Se=s(3),we=s(103),Ee=s(20),Te=s.n(Ee),ke=s(1);class Ae{constructor(e,t){this.childrenRetrieved=!1,this.filePath="dummy_path",this.fileType="unset",this.filePath=e,this.fileType=t}}class Ie{static async getFirstLayerRepoFileNodes(e){return""===e?[]:(Ie.fileIndex=0,Ie.currentRepoName=e,await Ie.getChildNodes(e,""))}static async getChildNodes(e,t){const s=[];if(e!==Ie.currentRepoName)return s;const a=xe.f();if(void 0===a)return s;try{const n=(await a.users.getAuthenticated()).data.login,i=(await a.repos.getContent({owner:n,repo:e,path:t})).data;Array.isArray(i)&&i.forEach((e=>{s.push(this.createNode(e))}))}catch(n){console.error(n)}return s}static createNode(e){const t=Ie.fileIndex;let s={id:t,label:"dummy file"};return"file"===e.type&&(s={id:t,nodeData:new Ae(e.path,"file"),icon:"document",label:e.name}),"dir"===e.type&&(s={id:t,nodeData:new Ae(e.path,"dir"),icon:"folder-close",label:e.name,childNodes:[]}),Ie.fileIndex++,s}}Ie.fileIndex=0,Ie.currentRepoName="";var Ne=s(0);var Me=e=>{const[t,s]=Object(ke.useState)([]),[a,n]=Object(ke.useState)(""),[i,r]=Object(ke.useState)("");return Object(ke.useEffect)((()=>{!async function(e,t){try{t(await Ie.getFirstLayerRepoFileNodes(e))}catch(s){console.error(s)}}(e.repoName,s)}),[e.repoName]),Object(Ne.jsxs)(Ce.h,{className:"githubDialog",isOpen:!0,onClose:o,children:[Object(Ne.jsx)("div",{className:Te()("githubDialogHeader",Se.a.DIALOG_HEADER),children:Object(Ne.jsx)("h3",{children:"Select a File"})}),Object(Ne.jsxs)("div",{className:Se.a.DIALOG_BODY,children:[Object(Ne.jsx)(Ce.bb,{contents:t,onNodeClick:async function(e,a,i){const r=e.isSelected,o=await c(t,e,(e=>e.isSelected=!1),(e=>{e.isSelected=null===r||!r;const t=void 0!==e.nodeData&&e.isSelected?e.nodeData.filePath:"";n(t)}));null!==o&&s(o)},onNodeCollapse:async function(e){const a=await c(t,e,(e=>{}),(e=>e.isExpanded=!1));null!==a&&s(a)},onNodeExpand:async function(a){const n=await c(t,a,(e=>{}),(async t=>{t.isExpanded=!0,void 0===t.nodeData||t.nodeData.childrenRetrieved||(t.childNodes=await Ie.getChildNodes(e.repoName,t.nodeData.filePath),t.nodeData.childrenRetrieved=!0)}));null!==n&&s(n)},className:Te()("FileTree",Se.a.ELEVATION_0)}),"Save"===e.pickerType&&Object(Ne.jsxs)("div",{children:[Object(Ne.jsx)(Ce.y,{id:"FileNameTextBox",onChange:function(e){n(e.target.value)},onClick:function(e){""===a&&n(".js")},placeholder:"Enter File Name",value:a}),Object(Ne.jsx)(Ce.y,{onChange:function(e){r(e.target.value)},placeholder:"Enter Commit Message",value:i})]})]}),Object(Ne.jsx)("div",{className:Se.a.DIALOG_FOOTER,children:Object(Ne.jsxs)("div",{className:Se.a.DIALOG_FOOTER_ACTIONS,children:[Object(Ne.jsx)(Ce.b,{onClick:o,children:"Close"}),Object(Ne.jsx)(Ce.a,{onClick:async function(){const t=await e.octokit.users.getAuthenticated(),s=t.data.login,n=t.data.name,r=t.data.email;"Open"===e.pickerType&&await Object(xe.a)(e.octokit,s,e.repoName,a)&&await Object(xe.c)()&&Object(xe.g)(e.octokit,s,e.repoName,a);if("Save"===e.pickerType){const{canBeSaved:t,saveType:o}=await Object(xe.b)(e.octokit,s,e.repoName,a);t&&("Overwrite"===o&&await Object(xe.d)()&&Object(xe.j)(e.octokit,s,e.repoName,a,n,r,i,e.editorContent),"Create"===o&&Object(xe.h)(e.octokit,s,e.repoName,a,n,r,i,e.editorContent))}e.onSubmit("")},intent:we.a.PRIMARY,text:e.pickerType})]})})]});function o(){e.onSubmit("")}async function c(e,t,s,a){if(null===e)return null;const n=[];for(let i=0;i<e.length;i++){const r=e[i],o=Object.assign({},r);if(await s(o),t===r&&await a(o),void 0!==o.childNodes){const e=await c(o.childNodes,t,s,a);null!==e&&(o.childNodes=e)}n.push(o)}return n}};var Pe=e=>{const[t,s]=Object(ke.useState)("");return Object(Ne.jsxs)(Ce.h,{className:"githubDialog",isOpen:!0,onClose:a,children:[Object(Ne.jsx)("div",{className:Te()("githubDialogHeader",Se.a.DIALOG_HEADER),children:Object(Ne.jsx)("h3",{children:"Select a Repository"})}),Object(Ne.jsx)("div",{className:Se.a.DIALOG_BODY,children:Object(Ne.jsx)(Ce.P,{className:"RepositoryRadioGroup",onChange:function(e){s(e.target.value)},selectedValue:t,children:e.userRepos.map((e=>Object(Ne.jsx)(Ce.O,{label:e.name,value:e.name},e.id)))})}),Object(Ne.jsx)("div",{className:Te()(Se.a.DIALOG_FOOTER),children:Object(Ne.jsxs)("div",{className:Te()(Se.a.DIALOG_FOOTER_ACTIONS),children:[Object(Ne.jsx)(Ce.b,{onClick:a,children:"Close"}),Object(Ne.jsx)(Ce.a,{onClick:function(){""===t?Object(G.e)("No repository selected!",1e3):e.onSubmit(t)},intent:we.a.PRIMARY,children:"Select"})]})})]});function a(){e.onSubmit("")}},Re=s(69);function*_e(){const e=`https://github.com/login/oauth/authorize?client_id=${T.b.githubClientId}&scope=repo`,t="Connect With OAuth",s="height=600,width=400";new BroadcastChannel("GitHubOAuthAccessToken").onmessage=e=>{_t.dispatch(B.a.setGitHubOctokitObject(e.data)),_t.dispatch(B.a.setGitHubAccessToken(e.data)),Object(G.d)("Logged in to GitHub",1e3)},T.b.githubClientId?yield Object(L.a)(window.open,e,t,s):yield Object(L.a)(window.open,"/callback/github",t,s)}function*Le(){_t.getState()&&_t.getState().workspaces.githubAssessment.hasUnsavedChanges?yield Object(L.a)(G.e,"You have unsaved changes!",2e3):(yield Object(L.d)(B.a.removeGitHubOctokitObjectAndAccessToken()),yield Object(L.a)(G.d,"Logged out from GitHub",1e3))}function*De(){const e=xe.f();if(void 0===e)return;const t=yield Object(L.a)((async()=>await e.paginate(e.repos.listForAuthenticatedUser,{per_page:100}))),s=yield Object(L.a)((async()=>await Object(Re.a)(Pe,(e=>({userRepos:t,onSubmit:e})))));if(""!==s){const t="Open",a=async()=>await Object(Re.a)(Me,(a=>({repoName:s,pickerType:t,octokit:e,editorContent:"",onSubmit:a})));yield Object(L.a)(a)}}function*Be(){const e=Object(xe.f)();if(void 0===e)return;const t=yield Object(L.a)(e.users.getAuthenticated),s=t.data.login,a=_t.getState().playground.githubSaveInfo.repoName,n=_t.getState().playground.githubSaveInfo.filePath,i=t.data.email,r=t.data.name,o=_t.getState().workspaces.playground.editorTabs[0].value;xe.j(e,s,a,n,i,r,"Changes made from Source Academy",o)}function*Ue(){const e=xe.f();if(void 0===e)return;const t=yield Object(L.a)((async()=>await e.paginate(e.repos.listForAuthenticatedUser,{per_page:100}))),s=yield Object(L.a)((async()=>await Object(Re.a)(Pe,(e=>({userRepos:t,onSubmit:e}))))),a=_t.getState().workspaces.playground.editorTabs[0].value;if(""!==s){const t="Save",n=async()=>await Object(Re.a)(Me,(n=>({repoName:s,pickerType:t,octokit:e,editorContent:a,onSubmit:n})));yield Object(L.a)(n)}}var Ge=function*(){yield Object(L.i)(P.s,_e),yield Object(L.i)(P.t,Le),yield Object(L.i)("GITHUB_OPEN_FILE",De),yield Object(L.i)("GITHUB_SAVE_FILE",Be),yield Object(L.i)("GITHUB_SAVE_FILE_AS",Ue)};function*Fe(){yield pe(P.r,He),yield pe(P.H,(e=>{de.b({id:e.payload.userId.toString()})})),yield pe(l.a,(()=>{de.b(null)}))}function He(e){let{payload:t}=e;return function*(){const e=function(e){const t=T.b.authProviders.get(e);if(t)try{const s=new URL(t.endpoint);return s.searchParams.set("redirect_uri",ye(e)),s.toString()}catch(s){return t.endpoint||""}}(t);e?window.location.href=e:yield Object(L.a)(G.e,"Could not log in; invalid provider name provided.")}()}var Ve=s(152);const We=["https://www.googleapis.com/discovery/v1/apis/drive/v3/rest"],Xe="https://www.googleapis.com/upload/drive/v3/files",$e="text/plain";let qe;const ze=new Promise((e=>{qe=e})).then((async function(){await new Promise(((e,t)=>gapi.load("client:auth2",{callback:e,onerror:t}))),await gapi.client.init({apiKey:T.b.googleApiKey,clientId:T.b.googleClientId,discoveryDocs:We,scope:"profile https://www.googleapis.com/auth/drive.file"}),gapi.auth2.getAuthInstance().currentUser.listen(Ye),Ye(gapi.auth2.getAuthInstance().currentUser.get())}));function Ye(e){_t.dispatch(B.a.setGoogleUser(e.isSignedIn()?e.getBasicProfile().getEmail():void 0))}function*Ke(){qe(),yield ze}function*Qe(){yield Object(L.a)(Ke),gapi.auth2.getAuthInstance().isSignedIn.get()||(yield gapi.auth2.getAuthInstance().signIn())}function Je(e,t){const s="undefined"!==typeof(null===t||void 0===t?void 0:t.pickFolders)&&(null===t||void 0===t?void 0:t.pickFolders),a="undefined"===typeof(null===t||void 0===t?void 0:t.showFolders)||(null===t||void 0===t?void 0:t.showFolders),n="undefined"===typeof(null===t||void 0===t?void 0:t.showFiles)||(null===t||void 0===t?void 0:t.showFiles);return new Promise((i=>{gapi.load("picker",(()=>{const r=new google.picker.DocsView(n?google.picker.ViewId.DOCS:google.picker.ViewId.FOLDERS);null!==t&&void 0!==t&&t.rootFolder&&r.setParent(t.rootFolder),r.setOwnedByMe(!0),r.setIncludeFolders(a),r.setSelectFolderEnabled(s),r.setMode(google.picker.DocsViewMode.LIST);(new google.picker.PickerBuilder).setTitle(e).enableFeature(google.picker.Feature.NAV_HIDDEN).addView(r).setOAuthToken(gapi.auth2.getAuthInstance().currentUser.get().getAuthResponse().access_token).setAppId(T.b.googleAppId).setDeveloperKey(T.b.googleApiKey).setCallback((e=>{switch(e[google.picker.Response.ACTION]){case google.picker.Action.PICKED:{const{id:t,name:s,mimeType:a,parentId:n}=e.docs[0];i({id:t,name:s,mimeType:a,parentId:n,picked:!0});break}case google.picker.Action.CANCEL:i({picked:!1})}})).build().setVisible(!0)}))}))}function Ze(e,t,s){let a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"",n=arguments.length>4?arguments[4]:void 0;const i=e,r={name:i,mimeType:s,parents:[t],appProperties:{source:!0,...n}},{body:o,headers:c}=tt(r,a,s);return gapi.client.request({path:Xe,method:"POST",params:{uploadType:"multipart"},headers:c,body:o}).then((e=>{let{result:t}=e;return{id:t.id,name:t.name}}))}function et(e,t,s){let a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"",n=arguments.length>4?arguments[4]:void 0;const i={name:t,mimeType:s,appProperties:{source:!0,...n}},{body:r,headers:o}=tt(i,a,s);return gapi.client.request({path:Xe+"/"+e,method:"PATCH",params:{uploadType:"multipart"},headers:o,body:r})}function tt(e,t,s){const a=JSON.stringify(e);let n;do{n=st()}while(a.includes(n)||t.includes(n));return{body:`--${n}\nContent-Type: application/json; charset=utf-8\n\n${JSON.stringify(e)}\n--${n}\nContent-Type: ${s}\n\n${t}\n--${n}--\n`,boundary:n,headers:{"Content-Type":`multipart/related; boundary=${n}`}}}function st(){let e="--------------------------";for(let t=0;t<24;t++)e+=Math.floor(10*Math.random()).toString(16);return e}var at=function*(){yield ge(P.u,(function*(){yield Object(L.d)(B.a.playgroundUpdatePersistenceFile(void 0)),yield Object(L.a)(Ke),yield Object(L.a)([gapi.auth2.getAuthInstance(),"signOut"])})),yield ge(Ve.b,(function*(){let e;try{yield Object(L.a)(Qe);const{id:t,name:s,picked:a}=yield Object(L.a)(Je,"Pick a file to open");if(!a)return;if(!(yield Object(L.a)(Re.b,{title:"Opening from Google Drive",contents:Object(Ne.jsxs)("p",{children:["Opening ",Object(Ne.jsx)("strong",{children:s})," will overwrite the current contents of your workspace. Are you sure?"]}),positiveLabel:"Open",negativeLabel:"Cancel"})))return;e=yield Object(L.a)(G.c,{message:"Opening file...",timeout:0,intent:we.a.PRIMARY});const{result:n}=yield Object(L.a)([gapi.client.drive.files,"get"],{fileId:t,fields:"appProperties"}),r=yield Object(L.a)([gapi.client.drive.files,"get"],{fileId:t,alt:"media"});yield Object(L.d)(B.a.updateEditorValue(r.body,"playground")),yield Object(L.d)(B.a.playgroundUpdatePersistenceFile({id:t,name:s,lastSaved:new Date})),n&&n.appProperties&&(yield Object(L.d)(B.a.chapterSelect(parseInt(n.appProperties.chapter||"4",10),n.appProperties.variant||i.Variant.DEFAULT,"playground")),yield Object(L.d)(B.a.externalLibrarySelect(Object.values(F.a).find((e=>e===n.appProperties.external))||F.a.NONE,"playground"))),yield Object(L.a)(G.d,`Loaded ${s}.`,1e3)}catch(t){console.error(t),yield Object(L.a)(G.e,"Error while opening file.",1e3)}finally{e&&Object(G.a)(e)}})),yield ge(Ve.d,(function*(){let e;try{yield Object(L.a)(Qe);const[t,s,a]=yield Object(L.f)((e=>[e.workspaces.playground.editorTabs[0].value,e.workspaces.playground.context.variant,e.workspaces.playground.externalLibrary])),n=yield Object(L.a)(Je,"Pick a folder, or cancel to pick the root folder",{pickFolders:!0,showFolders:!0,showFiles:!1}),i=n.picked?n:{id:"root",name:"My Drive"},r=yield Object(L.a)(Je,`Saving to ${i.name}; pick a file to overwrite, or cancel to save as a new file`,{pickFolders:!1,showFolders:!1,showFiles:!0,rootFolder:i.id});if(r.picked){if(!(yield Object(L.a)(Re.b,{title:"Saving to Google Drive",contents:Object(Ne.jsxs)("span",{children:["Really overwrite ",Object(Ne.jsx)("strong",{children:r.name}),"?"]})})))return;yield Object(L.d)(B.a.playgroundUpdatePersistenceFile(r)),yield Object(L.d)(B.a.persistenceSaveFile(r))}else{const n=yield Object(L.a)(Re.c,{title:"Saving to Google Drive",contents:Object(Ne.jsxs)(Ne.Fragment,{children:[Object(Ne.jsxs)("p",{children:["Saving to folder ",Object(Ne.jsx)("strong",{children:i.name}),"."]}),Object(Ne.jsx)("p",{children:"Save as name?"})]}),positiveLabel:"Save as new file",negativeLabel:"Cancel",props:{validationFunction:e=>!!e}});if(!n.buttonResponse)return;const r={variant:s,external:a};e=yield Object(L.a)(G.c,{message:`Saving as ${n.value}...`,timeout:0,intent:we.a.PRIMARY});const o=yield Object(L.a)(Ze,n.value,i.id,$e,t,r);yield Object(L.d)(B.a.playgroundUpdatePersistenceFile({...o,lastSaved:new Date})),yield Object(L.a)(G.d,`${n.value} successfully saved to Google Drive.`,1e3)}}catch(t){console.error(t),yield Object(L.a)(G.e,"Error while saving file.",1e3)}finally{e&&Object(G.a)(e)}})),yield pe(Ve.c,(function(e){let{payload:{id:t,name:s}}=e;return function*(){let e;try{e=yield Object(L.a)(G.c,{message:`Saving as ${s}...`,timeout:0,intent:we.a.PRIMARY}),yield Object(L.a)(Qe);const[a,n,i]=yield Object(L.f)((e=>[e.workspaces.playground.editorTabs[0].value,e.workspaces.playground.context.variant,e.workspaces.playground.externalLibrary])),r={variant:n,external:i};yield Object(L.a)(et,t,s,$e,a,r),yield Object(L.d)(B.a.playgroundUpdatePersistenceFile({id:t,name:s,lastSaved:new Date})),yield Object(L.a)(G.d,`${s} successfully saved to Google Drive.`,1e3)}catch(a){console.error(a),yield Object(L.a)(G.e,"Error while saving file.",1e3)}finally{e&&Object(G.a)(e)}}()})),yield pe(Ve.a,Ke)},nt=s(184),it=s(215),rt=s(127);function*ot(){yield pe(b.b,ct),yield pe(b.e,(function*(e){const t=yield Object(L.f)((e=>e.playground.queryString)),s=e.payload,a="ERROR";let n,i;try{const{result:e,hasTimedOut:a}=yield Object(L.e)({result:Object(L.a)(lt,t,s),hasTimedOut:Object(L.b)(1e4)});n=e,i=a}catch(r){}return!n||i?(yield Object(L.d)(Object(rt.updateShortURL)(a)),yield Object(L.a)(G.e,"Something went wrong trying to create the link.")):"success"===n.status||n.shorturl?("success"!==n.status&&(yield Object(L.a)(G.d,n.message)),void(yield Object(L.d)(Object(rt.updateShortURL)(T.b.urlShortenerBase+n.url.keyword)))):(yield Object(L.d)(Object(rt.updateShortURL)(a)),yield Object(L.a)(G.e,n.message))}))}function*ct(){const e=yield Object(L.f)((e=>e.workspaces.playground.editorTabs[0].value));if(!e||e===c.g)return void(yield Object(L.d)(Object(rt.changeQueryString)("")));const t=yield Object(L.f)((e=>e.workspaces.playground.context.variant)),s=yield Object(L.f)((e=>e.workspaces.playground.externalLibrary)),a=yield Object(L.f)((e=>e.workspaces.playground.execTime)),n=it.stringify({prgrm:Object(nt.compressToEncodedURIComponent)(e),variant:t,ext:s,exec:a});yield Object(L.d)(Object(rt.changeQueryString)(n))}async function lt(e,t){const s=`${window.location.protocol}//${window.location.host}/playground#${e}`,a={signature:T.b.urlShortenerSignature,action:"shorturl",format:"json",keyword:t,url:s},n={method:"POST",body:Object.entries(a).reduce(((e,t)=>{let[s,a]=t;return e.append(s,a),e}),new FormData)},i=await fetch(`${T.b.urlShortenerBase}yourls-api.php`,n);if(!i||!i.ok)return null;return await i.json()}var dt=s(519),ut=s(167);const ht={start:{line:0,column:0},end:{line:0,column:0}};const pt="0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ",gt=()=>new Array(16).fill(void 0).map((e=>pt[Math.floor(Math.random()*pt.length)])).join("");var mt=function*(){yield ge(M.c,(function*(){const[e,t]=yield Object(L.f)((e=>[{accessToken:e.session.accessToken,refreshToken:e.session.refreshToken},e.session.remoteExecutionSession])),s=yield Object(L.a)(le.e,e);if(yield Object(L.d)(B.a.remoteExecUpdateDevices(s)),!t)return;const a=s.find((e=>{let{id:s}=e;return s===t.device.id}));a&&(yield Object(L.d)(B.a.remoteExecUpdateSession({...t,device:a})))})),yield pe(M.a,(function*(e){const[t,s]=yield Object(L.f)((e=>[{accessToken:e.session.accessToken,refreshToken:e.session.refreshToken},e.session.remoteExecutionSession])),{device:a,workspace:r}=e.payload;yield Object(L.d)(B.a.remoteExecUpdateSession({device:a,workspace:r,connection:{status:"CONNECTING"}}));const o=yield Object(L.a)(le.m,a,t);if(!o)return void(yield Object(L.d)(B.a.remoteExecUpdateSession({...e.payload,connection:{status:"FAILED",error:"Could not retrieve MQTT endpoint"}})));const c=null===s||void 0===s?void 0:s.connection.client;if(c)try{c.disconnect()}catch{}const l=new dt.SlingClient({clientId:`${o.clientNamePrefix}${gt()}`,deviceId:o.thingName,websocketEndpoint:o.endpoint});l.on("statusChange",(e=>{_t.dispatch(B.a.updateWorkspace(r,{isRunning:e}))})),l.on("monitor",(e=>{const t=e[0].split(":")[1],s=`port${t.substring(t.length-1)}`,a=_t.getState().session.remoteExecutionSession,i=e=>_t.dispatch(B.a.remoteExecUpdateSession({...a,device:{...a.device,peripherals:{...n.a.pickBy(a.device.peripherals,(e=>Date.now()-e.lastUpdated<3e3)),[s]:{...e,lastUpdated:Date.now()}}}}));if(e[1].endsWith("motor")){i({type:e[1],position:parseInt(e[2]),speed:parseInt(e[3])})}else{i({type:e[1],mode:e[2],value:parseInt(e[3])})}})),l.on("display",((e,t)=>{switch(t){case"output":_t.dispatch(B.a.handleConsoleLog(r,`${e}`));break;case"error":{const t=new ut.ExceptionError(new Error(`${e}`),ht);_t.dispatch(B.a.evalInterpreterError([t],r));break}case"result":_t.dispatch(B.a.evalInterpreterSuccess(e,r))}}));const d=M.i.get(a.type);yield Object(L.d)(B.a.remoteExecUpdateSession({device:a,workspace:r,connection:{status:"CONNECTING",client:l,endpoint:o}})),yield Object(L.d)(B.a.updateWorkspace(r,{isRunning:!1,isEditorAutorun:!1,isDebugging:!1,externalLibrary:null===d||void 0===d?void 0:d.deviceLibraryName,output:[]})),yield Object(L.d)(B.a.beginClearContext(r,{variant:i.Variant.DEFAULT,external:{name:(null===d||void 0===d?void 0:d.deviceLibraryName)||F.a.NONE,symbols:(null===d||void 0===d?void 0:d.internalFunctions)||[]},globals:[]},!1));try{const t=new Promise(((e,t)=>{try{l.once("connect",(()=>e(!0))),l.once("error",t),l.connect()}catch{t()}}));(yield Object(L.e)({connect:t,reconnect:Object(L.g)(M.a),disconnect:Object(L.g)(M.b)})).connect?yield Object(L.d)(B.a.remoteExecUpdateSession({...e.payload,connection:{status:"CONNECTED",client:l,endpoint:o}})):l.disconnect()}catch(u){l.disconnect(),yield Object(L.d)(B.a.remoteExecUpdateSession({...e.payload,connection:{status:"FAILED",client:l,error:u.toString()}}))}})),yield ge(M.b,(function*(e){const t=yield Object(L.f)((e=>e.session.remoteExecutionSession));if(!t)return;const s=t.connection.client;s&&s.disconnect(),yield Object(L.d)(B.a.remoteExecUpdateSession(void 0)),yield Object(L.d)(B.a.externalLibrarySelect(F.a.NONE,t.workspace,!0))})),yield pe(S.b,(function*(){const e=yield Object(L.f)((e=>e.session.remoteExecutionSession));e&&"CONNECTED"===e.connection.status&&e.connection.client.sendStop()}))},bt=s(88),jt=s(287),yt=s(158),Ot=s.n(yt),ft=s(174),vt=s(216),xt=s(299),Ct=s(13);function*St(){let e;yield pe(A.a,(function*(e){yield Object(L.d)(B.a.handleConsoleLog(e.payload.workspaceLocation,e.payload.errorMsg))})),yield pe(A.o,(function*(e){const t=e.payload.workspaceLocation;yield*At(t)})),yield pe(A.A,(function*(e){const t=e.payload.workspaceLocation,s=yield Object(L.f)((e=>e.workspaces[t].isEditorAutorun));yield Object(L.a)(G.e,"Autorun "+(s?"Started":"Stopped"),750)})),yield pe(A.q,(function*(t){const s=t.payload.workspaceLocation,a=yield Object(L.f)((e=>e.workspaces[s].replValue)),n=yield Object(L.f)((e=>e.workspaces[s].execTime));yield Object(L.d)(B.a.beginInterruptExecution(s)),yield Object(L.d)(B.a.clearReplInput(s)),yield Object(L.d)(B.a.sendReplInputToOutput(a,s)),e=yield Object(L.f)((e=>e.workspaces[s].context)),yield Object(L.a)(Mt,a,e,n,s,A.q)})),yield pe(S.d,(function*(t){const s=t.payload.workspaceLocation,a=yield Object(L.f)((e=>e.workspaces[s].editorTabs[0].value)),n=yield Object(L.f)((e=>e.workspaces[s].execTime));yield Object(L.d)(B.a.beginInterruptExecution(s)),yield Object(L.d)(B.a.clearReplOutput(s)),e=yield Object(L.f)((e=>e.workspaces[s].context)),yield Object(L.d)(B.a.highlightEditorLine([],s)),yield Object(L.a)(Mt,a,e,n,s,S.d)})),yield pe(S.c,(function*(t){const s=t.payload.workspaceLocation;e=yield Object(L.f)((e=>e.workspaces[s].context)),yield Object(L.d)(B.a.clearReplOutput(s)),yield Object(L.d)(B.a.highlightEditorLine([],s)),e.runtime.break=!1,wt=void 0})),yield pe(S.l,(function*(e){const t=e.payload.highlightedLines;0===t.length?Object(k.f)():Object(k.g)(t[0]),yield})),yield pe(A.s,(function*(e){yield Object(L.d)(B.a.addEvent([h.e.RUN_TESTCASE]));const t=e.payload.workspaceLocation,s=e.payload.testcaseId;yield*It(t,s)})),yield pe(A.j,(function*(e){const{workspaceLocation:t,chapter:s,variant:a}=e.payload,[n,i,r,o,l]=yield Object(L.f)((e=>[e.workspaces[t].context.variant,e.workspaces[t].context.externalSymbols,e.workspaces[t].globals,e.workspaces[t].externalLibrary]));if(s!==i||a!==n){const e={variant:a,external:{name:l,symbols:r},globals:o};yield Object(L.d)(B.a.beginClearContext(t,e,!1)),yield Object(L.d)(B.a.clearReplOutput(t)),yield Object(L.d)(B.a.debuggerReset(t)),yield Object(L.a)(G.d,`Switched to ${Object(c.o)(s,a)}`,1e3)}})),yield pe(A.v,(function*(e){const{workspaceLocation:t,externalLibraryName:s}=e.payload,[a,n]=yield Object(L.f)((e=>[e.workspaces[t].globals,e.workspaces[t].externalLibrary])),i={external:{name:s,symbols:F.b.get(s)},globals:a};(s!==n||e.payload.initialise)&&(yield Object(L.d)(B.a.changeExternalLibrary(s,t)),yield Object(L.d)(B.a.beginClearContext(t,i,!0)),yield Object(L.d)(B.a.clearReplOutput(t)),e.payload.initialise||(yield Object(L.a)(G.d,`Switched to ${s} library`,1e3)))})),yield pe(A.b,(function*(e){vt.a.clear(),ft.a.clear();const t=e.payload.library.globals;for(const[s,a]of t)window[s]=a;yield Object(L.d)(B.a.endClearContext({...e.payload.library,moduleParams:{runes:{},phaser:Ot.a}},e.payload.workspaceLocation)),yield})),yield pe(A.u,(function*(t){const s=t.payload.workspaceLocation,a=yield Object(L.f)((e=>e.workspaces[s].editorTabs[0].value));e=yield Object(L.f)((e=>e.workspaces[s].context));const n=Object(bt.findDeclaration)(a,e,{line:t.payload.cursorPosition.row+1,column:t.payload.cursorPosition.column});n&&(yield Object(L.d)(B.a.moveCursor(t.payload.workspaceLocation,{row:n.start.line-1,column:n.start.column})))})),yield function(e,t){function*s(){try{const e=t(...arguments);he(e)&&(yield*e)}catch(e){ue(e)}}for(var a=arguments.length,n=new Array(a>2?a-2:0),i=2;i<a;i++)n[i-2]=arguments[i];return Object(L.j)(e,s,...n)}(A.p,(function*(e){const{workspaceLocation:t}=e.payload;yield Object(L.a)(At,t);const s=yield Object(L.f)((e=>e.workspaces[t].editorTestcases));if(s.length>0){yield Object(L.a)(G.d,"Running all testcases!",2e3);for(const e of s.keys()){yield new Promise((e=>setTimeout(e,0)));if(!(yield Object(L.a)(It,t,e)))return}}}))}let wt;function*Et(e){try{const t=wt.context.runtime.nodes[0].loc.start.line-1,s=wt.context.runtime.nodes[0].loc.end.line-1;yield Object(L.d)(B.a.highlightEditorLine([t,s],e)),Object(k.i)(wt)}catch(t){yield Object(L.d)(B.a.highlightEditorLine([],e))}}function*Tt(e,t){const[s,a,n,i]=yield Object(L.f)((t=>[t.workspaces[e].context.externalSymbols,t.workspaces[e].externalLibrary,t.workspaces[e].globals,t.workspaces[e].context.variant])),r={variant:i,external:{name:a,symbols:s},globals:n};yield Object(L.d)(B.a.beginClearContext(e,r,!1)),yield Object(L.g)(A.n)}function*kt(e){yield Object(L.d)(B.a.handleConsoleLog(e,...xt.a.dump()))}function*At(e){const[t,s,a,n]=yield Object(L.f)((t=>[t.workspaces[e].editorTabs[0].prependValue,t.workspaces[e].editorTabs[0].value,t.workspaces[e].execTime,t.session.remoteExecutionSession]));if(yield Object(L.d)(B.a.addEvent([h.e.RUN_CODE])),n&&n.workspace===e)yield Object(L.d)(B.a.remoteExecRun(s));else{yield Object(L.d)(B.a.beginInterruptExecution(e)),yield*Tt(e),yield Object(L.d)(B.a.clearReplOutput(e));const n=yield Object(L.f)((t=>t.workspaces[e].context));let i=s;if(Object(c.m)(n.chapter)&&Object(jt.parse)(i,n),!n.errors.length){const t=s.split("\n"),a=yield Object(L.f)((t=>t.workspaces[e].editorTabs[0].breakpoints));for(const s in a){if("string"!==typeof s)continue;const a=+s;if(n.errors=[],t[a]="debugger;"+t[a],i=t.join("\n"),Object(c.m)(n.chapter)&&Object(jt.parse)(i,n),n.errors.length){const t="Hint: Misplaced breakpoint at line "+(a+1)+".";yield Object(L.d)(B.a.sendReplInputToOutput(t,e))}}}if(n.errors=[],t.length){const s=Object(k.h)(n);yield Object(L.a)(Mt,t,s,a,e,A.r),yield*Nt(s,n,a,e)}yield Object(L.a)(Mt,i,n,a,e,A.o)}}function*It(e,t){const[s,n,i,r]=yield Object(L.f)((s=>[s.workspaces[e].editorTabs[0].prependValue,s.workspaces[e].editorTabs[0].value,s.workspaces[e].editorTabs[0].postpendValue,s.workspaces[e].editorTestcases[t].program])),o=yield Object(L.f)((s=>s.workspaces[e].editorTestcases[t].type)),c=yield Object(L.f)((t=>t.workspaces[e].execTime));yield*Tt(e);const l=yield Object(L.f)((t=>t.workspaces[e].context)),d=Object(k.h)(l);yield Object(L.a)(Mt,s,d,c,e,A.r);const u=String(Object(a.random)(1048576,68719476736));return yield*Nt(d,l,c,e,u),yield Object(L.a)(Mt,n,l,c,e,A.r),l.errors.length?(yield Object(L.d)(B.a.evalTestcaseFailure(l.errors,e,t)),!1):(i&&(yield*function*(e,t,s,a,n){const i=Object(k.c)(e,t),r=Object(k.d)(i,n);yield Object(L.a)(Mt,r,e,s,a,A.r)}(d,l,c,e,u),yield Object(L.a)(Mt,i,d,c,e,A.r),yield*Nt(d,l,c,e,u)),yield*function*(e,t,s,a,n,i){yield Object(L.d)(B.a.resetTestcase(a,n));const{result:r,interrupted:o}=yield Object(L.e)({result:Object(L.a)(bt.runInContext,e,t,{scheduler:"preemptive",originalMaxExecTime:s,throwInfiniteLoops:!0}),interrupted:Object(L.g)(S.b)});if(o)return Object(bt.interrupt)(t),yield*kt(a),t.errors.push(new ut.InterruptedError(t.runtime.nodes[0])),yield Object(L.d)(B.a.endInterruptExecution(a)),void(yield Object(L.a)(G.e,`Execution of testcase ${n} aborted`,750));yield*kt(a),"error"===r.status?(yield Object(L.d)(B.a.evalInterpreterError(t.errors,a)),yield Object(L.d)(B.a.evalTestcaseFailure(t.errors,a,n))):"finished"===r.status&&(yield Object(L.d)(B.a.evalInterpreterSuccess(r.value,a)),yield Object(L.d)(B.a.evalTestcaseSuccess(r.value,a,n)));i===D.f.opaque&&(yield Object(L.d)(B.a.clearReplOutputLast(a)))}(r,d,c,e,t,o),!0)}function*Nt(e,t,s,a,n){const i=Object(k.c)(e,t);if(n){const t=Object(k.e)(i,n);yield Object(L.a)(Mt,t,e,s,a,A.r)}const r=Object(k.b)(i);yield Object(L.a)(Mt,r,e,s,a,A.r)}function*Mt(e,t,s,a,n){const r=yield Object(L.f)((e=>e.workspaces[a].stepLimit)),{result:o,interrupted:c,paused:l}=yield Object(L.e)({result:Object(L.a)(bt.runInContext,e,t,{scheduler:"preemptive",executionMethod:"interpreter",originalMaxExecTime:s,stepLimit:r,variant:i.Variant.DEFAULT,useSubst:!1}),interrupted:Object(L.g)(S.b),paused:Object(L.g)(S.a)});if(c)return Object(bt.interrupt)(t),t.errors.push(new ut.InterruptedError(t.runtime.nodes[0])),yield Object(L.d)(B.a.debuggerReset(a)),yield Object(L.d)(B.a.endInterruptExecution(a)),void(yield Object(L.a)(G.e,"Execution aborted",750));if(l)return yield Object(L.d)(B.a.endDebuggerPause(a)),yield Object(L.a)(Et,a),void(yield Object(L.a)(G.e,"Execution paused",750));if(n===A.o&&(wt=o),yield Object(L.a)(Et,a),"suspended"===o.status||"finished"===o.status||"suspended-non-det"===o.status){if("suspended"===o.status)return yield Object(L.d)(B.a.endDebuggerPause(a)),void(yield Object(L.d)(B.a.evalInterpreterSuccess("Breakpoint hit!",a)));yield*kt(a),n!==A.r&&(yield Object(L.d)(B.a.evalInterpreterSuccess(o.value,a))),n!==A.o&&n!==A.q||(t.errors.length>0&&(yield Object(L.d)(B.a.addEvent([h.e.ERROR]))),yield Object(L.d)(Object(Ct.notifyProgramEvaluated)(o,wt,e,t,a)))}else{yield*kt(a),yield Object(L.d)(B.a.evalInterpreterError(t.errors,a));const e=t.errors;t.errors=[],t.errors=e;const s=t.errors.length>0?[h.e.ERROR]:[];yield Object(L.d)(B.a.addEvent(s))}}function*Pt(){yield Object(L.c)(T.b.useBackend?ve:ne),yield Object(L.c)(St),yield Object(L.c)(Fe),yield Object(L.c)(ot),yield Object(L.c)(be),yield Object(L.c)(at),yield Object(L.c)(Ge),yield Object(L.c)(mt)}var Rt=s(282);const _t=function(){const e=Object(o.a)(),t=[e],s=window.__REDUX_DEVTOOLS_EXTENSION_COMPOSE__&&window.__REDUX_DEVTOOLS_EXTENSION_COMPOSE__({serialize:!0,maxAge:300})||r.d,n=function(e){if(!e)return;return{...c.k,session:{...c.k.session,...e.session?e.session:{},githubOctokitObject:{octokit:e.session.githubAccessToken?Object(Rt.a)(e.session.githubAccessToken):void 0}},workspaces:{...c.k.workspaces,playground:{...c.k.workspaces.playground,editorTabs:e.playgroundEditorValue?[{value:e.playgroundEditorValue,prependValue:"",postpendValue:"",highlightedLines:[],breakpoints:[]}]:c.k.workspaces.playground.editorTabs,isEditorAutorun:e.playgroundIsEditorAutorun?e.playgroundIsEditorAutorun:c.k.workspaces.playground.isEditorAutorun,externalLibrary:e.playgroundExternalLibrary?e.playgroundExternalLibrary:c.k.workspaces.playground.externalLibrary,context:{...c.k.workspaces.playground.context,chapter:e.playgroundSourceChapter?e.playgroundSourceChapter:i.Chapter.CALC,variant:e.playgroundSourceVariant?e.playgroundSourceVariant:c.k.workspaces.playground.context.variant}}}}}((()=>{try{const e=localStorage.getItem("storedState");if(!e)return;const t=Object(nt.decompressFromUTF16)(e);if(!t)return;return JSON.parse(t)}catch(e){return void Object(G.e)("Error loading from local storage")}})())||c.k,l=s(Object(r.a)(...t)),d=Object(r.e)(_(),n,l);return e.run(Pt),d.subscribe(Object(a.throttle)((()=>{(e=>{try{const t={session:{accessToken:e.session.accessToken,refreshToken:e.session.refreshToken,courseRegId:e.session.courseRegId,role:e.session.role,name:e.session.name,userId:e.session.userId,courses:e.session.courses,courseId:e.session.courseId,courseName:e.session.courseName,courseShortName:e.session.courseShortName,viewable:e.session.viewable,enableGame:e.session.enableGame,enableAchievements:e.session.enableAchievements,enableSourcecast:e.session.enableSourcecast,moduleHelpText:e.session.moduleHelpText,assetsPrefix:e.session.assetsPrefix,assessmentConfigurations:e.session.assessmentConfigurations,githubAccessToken:e.session.githubAccessToken},achievements:e.achievement.achievements,playgroundEditorValue:e.workspaces.playground.editorTabs[0].value,playgroundIsEditorAutorun:e.workspaces.playground.isEditorAutorun,playgroundSourceChapter:i.Chapter.CALC,playgroundSourceVariant:e.workspaces.playground.context.variant,playgroundExternalLibrary:e.workspaces.playground.externalLibrary},s=Object(nt.compressToUTF16)(JSON.stringify(t));localStorage.setItem("storedState",s)}catch(t){Object(G.e)("Error saving to local storage")}})(d.getState())}),1e3)),d}()},90:function(e,t,s){"use strict";s.d(t,"c",(function(){return i})),s.d(t,"f",(function(){return r})),s.d(t,"g",(function(){return o})),s.d(t,"a",(function(){return c})),s.d(t,"b",(function(){return l})),s.d(t,"e",(function(){return d})),s.d(t,"d",(function(){return u})),s.d(t,"h",(function(){return h})),s.d(t,"i",(function(){return p}));var a=s(27),n=s(71);const i="REMOTE_EXEC_FETCH_DEVICES",r="REMOTE_EXEC_UPDATE_DEVICES",o="REMOTE_EXEC_UPDATE_SESSION",c="REMOTE_EXEC_CONNECT",l="REMOTE_EXEC_DISCONNECT",d="REMOTE_EXEC_RUN",u="REMOTE_EXEC_REPL_INPUT",h=[{id:"EV3",name:"Lego Mindstorms EV3",internalFunctions:["ev3_pause","ev3_connected","ev3_motorA","ev3_motorB","ev3_motorC","ev3_motorD","ev3_motorGetSpeed","ev3_motorSetSpeed","ev3_motorStart","ev3_motorStop","ev3_motorSetStopAction","ev3_motorGetPosition","ev3_runForTime","ev3_runToAbsolutePosition","ev3_runToRelativePosition","ev3_colorSensor","ev3_colorSensorRed","ev3_colorSensorGreen","ev3_colorSensorBlue","ev3_reflectedLightIntensity","ev3_ambientLightIntensity","ev3_colorSensorGetColor","ev3_ultrasonicSensor","ev3_ultrasonicSensorDistance","ev3_gyroSensor","ev3_gyroSensorAngle","ev3_gyroSensorRate","ev3_touchSensor1","ev3_touchSensor2","ev3_touchSensor3","ev3_touchSensor4","ev3_touchSensorPressed","ev3_hello","ev3_waitForButtonPress","ev3_speak","ev3_playSequence","ev3_ledLeftGreen","ev3_ledLeftRed","ev3_ledRightGreen","ev3_ledRightRed","ev3_ledGetBrightness","ev3_ledSetBrightness"],languageChapter:a.Chapter.CALC,deviceLibraryName:n.a.EV3}],p=new Map(h.map((e=>[e.id,e])))},93:function(e,t,s){"use strict";var a=s(42),n=s(139),i=s(1),r=s(0);t.a=e=>(Object(i.useEffect)((()=>e.loadContentDispatch()),[]),Object(r.jsx)("div",{className:"ContentDisplay row center-xs",children:Object(r.jsx)("div",{className:(e.fullWidth?"col-md-12":"col-md-10 col-xs-11")+" contentdisplay-content-parent",children:Object(r.jsx)(a.e,{className:"contentdisplay-content",elevation:n.a.THREE,children:e.display})})}))},95:function(e,t,s){"use strict";s.r(t),s.d(t,"saveSourcecastData",(function(){return i})),s.d(t,"setCurrentPlayerTime",(function(){return r})),s.d(t,"setCodeDeltasToApply",(function(){return o})),s.d(t,"setInputToApply",(function(){return c})),s.d(t,"setSourcecastData",(function(){return l})),s.d(t,"setSourcecastDuration",(function(){return d})),s.d(t,"setSourcecastStatus",(function(){return u}));var a=s(7),n=s(37);const i=(e,t,s,i,r,o)=>Object(a.action)(n.d,{title:e,description:t,uid:s,audio:i,audioUrl:window.URL.createObjectURL(i),playbackData:r,workspaceLocation:o}),r=(e,t)=>Object(a.action)(n.f,{playerTime:e,workspaceLocation:t}),o=(e,t)=>Object(a.action)(n.e,{deltas:e,workspaceLocation:t}),c=(e,t)=>Object(a.action)(n.g,{inputToApply:e,workspaceLocation:t}),l=(e,t,s,i,r,o)=>Object(a.action)(n.h,{title:e,description:t,uid:s,audioUrl:i,playbackData:r,workspaceLocation:o}),d=(e,t)=>Object(a.action)(n.i,{duration:e,workspaceLocation:t}),u=(e,t)=>Object(a.action)(n.j,{playbackStatus:e,workspaceLocation:t})},96:function(e,t,s){"use strict";s.r(t),s.d(t,"bulkUpdateAchievements",(function(){return i})),s.d(t,"bulkUpdateGoals",(function(){return r})),s.d(t,"getAchievements",(function(){return o})),s.d(t,"getGoals",(function(){return c})),s.d(t,"getOwnGoals",(function(){return l})),s.d(t,"getUserAssessmentOverviews",(function(){return d})),s.d(t,"getUsers",(function(){return u})),s.d(t,"removeAchievement",(function(){return h})),s.d(t,"removeGoal",(function(){return p})),s.d(t,"updateOwnGoalProgress",(function(){return g})),s.d(t,"addEvent",(function(){return m})),s.d(t,"handleEvent",(function(){return b})),s.d(t,"updateGoalProgress",(function(){return j})),s.d(t,"saveAchievements",(function(){return y})),s.d(t,"saveGoals",(function(){return O})),s.d(t,"saveUsers",(function(){return f})),s.d(t,"saveUserAssessmentOverviews",(function(){return v}));var a=s(7),n=s(26);const i=e=>Object(a.action)(n.c,e),r=e=>Object(a.action)(n.d,e),o=()=>Object(a.action)(n.g),c=e=>Object(a.action)(n.h,e),l=()=>Object(a.action)(n.i),d=e=>Object(a.action)(n.k,e),u=()=>Object(a.action)(n.j),h=e=>Object(a.action)(n.n,e),p=e=>Object(a.action)(n.o,e),g=e=>Object(a.action)(n.u,e),m=e=>Object(a.action)(n.a,e),b=e=>Object(a.action)(n.m,e),j=(e,t)=>Object(a.action)(n.t,{studentCourseRegId:e,progress:t}),y=e=>Object(a.action)(n.p,e),O=e=>Object(a.action)(n.q,e),f=e=>Object(a.action)(n.r,e),v=e=>Object(a.action)(n.s,e)},97:function(e,t,s){"use strict";s.d(t,"a",(function(){return A}));var a=s(134),n=s(33),i=s.n(n),r=s(1),o=(s(396),s(600),s(397),s(148)),c=s.n(o),l=s(136),d=s(37),u=s(0);class h extends r.PureComponent{constructor(e){super(e),this.ShareAce=void 0,this.AceEditor=void 0,this.onChangeMethod=void 0,this.onCursorChange=void 0,this.onSelectionChange=void 0,this.getMarkers=()=>{const e=[];for(const t of this.props.highlightedLines)e.push({startRow:t[0],startCol:0,endRow:t[1],endCol:1,className:"myMarker",type:"fullLine"});return e},this.handleGutterClick=e=>{const t=e.domEvent.target;if(-1===t.className.indexOf("ace_gutter-cell")||!e.editor.isFocused()||e.clientX>35+t.getBoundingClientRect().left)return;const s=e.getDocumentPosition().row,a=e.editor.session.getLine(s);void 0!==e.editor.session.getBreakpoints(s,0)[s]||0===a.length||a.includes("//")||a.includes("debugger;")?e.editor.session.clearBreakpoint(s):e.editor.session.setBreakpoint(s),e.stop(),this.props.handleEditorUpdateBreakpoints(e.editor.session.$breakpoints)},this.handleAnnotationChange=e=>()=>{const t=e.getAnnotations();let s=0;for(const e of t)"info"===e.type&&(e.type="error",e.className="ace_error",s++);0!==s&&e.setAnnotations(t)},this.handleEvaluate=()=>{this.props.handleEditorEval(),this.props.isRecording&&this.props.handleRecordInput({type:"keyboardCommand",time:this.props.getTimerDuration(),data:d.a.run})},this.moveCursor=e=>{this.AceEditor.current.editor.selection.clearSelection(),this.AceEditor.current.editor.moveCursorToPosition(e),this.AceEditor.current.editor.renderer.showCursor(),this.AceEditor.current.editor.renderer.scrollCursorIntoView(e,.5)},this.handleDeclarationNavigate=()=>{this.props.handleDeclarationNavigate(this.AceEditor.current.editor.getCursorPosition())},this.AceEditor=r.createRef(),this.ShareAce=null,this.onChangeMethod=(e,t)=>{this.props.handleUpdateHasUnsavedChanges&&this.props.handleUpdateHasUnsavedChanges(!0),this.props.handleEditorValueChange(e),this.props.isRecording&&this.props.handleRecordInput({type:"codeDelta",time:this.props.getTimerDuration(),data:t});const s=this.AceEditor.current.editor.getSession().getAnnotations();this.props.isEditorAutorun&&0===s.length&&this.props.handleEditorEval()},this.onCursorChange=e=>{if(!this.props.isRecording)return;const t=e.getCursor();this.props.handleRecordInput({type:"cursorPositionChange",time:this.props.getTimerDuration(),data:t})},this.onSelectionChange=e=>{if(!this.props.isRecording)return;const t=e.getRange(),s=e.isBackwards();Object(n.isEqual)(t.start,t.end)||this.props.handleRecordInput({type:"selectionRangeData",time:this.props.getTimerDuration(),data:{range:t,isBackwards:s}})}}componentDidUpdate(e){const{codeDeltasToApply:t,inputToApply:s,newCursorPosition:a}=this.props;if(t&&t!==e.codeDeltasToApply&&(this.AceEditor.current.editor.session.getDocument().applyDeltas(t),this.AceEditor.current.editor.selection.clearSelection()),a&&a!==e.newCursorPosition&&this.moveCursor(a),s&&s!==e.inputToApply)switch(s.type){case"codeDelta":this.AceEditor.current.editor.session.getDocument().applyDelta(s.data),this.AceEditor.current.editor.selection.clearSelection();break;case"cursorPositionChange":this.moveCursor(s.data);break;case"selectionRangeData":const{range:e,isBackwards:t}=s.data;this.AceEditor.current.editor.selection.setRange(e,t);break;case"keyboardCommand":if("run"===s.data)this.props.handleEditorEval(),this.props.setDraggableReplPosition&&this.props.setDraggableReplPosition()}}getBreakpoints(){return this.AceEditor.current.editor.session.getBreakpoints().filter((e=>null!=e))}componentDidMount(){if(!this.AceEditor||!this.AceEditor.current||!this.AceEditor.current.editor)return;const e=this.AceEditor.current.editor,t=e.getSession();e.on("gutterclick",this.handleGutterClick),t.on("changeAnnotation",this.handleAnnotationChange(t));const{onFocus:s,onBlur:a}=this.props;s&&e.on("focus",(t=>s(t,e))),a&&e.on("blur",(t=>a(t,e)))}componentWillUnmount(){null!==this.ShareAce&&this.ShareAce.WS.close(),this.ShareAce=null}render(){return Object(u.jsx)(l.HotKeys,{className:"Editor bp4-card bp4-elevation-0",handlers:p,children:Object(u.jsx)("div",{className:"row editor-react-ace",children:Object(u.jsx)(c.a,{className:"react-ace",commands:[{name:"evaluate",bindKey:{win:"Shift-Enter",mac:"Shift-Enter"},exec:this.handleEvaluate},{name:"navigate",bindKey:{win:"Ctrl-B",mac:"Command-B"},exec:this.handleDeclarationNavigate}],editorProps:{$blockScrolling:1/0},ref:this.AceEditor,markers:this.getMarkers(),fontSize:17,height:"100%",highlightActiveLine:!1,mode:"javascript",onChange:this.onChangeMethod,onCursorChange:this.onCursorChange,onSelectionChange:this.onSelectionChange,readOnly:this.props.isEditorReadonly,theme:"source",value:this.props.editorValue,width:"100%",setOptions:{fontFamily:"'Inconsolata', 'Consolas', monospace"}})})})}}const p={goGreen:()=>{}};var g=h,m=(s(607),s(27));const b={evaluate:{win:"Shift-Enter",mac:"Shift-Enter"},navigate:{win:"Ctrl-B",mac:"Command-B"},refactor:{win:"Ctrl-M",mac:"Command-M"},highlightScope:{win:"Ctrl-Shift-H",mac:"Command-Shift-H"},typeInferenceDisplay:{win:"Ctrl-Shift-M",mac:"Command-Shift-M"}};var j=s(1304),y=s(510),O=s.n(y),f=s(221);var v=(e,t,s,a)=>{const n=r.useRef(e);n.current=e;const{editorSessionId:i}=e;r.useEffect((()=>{if(!i)return;const e=a.current.editor,t=new O.a(i,{WsUrl:Object(f.c)(i,!0),pluginWsUrl:null,namespace:"sa"});t.on("ready",(()=>{t.add(e,[],[]),n.current.handleSetSharedbConnected(!0)})),t.on("error",((e,t)=>{console.error("ShareAce error",t),j.a(t)}));const s=t.WS;let r;return r=setInterval((async()=>{if(null!==t)try{await Object(f.a)(i)||(clearInterval(r),s.close())}catch{s.reconnect()}}),5e3),s.addEventListener("open",(()=>{n.current.handleSetSharedbConnected(!0)})),s.addEventListener("close",(()=>{n.current.handleSetSharedbConnected(!1)})),()=>{clearInterval(r);for(const e of Object.values(t.connections))e.unlisten();t.WS.close()}}),[i,a])},x=s(227),C=s(150);const S=["onSelectionChange","onCursorChange","onInput","onLoad","onValidate","onBeforeLoad","onChange","onSelection","onCopy","onPaste","onFocus","onBlur","onScroll"],w={goGreen:()=>{}},E=r.memo((e=>{const t=r.useRef(null),s=r.useRef(e.handleEditorUpdateBreakpoints),n=r.useRef(e.handlePromptAutocomplete);r.useEffect((()=>{s.current=e.handleEditorUpdateBreakpoints,n.current=e.handlePromptAutocomplete}),[e.handleEditorUpdateBreakpoints,e.handlePromptAutocomplete]),r.useEffect((()=>(/iPhone|iPad|iPod/.test(navigator.userAgent)&&(document.body.style.position="fixed",document.body.style.width="100%"),()=>{document.body.style.position="",document.body.style.width=""})),[]);const[i,o,d]=[e.sourceChapter||m.Chapter.CALC,e.sourceVariant||m.Variant.DEFAULT,e.externalLibraryName||"NONE"];Object(x.b)(i,o,d),r.useLayoutEffect((()=>{if(!t.current)return;const e=t.current.editor,i=e.getSession();var r,o;e.on("gutterclick",(r=function(){return s.current(...arguments)},e=>{const t=e.domEvent.target;if(-1===t.className.indexOf("ace_gutter-cell")||!e.editor.isFocused()||e.clientX>35+t.getBoundingClientRect().left)return;const s=e.getDocumentPosition().row,a=e.editor.session.getLine(s);void 0!==e.editor.session.getBreakpoints()[s]||0===a.length||a.includes("//")||a.includes("debugger;")?e.editor.session.clearBreakpoint(s):e.editor.session.setBreakpoint(s,void 0),e.stop(),r(e.editor.session.getBreakpoints())})),i.on("changeAnnotation",(e=>()=>{const t=e.getAnnotations();let s=0;for(const e of t)"info"===e.type&&(e.type="error",e.className="ace_error",s++);0!==s&&e.setAnnotations(t)})(i)),Object(a.require)("ace/ext/language_tools").setCompleters([(o=function(){return n.current(...arguments)},{getCompletions:(e,t,s,a,n)=>{a&&/\d/.test(a.charAt(0))?n():o(s.row+1,s.column,n)}})])}),[]),r.useLayoutEffect((()=>{if(!t.current)return;const s=e.newCursorPosition;var a,n;s&&(a=t.current.editor,n=s,a.selection.clearSelection(),a.moveCursorToPosition(n),a.renderer.showCursor(),a.renderer.scrollCursorIntoView(n,.5))}),[e.newCursorPosition]);const{handleUpdateHasUnsavedChanges:h,handleEditorValueChange:p,isEditorAutorun:g,handleEditorEval:j}=e,y={evaluate:j},O={className:"react-ace",editorProps:{$blockScrolling:1/0},markers:r.useMemo((()=>e.highlightedLines.map((e=>({startRow:e[0],startCol:0,endRow:e[1],endCol:1,className:"myMarker",type:"fullLine"})))),[e.highlightedLines]),fontSize:17,height:"100%",highlightActiveLine:!1,mode:Object(x.a)(i,o,d),theme:"source",value:e.editorValue,width:"100%",setOptions:{enableBasicAutocompletion:!0,enableLiveAutocompletion:!0,fontFamily:"'Inconsolata', 'Consolas', monospace"},keyboardHandler:e.editorBinding},[f]=r.useState(e.hooks);if(f)for(const a of f)a(e,O,y,t);const v=O.onChange;return O.onChange=r.useCallback(((e,s)=>{if(!t.current)return;p(e),h&&h(!0);const a=t.current.editor.getSession().getAnnotations();g&&0===a.length&&j(),v&&v(e,s)}),[p,h,g,v,j]),O.commands=Object.entries(y).filter((e=>{let[t,s]=e;return s})).map((e=>{let[t,s]=e;return{name:t,bindKey:b[t],exec:s}})),S.forEach((t=>{const s=e[t];if(s){const e=O[t];O[t]=e?function(){e(...arguments),s(...arguments)}:s}})),Object(u.jsx)(l.HotKeys,{className:"Editor bp4-card bp4-elevation-0",handlers:w,children:Object(u.jsx)("div",{className:"row editor-react-ace",children:Object(u.jsx)(c.a,{...O,ref:t})})})})),T=[v];var k=e=>{const[t]=r.useContext(C.b);return Object(u.jsx)(E,{...e,editorBinding:t.editorBinding,hooks:T})};const A=e=>({editorValue:e.value,...i.a.pick(e,"highlightedLines","breakpoints","newCursorPosition")});t.b=e=>{let t;if("sourcecast"===e.editorVariant){const{editorVariant:s,editorTabs:a,...n}=e;t=(e=>t=>Object(u.jsx)(g,{...e,...t}))(n)}else{const{editorVariant:s,editorTabs:a,...n}=e;t=(e=>t=>Object(u.jsx)(k,{...e,...t}))(n)}return t(e.editorTabs[0])}}},[[1292,1,2]]]);
//# sourceMappingURL=main.29be93b4.chunk.js.map